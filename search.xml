<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Dubbo LoadBalance è´Ÿè½½å‡è¡¡</title>
      <link href="/2023/03/05/Dubbo-LoadBalance-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
      <url>/2023/03/05/Dubbo-LoadBalance-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€è´Ÿè½½å‡è¡¡ç­–ç•¥æ¦‚è¿°"><a href="#ä¸€ã€è´Ÿè½½å‡è¡¡ç­–ç•¥æ¦‚è¿°" class="headerlink" title="ä¸€ã€è´Ÿè½½å‡è¡¡ç­–ç•¥æ¦‚è¿°"></a>ä¸€ã€è´Ÿè½½å‡è¡¡ç­–ç•¥æ¦‚è¿°</h2><p> å¤§éƒ¨åˆ†ä½¿ç”¨Dubboçš„äº’è”ç½‘åº”ç”¨ä¸­ï¼ŒæœåŠ¡æä¾›æ–¹åŸºæœ¬éƒ½æ˜¯ä»¥é›†ç¾¤çš„å½¢å¼æä¾›æ¥å£ï¼Œä¸ºäº†é¿å…å¤§é‡è¯·æ±‚ä¸€ç›´é›†ä¸­åœ¨ä¸€ä¸ªæˆ–è€…å‡ ä¸ªæœåŠ¡æä¾›æœºå™¨ä¸Šï¼Œä»è€Œä½¿è¿™äº›æœºå™¨è´Ÿè½½å‡é«˜æœ€åå½±å“æœåŠ¡å¥åº·çŠ¶æ€ï¼Œéœ€è¦åšä¸€å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚Dubboæä¾›äº†å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé»˜è®¤ä¸º<strong><em>random</em></strong>ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éšæœºé€‰æ‹©ä¸€å°æœåŠ¡æä¾›è€…çš„æœåŠ¡ã€‚</p><p> Dubboæä¾›çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>RandomLoadBalance    éšæœºç­–ç•¥</li><li>RoundRobinLoadBalance è½®è¯¢ç­–ç•¥</li><li>LeastActiveLoadBalance æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°</li><li>ConsistentHashLoadBalance ä¸€è‡´æ€§hashç­–ç•¥</li></ul><h2 id="äºŒã€RandomLoadBalance"><a href="#äºŒã€RandomLoadBalance" class="headerlink" title="äºŒã€RandomLoadBalance"></a>äºŒã€RandomLoadBalance</h2><p>  éšæœºç­–ç•¥æŒ‰ç…§æ¦‚ç‡è®¾ç½®æƒé‡ï¼Œæ¯”è¾ƒå‡åŒ€è€Œä¸”å¯ä»¥åŠ¨æ€è°ƒèŠ‚æä¾›è€…çš„æƒé‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">doSelect</span><span class="params">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> length = invokers.size(); <span class="comment">// è·å–ä¸ªæ•°</span></span><br><span class="line">      <span class="keyword">int</span> totalWeight = <span class="number">0</span>; <span class="comment">// The sum of weights</span></span><br><span class="line">      <span class="keyword">boolean</span> sameWeight = <span class="keyword">true</span>; <span class="comment">// Every invoker has the same weight?</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">          <span class="comment">//è®¡ç®—æƒé‡</span></span><br><span class="line">          <span class="keyword">int</span> weight = getWeight(invokers.get(i), invocation);</span><br><span class="line">          totalWeight += weight; <span class="comment">// Sum</span></span><br><span class="line">          <span class="keyword">if</span> (sameWeight &amp;&amp; i &gt; <span class="number">0</span> <span class="comment">// ä¸ä¸‹ä¸€ä¸ªçš„invokerçš„æƒé‡ä¸ç›¸ç­‰</span></span><br><span class="line">                  &amp;&amp; weight != getWeight(invokers.get(i - <span class="number">1</span>), invocation)) &#123;</span><br><span class="line">              sameWeight = <span class="keyword">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å½“æ‹¥æœ‰ä¸åŒæƒé‡çš„invokerçš„æ—¶å€™</span></span><br><span class="line">      <span class="keyword">if</span> (totalWeight &gt; <span class="number">0</span> &amp;&amp; !sameWeight) &#123;</span><br><span class="line">          <span class="comment">// If (not every invoker has the same weight &amp; at least one invoker's weight&gt;0), </span></span><br><span class="line">        <span class="comment">// select randomly based on totalWeight.</span></span><br><span class="line">          <span class="keyword">int</span> offset = random.nextInt(totalWeight);<span class="comment">// åœ¨æ‰€æœ‰æƒé‡ä¸­é€‰æ‹©ä¸€ä¸ª æ•°</span></span><br><span class="line">          <span class="comment">// Return a invoker based on the random value.</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line"></span><br><span class="line">              <span class="comment">//ä½¿ç”¨ éšæœºå‡ºæ¥çš„è¿™ä¸ª offset - invokerçš„æƒé‡å€¼</span></span><br><span class="line">              offset -= getWeight(invokers.get(i), invocation);</span><br><span class="line">              <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="comment">// å°äº0 çš„æ—¶å€™å°±è¿”å›å½“å‰è¿™ä¸ªinvoker</span></span><br><span class="line">                  <span class="keyword">return</span> invokers.get(i);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// If all invokers have the same weight value or totalWeight=0, return evenly.</span></span><br><span class="line">      <span class="comment">// åœ¨é›†åˆä¸‹æ ‡ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªä¸‹æ ‡</span></span><br><span class="line">      <span class="keyword">return</span> invokers.get(random.nextInt(length));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>length</code> è·å–æ‰€æœ‰invokerä¸ªæ•°ï¼Œ é€šè¿‡invokerä¸ªæ•°å¾ªç¯è®¡ç®—<code>totalWeight</code> æ€»æƒé‡ï¼Œè·å–ä¸€ä¸ª<strong>[0,totalWeight)</strong>åŒºé—´å†…çš„éšæœºæ•°ï¼Œå†è¿›è¡Œä¸€ä¸ªå‡æ³•è·å–å¯¹åº”çš„invokerã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// é€šè¿‡å‚æ•°weightæŒ‡å®šæƒé‡</span></span><br><span class="line">       <span class="keyword">int</span> weight = invoker.getUrl().getMethodParameter(invocation.getMethodName(), <span class="string">"weight"</span>, <span class="number">100</span>);</span><br><span class="line">       <span class="keyword">if</span> (weight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">long</span> timestamp = invoker.getUrl().getParameter(<span class="string">"remote.timestamp"</span>, <span class="number">0L</span>);</span><br><span class="line">           <span class="keyword">if</span> (timestamp &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">               <span class="keyword">int</span> uptime = (<span class="keyword">int</span>)(System.currentTimeMillis() - timestamp);</span><br><span class="line">             <span class="comment">// è®¾ç½®é¢„çƒ­æ—¶é—´</span></span><br><span class="line">               <span class="keyword">int</span> warmup = invoker.getUrl().getParameter(<span class="string">"warmup"</span>, <span class="number">600000</span>);</span><br><span class="line">               <span class="keyword">if</span> (uptime &gt; <span class="number">0</span> &amp;&amp; uptime &lt; warmup) &#123;</span><br><span class="line">                   weight = calculateWarmupWeight(uptime, warmup, weight);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> weight;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡getWeightæ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æƒé‡ä¸º100ï¼Œå¯ä»¥è‡ªå®šä¹‰æŒ‡å®šæƒé‡å’Œé¢„çƒ­æ—¶é—´ã€‚</p><h2 id="ä¸‰ã€RoundRobinLoadBalance"><a href="#ä¸‰ã€RoundRobinLoadBalance" class="headerlink" title="ä¸‰ã€RoundRobinLoadBalance"></a>ä¸‰ã€RoundRobinLoadBalance</h2><p>è½®è¯¢ï¼ŒæŒ‰ç…§å…¬çº¦ä¹‹åçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ã€‚å­˜åœ¨æ‰§è¡Œæ¯”è¾ƒæ…¢çš„æœåŠ¡æä¾›è€…å †ç§¯è¯·æ±‚çš„æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ç¼“å­˜   key =æ¥å£å…¨ç±»å.æ–¹æ³•å      value = map&lt;æ¯ä¸ªinvokerçš„æ ‡è¯†ï¼ŒWeightedRoundRobin &gt;</span></span><br><span class="line">  <span class="keyword">private</span> ConcurrentMap&lt;String, ConcurrentMap&lt;String, WeightedRoundRobin&gt;&gt; methodWeightMap = <span class="keyword">new</span> ConcurrentHashMap&lt;String, ConcurrentMap&lt;String, WeightedRoundRobin&gt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> AtomicBoolean updateLock = <span class="keyword">new</span> AtomicBoolean();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> RECYCLE_PERIOD = <span class="number">60000</span>; <span class="comment">// æ›´æ–°å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">doSelect</span><span class="params">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> </span>&#123;</span><br><span class="line">      <span class="comment">/// ç»„è£…key = æ¥å£å…¨ç±»å.æ–¹æ³•å</span></span><br><span class="line">      String key = invokers.get(<span class="number">0</span>).getUrl().getServiceKey() + <span class="string">"."</span> + invocation.getMethodName();</span><br><span class="line">      <span class="comment">// æ ¹æ®key ä»ç¼“å­˜ä¸­è·å–</span></span><br><span class="line">      ConcurrentMap&lt;String, WeightedRoundRobin&gt; map = methodWeightMap.get(key);</span><br><span class="line">      <span class="comment">// å¤„ç†æ˜¯ç©ºçš„æƒ…å†µï¼Œå¦‚æœä¸ºç©ºå°±åˆ›å»º ç„¶åå¡è¿›å»</span></span><br><span class="line">      <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">          methodWeightMap.putIfAbsent(key, <span class="keyword">new</span> ConcurrentHashMap&lt;String, WeightedRoundRobin&gt;());</span><br><span class="line">          map = methodWeightMap.get(key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">int</span> totalWeight = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//åˆå§‹åŒ–max ä¸ºlongæœ€å°å€¼</span></span><br><span class="line">      <span class="keyword">long</span> maxCurrent = Long.MIN_VALUE;</span><br><span class="line">      <span class="comment">// è·å–ç³»ç»Ÿå½“å‰æ—¶é—´</span></span><br><span class="line">      <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">      Invoker&lt;T&gt; selectedInvoker = <span class="keyword">null</span>;</span><br><span class="line">      WeightedRoundRobin selectedWRR = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†invokers</span></span><br><span class="line">      <span class="keyword">for</span> (Invoker&lt;T&gt; invoker : invokers) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å°†url è½¬æˆ èº«ä»½æ ‡è¯†</span></span><br><span class="line">          String identifyString = invoker.getUrl().toIdentityString();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä»mapä¸­è·å–</span></span><br><span class="line">          WeightedRoundRobin weightedRoundRobin = map.get(identifyString);</span><br><span class="line">          <span class="comment">// è®¡ç®—æƒé‡</span></span><br><span class="line">          <span class="keyword">int</span> weight = getWeight(invoker, invocation);</span><br><span class="line">          <span class="keyword">if</span> (weight &lt; <span class="number">0</span>) &#123;<span class="comment">// å¦‚æœè®¡ç®—çš„æƒé‡å°äº0 ï¼Œ è®¾ç½®æˆ0</span></span><br><span class="line">              weight = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (weightedRoundRobin == <span class="keyword">null</span>) &#123;<span class="comment">// æ²¡æœ‰è·å–åˆ°ï¼Œè¯´æ˜æ²¡æœ‰ç¼“å­˜</span></span><br><span class="line">              weightedRoundRobin = <span class="keyword">new</span> WeightedRoundRobin();<span class="comment">//åˆ›å»ºWeightedRoundRobinå¯¹è±¡</span></span><br><span class="line">              weightedRoundRobin.setWeight(weight);<span class="comment">// è®¾ç½®æƒé‡</span></span><br><span class="line">              <span class="comment">// å°†WeightedRoundRobin å¯¹è±¡å¡åˆ° mapä¸­</span></span><br><span class="line">              map.putIfAbsent(identifyString, weightedRoundRobin);</span><br><span class="line">              weightedRoundRobin = map.get(identifyString);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//å¦‚æœå½“å‰è®¡ç®—çš„æƒé‡ä¸ä¹‹å‰ç¼“å­˜çš„æ¯”åŒ¹é…å°±è®¾ç½®æˆå½“å‰æƒé‡</span></span><br><span class="line">          <span class="keyword">if</span> (weight != weightedRoundRobin.getWeight()) &#123;</span><br><span class="line">              <span class="comment">//weight changed</span></span><br><span class="line">              weightedRoundRobin.setWeight(weight);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å°†æƒé‡å€¼è®¾ç½®åˆ°atomiclong ä¸­ current += weight</span></span><br><span class="line">          <span class="keyword">long</span> cur = weightedRoundRobin.increaseCurrent();</span><br><span class="line">          <span class="comment">// è®¾ç½®æœ€åä¿®æ”¹æ—¶é—´</span></span><br><span class="line">          weightedRoundRobin.setLastUpdate(now);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å¦‚æœå½“å‰æƒé‡ &gt; max</span></span><br><span class="line">          <span class="keyword">if</span> (cur &gt; maxCurrent) &#123;</span><br><span class="line">              maxCurrent = cur;<span class="comment">// max è®¾ç½®æˆèµ‹å€¼ä¸ºå½“å‰æƒé‡</span></span><br><span class="line">              selectedInvoker = invoker;</span><br><span class="line">              selectedWRR = weightedRoundRobin;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// æ€»æƒé‡+ å½“å‰æƒé‡</span></span><br><span class="line">          totalWeight += weight;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®RECYCLE_PERIODæ—¶é—´ æ›´æ–°map ä¸€èˆ¬å‘ç”Ÿåœ¨æœåŠ¡æä¾›è€…æ•°é‡å˜æ›´</span></span><br><span class="line">      <span class="comment">// æ²¡æœ‰åœ¨ä¿®æ”¹çš„ &amp;&amp; å½“å‰æ‰€æœ‰çš„invoker åˆ—è¡¨å¤§å° ä¸ç­‰äº ç¼“å­˜é‡Œé¢çš„å¤§å°</span></span><br><span class="line">      <span class="keyword">if</span> (!updateLock.get() &amp;&amp; invokers.size() != map.size()) &#123;</span><br><span class="line">          <span class="keyword">if</span> (updateLock.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) &#123;<span class="comment">// cas æ“ä½œ</span></span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                  <span class="comment">// copy -&gt; modify -&gt; update reference</span></span><br><span class="line">                  ConcurrentMap&lt;String, WeightedRoundRobin&gt; newMap = <span class="keyword">new</span> ConcurrentHashMap&lt;String, WeightedRoundRobin&gt;();</span><br><span class="line">                  newMap.putAll(map);<span class="comment">// å°†mapæ·»åŠ åˆ° newMapä¸­</span></span><br><span class="line">                  Iterator&lt;Entry&lt;String, WeightedRoundRobin&gt;&gt; it = newMap.entrySet().iterator();</span><br><span class="line">                  <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                      Entry&lt;String, WeightedRoundRobin&gt; item = it.next();</span><br><span class="line">                      <span class="comment">// ç§»é™¤ 1åˆ†é’Ÿæ²¡æœ‰æ”¹åŠ¨è¿‡çš„</span></span><br><span class="line">                      <span class="keyword">if</span> (now - item.getValue().getLastUpdate() &gt; RECYCLE_PERIOD) &#123;</span><br><span class="line">                          it.remove();</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;<span class="comment">// æ›¿æ¢æˆæ–°çš„</span></span><br><span class="line">                  methodWeightMap.put(key, newMap);</span><br><span class="line">              &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                  updateLock.set(<span class="keyword">false</span>);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (selectedInvoker != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">// å°†é€‰ä¸­çš„é‚£ä¸ªweightedRoundRobin é‡Œé¢çš„æƒé‡ï¼ˆcurrentï¼‰è®¾ç½®ä¸ºå½“å‰å€¼å‡å»æ€»æƒé‡</span></span><br><span class="line">          selectedWRR.sel(totalWeight); <span class="comment">// current -= totalWeight </span></span><br><span class="line">          <span class="keyword">return</span> selectedInvoker;<span class="comment">// è¿”å›é€‰ä¸­çš„é‚£ä¸ªinvoker</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/// æœ€åå°±æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ª</span></span><br><span class="line">      <span class="comment">// should not happen here</span></span><br><span class="line">      <span class="keyword">return</span> invokers.get(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>â€‹    è½®è¯¢ç®—æ³•é€šè¿‡ä¸æ–­æ›´æ–°<code>weightedRoundRobin</code> å¯¹è±¡ä¸­çš„<code>current</code>å­—æ®µæ¥è°ƒæ•´æ¥ä¸‹æ¥è°ƒç”¨è¦é€‰å–çš„invokerï¼Œå‡å¦‚æˆ‘ä»¬å°†æ‰€æœ‰invokerçš„æƒé‡è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œé‚£ä¹ˆloadbalanceå°†ä¼šæŒ‰ç…§é¡ºåºçš„æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (selectedInvoker != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å°†é€‰ä¸­çš„é‚£ä¸ªweightedRoundRobin é‡Œé¢çš„æƒé‡ï¼ˆcurrentï¼‰è®¾ç½®ä¸ºå½“å‰å€¼å‡å»æ€»æƒé‡</span></span><br><span class="line">    selectedWRR.sel(totalWeight); <span class="comment">// current -= totalWeight </span></span><br><span class="line">    <span class="keyword">return</span> selectedInvoker;<span class="comment">// è¿”å›é€‰ä¸­çš„é‚£ä¸ªinvoker</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>currentWeightçš„æ›´æ–°æ˜¯å®ç°è½®è¯¢çš„å…³é”®å¤„ç†é€»è¾‘ã€‚</p><h2 id="å››ã€LeastActiveLoadBalance"><a href="#å››ã€LeastActiveLoadBalance" class="headerlink" title="å››ã€LeastActiveLoadBalance"></a>å››ã€LeastActiveLoadBalance</h2><p>â€‹    æœ€å°‘æ´»è·ƒè°ƒç”¨ç­–ç•¥ï¼Œåœ¨äº†è§£æœ€å°æ´»è·ƒè°ƒç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ä¹‹å‰éœ€è¦äº†è§£è´Ÿè½½å‡è¡¡ä¸­è·å–invokeræ´»è·ƒæ•°çš„æ–¹æ³•ã€‚å³é€šè¿‡<code>ActiveLimitFilter</code>è·å–çš„invokerçš„æ´»è·ƒæƒ…å†µã€‚</p><h3 id="com-alibaba-dubbo-rpc-RpcStatus"><a href="#com-alibaba-dubbo-rpc-RpcStatus" class="headerlink" title="com.alibaba.dubbo.rpc.RpcStatus"></a>com.alibaba.dubbo.rpc.RpcStatus</h3><p>è¿™é‡Œä¸åšè¯¦ç»†åˆ†æï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨<code>RpcStatus</code>ä¸­ç»´æŠ¤äº†ä¸€ä¸ªåŸå­ç±»å‹çš„<code>active</code>å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºinvokerçš„å¹¶å‘æƒ…å†µã€‚</p><p>åœ¨invokerè¢«è°ƒç”¨çš„å‰åå¯¹å­—æ®µ<code>active</code>è¿›è¡Œæ“ä½œï¼Œå³ï¼š</p><p>invokerè°ƒç”¨å¼€å§‹ï¼Œé€šè¿‡<code>com.alibaba.dubbo.rpc.RpcStatus#beginCount</code>ä½¿active + 1</p><p>invokerè°ƒç”¨ç»“æŸï¼Œé€šè¿‡<code>com.alibaba.dubbo.rpc.RpcStatus#endCount</code>ä½¿active - 1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">doSelect</span><span class="params">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Number of invokers</span></span><br><span class="line">        <span class="keyword">int</span> length = invokers.size();</span><br><span class="line">        <span class="comment">// æœ€æ´»è·ƒåˆå§‹å€¼æ˜¯-1</span></span><br><span class="line">        <span class="keyword">int</span> leastActive = -<span class="number">1</span>; </span><br><span class="line">        <span class="comment">//å…·æœ‰ç›¸åŒçš„æœ€å°æ´»åŠ¨å€¼çš„è°ƒç”¨ç¨‹åºçš„æ•°é‡(leastActive)</span></span><br><span class="line">        <span class="keyword">int</span> leastCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] leastIndexs = <span class="keyword">new</span> <span class="keyword">int</span>[length]; </span><br><span class="line">        <span class="comment">// æƒé‡å’Œ</span></span><br><span class="line">        <span class="keyword">int</span> totalWeight = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//åˆå§‹å€¼</span></span><br><span class="line">        <span class="keyword">int</span> firstWeight = <span class="number">0</span>;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">boolean</span> sameWeight = <span class="keyword">true</span>; </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            Invoker&lt;T&gt; invoker = invokers.get(i);</span><br><span class="line">            <span class="comment">// è·å–å½“å‰è¿™ä¸ªinvokerå¹¶å‘æ•°</span></span><br><span class="line">            <span class="keyword">int</span> active = RpcStatus.getStatus(invoker.getUrl(), invocation.getMethodName()).getActive(); </span><br><span class="line">            <span class="comment">// è·å–æƒé‡</span></span><br><span class="line">            <span class="keyword">int</span> afterWarmup = getWeight(invoker, invocation); <span class="comment">// Weight</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç¬¬ä¸€ä¸ªå…ƒç´ çš„åæˆ–è€… å½“å‰invokerå¹¶å‘æ•° å°äº æœ€å°å¹¶å‘æ•°ï¼ˆåˆå§‹å€¼æ˜¯-1ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (leastActive == -<span class="number">1</span> || active &lt; leastActive) &#123; </span><br><span class="line">                <span class="comment">// è®°å½•leastActive ä¸ºå½“å‰çš„æ´»è·ƒæ•°</span></span><br><span class="line">                leastActive = active;</span><br><span class="line">                <span class="comment">//é‡ç½®æœ€å°è®¡æ•°ï¼ŒåŸºäºå½“å‰æœ€å°è®¡æ•°é‡æ–°è®¡æ•°</span></span><br><span class="line">                leastCount = <span class="number">1</span>;</span><br><span class="line">                <span class="comment">//åœ¨0ä¸‹æ ‡å‡ºæ”¾å…¥è¿™ä¸ªç´¢å¼•</span></span><br><span class="line">                leastIndexs[<span class="number">0</span>] = i; <span class="comment">// Reset</span></span><br><span class="line">                <span class="comment">// æ€»æƒé‡å°±æ˜¯ å½“å‰invokerçš„æƒé‡</span></span><br><span class="line">                totalWeight = afterWarmup; </span><br><span class="line">                <span class="comment">//ç¬¬ä¸€ä¸ªæƒé‡</span></span><br><span class="line">                firstWeight = afterWarmup;</span><br><span class="line">                sameWeight = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (active == leastActive) &#123; <span class="comment">// å½“å‰invokerçš„æ´»è·ƒæ•° ä¸ leastActiveç›¸ç­‰</span></span><br><span class="line">                <span class="comment">// è®°å½•ç´¢å¼•ä½ç½®ï¼Œå…·æœ‰ç›¸åŒæœ€å°æ´»è·ƒæ•°çš„è®¡æ•°å™¨ +1</span></span><br><span class="line">                leastIndexs[leastCount++] = i;</span><br><span class="line">                <span class="comment">//æ€»æƒé‡ =  æ€»æƒé‡+å½“å‰æƒé‡</span></span><br><span class="line">                totalWeight += afterWarmup; <span class="comment">// Add this invoker's weight to totalWeight.</span></span><br><span class="line">                <span class="keyword">if</span> (sameWeight &amp;&amp; i &gt; <span class="number">0</span></span><br><span class="line">                        &amp;&amp; afterWarmup != firstWeight) &#123;</span><br><span class="line">                    sameWeight = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leastCount == <span class="number">1</span>) &#123;<span class="comment">//å¦‚æœæˆ‘ä»¬æ°å¥½æœ‰ä¸€ä¸ªè°ƒç”¨ç¨‹åºå…·æœ‰æœ€å°‘çš„æ´»åŠ¨å€¼ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›è¿™ä¸ªè°ƒç”¨ç¨‹åºã€‚</span></span><br><span class="line">            <span class="keyword">return</span> invokers.get(leastIndexs[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ¯ä¸ªinvokeræœ‰ä¸åŒçš„æƒé‡ &amp;&amp;  totalWeight &gt; 0</span></span><br><span class="line">        <span class="keyword">if</span> (!sameWeight &amp;&amp; totalWeight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// åœ¨totalWeight èŒƒå›´å†…éšæœºä¸€ä¸ªå€¼</span></span><br><span class="line">            <span class="keyword">int</span> offsetWeight = random.nextInt(totalWeight) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; leastCount; i++) &#123;</span><br><span class="line">                <span class="comment">// è·å–iä½ç½®çš„é‚£ä¸ªæœ€å°æ´»è·ƒ åœ¨invokers é‡Œé¢çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">int</span> leastIndex = leastIndexs[i];</span><br><span class="line">                <span class="comment">//offsetWeight - leastIndex ä½ç½®invokerçš„æƒé‡</span></span><br><span class="line">                offsetWeight -= getWeight(invokers.get(leastIndex), invocation);</span><br><span class="line">                <span class="comment">// offsetWeight å°äº0çš„è¯</span></span><br><span class="line">                <span class="keyword">if</span> (offsetWeight &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="comment">// è¿”å›è¿™ä¸ªä½ç½®çš„è¿™ä¸ª</span></span><br><span class="line">                    <span class="keyword">return</span> invokers.get(leastIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…·æœ‰ç›¸åŒæƒé‡æˆ–è€…æ˜¯ æ€»æƒé‡=0 çš„è¯å°±å‡åŒ€è¿”å›</span></span><br><span class="line">        <span class="comment">// If all invokers have the same weight value or totalWeight=0, return evenly.</span></span><br><span class="line">        <span class="keyword">return</span> invokers.get(leastIndexs[random.nextInt(leastCount)]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ€å°æ´»è·ƒç®—æ³•å¾ˆå¥½ç†è§£ï¼Œç¬¬ä¸€ä¸ªåˆ¤æ–­é€»è¾‘<code>leastActive == -1 || active &lt; leastActive</code>ä¼šå¤„ç†ç¬¬ä¸€ä¸ªinvokeræˆ–è€…æ˜¯æœ€ä¸æ´»è·ƒçš„ä¸€ä¸ªinvokerï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åˆ°æ•°ç»„ä¸‹æ ‡ä¸º0çš„ä½ç½®ä¸Šã€‚ä¹Ÿå°±æ˜¯å¾ªç¯è¿‡ç¨‹ä¸­ä¼šå¾—åˆ°ä¸€ä¸ª<code>leastIndexs</code>æ•°ç»„ï¼Œè®°å½•äº†å½“å‰æœ€ä¸æ´»è·ƒçš„invoker listã€‚</p><p>åé¢çš„å¤„ç†å°±æ˜¯åˆ¤æ–­å½“å‰çš„listä¸­æ˜¯å¦æœ‰å¤šä¸ªinvokeræˆ–è€…å­˜åœ¨ä¸åŒæƒé‡çš„æƒ…å†µï¼Œè¿™é‡Œçš„invokeré€‰å–å°±å’Œ<code>RandomLoadBalance</code>é€»è¾‘å®Œå…¨ä¸€è‡´ã€‚</p><h2 id="äº”ã€ConsistentHashLoadBalance"><a href="#äº”ã€ConsistentHashLoadBalance" class="headerlink" title="äº”ã€ConsistentHashLoadBalance"></a>äº”ã€ConsistentHashLoadBalance</h2><p>â€‹    åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡Hashç®—æ³•è®©å›ºå®šçš„ä¸€éƒ¨åˆ†è¯·æ±‚è½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¯å°æœåŠ¡å™¨å°±ä¼šå›ºå®šå¤„ç†ä¸€éƒ¨åˆ†è¯·æ±‚ï¼Œä»è€Œèµ·åˆ°è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚</p><p>â€‹    ä½†æ˜¯æ™®é€šçš„Hashç®—æ³•ç¼ºä¹ä¼¸ç¼©æ€§ï¼Œå½“æ–°å¢æˆ–è€…ä¸‹çº¿æœåŠ¡å™¨æœºå™¨æ—¶ï¼Œç®€å•é€šè¿‡æ•£åˆ—çš„æ–¹å¼å»è´Ÿè½½å‡è¡¡å°±ä¼šå¯¼è‡´åŸæœ‰çš„æ˜ å°„å…³ç³»å¤§é‡å¤±æ•ˆã€‚<strong>ä¸€è‡´æ€§Hash</strong>åˆ™é€šè¿‡Hashç¯è¿›è¡Œäº†ä¼˜åŒ–ä¿®æ”¹ã€‚</p><h3 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h3><p>é¦–å…ˆå‡è®¾å­˜åœ¨4å°æœåŠ¡å™¨åˆ†åˆ«ä¸ºIp1-4:</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311165622760.png" alt="image-20230311165622760"></p><p>è®¡ç®—å››å°æœåŠ¡å™¨ipåœ°å€å¯¹åº”çš„Hashå€¼ï¼Œè®¡ç®—å‡ºæ¥çš„Hashå€¼æ—¶0ï½æœ€å¤§æ­£æ•´æ•°ä¹‹é—´çš„ä¸€ä¸ªå€¼ï¼Œå¯¹åº”hashç¯ä¸Šçš„ä½ç½®å¦‚ä¸Šå›¾æ‰€ç¤ºğŸ‘†</p><p>å½“ç”¨æˆ·åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®hashè®¡ç®—è·¯ç”±è§„åˆ™ï¼Œè®¡ç®—å‡ºä¸€ä¸ªHashå€¼ï¼Œç„¶åçœ‹è¿™ä¸ªHashå€¼è½åœ¨äº†Hashç¯çš„å“ªä¸ªåœ°æ–¹ï¼Œå†æ ¹æ®Hashå€¼åœ¨Hashç¯ä¸Šçš„ä½ç½®é¡ºæ—¶é’ˆæ‰¾åˆ°è·ç¦»æœ€è¿‘çš„IPä½œä¸ºè·¯ç”±IPã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311165650267.png" alt="image-20230311165650267"></p><p>å‡è®¾æ­¤æ—¶ip3æœºå™¨å®•æœº,é‚£ä¹ˆæ­¤æ—¶çš„è¯·æ±‚åˆ†å¸ƒæƒ…å†µåº”è¯¥æ˜¯è¿™æ ·çš„ğŸ‘‡ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311170323499.png" alt="image-20230311170323499"></p><p>åŸæœ¬çš„u1è¯·æ±‚ä¼šä»åŸæ¥çš„ip3æœºå™¨é‡æ–°åˆ†é…åˆ°ip4æœºå™¨ä¸Šï¼Œè€Œä¹‹å‰æ²¡æœ‰åˆ†é…åˆ°ip3æœºå™¨ä¸Šçš„è¯·æ±‚ä¸ä¼šå—åˆ°å½±å“ã€‚</p><p>å‡è®¾æˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªip5çš„æœºå™¨ï¼Œè¿™ä¸ªæœºå™¨åœ¨hashç¯ä¸Šçš„ä½ç½®åœ¨ip2å’Œip3ä¹‹é—´ï¼Œé‚£ä¹ˆåœ¨ç¯ä¸Šçš„åˆ†å¸ƒæƒ…å†µåº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤ºğŸ‘‡ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311171214857.png" alt="image-20230311171214857"></p><p>æ–°å¢åŠ çš„ip5çš„æœºå™¨ä¼šåˆ†æ‘Šä¸€éƒ¨åˆ†ip3çš„æœºå™¨çš„è¯·æ±‚ï¼Œå¦‚æœu1çš„è¯·æ±‚åœ¨ip5å’Œip2ä¹‹é—´ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šé‡æ–°åˆ†é…åˆ°ip5æœºå™¨ä¸Šå¤„ç†ã€‚</p><h3 id="ä¸€è‡´æ€§Hashçš„ç‰¹æ€§"><a href="#ä¸€è‡´æ€§Hashçš„ç‰¹æ€§" class="headerlink" title="ä¸€è‡´æ€§Hashçš„ç‰¹æ€§"></a>ä¸€è‡´æ€§Hashçš„ç‰¹æ€§</h3><ul><li><strong>å•è°ƒæ€§ï¼ˆMonotonicityï¼‰</strong>ï¼šå•è°ƒæ€§æŒ‡åœ¨æ–°æœåŠ¡å™¨åŠ å…¥åˆ°ç³»ç»Ÿä¸­æ—¶ï¼Œåº”å½“ä¿è¯åŸæœ‰çš„è¯·æ±‚å¯ä»¥è¢«æ˜ å°„åˆ°åŸæœ‰å’Œæ–°å¢çš„æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸ä¼šæ˜ å°„åˆ°åŸæœ‰çš„å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚</li><li><strong>åˆ†æ•£æ€§ï¼ˆSpreadï¼‰</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚æ—¶å¯èƒ½ä¸çŸ¥é“æ‰€æœ‰æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œå¯èƒ½åªçŸ¥é“å…¶ä¸­ä¸€éƒ¨åˆ†æœåŠ¡å™¨ï¼Œä»å®¢æˆ·ç«¯çœ‹æ¥ï¼Œå®ƒçœ‹åˆ°çš„éƒ¨åˆ†æœåŠ¡å™¨ä¼šå½¢æˆä¸€ä¸ªå®Œæ•´çš„Hashç¯ã€‚å¦‚æœå¤šä¸ªå®¢æˆ·ç«¯éƒ½æŠŠéƒ¨åˆ†æœåŠ¡å™¨ä½œä¸ºä¸€ä¸ªå®Œæ•´Hashç¯ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚è¢«è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯åº”è¯¥é¿å…çš„ï¼Œå› ä¸ºå®ƒä¸èƒ½ä¿è¯åŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚è½åˆ°åŒä¸€å°æœåŠ¡å™¨ã€‚æ‰€è°“åˆ†æ•£æ€§æ˜¯æŒ‡ä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„ä¸¥é‡ç¨‹åº¦ã€‚</li><li><strong>å¹³è¡¡æ€§ï¼ˆBalanceï¼‰</strong>ï¼šå¹³è¡¡æ€§æŒ‡è´Ÿè½½å‡è¡¡ï¼ŒæŒ‡å®¢æˆ·ç«¯Hashåçš„è¯·æ±‚åº”è¯¥èƒ½åˆ†æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚</li></ul><h3 id="è™šæ‹ŸèŠ‚ç‚¹"><a href="#è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="è™šæ‹ŸèŠ‚ç‚¹"></a>è™šæ‹ŸèŠ‚ç‚¹</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311173641982.png" alt="image-20230311173641982"></p><p>å‡è®¾ç»è¿‡è®¡ç®—åçš„Hashå€¼åœ¨ç¯ä¸Šåˆ†å¸ƒä¸å‡åŒ€ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ä¸Šå›¾çš„æƒ…å†µï¼Œä¼šä½¿å¾—ip1æœºå™¨å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œè€Œip2å’Œip3åªä¼šè´Ÿè´£å°‘é‡çš„è¯·æ±‚ï¼Œè¿™æ ·å°±å‡ºç°äº†ä¸€è‡´æ€§Hashçš„å€¾æ–œã€‚</p><p>è§£å†³ä¸€è‡´æ€§Hashå€¾æ–œé—®é¢˜çš„è§£å†³æ–¹å¼ä¸€ç§æ˜¯ç®€å•ç²—æš´çš„åŠ æœºå™¨è§£å†³ï¼Œä½†æ˜¯å¢åŠ æœºå™¨æ˜¯æœ‰æˆæœ¬çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦è™šæ‹ŸèŠ‚ç‚¹æ¥è§£å†³ã€‚å¦‚å›¾ï¼Œæ¯å°æœºå™¨å¢åŠ ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ä¹‹åçš„ä¸€è‡´æ€§Hashç¯å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311174009199.png" alt="image-20230311174009199"></p><p>è¿™æ ·å°±ä½¿å¾—è¯·æ±‚ç›¸å¯¹å‡åŒ€çš„åˆ†å¸ƒåœ¨ä¸‰å°æœºå™¨ä¸Šã€‚</p><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">protected</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">doSelect</span><span class="params">(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation)</span> </span>&#123;</span><br><span class="line">     String methodName = RpcUtils.getMethodName(invocation);</span><br><span class="line">     <span class="comment">// æ‹¼æ¥key</span></span><br><span class="line">     String key = invokers.get(<span class="number">0</span>).getUrl().getServiceKey() + <span class="string">"."</span> + methodName;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// è®¡ç®—hash</span></span><br><span class="line">     <span class="keyword">int</span> identityHashCode = System.identityHashCode(invokers);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// æ ¹æ®key ä»ç¼“å­˜ä¸­è·å–ConsistentHashSelector</span></span><br><span class="line">     ConsistentHashSelector&lt;T&gt; selector = (ConsistentHashSelector&lt;T&gt;) selectors.get(key);</span><br><span class="line">     <span class="keyword">if</span> (selector == <span class="keyword">null</span> || selector.identityHashCode != identityHashCode) &#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// åˆ›å»ºConsistentHashSelector æ”¾å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">         selectors.put(key, <span class="keyword">new</span> ConsistentHashSelector&lt;T&gt;(invokers, methodName, identityHashCode));</span><br><span class="line">         <span class="comment">// è·å–æ–°çš„selector</span></span><br><span class="line">         selector = (ConsistentHashSelector&lt;T&gt;) selectors.get(key);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> selector.select(invocation);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸»è¦æ˜¯é€šè¿‡invokeræ¥è®¡ç®—è·å–å¯¹åº”çš„selectorï¼Œä¸»è¦çš„è´Ÿè½½å‡è¡¡é€»è¾‘åº”å½“éƒ½æ˜¯ç”±selectoræ¥å®ç°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   ConsistentHashSelectoræ„é€ æ–¹æ³•</span></span><br><span class="line">ConsistentHashSelector(List&lt;Invoker&lt;T&gt;&gt; invokers, String methodName, <span class="keyword">int</span> identityHashCode) &#123;</span><br><span class="line">            <span class="comment">// è™šæ‹Ÿçš„invoker</span></span><br><span class="line">            <span class="keyword">this</span>.virtualInvokers = <span class="keyword">new</span> TreeMap&lt;Long, Invoker&lt;T&gt;&gt;();</span><br><span class="line">            <span class="comment">// hashcode</span></span><br><span class="line">            <span class="keyword">this</span>.identityHashCode = identityHashCode;</span><br><span class="line">            <span class="comment">// è·å–url</span></span><br><span class="line">            URL url = invokers.get(<span class="number">0</span>).getUrl();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–hash.nodes ï¼Œç¼ºçœæ˜¯160 å¯ä»¥æŒ‡å®š</span></span><br><span class="line">            <span class="keyword">this</span>.replicaNumber = url.getMethodParameter(methodName, <span class="string">"hash.nodes"</span>, <span class="number">160</span>);</span><br><span class="line">            <span class="comment">// è·å–hash.arguments ç¼ºçœæ˜¯0 ç„¶åè¿›è¡Œåˆ‡å‰²</span></span><br><span class="line">            String[] index = Constants.COMMA_SPLIT_PATTERN.split(url.getMethodParameter(methodName, <span class="string">"hash.arguments"</span>, <span class="string">"0"</span>));</span><br><span class="line">            argumentIndex = <span class="keyword">new</span> <span class="keyword">int</span>[index.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index.length; i++) &#123;</span><br><span class="line">                argumentIndex[i] = Integer.parseInt(index[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (Invoker&lt;T&gt; invoker : invokers) &#123;</span><br><span class="line">                <span class="comment">// è·å–åœ°å€ åŒå±‚åµŒå¥—å¾ªç¯</span></span><br><span class="line">                String address = invoker.getUrl().getAddress();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; replicaNumber / <span class="number">4</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">byte</span>[] digest = md5(address + i);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; <span class="number">4</span>; h++) &#123;</span><br><span class="line">                        <span class="keyword">long</span> m = hash(digest, h);<span class="comment">//è®¡ç®—ä½ç½®</span></span><br><span class="line">                        virtualInvokers.put(m, invoker);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ˜¯å¯¹æ¯ä¸ªmethodåˆ›å»ºä¸€ä¸ª<code>virtualInvokers</code>çš„treeMapç”¨æ¥å­˜å‚¨è™šæ‹ŸèŠ‚ç‚¹ï¼Œkeyå°±æ˜¯è®¡ç®—å‡ºæ¥çš„hashå€¼ï¼Œvalueå°±æ˜¯invokerã€‚</p><blockquote><p>  è¿™é‡Œçš„åŒå±‚å¾ªç¯çš„å…·ä½“ç®—æ³•ï¼š</p><p>  <a href="https://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Consistent_hashing</a></p></blockquote><p><code>ConsistentHashSelector</code>çš„<code>invoker()</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Invoker&lt;T&gt; <span class="title">select</span><span class="params">(Invocation invocation)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// å°†å‚æ•°è½¬æˆkey</span></span><br><span class="line">          String key = toKey(invocation.getArguments());</span><br><span class="line">          <span class="keyword">byte</span>[] digest = md5(key);</span><br><span class="line">          <span class="keyword">return</span> selectForKey(hash(digest, <span class="number">0</span>));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> String <span class="title">toKey</span><span class="params">(Object[] args)</span> </span>&#123;</span><br><span class="line">          StringBuilder buf = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i : argumentIndex) &#123;</span><br><span class="line">              <span class="keyword">if</span> (i &gt;= <span class="number">0</span> &amp;&amp; i &lt; args.length) &#123;</span><br><span class="line">                  buf.append(args[i]);<span class="comment">// å‚æ•°</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> buf.toString();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> Invoker&lt;T&gt; <span class="title">selectForKey</span><span class="params">(<span class="keyword">long</span> hash)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//tailMap æ˜¯è¿”å›é”®å€¼å¤§äºæˆ–ç­‰äºkeyçš„é‚£éƒ¨åˆ† ï¼Œç„¶åå†å–ç¬¬ä¸€ä¸ª</span></span><br><span class="line">          Map.Entry&lt;Long, Invoker&lt;T&gt;&gt; entry = virtualInvokers.tailMap(hash, <span class="keyword">true</span>).firstEntry();</span><br><span class="line">          <span class="keyword">if</span> (entry == <span class="keyword">null</span>) &#123;<span class="comment">//å¦‚æœæ²¡æœ‰å–åˆ°çš„è¯å°±è¯´æ˜hashå°±æ˜¯æœ€å¤§çš„äº†ï¼Œä¸‹é¢é‚£ä¸ªå°±æ˜¯ treemap ç¬¬ä¸€ä¸ªäº†</span></span><br><span class="line">              entry = virtualInvokers.firstEntry();</span><br><span class="line">          &#125;<span class="comment">// è¿”å›å¯¹åº”çš„é‚£ä¸ªinvoker</span></span><br><span class="line">          <span class="keyword">return</span> entry.getValue();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯é€šè¿‡<code>tailMap()</code>æ–¹æ³•æ‰¾åˆ°è¿”å›é”®å€¼å¤§äºæˆ–ç­‰äºkeyçš„éƒ¨åˆ†ï¼Œç„¶é€šè¿‡<code>firstEntry()</code>å–ç¬¬ä¸€ä¸ªã€‚</p><h2 id="å…­ã€åŸºäºæ‰©å±•æ¥å£å®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#å…­ã€åŸºäºæ‰©å±•æ¥å£å®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="å…­ã€åŸºäºæ‰©å±•æ¥å£å®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>å…­ã€åŸºäºæ‰©å±•æ¥å£å®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h2><p>â€‹     è‡ªå®šä¹‰æ‰©å±•å®ç°ï¼Œé¦–å…ˆéœ€è¦å®ç°LoadBalanceæ¥å£ï¼Œç”±äºDubboæœ¬èº«æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»AbstractLoadBalanceï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿è¯¥ç±»å¹¶ä¸”å®ç°<code>doSelect()</code>æ–¹æ³•ï¼š<br><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230311182131266.png" alt="image-20230311182131266"></p><p>ä»¥ä¸Šï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lag Compensation - ç½‘ç»œæ¸¸æˆä¸­çš„å»¶è¿Ÿè¡¥å¿</title>
      <link href="/2023/02/05/Lag-Compensation-%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E4%B8%AD%E7%9A%84%E5%BB%B6%E8%BF%9F%E8%A1%A5%E5%81%BF/"/>
      <url>/2023/02/05/Lag-Compensation-%E7%BD%91%E7%BB%9C%E6%B8%B8%E6%88%8F%E4%B8%AD%E7%9A%84%E5%BB%B6%E8%BF%9F%E8%A1%A5%E5%81%BF/</url>
      
        <content type="html"><![CDATA[<h2 id="é›¶ã€The-Server-Is-The-Man"><a href="#é›¶ã€The-Server-Is-The-Man" class="headerlink" title="é›¶ã€The Server Is The Man"></a>é›¶ã€The Server Is The Man</h2><p>ç½‘ç»œæ¸¸æˆä¸­æœ‰ä¸€ä¸ªé“å¾‹ï¼š<strong>â€œThe Server Is The Manâ€</strong></p><blockquote><p>  <em>From the above, the serverâ€™s game state is completely and concisely defined by the set of all variables of all actors within a level. Because the server is authoritative about the game play flow, the serverâ€™s game state can always be regarded as the one true game state. The version of the game state on client machines should always be regarded as an approximation subject to many different kinds of deviations from the serverâ€™s game state. Actors that exist on the client machine should be considered proxies because they are a temporary, approximate representation of an object rather than the object itself.</em></p><p>  <em>When a client loads a Level to use in a networked multiplayer game, it deletes all Actors in the Level except those that have either bNoDelete set to true or bStatic set to true. Other Actors relevant to that client (as determined by the server) will be replicated from the server to the client. Some Actors (such as the GameInfo Actor) are never replicated to a client.</em></p><p>  <em>å‡ºè‡ªUnrealï¼ˆEpicè™šå¹»å¼•æ“ï¼‰<a href="https://docs.unrealengine.com/udk/Three/NetworkingOverview.html" target="_blank" rel="noopener">https://docs.unrealengine.com/udk/Three/NetworkingOverview.html</a></em></p></blockquote><p>å¤§æ„ä¸ºæœåŠ¡å™¨å³æœåŠ¡ç«¯å¯¹æ¸¸æˆæœ‰ç»å¯¹æƒå¨çš„æŒæ§ï¼Œæ¸¸æˆä¸­çš„ä¸€åˆ‡çŠ¶æ€éƒ½è¦ä»¥æœåŠ¡å™¨ä¸­æ‰€è®°å½•çš„ä¸ºå‡†ã€‚</p><h2 id="ä¸€ã€å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¸¸æˆæ¶æ„ï¼ˆClient-Server-Gameï¼‰"><a href="#ä¸€ã€å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¸¸æˆæ¶æ„ï¼ˆClient-Server-Gameï¼‰" class="headerlink" title="ä¸€ã€å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¸¸æˆæ¶æ„ï¼ˆClient/Server Gameï¼‰"></a>ä¸€ã€å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¸¸æˆæ¶æ„ï¼ˆClient/Server Gameï¼‰</h2><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/Lagcomp1.png" alt="Client/Server Game"></p><p>  ç›®å‰å¤§éƒ¨åˆ†åŠ¨ä½œæ¸¸æˆéƒ½æ˜¯ç»è¿‡ä¿®æ”¹åçš„ å®¢æˆ·ç«¯ / æœåŠ¡å™¨æ¸¸æˆï¼Œ ç±»ä¼¼ <code>Half-Life</code> åŠæ¡å‘½ç³»åˆ—ï¼Œä»¥åŠå…¶æ¨¡ç»„ï¼šå¤§åé¼é¼çš„<code>Conter-Strike åæç²¾è‹±</code>ç³»åˆ—ã€‚ </p><p>  åœ¨è¿™äº›æ¸¸æˆä¸­ï¼Œé€šå¸¸æœ‰å•ç‹¬çš„ä¸€ä¸ª<strong>æƒå¨ä¸»æœåŠ¡å™¨æ¥è¿è¡Œä¸»æ¸¸æˆé€»è¾‘</strong>ï¼Œä¸ºæ­¤<strong>é“¾æ¥ä¸€ä¸ªæˆ–å¤šä¸ªâ€œæ— çŸ¥â€çš„å®¢æˆ·ç«¯</strong>ï¼Œå®¢æˆ·ç«¯çš„æŒ‡è´£æœ€åˆä¸è¿‡æ˜¯æ”¶é›†ç”¨æˆ·è¾“å…¥çš„æŒ‡ä»¤ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°æœåŠ¡ç«¯ï¼›éšåæœåŠ¡ç«¯ä¼šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œç„¶åå°†æ‰§è¡Œç»“æœå‘é€ä¼šå®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å‘ˆç°å‡ºè¿è¡Œçš„ç»“æœï¼Œä¾‹å¦‚åœ¨æ¸¸æˆä¸­æ“çºµæ¸¸æˆäººç‰©å‰è¿›ï¼Œä¹Ÿéœ€è¦å®Œæˆè¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œå°†å‰è¿›å‘½ä»¤å‘å‘æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥å—å‰è¿›æŒ‡ä»¤ï¼Œå¤„ç†æŒ‡ä»¤ï¼Œå°†æ¸¸æˆäººç‰©å‰è¿›åçš„åæ ‡å‘å¾€å®¢æˆ·ç«¯ï¼Œè¿™æ ·æ“çºµæ¸¸æˆäººç‰©çš„ç©å®¶æ‰çœŸå®çš„çœ‹åˆ°æ¸¸æˆè§’è‰²å‘å‰èµ°äº†ä¸€æ­¥ã€‚</p><p> å½“ç„¶ï¼Œåœ¨çœŸå®çš„æ¸¸æˆç³»ç»Ÿä¸­éœ€è¦å¾ˆå¤šç»„ä»¶çš„é…åˆï¼Œè€Œä¸”ä¹Ÿéœ€è¦è€ƒè™‘<strong>é¢„æµ‹å’Œå»¶è¿Ÿæ»åè¡¥å¿</strong>ã€‚</p><h2 id="äºŒã€é™ä½å»¶è¿Ÿå½±å“"><a href="#äºŒã€é™ä½å»¶è¿Ÿå½±å“" class="headerlink" title="äºŒã€é™ä½å»¶è¿Ÿå½±å“"></a>äºŒã€é™ä½å»¶è¿Ÿå½±å“</h2><p>  ç½‘ç»œæ¸¸æˆä¸­ï¼Œç”±äºç½‘ç»œå»¶è¿Ÿæˆ–è€…ç½‘ç»œçŠ¶å†µçš„éƒ½æ‡‚ï¼Œå¯èƒ½ä¼šå¯¹å®¢æˆ·ç«¯çš„æ•ˆæœäº§ç”Ÿä¸€å®šçš„æ‰­æ›²ï¼Œå½±å“ç©å®¶ä½“éªŒã€‚ä¸ºäº†é™ä½å»¶è¿Ÿå¸¦æ¥çš„ä½“éªŒé—®é¢˜ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥ï¼Œä¸€ç§æ˜¯<strong>å®¢æˆ·ç«¯é¢„æµ‹</strong>ï¼Œä¸€ç§æ˜¯<strong>å»¶è¿Ÿè¡¥å¿</strong>ã€‚</p><h2 id="ä¸‰ã€å®¢æˆ·ç«¯é¢„æµ‹"><a href="#ä¸‰ã€å®¢æˆ·ç«¯é¢„æµ‹" class="headerlink" title="ä¸‰ã€å®¢æˆ·ç«¯é¢„æµ‹"></a>ä¸‰ã€å®¢æˆ·ç«¯é¢„æµ‹</h2><p>  å®¢æˆ·ç«¯é¢„æµ‹ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨ç”¨æˆ·è¿›è¡Œæ“ä½œæ—¶ï¼Œä¸€æ–¹é¢å®¢æˆ·ç«¯æƒ³æœåŠ¡ç«¯å‘é€æŒ‡ä»¤è¯´æ˜ç”¨æˆ·æ“ä½œï¼Œå¦ä¸€æ–¹é¢å®¢æˆ·ç«¯è‡ªå·±ä¹Ÿä¼šè¿›è¡Œä¸€å®šçš„é¢„å…ˆè¡ŒåŠ¨ï¼Œç­‰åˆ°æœåŠ¡ç«¯ç¡®è®¤ä¹‹åï¼Œæ ¹æ®æœåŠ¡ç«¯è¿”å›çš„ç»“æœè¿›è¡ŒçŠ¶æ€ä¿®æ­£ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æ“çºµæ¸¸æˆè§’è‰²å‰è¿›æ—¶ï¼Œå³ä½¿æŒ‡ä»¤è¿˜æœªå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä¹Ÿçœ‹åˆ°äº†æ¸¸æˆè§’è‰²åœ¨å‘å‰ç§»åŠ¨ã€‚</p><p>  ä»¥é­”å…½ä¸–ç•Œ ç½‘æ¸¸ä¸­çš„ç§»åŠ¨åŒæ­¥ä¸¾ä¾‹è¯´æ˜ï¼š</p><p>  å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€çš„ç½‘ç»œåŒ…æœ‰ä¸‰ç§ç±»å‹ï¼š</p><ul><li>å¼€å§‹æ“ä½œåŒ…ï¼šç”¨æˆ·<strong>å¼€å§‹ç§»åŠ¨çš„ä¿¡å·</strong>ï¼Œå‘Šè¯‰æœåŠ¡ç«¯ï¼Œç›®æ ‡ä½•æ—¶ä»ä½•åœ°å‘å“ªé‡Œå¼€å§‹ç§»åŠ¨ï¼Œæ–¹å‘å¤šå°‘ï¼›</li><li>å¿ƒè·³åŒ…ï¼šæ“ä½œå¼€å§‹åï¼Œå¦‚æœæ“ä½œçŠ¶æ€ä¸å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ¯éš”ä¸€ä¸ª<strong>å¿ƒè·³æ—¶é—´</strong>ï¼Œå‘æœåŠ¡ç«¯å‘é€å¿ƒè·³ï¼Œè¡¨ç¤ºæˆ‘ä»ç„¶å¤„äºä¸Šä¸€ä¸ªæ“ä½œçŠ¶æ€ã€‚</li><li><p>åœæ­¢åŒ…ï¼šå‘ŠçŸ¥æœåŠ¡ç«¯ï¼Œ<strong>ä¸Šä¸€ä¸ªæ“ä½œçŠ¶æ€åœæ­¢</strong>ï¼Œä»¥åŠç›®æ ‡åœç•™çš„ä½ç½®ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯å½“æˆ‘ä»¬æŒ‰ä¸‹â€œå‘å‰â€ï¼Œå‘é€æ“ä½œåŒ…ï¼ŒæŒç»­æŒ‰ä½ï¼Œæ¯ä¸€ä¸ªå¿ƒè·³æ—¶é—´å°±å‘é€ä¸€ä¸ªå¿ƒè·³åŒ…ï¼Œå½“æ”¹å˜æ–¹å‘æˆ–è€…åœä¸‹ï¼Œå°±å‘é€ä¸€ä¸ªåœæ­¢åŒ…ï¼Œå†å‘é€ä¸€ä¸ªå¦ä¸€ä¸ªæ–¹å‘çš„æ“ä½œåŒ…ã€‚</p><p>æœåŠ¡å™¨æ”¶åˆ°ç½‘ç»œåŒ…åéœ€è¦å‘å…¶ä»–ç©å®¶è¿›è¡Œå¹¿æ’­ï¼Œä½†æ˜¯ä¼šæ™šä¸€ä¸ª<strong>å¿ƒè·³æ—¶é—´</strong>ï¼ŒæœåŠ¡ç«¯ç«¯æ›´æ–°ç­–ç•¥æ˜¯ï¼š</p></li><li><p>æ”¶åˆ°æ“ä½œåŒ…ï¼šç­‰å¾…ä¸€ä¸ªå¿ƒè·³æ—¶é—´ï¼Œå°†ç›®æ ‡çŠ¶æ€è½¬ä¸ºç§»åŠ¨ï¼Œå¹¶ä¸”å‘é€åŒ…ç»™å…¶ä»–å®¢æˆ·ç«¯å‘ŠçŸ¥ã€‚</p></li><li>æ”¶åˆ°å¿ƒè·³åŒ…ï¼šæ›´æ–°ä¸€ä¸ªå¿ƒè·³çš„ä½ç§»ï¼Œå‘åŒ…ç»™å…¶ä»–å®¢æˆ·ç«¯ï¼ŒåŒæ­¥ç›®æ ‡åæ ‡ï¼Œè¿™æ—¶å…¶ä»–å®¢æˆ·ç«¯çš„ä»»åŠ¡ä¹Ÿåœ¨ç§»åŠ¨ï¼Œæ‰€ä»¥åŒæ­¥çš„ä»£ä»·å¾ˆå°ï¼Œå®¢æˆ·ç«¯çœ‹èµ·æ¥å¾ˆæµç•…ã€‚</li><li>æ”¶åˆ°åœæ­¢åŒ…ï¼šæ ¹æ®å¿ƒè·³åŒ…æ—¶é—´çš„æ¯”ä¾‹ï¼Œè®¡ç®—å‡ºæœ€ç»ˆåæ ‡ï¼Œä¸å…¶ä»–å®¢æˆ·ç«¯åŒæ­¥ã€‚</li></ul><p>å½“å‡ºç°ç½‘ç»œå»¶è¿Ÿæ—¶ï¼š</p><p>æ“ä½œäººç‰©å‰è¿›æ—¶ï¼Œç”±ç½‘ç»œå»¶è¿Ÿçš„åŸå› ï¼Œ<strong>æŒç»­çš„å¿ƒè·³åŒ…å‘é€å¤±è´¥</strong>ï¼Œæ‰€ä»¥åœ¨å…¶ä»–çš„å®¢æˆ·ç«¯ä¸Šï¼Œè§’è‰²å°±ä¼šåœåœ¨ä¸Šä¸€ä¸ªå¿ƒè·³åŒ…çš„ä½ç½®ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªå¿ƒè·³åŒ…çš„åˆ°æ¥ï¼Œè€Œä¸”è¿™æ—¶ä¹Ÿä¼šä¿æŒåŠ¨ç”»æ’­æ”¾ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ç½‘æ¸¸ä¸­ç»å¸¸çœ‹åˆ°å…¶ä»–ç½‘ç»œå·®çš„ç©å®¶åœ¨åŸåœ°è·‘åŠ¨çš„æƒ…å†µã€‚æœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œæ‰€ä»¥åªä¼šæ›´æ–°äººç‰©<strong>å‘å‰ä¸€ä¸ªå¿ƒè·³åŒ…çš„ä½ç§»</strong>ï¼Œè€Œä¸æ˜¯æŒç»­æ›´æ–°ï¼Œè¿™æ ·é¿å…äº†ç±»ä¼¼â€œè·³å´–â€ä¹‹ç±»çš„æ„å¤–äº‹ä»¶ã€‚å®¢æˆ·ç«¯æœ¬åœ°ä¹Ÿä¼šè¿›è¡Œä¸€ä¸ªå¿ƒè·³çš„ä½ç§»ï¼Œè¿™é‡Œä¹Ÿç®—æ˜¯ä¸€ç§å®¢æˆ·ç«¯é¢„æµ‹çš„å®ç°ã€‚</p><p>å»¶è¿Ÿç»“æŸä¹‹åï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å»¶è¿Ÿçš„åŒ…ï¼Œå‘ç°éœ€è¦åŒæ­¥çš„ä½ç§»è·ç¦»å¾ˆå¤§ï¼Œè¿™é‡Œå°±ä¼šé€‰æ‹©è®©æ¸¸æˆè§’è‰²â€œè·‘â€è¿‡å»æˆ–è€…ç›´æ¥ç¬ç§»åˆ°ç›®æ ‡ä½ç½®ã€‚</p><h2 id="å››ã€å»¶è¿Ÿè¡¥å¿"><a href="#å››ã€å»¶è¿Ÿè¡¥å¿" class="headerlink" title="å››ã€å»¶è¿Ÿè¡¥å¿"></a>å››ã€å»¶è¿Ÿè¡¥å¿</h2><p>  å»¶è¿Ÿè¡¥å¿ï¼ˆLag Compensationï¼‰çš„æ¦‚å¿µé¦–æ¬¡æå‡ºæ­£æ˜¯åœ¨æ¸¸æˆ <code>half-life</code> ä¹‹ä¸­ï¼Œè€Œä¸”æœ€çŸ¥åçš„æè¿°ä¹Ÿæ¥è‡ªäºValve vç¤¾çš„<em>Yahn W. Bernier</em>çš„æ–‡ç« ï¼š<strong>ã€ŠLatency Compensating Methods in Client/Server In-game Protocol Design and Optimizationã€‹</strong></p><blockquote><p>  <em>Lag compensation is a method of normalizing server-side the state of the world for each player as that playerâ€™s user commands are executed. You can think of lag compensation as taking a step back in time, on the server, and looking at the state of the world at the exact instant that the user performed some action. The algorithm works as follows:</em></p><ol><li><p><em>Before executing a playerâ€™s current user command, the server:</em></p></li><li><ol><li><em>Computes a fairly accurate latency for the player</em></li><li><em>Searches</em> [<em>the server history</em>) <em>(for the current player) for the world update that was sent to the player and received by the player just before the player would have issued the movement command</em></li><li><em>From that update (and the one following it based on the exact target time being used), for each player in the update, move the other players backwards in time to exactly where they were when the      current playerâ€™s user command was created. This moving backwards must      account for both connection latency and the interpolation amount the      client was using that frame.</em></li></ol></li><li><p><em>Allow the user command to execute (including any weapon firing commands, etc., that will run ray casts against all of the other players in their â€œoldâ€ positions).</em></p></li><li><p><em>Move all of the moved/time-warped players back to their correct/current positions</em></p><p><em><a href="https://developer.valvesoftware.com/wiki/Latency_Compensating_Methods_in_Client/Server_In-game_Protocol_Design_and_Optimization" target="_blank" rel="noopener">https://developer.valvesoftware.com/wiki/Latency_Compensating_Methods_in_Client/Server_In-game_Protocol_Design_and_Optimization</a></em></p></li></ol></blockquote><p>  ç®€å•æ¦‚æ‹¬æ¥è¯´ï¼Œå°±æ˜¯æœåŠ¡å™¨ä¼šè€ƒè™‘å®¢æˆ·ç«¯çš„ç½‘ç»œå»¶è¿Ÿï¼Œå°†æœåŠ¡å™¨çŠ¶æ€å›æ»šåˆ°å»¶è¿Ÿä¹‹å‰ï¼Œç„¶åå†æ¬¡è¿›è¡Œå¯¹æŒ‡ä»¤çš„å¤„ç†ã€‚</p><p>  ç®—æ³•åŸç†ï¼š</p><ul><li>ä¸ºæ‰€æœ‰çš„æ¸¸æˆç©å®¶è®¡ç®—ä¸€ä¸ª<strong>ç²¾å‡†çš„å»¶è¿Ÿæ—¶é—´</strong>ï¼ˆpingå€¼ï¼‰</li><li>ä¸ºå½“å‰ç©å®¶åœ¨æœåŠ¡å™¨ä¸­<strong>æŸ¥æ‰¾å½“å‰ç©å®¶å‘å‡ºæŒ‡ä»¤ä¹‹å‰çš„æ‰€æ”¶åˆ°çš„ä¸Šä¸€ä¸ªæ¸¸æˆå†…å®¹æ›´æ–°æŒ‡ä»¤</strong>ï¼›</li><li>å¯¹äºå½“å‰æœ€æ–°å‘å‡ºçš„æŒ‡ä»¤ä¸­æ¶‰åŠåˆ°çš„æ‰€æœ‰æ¸¸æˆç©å®¶ï¼Œéƒ½å°†ä»–ä»¬åœ¨æœåŠ¡å™¨ä¸­ä»ä¸Šä¸€æ›´æ–°æŒ‡ä»¤å¼€å§‹è®¡ç®—ï¼Œå°†ä»–ä»¬<strong>åŒæ­¥åˆ°å½“å‰æŒ‡ä»¤åˆ›å»ºæ—¶çš„ä½ç½®å’ŒçŠ¶æ€</strong>ï¼ˆè¿™ç§åŒæ­¥å¿…é¡»è¦è€ƒè™‘åˆ°å®¢æˆ·ç«¯çš„æ’å€¼è¿ç®—å’Œé“¾æ¥å»¶è¿Ÿï¼‰</li><li>å¼€å§‹å…è®¸ç©å®¶çš„<strong>æŒ‡ä»¤æ‰§è¡Œ</strong>(æœ‰æ—¶å€™å¯èƒ½ä¼šå¯¹å¯¹æ–¹ç©å®¶çš„â€œæ—§â€ä½ç½®è¿›è¡Œå½±å“ï¼Œæ¯”å¦‚å°„å‡»æˆ–è€…å‡»æ€ï¼‰</li><li>æœ€åå°†æ‰€æœ‰å—å½±å“çš„ç©å®¶<strong>åŒæ­¥æ›´æ–°åˆ°å…¶æ­£ç¡®çš„çŠ¶æ€å’Œä½ç½®</strong>ã€‚</li></ul><h2 id="äº”ã€æœåŠ¡å™¨çš„é€šä¿¡é¢‘ç‡ï¼ˆtickrateï¼‰"><a href="#äº”ã€æœåŠ¡å™¨çš„é€šä¿¡é¢‘ç‡ï¼ˆtickrateï¼‰" class="headerlink" title="äº”ã€æœåŠ¡å™¨çš„é€šä¿¡é¢‘ç‡ï¼ˆtickrateï¼‰"></a>äº”ã€æœåŠ¡å™¨çš„é€šä¿¡é¢‘ç‡ï¼ˆtickrateï¼‰</h2><p>  æ¸¸æˆè¿‡ç¨‹æ˜¯ä¸€ä¸ªç¦»æ•£è€Œéè¿ç»­çš„è¿‡ç¨‹ï¼ŒæœåŠ¡å™¨ä¼šä»¥ä¸€ç§é¢‘ç‡å‘ç©å®¶çš„å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡æ¥æ›´æ–°æ¸¸æˆçŠ¶æ€ã€‚ç§°ä¹‹ä¸ºæœåŠ¡å™¨çš„é€šä¿¡é¢‘ç‡ï¼Œä¹Ÿå°±æ˜¯csgoä¸­æˆ‘ä»¬å¸¸è¯´çš„tickrateã€‚å®˜æ–¹æœåŠ¡å™¨ä¸­ä¸€èˆ¬ä¸º64tickï¼ŒçŸ¥åå¯¹æˆ˜å¹³å°çš„éƒ½æ˜¯128tickã€‚</p><h2 id="å…­ã€CSGOä¸­çš„å»¶è¿Ÿè¡¥å¿"><a href="#å…­ã€CSGOä¸­çš„å»¶è¿Ÿè¡¥å¿" class="headerlink" title="å…­ã€CSGOä¸­çš„å»¶è¿Ÿè¡¥å¿"></a>å…­ã€CSGOä¸­çš„å»¶è¿Ÿè¡¥å¿</h2><p>csgoä¸­çš„å»¶è¿Ÿè¡¥å¿æŒ‡ä»¤æœ‰ä¸¤ä¸ªï¼š</p><ul><li>cl_interp</li><li>cl_interp_ratio</li></ul><h3 id="cl-interp"><a href="#cl-interp" class="headerlink" title="cl_interp"></a>cl_interp</h3><p>  å¯ä»¥è¿™æ ·ç†è§£ï¼šå®¢æˆ·ç«¯æ˜¾ç¤ºçš„å®æ—¶æ¸¸æˆç”»é¢æ˜¯ç”±æœåŠ¡å™¨å‘é€è¿‡æ¥çš„åŒ…ä»¥åŠå®¢æˆ·ç«¯é¢„æµ‹äº’è¡¥ç»„æˆã€‚cl_interpæ˜¯æŒ‡æœåŠ¡å™¨å‘é€è¿‡æ¥çš„è¿ç»­ä¸¤ä¸ªåŒ…ä¹‹é—´çš„é—´éš”æ—¶é•¿ã€‚å®¢æˆ·ç«¯ä¼šæ ¹æ®è¿ç»­ä¸¤ä¸ªåŒ…ä¹‹é—´çš„é—´éš”æ—¶é•¿ï¼Œæ›´å‡†ç¡®åœ°è¿›è¡Œé¢„æµ‹ã€‚å»ºè®®64tickä¸‹è®¾ç½®æˆ0.015625ï¼ˆç§’ï¼‰ï¼Œ128tickä¸‹è®¾ç½®æˆ0.0078125ï¼ˆç§’ï¼‰ã€‚å¦å¤–è®¾ç½®cl_interpçš„å€¼ä¸º0æˆ–ä½äº1/cl_updaterateå€¼æ—¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæœ€ä½³è®¾ç½®ã€‚</p><h3 id="cl-interp-ratio"><a href="#cl-interp-ratio" class="headerlink" title="cl_interp_ratio"></a>cl_interp_ratio</h3><p>  å‡è®¾æœåŠ¡å™¨å‘é€è¿‡æ¥çš„è¿ç»­ç…§ç‰‡ä¸­çš„ç¬¬10ä¸ªç½‘ç»œåŒ…åˆ°è¾¾å®¢æˆ·ç«¯åï¼Œå†³å®šå®¢æˆ·ç«¯æ˜¯å¦åº”è¯¥ç­‰å¾…ä¸‹ä¸€ç½‘ç»œåŒ…åˆ°è¾¾ï¼Œä¹Ÿå°±æ˜¯ç¬¬11ä¸ªåŒ…ä¹Ÿåˆ°è¾¾åï¼Œå†æŠŠå›¾åƒç»˜åˆ¶åœ¨æ˜¾ç¤ºå™¨ä¸Šã€‚ä¹Ÿå°±æ˜¯å†³å®šè¦ä¸è¦å»¶è¿Ÿä¸€ä¸ªæ’å¸§å‘¨æœŸå†æ’å¸§ã€‚</p><p>  è®¾ç½®è¯¥å€¼ä¸º1æ—¶ï¼Œä¸ä¼šå»¶è¿Ÿä¸€ä¸ªå‘¨æœŸï¼Œä¼šç«‹åˆ»æ’å¸§ã€‚è¿™æ ·è®¾ç½®ç¼ºç‚¹æ˜æ˜¾ï¼Œå› ä¸ºå½“é‡åˆ°ç½‘ç»œçŠ¶å†µä¸ä½³æ—¶ï¼Œå¦‚lossã€å»¶è¿Ÿä¸ç¨³å®šæ—¶ï¼Œå®¹æ˜“å‘ç”Ÿæ’å¸§ä¸¢å¤±ç°è±¡ï¼Œè¡¨ç°ä¸ºäººç‰©è¿åŠ¨ä¸è¿è´¯ã€å¡ã€ç”šè‡³ç¬ç§»ã€‚</p><p>  è®¾ç½®è¯¥å€¼ä¸º2æ—¶ï¼Œå®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨ä¼ é€è¿‡æ¥çš„ä¸€å¸§ç…§ç‰‡åï¼Œä¼šç­‰å¾…ä¸€ä¸ªå‘¨æœŸï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…0.015625ç§’ä¹‹åï¼ˆ128tickä¸º0.0078125ç§’ï¼‰ï¼Œæ‰ä¼šæŠŠç…§ç‰‡æ‰€åŒ…å«çš„ä¿¡æ¯è½¬å˜ä¸ºæ¸¸æˆç”»é¢ã€‚ä¸ºä»€ä¹ˆè¦å°†æœåŠ¡å™¨ä¼ é€è¿‡æ¥çš„ç”»é¢å»¶è¿Ÿä¸€ä¸ªå‘¨æœŸä¹‹åæ‰æ˜¾ç¤ºå‘¢ï¼ŸåŸå› æ˜¯è¿™æ ·çš„ï¼Œä¸ºäº†é¿å…é¢„æµ‹å›¾åƒå‡ºç°è¯¯å·®ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°ç¬¬ä¸€å¼ ç…§ç‰‡åï¼Œç­‰å¾…ä¸€ä¸ªå‘¨æœŸï¼Œç­‰æ”¶åˆ°äº†ç¬¬äºŒå¼ ç…§ç‰‡åã€‚ç»“åˆä¸¤ä¸ªç…§ç‰‡æ‰€åŒ…å«çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ›´åŠ ç²¾ç¡®çš„é¢„æµ‹å‡ºä¸¤ä¸ªç…§ç‰‡ä¹‹é—´çš„äººç‰©åŠ¨ä½œã€‚è¿™æ ·é¢„æµ‹å‡ºæ¥çš„ç”»é¢æ¯”è¾ƒå‡†ç¡®ï¼Œå¯ä»¥è¯´æå¤§ç¨‹åº¦ä¸Šä¿®å¤äº†ç¬ç§»ï¼Œå¡ï¼Œç”»é¢ä¸è¿è´¯ç­‰æƒ…å†µã€‚äº§ç”Ÿçš„å»¶è¿Ÿå¯ä»¥ç”¨å»¶è¿Ÿè¡¥å¿åŠŸèƒ½å¼¥è¡¥ã€‚</p><p>  æŒ‡ä»¤çš„è®¾ç½®ä¼šå¯¹è¿åŠ¨ä¸­çš„æ•Œäººçˆ†å¤´çš„æ‰‹æ„Ÿäº§ç”Ÿå½±å“ï¼Œé»˜è®¤è®¾ç½®ä¸­ï¼Œhitboxå’Œäººç‰©æ¨¡å‹æ˜¯é‡åˆçš„ï¼Œè®¾ç½®ä¸ºç«‹å³æ’å¸§ï¼ˆcl_interp_ratio 1ï¼‰åhitboxä¼šå› ä¸ºå®¢æˆ·ç«¯é¢„æµ‹çš„åŸå› å®é™…æ‰‹æ„Ÿä¼šæœ‰ä¸€ç§hitboxåœ¨äººç‰©æ¨¡å‹è¿åŠ¨ä¹‹å‰çš„æ„Ÿè§‰ï¼Œå¹¶ä¸æ˜¯é‡åˆçš„ã€‚</p><h2 id="ä¸ƒã€Peeker-â€˜s-Advantage"><a href="#ä¸ƒã€Peeker-â€˜s-Advantage" class="headerlink" title="ä¸ƒã€Peeker â€˜s Advantage"></a>ä¸ƒã€Peeker â€˜s Advantage</h2><p>  åœ¨ã€Šå½©è™¹å…­å·ï¼šå›´æ”»ã€‹ã€ŠCS:GOã€‹ç­‰å°„å‡»æ¸¸æˆä¸­ï¼Œå…ˆæ¢å¤´Peekçš„ä¸€æ–¹å¾€å¾€ä¼šè·å¾—æå¤§çš„ä¼˜åŠ¿ï¼Œè¿™ç§æƒ…å†µç§°ä½œã€Œæ¢å¤´ä¼˜åŠ¿ã€å³Peeker â€˜s Advantageã€‚å…ˆæ¢å¤´å¼€æªçš„ä¸€æ–¹ä¼˜åŠ¿è¾ƒå¤§ï¼Œè€Œè¢«åŠ¨çš„ä¸€æ–¹åœ¨ä¸€ç¬é—´è¢«å‡»æ€ï¼Œçœ‹å‡»æ€å›æ”¾æ—¶åˆä¼šå‘ç°è‡ªå·±åœ¨å¯¹æ–¹çš„è§†é‡ä¸­å‚»æ„£äº†å¾ˆä¹…ã€‚</p><p>  <img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/peekerAdvantage.png" alt="peeker advantage1"></p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/peekerAdvantage2.png" alt="peekerAdvantage2"></p><p>  å‡è®¾P2æ˜¯ç«™ç€ä¸åŠ¨ï¼Œ<strong>P1æ˜¯ä¸»åŠ¨peek</strong>ï¼ŒP2çš„å‡†ç¡®ä½ç½®ä¿¡æ¯å·²ç»åœ¨P1çœ‹åˆ°P2ä¹‹å‰å°±å·²ç»åœ¨P1çš„æœ¬åœ°å®¢æˆ·ç«¯ä½œä¸ºåˆ¤å®šä¾æ®äº†ã€‚å½“P1çœ‹åˆ°P2çš„æ—¶å€™ï¼Œä»–çœ‹åˆ°çš„P2çš„ä½ç½®å°±æ˜¯å½“å‰æ—¶é—´P2çš„å‡†ç¡®ä½ç½®ï¼Œå› ä¸ºP2æ²¡åŠ¨ã€‚ç„¶è€ŒP2åœ¨æ­¤æ—¶æ­¤åˆ»æ˜¯çœ‹ä¸åˆ°P1çš„ï¼Œå› ä¸ºP1æ­¤æ—¶æ­¤åˆ»çš„å‡†ç¡®çš„ä½ç½®ä¿¡æ¯è¿˜æ²¡æœ‰å‘é€åˆ°P2çš„æœ¬åœ°å®¢æˆ·ç«¯ï¼ŒP2çœ‹åˆ°çš„æ˜¯ä¸€æ®µæ—¶é—´ä¹‹å‰çš„P1çš„ä¿¡æ¯ï¼Œè¿™å°±å¯¼è‡´åœ¨åŒä¸€æ—¶åˆ»ï¼ŒP1èƒ½çœ‹åˆ°P2è€ŒP2çœ‹ä¸åˆ°P1ã€‚</p><p>  ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ–è€…å‡å°‘Peeker â€˜s Advantageï¼Œä¸åŒæ¸¸æˆéƒ½é‡‡ç”¨äº†ä¸åŒçš„ç­–ç•¥ï¼Œä¾‹å¦‚äººç‰©çš„hitboxè¦æ¯”å®é™…äººç‰©æ¨¡å‹å°ï¼Œæˆ–è€…æ˜¯csgoä¸­æˆ‘ä»¬å¸¸è¯´çš„è¿‘å¤§è¿œå°åŸåˆ™ã€‚</p><h2 id="å…«ã€å¼•ç”¨"><a href="#å…«ã€å¼•ç”¨" class="headerlink" title="å…«ã€å¼•ç”¨"></a>å…«ã€å¼•ç”¨</h2><blockquote><ul><li><a href="https://www.zhihu.com/question/29076648/answer/43726059" target="_blank" rel="noopener">https://www.zhihu.com/question/29076648/answer/43726059</a></li><li><a href="https://www.zhihu.com/question/263933628/answer/274629763" target="_blank" rel="noopener">https://www.zhihu.com/question/263933628/answer/274629763</a></li><li><a href="https://www.zhihu.com/question/20466492" target="_blank" rel="noopener">https://www.zhihu.com/question/20466492</a></li><li><a href="https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/" target="_blank" rel="noopener">https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/</a></li></ul></blockquote><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Computer Networking </tag>
            
            <tag> CSGO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…· jstat</title>
      <link href="/2023/01/23/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E7%9B%91%E8%A7%86%E5%B7%A5%E5%85%B7-jstat/"/>
      <url>/2023/01/23/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E7%9B%91%E8%A7%86%E5%B7%A5%E5%85%B7-jstat/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·-jstat"><a href="#ä¸€ã€è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·-jstat" class="headerlink" title="ä¸€ã€è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…· - jstat"></a>ä¸€ã€è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…· - jstat</h2><p>â€‹    jstat(JVM Statistics Monitoring Tool)æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„<code>å‘½ä»¤è¡Œå·¥å…·</code>ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®. </p><p>â€‹    <img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123020509130.png" alt="image-20230123020509130" style="zoom:50%;" /></p><h2 id="äºŒã€å‘½ä»¤å‚æ•°"><a href="#äºŒã€å‘½ä»¤å‚æ•°" class="headerlink" title="äºŒã€å‘½ä»¤å‚æ•°"></a>äºŒã€å‘½ä»¤å‚æ•°</h2><p>â€‹    é€šè¿‡ä¸Šå›¾çš„helpå¸®åŠ©å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° <em>jstat</em> çš„é€šç”¨å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</span><br><span class="line"><span class="meta">#</span><span class="bash">       å‚æ•°     æ—¶é—´  æ¯éš”å¤šå°‘è¡Œ   è¿›ç¨‹å·    æ—¶é—´é—´éš”     æ‰“å°æ¬¡æ•°</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ éœ€è¦æ¯250æ¯«ç§’æŸ¥è¯¢ä¸€æ¬¡è¿›ç¨‹2764åƒåœ¾æ”¶é›†çŠ¶å†µï¼Œä¸€å…±æŸ¥è¯¢20æ¬¡ é‚£ä¹ˆå‘½ä»¤å°±åº”è¯¥æ˜¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc 2764 250 20</span><br></pre></td></tr></table></figure><h3 id="ä¸»è¦å‚æ•°é€‰é¡¹"><a href="#ä¸»è¦å‚æ•°é€‰é¡¹" class="headerlink" title="ä¸»è¦å‚æ•°é€‰é¡¹"></a>ä¸»è¦å‚æ•°é€‰é¡¹</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123025143977.png" alt="image-20230123025143977" style="zoom:50%;" /></p><p>æˆ–è€…é€šè¿‡ <code>jstat -options</code>æ¥çœ‹æˆ‘ä»¬åˆ°åº•æ”¯æŒå“ªäº›ç±»å‹çš„æ•°æ®</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123025335605.png" alt="image-20230123025335605" style="zoom:50%;" /></p><blockquote><p>-class                ç±»åŠ è½½ç»Ÿè®¡<br>-compiler                ç¼–è¯‘ç»Ÿè®¡<br>-gc                åƒåœ¾å›æ”¶ç»Ÿè®¡<br>-gccapacity                å †å†…å­˜ç»Ÿè®¡<br>-gccause                è¿‘ä¸€æ¬¡GCç»Ÿè®¡å’ŒåŸå› <br>-gcmetacapacity                å…ƒæ•°æ®ç©ºé—´ç»Ÿè®¡<br>-gcnew                æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡<br>-gcnewcapacity                æ–°ç”Ÿä»£å†…å­˜ç»Ÿè®¡<br>-gcold                è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡<br>-gcoldcapacity                è€å¹´ä»£å†…å­˜ç»Ÿè®¡<br>-gcutil                åƒåœ¾å›æ”¶ç»Ÿè®¡(ç™¾åˆ†æ¯”)<br>-printcompilation                JVMç¼–è¯‘æ–¹æ³•ç»Ÿè®¡</p></blockquote><p>optionä¸»è¦æ”¯æŒæŸ¥è¯¢çš„å†…å®¹ä¸»è¦åˆ†ä¸‰ç±»</p><ul><li>åƒåœ¾æ”¶é›†æƒ…å†µ</li><li>ç±»åŠ è½½æƒ…å†µ</li><li>è¿è¡ŒæœŸç¼–è¯‘æƒ…å†µ</li></ul><h2 id="ä¸‰ã€åƒåœ¾æ”¶é›†"><a href="#ä¸‰ã€åƒåœ¾æ”¶é›†" class="headerlink" title="ä¸‰ã€åƒåœ¾æ”¶é›†"></a>ä¸‰ã€åƒåœ¾æ”¶é›†</h2><p>â€‹    åƒåœ¾æ”¶é›†æƒ…å†µçš„ç›‘è§†optionä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>-gc åƒåœ¾å›æ”¶ç»Ÿè®¡</li><li>-gcnew æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡</li><li>-gcold è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡</li><li>-gcutil åƒåœ¾å›æ”¶ç»Ÿè®¡(ç™¾åˆ†æ¯”)</li></ul><h3 id="ä½¿ç”¨-gcutilåƒåœ¾å›æ”¶ç»Ÿè®¡-ç™¾åˆ†æ¯”"><a href="#ä½¿ç”¨-gcutilåƒåœ¾å›æ”¶ç»Ÿè®¡-ç™¾åˆ†æ¯”" class="headerlink" title="ä½¿ç”¨-gcutilåƒåœ¾å›æ”¶ç»Ÿè®¡(ç™¾åˆ†æ¯”)"></a>ä½¿ç”¨<code>-gcutil</code>åƒåœ¾å›æ”¶ç»Ÿè®¡(ç™¾åˆ†æ¯”)</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123030433772.png" alt="image-20230123030433772" style="zoom:50%;" /></p><h3 id="ä½¿ç”¨-gcåƒåœ¾å›æ”¶ç»Ÿè®¡"><a href="#ä½¿ç”¨-gcåƒåœ¾å›æ”¶ç»Ÿè®¡" class="headerlink" title="ä½¿ç”¨-gcåƒåœ¾å›æ”¶ç»Ÿè®¡"></a>ä½¿ç”¨<code>-gc</code>åƒåœ¾å›æ”¶ç»Ÿè®¡</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123030709826.png" alt="image-20230123030709826"></p><h3 id="ä½¿ç”¨-gcnew-æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡"><a href="#ä½¿ç”¨-gcnew-æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡" class="headerlink" title="ä½¿ç”¨-gcnew æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡"></a>ä½¿ç”¨<code>-gcnew</code> æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123030649928.png" alt="image-20230123030649928"></p><h3 id="ä½¿ç”¨-gcold-è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡"><a href="#ä½¿ç”¨-gcold-è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡" class="headerlink" title="ä½¿ç”¨ -gcold  è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡"></a>ä½¿ç”¨ <code>-gcold</code>  è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123030802319.png" alt="image-20230123030802319"></p><h3 id="å‚æ•°å«ä¹‰"><a href="#å‚æ•°å«ä¹‰" class="headerlink" title="å‚æ•°å«ä¹‰"></a><strong>å‚æ•°å«ä¹‰</strong></h3><blockquote><p>  S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„å¤§å°<br>  S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°<br>  S0Uï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°<br>  S1Uï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°<br>  ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°<br>  EUï¼šä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°<br>  OCï¼šè€å¹´ä»£å¤§å°<br>  OUï¼šè€å¹´ä»£ä½¿ç”¨å¤§å°<br>  MCï¼šæ–¹æ³•åŒºå¤§å°<br>  MUï¼šæ–¹æ³•åŒºä½¿ç”¨å¤§å°<br>  CCSC:å‹ç¼©ç±»ç©ºé—´å¤§å°<br>  CCSU:å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°<br>  GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´<br>  YGC: Young GC ä»£è¡¨Minor GCæ¬¡æ•°ï¼›<br>  YGCT: Young GC Time ä»£è¡¨Minor GCè€—æ—¶ï¼›<br>  FGC: Full GC ä»£è¡¨Full GCæ¬¡æ•°ï¼›<br>  FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´ï¼›<br>  GCT: GC Time ä»£è¡¨Minor &amp; Full GCå…±è®¡è€—æ—¶ï¼›<br>  TT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°<br>  MTT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°<br>  DSS: Desired survivor size,æœŸæœ›å¹¸å­˜è€…å¤§å°<br>  S0ï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºç™¾åˆ†æ¯”<br>  S1ï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºç™¾åˆ†æ¯”<br>  E:  Eden ä»£è¡¨ä¼Šç”¸åŒºä½¿ç”¨ç™¾åˆ†æ¯”ï¼›<br>  O: Old ä»£è¡¨è€å¹´ä»£ä½¿ç”¨ç™¾åˆ†æ¯”ï¼›<br>  M: Metaspace å…ƒç©ºé—´<br>  CCS:å‹ç¼©ç±»ç©ºé—´åˆ©ç”¨ç‡ä¸ºç™¾åˆ†æ¯”</p></blockquote><h2 id="å››ã€ç±»åŠ è½½"><a href="#å››ã€ç±»åŠ è½½" class="headerlink" title="å››ã€ç±»åŠ è½½"></a>å››ã€ç±»åŠ è½½</h2><h3 id="ä½¿ç”¨-classç±»åŠ è½½ç»Ÿè®¡"><a href="#ä½¿ç”¨-classç±»åŠ è½½ç»Ÿè®¡" class="headerlink" title="ä½¿ç”¨-classç±»åŠ è½½ç»Ÿè®¡"></a>ä½¿ç”¨<code>-class</code>ç±»åŠ è½½ç»Ÿè®¡</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123035123294.png" alt="image-20230123035123294"></p><h3 id="å‚æ•°å«ä¹‰-1"><a href="#å‚æ•°å«ä¹‰-1" class="headerlink" title="å‚æ•°å«ä¹‰"></a>å‚æ•°å«ä¹‰</h3><blockquote><p>  Loaded:åŠ è½½classçš„æ•°é‡<br>  Bytesï¼šæ‰€å ç”¨ç©ºé—´å¤§å°<br>  Unloadedï¼šæœªåŠ è½½æ•°é‡<br>  Bytes:æœªåŠ è½½å ç”¨ç©ºé—´<br>  Timeï¼šæ—¶é—´<br>  Compiledï¼šç¼–è¯‘ä»»åŠ¡çš„æ•°ç›®<br>  Failedï¼šå¤±è´¥æ•°é‡<br>  Invalidï¼šä¸å¯ç”¨æ•°é‡<br>  Timeï¼šæ—¶é—´<br>  FailedTypeï¼šå¤±è´¥ç±»å‹<br>  FailedMethodï¼šå¤±è´¥çš„æ–¹æ³•<br>  Sizeï¼šæ–¹æ³•ç”Ÿæˆçš„å­—èŠ‚ç çš„å¤§å°<br>  Typeï¼šç¼–è¯‘ç±»å‹<br>  Method æ–¹æ³•</p></blockquote><h2 id="äº”ã€è¿è¡ŒæœŸç¼–è¯‘æƒ…å†µ"><a href="#äº”ã€è¿è¡ŒæœŸç¼–è¯‘æƒ…å†µ" class="headerlink" title="äº”ã€è¿è¡ŒæœŸç¼–è¯‘æƒ…å†µ"></a>äº”ã€è¿è¡ŒæœŸç¼–è¯‘æƒ…å†µ</h2><h3 id="ä½¿ç”¨-compiler-ç¼–è¯‘æƒ…å†µ"><a href="#ä½¿ç”¨-compiler-ç¼–è¯‘æƒ…å†µ" class="headerlink" title="ä½¿ç”¨-compiler ç¼–è¯‘æƒ…å†µ"></a>ä½¿ç”¨<code>-compiler</code> ç¼–è¯‘æƒ…å†µ</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123035501310.png" alt="image-20230123035501310"></p><h3 id="ä½¿ç”¨-gccapacityå †å†…å­˜ç»Ÿè®¡"><a href="#ä½¿ç”¨-gccapacityå †å†…å­˜ç»Ÿè®¡" class="headerlink" title="ä½¿ç”¨ -gccapacityå †å†…å­˜ç»Ÿè®¡"></a>ä½¿ç”¨ <code>-gccapacity</code>å †å†…å­˜ç»Ÿè®¡</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123035613181.png" alt="image-20230123035613181"></p><h3 id="å‚æ•°å«ä¹‰-2"><a href="#å‚æ•°å«ä¹‰-2" class="headerlink" title="å‚æ•°å«ä¹‰"></a>å‚æ•°å«ä¹‰</h3><blockquote><p>  NGCMNï¼šæ–°ç”Ÿä»£æœ€å°å®¹é‡<br>  NGCMXï¼šæ–°ç”Ÿä»£æœ€å¤§å®¹é‡<br>  NGCï¼šå½“å‰æ–°ç”Ÿä»£å®¹é‡<br>  S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°<br>  S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°<br>  ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°<br>  OGCMNï¼šè€å¹´ä»£æœ€å°å®¹é‡<br>  OGCMXï¼šè€å¹´ä»£æœ€å¤§å®¹é‡<br>  OGCï¼šå½“å‰è€å¹´ä»£å¤§å°<br>  OC:å½“å‰è€å¹´ä»£å¤§å°<br>  MCMN:æœ€å°å…ƒæ•°æ®å®¹é‡<br>  MCMXï¼šæœ€å¤§å…ƒæ•°æ®å®¹é‡<br>  MCï¼šå½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°<br>  CCSMNï¼šæœ€å°å‹ç¼©ç±»ç©ºé—´å¤§å°<br>  CCSMXï¼šæœ€å¤§å‹ç¼©ç±»ç©ºé—´å¤§å°<br>  CCSCï¼šå½“å‰å‹ç¼©ç±»ç©ºé—´å¤§å°<br>  YGCï¼šå¹´è½»ä»£gcæ¬¡æ•°<br>  FGCï¼šè€å¹´ä»£GCæ¬¡æ•°<br>  S0CMXï¼šæœ€å¤§å¹¸å­˜1åŒºå¤§å°<br>  S1CMXï¼šæœ€å¤§å¹¸å­˜2åŒºå¤§å°<br>  ECMXï¼šæœ€å¤§ä¼Šç”¸å›­åŒºå¤§å°</p></blockquote><h2 id="å…­ã€åŸç†"><a href="#å…­ã€åŸç†" class="headerlink" title="å…­ã€åŸç†"></a>å…­ã€åŸç†</h2><p>â€‹    åœ¨Javaç¯å¢ƒå˜é‡çš„ç›®å½•ä¸‹ï¼ˆæˆ‘çš„ç”µè„‘æ˜¯åœ¨<code>/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib</code>)  è¿™ä¸ªç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ª <code>tool.jar</code>çš„jaråŒ…</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20230123040806063.png" alt="image-20230123040806063"></p><p>â€‹    è¿™ä¸ªjaråŒ…é‡Œæœ‰ä¸€ä¸ª<code>jstat_options</code> çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œçš„å†…å®¹èŠ‚é€‰ä¸€æ®µå…³äº<code>gcutil</code>çš„å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">option gcutil &#123;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^S0^"</span>    <span class="comment">/* Survivor 0 Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.generation<span class="number">.0</span>.space<span class="number">.1</span>.capacity - sun.gc.generation<span class="number">.0</span>.space<span class="number">.1</span>.used)/sun.gc.generation<span class="number">.0</span>.space<span class="number">.1</span>.capacity)) * <span class="number">100</span></span><br><span class="line">    scale raw</span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^S1^"</span>    <span class="comment">/* Survivor 1 Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.generation<span class="number">.0</span>.space<span class="number">.2</span>.capacity - sun.gc.generation<span class="number">.0</span>.space<span class="number">.2</span>.used)/sun.gc.generation<span class="number">.0</span>.space<span class="number">.2</span>.capacity)) * <span class="number">100</span></span><br><span class="line">    scale raw</span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^E^"</span>    <span class="comment">/* Eden Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.generation<span class="number">.0</span>.space<span class="number">.0</span>.capacity - sun.gc.generation<span class="number">.0</span>.space<span class="number">.0</span>.used)/sun.gc.generation<span class="number">.0</span>.space<span class="number">.0</span>.capacity)) * <span class="number">100</span></span><br><span class="line">    align right</span><br><span class="line">    scale raw</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^O^"</span>    <span class="comment">/* Old Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.generation<span class="number">.1</span>.space<span class="number">.0</span>.capacity - sun.gc.generation<span class="number">.1</span>.space<span class="number">.0</span>.used)/sun.gc.generation<span class="number">.1</span>.space<span class="number">.0</span>.capacity)) * <span class="number">100</span></span><br><span class="line">    align right</span><br><span class="line">    scale raw</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^M^"</span>    <span class="comment">/* Metaspace Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.metaspace.capacity - sun.gc.metaspace.used)/sun.gc.metaspace.capacity)) * <span class="number">100</span></span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    scale raw</span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^CCS^"</span>    <span class="comment">/* Compressed Class Space Space - Percent Used */</span></span><br><span class="line">    data (<span class="number">1</span>-((sun.gc.compressedclassspace.capacity - sun.gc.compressedclassspace.used)/sun.gc.compressedclassspace.capacity)) * <span class="number">100</span></span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    scale raw</span><br><span class="line">    format <span class="string">"0.00"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^YGC^"</span>    <span class="comment">/* Young Generation Collections */</span></span><br><span class="line">    data sun.gc.collector<span class="number">.0</span>.invocations</span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">6</span></span><br><span class="line">    format <span class="string">"0"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^YGCT^"</span>    <span class="comment">/* Young Generation Collection Time */</span></span><br><span class="line">    data sun.gc.collector<span class="number">.0</span>.time/sun.os.hrt.frequency</span><br><span class="line">    align right</span><br><span class="line">    scale sec</span><br><span class="line">    width <span class="number">8</span></span><br><span class="line">    format <span class="string">"0.000"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^FGC^"</span>    <span class="comment">/* Full Collections */</span></span><br><span class="line">    data sun.gc.collector<span class="number">.1</span>.invocations</span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">5</span></span><br><span class="line">    scale raw</span><br><span class="line">    format <span class="string">"0"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^FGCT^"</span>    <span class="comment">/* Full Collection Time */</span></span><br><span class="line">    data sun.gc.collector<span class="number">.1</span>.time/sun.os.hrt.frequency</span><br><span class="line">    align right</span><br><span class="line">    scale sec</span><br><span class="line">    width <span class="number">8</span></span><br><span class="line">    format <span class="string">"0.000"</span></span><br><span class="line">  &#125;</span><br><span class="line">  column &#123;</span><br><span class="line">    header <span class="string">"^GCT^"</span>    <span class="comment">/* Total Garbage Collection Time */</span></span><br><span class="line">    data (sun.gc.collector<span class="number">.0</span>.time + sun.gc.collector<span class="number">.1</span>.time)/sun.os.hrt.frequency</span><br><span class="line">    align right</span><br><span class="line">    width <span class="number">8</span></span><br><span class="line">    scale sec</span><br><span class="line">    format <span class="string">"0.000"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“gcutilçš„æ¯ä¸€åˆ—æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼Œå…¶ä¸­ç±»ä¼¼<code>sun.gc.generation.0.space.0.capacity</code>è¿™æ ·çš„ä¸€äº›å˜é‡æ˜¯jvmé‡Œåˆ›å»ºå¹¶å®æ—¶æ›´æ–°çš„å€¼.</p><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RateLimiter Guavaé™æµå·¥å…·ç±»</title>
      <link href="/2021/10/24/RateLimiter-Guava%E9%99%90%E6%B5%81%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
      <url>/2021/10/24/RateLimiter-Guava%E9%99%90%E6%B5%81%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€é™æµ"><a href="#ä¸€ã€é™æµ" class="headerlink" title="ä¸€ã€é™æµ"></a>ä¸€ã€é™æµ</h2><p>â€‹    é™æµæ˜¯ä¿æŠ¤é«˜å¹¶å‘ç³»ç»Ÿçš„ä¸‰æŠŠåˆ©å™¨ä¹‹ä¸€ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ç¼“å­˜å’Œé™çº§ã€‚é™æµåœ¨å¾ˆå¤šåœºæ™¯ä¸­ç”¨æ¥é™åˆ¶å¹¶å‘å’Œè¯·æ±‚é‡ï¼Œæ¯”å¦‚è¯´ç§’æ€æŠ¢è´­ï¼Œä¿æŠ¤è‡ªèº«ç³»ç»Ÿå’Œä¸‹æ¸¸ç³»ç»Ÿä¸è¢«å·¨å‹æµé‡å†²å®ç­‰ã€‚<strong>æœåŠ¡é™çº§ã€ç†”æ–­æœ¬èº«ä¹Ÿæ˜¯é™æµçš„ä¸€ç§</strong></p><p>â€‹    é™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®/è¯·æ±‚è¿›è¡Œé™é€Ÿæˆ–è€…ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡æˆ–è¿›è¡Œæµé‡æ•´å½¢ã€‚</p><p>â€‹    å¸¸ç”¨çš„é™æµæ–¹å¼å’Œåœºæ™¯æœ‰ï¼šé™åˆ¶æ€»å¹¶å‘æ•°ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰ã€é™åˆ¶ç¬æ—¶å¹¶å‘æ•°ï¼ˆå¦‚nginxçš„limit<em>connæ¨¡å—ï¼Œç”¨æ¥é™åˆ¶ç¬æ—¶å¹¶å‘è¿æ¥æ•°ï¼ŒJavaçš„Semaphoreä¹Ÿå¯ä»¥å®ç°ï¼‰ã€é™åˆ¶æ—¶é—´çª—å£å†…çš„å¹³å‡é€Ÿç‡ï¼ˆå¦‚Guavaçš„RateLimiterã€nginxçš„limit</em>reqæ¨¡å—ï¼Œé™åˆ¶æ¯ç§’çš„å¹³å‡é€Ÿç‡ï¼‰ï¼›å…¶ä»–è¿˜æœ‰å¦‚é™åˆ¶è¿œç¨‹æ¥å£è°ƒç”¨é€Ÿç‡ã€é™åˆ¶MQçš„æ¶ˆè´¹é€Ÿç‡ã€‚å¦å¤–è¿˜å¯ä»¥æ ¹æ®ç½‘ç»œè¿æ¥æ•°ã€ç½‘ç»œæµé‡ã€CPUæˆ–å†…å­˜è´Ÿè½½ç­‰æ¥é™æµã€‚</p><h2 id="äºŒã€é™æµåŸºç¡€ç®—æ³•"><a href="#äºŒã€é™æµåŸºç¡€ç®—æ³•" class="headerlink" title="äºŒã€é™æµåŸºç¡€ç®—æ³•"></a>äºŒã€é™æµåŸºç¡€ç®—æ³•</h2><p>â€‹    é™æµåŸºç¡€ç®—æ³•æœ‰ä¸¤ç§ï¼šä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•</p><h3 id="1-æ¼æ¡¶ç®—æ³•"><a href="#1-æ¼æ¡¶ç®—æ³•" class="headerlink" title="1)æ¼æ¡¶ç®—æ³•"></a>1)æ¼æ¡¶ç®—æ³•</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/801753-20190824212037987-415810352.png" alt="801753-20190824212037987-415810352"></p><p>â€‹    æ¼æ¡¶ç®—æ³•å¯ä»¥å¼ºåˆ¶çš„<strong>é™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡</strong>ã€‚æ¼æ¡¶ç®—æ³•åŸç†ä¸ºå°†è¯·æ±‚å…ˆè¿›å…¥åˆ°ä¸€ä¸ªæ¼æ¡¶é‡Œï¼Œç„¶åäººä¸ºè®¾ç½®ä¸€ä¸ªæœ€å¤§çš„å‡ºæ°´é€Ÿç‡ï¼Œä¿è¯æ¼æ¡¶çš„å‡ºæ°´é€Ÿç‡å°äºç­‰äºè®¾ç½®è¿‡çš„å‡ºæ°´é€Ÿç‡ï¼Œå½“æ°´æµè¿‡å¤§çš„æ—¶å€™å°±ä¼šç›´æ¥æº¢å‡ºï¼Œä¹Ÿå°±æ˜¯é‡‡å–æ‹’ç»ç­–ç•¥ã€‚æ¼æ¡¶ç®—æ³•çš„å®ç°å¾€å¾€ä¾èµ–äº<strong>é˜Ÿåˆ—</strong>ï¼Œè¯·æ±‚åˆ°è¾¾å¦‚æœé˜Ÿåˆ—æœªæ»¡åˆ™ç›´æ¥æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åæœ‰ä¸€ä¸ªå¤„ç†å™¨æŒ‰ç…§å›ºå®šé¢‘ç‡ä»é˜Ÿåˆ—å¤´å–å‡ºè¯·æ±‚è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¯·æ±‚é‡å¤§ï¼Œåˆ™ä¼šå¯¼è‡´é˜Ÿåˆ—æ»¡ï¼Œé‚£ä¹ˆæ–°æ¥çš„è¯·æ±‚å°±ä¼šè¢«æŠ›å¼ƒã€‚</p><p>â€‹    ç®—æ³•çš„å¤§è‡´æµç¨‹å°±æ˜¯ï¼š</p><ul><li>å­˜ä¸‹è¯·æ±‚</li><li>åŒ€é€Ÿå¤„ç†</li><li>å¤šä½™ä¸¢å¼ƒ</li></ul><p>æ¼æ¡¶ç®—æ³•çš„ç¼ºç‚¹ååˆ†æ˜æ˜¾ï¼Œå› ä¸ºæ¼æ¡¶ç®—æ³•æ˜¯ä¸€ç§å¼ºåˆ¶é™åˆ¶è¯·æ±‚é€Ÿç‡çš„æ–¹å¼ï¼Œæ‰€ä»¥å®ƒæ— æ³•å¤„ç†<strong>çªå‘çš„å¤§æµé‡</strong>ï¼Œç½‘ç»œè¯·æ±‚ä¸­çªç„¶æ¿€å¢çš„æµé‡æ˜¯ååˆ†å¸¸è§çš„ï¼Œè€Œæ¼æ¡¶ç®—æ³•çš„ç­–ç•¥å¯èƒ½æ˜¯ç›´æ¥å°†è¯·æ±‚ä¸¢å¼ƒï¼Œè¿™æ˜¯ååˆ†ä¸åˆç†çš„ã€‚</p><h3 id="2-ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#2-ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="2)ä»¤ç‰Œæ¡¶ç®—æ³•"></a>2)ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>â€‹    ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé™æµï¼ˆRate Limitingï¼‰ä¸­æœ€å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•ï¼Œå®ƒå¯ç”¨äºæ§åˆ¶å‘é€åˆ°ç½‘ç»œä¸Šæ•°æ®çš„æ•°é‡å¹¶å…è®¸çªå‘æ•°æ®çš„å‘é€ã€‚</p><p>â€‹    ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯å¯¹æ¼æ¡¶ç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼›</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/081226107372877.png" alt="img"></p><p>â€‹    ä»¤ç‰Œæ¡¶çš„å¤„ç†è¿‡ç¨‹å¤§æ¦‚æ˜¯ï¼š</p><ul><li>ç³»ç»Ÿå›ºå®šé€Ÿç‡äº§ç”Ÿä»¤ç‰Œï¼Œç„¶åå°†ä»¤ç‰Œæ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­</li><li>ä»¤ç‰Œæ¡¶æœ‰å›ºå®šå®¹é‡ï¼Œä»¤ç‰Œæ¡¶æ»¡äº†ï¼Œå†äº§ç”Ÿçš„ä»¤ç‰Œå°±ä¼šè¢«ä¸¢å¼ƒ</li><li>æ¯æ¬¡å‘ç”Ÿè¯·æ±‚ï¼Œéƒ½ä¼šä»ä»¤ç‰Œæ¡¶ä¸­è·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœå–åˆ°ï¼Œè¯·æ±‚é€šè¿‡ï¼›å¦‚æœæ²¡å–åˆ°ï¼Œé‚£ä¹ˆå°±æ‹’ç»è¯·æ±‚</li></ul><p>â€‹    ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢çªå‘æµé‡(<strong>å¹³æ»‘æµå‡ºé€Ÿç‡</strong>)ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦çš„é€Ÿç‡æ˜¯1000QPSï¼Œé‚£ä¹ˆå¾€æ¡¶ä¸­æ”¾ä»¤ç‰Œçš„é€Ÿåº¦å°±æ˜¯1000ä¸ª/sï¼Œå‡è®¾ç¬¬1ç§’åªæœ‰800ä¸ªè¯·æ±‚ï¼Œé‚£æ„å‘³ç€ç¬¬2ç§’å¯ä»¥å®¹è®¸1200ä¸ªè¯·æ±‚ï¼Œè¿™å°±æ˜¯<strong>ä¸€å®šç¨‹åº¦</strong>çªå‘æµé‡çš„æ„æ€ï¼Œåä¹‹æˆ‘ä»¬çœ‹æ¼æ¡¶ç®—æ³•ï¼Œç¬¬ä¸€ç§’åªæœ‰800ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå…¨éƒ¨æ”¾è¿‡ï¼Œç¬¬äºŒç§’è¿™1200ä¸ªè¯·æ±‚å°†ä¼šè¢«æ‰“å›200ä¸ªã€‚ï¼ˆæ˜¯åœ¨è®¾ç½®æ¡¶ä¸­ä»¤ç‰Œä¸Šé™æ»¡è¶³çš„æƒ…å†µä¸‹ï¼‰</p><h2 id="ä¸‰ã€RateLimiter"><a href="#ä¸‰ã€RateLimiter" class="headerlink" title="ä¸‰ã€RateLimiter"></a>ä¸‰ã€RateLimiter</h2><h3 id="1ã€SmoothBursty-å¹³æ»‘çªå‘é™æµ"><a href="#1ã€SmoothBursty-å¹³æ»‘çªå‘é™æµ" class="headerlink" title="1ã€SmoothBursty å¹³æ»‘çªå‘é™æµ"></a>1ã€SmoothBursty å¹³æ»‘çªå‘é™æµ</h3><p>ä¸€æ®µä»£ç ç¤ºä¾‹ï¼Œä»¤ç‰Œæ¡¶ä¸­æ”¾ç½®5ä¸ªä»¤ç‰Œï¼Œæ¨¡æ‹Ÿæ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuchanglin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: LimiterTest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/25 1:11 ä¸Šåˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LimiterTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleDateFormat FORMATTER = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THREAD_COUNT = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testRateLimiter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RateLimiter rateLimiter = RateLimiter.create(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        Thread[] ts = <span class="keyword">new</span> Thread[THREAD_COUNT];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREAD_COUNT; i++) &#123;</span><br><span class="line">            ts[i] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> RateLimiterThread(rateLimiter), <span class="string">"RateLimiterThread-"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREAD_COUNT; i++) &#123;</span><br><span class="line">            ts[i].start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RateLimiterThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> RateLimiter rateLimiter;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">RateLimiterThread</span><span class="params">(RateLimiter rateLimiter)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.rateLimiter = rateLimiter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            rateLimiter.acquire(<span class="number">1</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() </span><br><span class="line">                               + <span class="string">"è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = "</span> + FORMATTER.format(<span class="keyword">new</span> Date()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        testRateLimiter();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¿è¡Œç»“æœï¼š</p><blockquote><p>RateLimiterThread-0è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:23<br>RateLimiterThread-15è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:23<br>RateLimiterThread-16è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:23<br>RateLimiterThread-14è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:23<br>RateLimiterThread-13è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:24<br>RateLimiterThread-12è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:24<br>RateLimiterThread-11è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:24<br>RateLimiterThread-17è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:24<br>RateLimiterThread-18è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:24<br>RateLimiterThread-10è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:25<br>RateLimiterThread-9è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:25<br>RateLimiterThread-8è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:25<br>RateLimiterThread-7è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:25<br>RateLimiterThread-6è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:25<br>RateLimiterThread-5è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:26<br>RateLimiterThread-4è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:26<br>RateLimiterThread-3è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:26<br>RateLimiterThread-19è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:26<br>RateLimiterThread-2è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:26<br>RateLimiterThread-1è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:27<br>RateLimiterThread-20è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:27<br>RateLimiterThread-21è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:27<br>RateLimiterThread-22è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:27<br>RateLimiterThread-23è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:27<br>RateLimiterThread-24è·å–åˆ°äº†ä»¤ç‰Œï¼Œæ—¶é—´ = 2021-10-25 01:23:28</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ç§’åªæœ‰5ä¸ªçº¿ç¨‹å¯ä»¥å–åˆ°ä»¤ç‰Œã€‚</p><ul><li>acquireä¼šé˜»å¡çº¿ç¨‹ç›´åˆ°çº¿ç¨‹è·å–åˆ°ä»¤ç‰Œï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªdoubleç±»å‹ï¼Œè¡¨ç¤ºä»å¼€å§‹é˜»å¡åˆ°è·å–åˆ°ä»¤ç‰Œçš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼›</li><li>tryAquireå¯ä»¥æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œè¿”å›å€¼ä¸ºbooleanç±»å‹ï¼›</li></ul><h3 id="RateLimiter-é¢„æ¶ˆè´¹"><a href="#RateLimiter-é¢„æ¶ˆè´¹" class="headerlink" title="RateLimiter é¢„æ¶ˆè´¹"></a>RateLimiter é¢„æ¶ˆè´¹</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20211025021453432.png" alt="image-20211025021453432"></p><p>acquireæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°ä¸ºpermitsçš„é‡è½½æ–¹æ³•ï¼Œå®ƒå¯ä»¥å…è®¸ä¸€æ¬¡æŒ‡å®šå¤šä¸ªä»¤ç‰Œæ•°  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testRateLimiterPermits</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    RateLimiter rateLimiter = RateLimiter.create(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"è·å–1ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    <span class="keyword">double</span> cost = rateLimiter.acquire(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">"è·å–1ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()) + <span class="string">", è€—æ—¶"</span> + cost + <span class="string">"ms"</span>);</span><br><span class="line">    System.out.println(<span class="string">"è·å–5ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    cost = rateLimiter.acquire(<span class="number">5</span>);</span><br><span class="line">    System.out.println(<span class="string">"è·å–5ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()) + <span class="string">", è€—æ—¶"</span> + cost + <span class="string">"ms"</span>);</span><br><span class="line">    System.out.println(<span class="string">"è·å–3ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    cost = rateLimiter.acquire(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">"è·å–3ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º"</span> + FORMATTER.format(<span class="keyword">new</span> Date()) + <span class="string">", è€—æ—¶"</span> + cost + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¾“å‡ºç»“æœğŸ‘‡ğŸ»</p><blockquote><p>è·å–1ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º2021-10-25 02:16:57<br>è·å–1ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º2021-10-25 02:16:57, è€—æ—¶0.0ms<br>è·å–5ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º2021-10-25 02:16:57<br>è·å–5ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º2021-10-25 02:16:58, è€—æ—¶0.996506ms<br>è·å–3ä¸ªä»¤ç‰Œå¼€å§‹ï¼Œæ—¶é—´ä¸º2021-10-25 02:16:58<br>è·å–3ä¸ªä»¤ç‰Œç»“æŸï¼Œæ—¶é—´ä¸º2021-10-25 02:17:03, è€—æ—¶4.994537ms</p></blockquote><p>ä»ç»“æœä¸Šçœ‹ï¼Œå¦‚æœè¯·æ±‚çš„æ•°é‡å¤§äºé˜²æ­¢ä»¤ç‰Œçš„æ•°é‡ï¼Œé‚£ä¹ˆè¿™æ˜¯å¯ä»¥å…è®¸å¤„ç†çš„ï¼Œä½†æ˜¯å½±å“å°±æ˜¯åç»­çš„è¯·æ±‚å°±è¦å»¶åå¤„ç†ã€‚</p><h3 id="2ã€SmoothWarmingUp-å¹³æ»‘é¢„çƒ­é™æµ"><a href="#2ã€SmoothWarmingUp-å¹³æ»‘é¢„çƒ­é™æµ" class="headerlink" title="2ã€SmoothWarmingUp å¹³æ»‘é¢„çƒ­é™æµ"></a>2ã€SmoothWarmingUp å¹³æ»‘é¢„çƒ­é™æµ</h3><p>RateLimiter è¿˜å…·æœ‰å¹³æ»‘é¢„çƒ­é™æµçš„ä½¿ç”¨æ–¹å¼ï¼Œé€šè¿‡<code>create</code>æ–¹æ³•ä¸­çš„å‚æ•°é…ç½®ï¼Œå¯ä»¥æŒ‡å®šRateLimiterçš„ä¸€æ®µé¢„çƒ­æ—¶é—´ğŸ‘‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testSmoothWarmingUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæ˜¯æŒ‡æ¯ç§’2ä¸ªä»¤ç‰Œ 3ç§’é¢„çƒ­æ—¶é—´</span></span><br><span class="line">        RateLimiter r = RateLimiter.create(<span class="number">2</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"get 1 tokens: "</span> + r.acquire(<span class="number">1</span>) + <span class="string">"s"</span>);</span><br><span class="line">            System.out.println(<span class="string">"get 1 tokens: "</span> + r.acquire(<span class="number">1</span>) + <span class="string">"s"</span>);</span><br><span class="line">            System.out.println(<span class="string">"get 1 tokens: "</span> + r.acquire(<span class="number">1</span>) + <span class="string">"s"</span>);</span><br><span class="line">            System.out.println(<span class="string">"get 1 tokens: "</span> + r.acquire(<span class="number">1</span>) + <span class="string">"s"</span>);</span><br><span class="line">            System.out.println(<span class="string">"end"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20220203173304426.png" alt="image-20220203173304426" style="zoom:50%;" /></p><p>â€‹    æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰ä¸‰æ¬¡ä»¤ç‰Œçš„è·å–å°±è€—æ—¶äº†æ€»å…±çº¦3sçš„æ—¶é—´ï¼Œè¿™ä»£è¡¨RateLimiteråœ¨å‰ä¸‰ç§’å¤„äºé¢„çƒ­çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯ä¸€å¼€å§‹æˆ‘ä»¬æœŸæœ›çš„æ¯ç§’2ä¸ªä»¤ç‰Œçš„é€Ÿç‡ã€‚</p><p>â€‹    å¹³æ»‘é¢„çƒ­é™æµé€‚ç”¨äºèµ„æºéœ€è¦é¢„çƒ­çš„åœºæ™¯ï¼Œæ¯”å¦‚æœåŠ¡å¯åŠ¨æ—¶æ•°æ®åº“è¿æ¥è¿˜æ²¡æœ‰åŠ è½½å®Œæˆï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¦‚æœå¤§æ‰¹é‡çš„è¯·æ±‚è¿›å…¥å°±ä¼šç»™æœåŠ¡å¸¦æ¥ä¸å¿…è¦çš„å‹åŠ›ï¼Œä¸€ä¸ªé¢„çƒ­çš„é™æµå°±å¯ä»¥é¿å…è¿™æ ·çš„é—®é¢˜å‘ç”Ÿã€‚</p><h3 id="RateLimiterçš„é™åˆ¶"><a href="#RateLimiterçš„é™åˆ¶" class="headerlink" title="RateLimiterçš„é™åˆ¶"></a>RateLimiterçš„é™åˆ¶</h3><p>â€‹    RateLimiter æ˜¯å•æœºçš„å¦‚æœéœ€è¦å¯¹é›†ç¾¤è¿›è¡Œé™æµï¼Œå°±éœ€è¦å€ŸåŠ©äºRedisã€sentinelç­‰æ¥å®ç°ï¼›</p><h2 id="å››ã€æºç "><a href="#å››ã€æºç " class="headerlink" title="å››ã€æºç "></a>å››ã€æºç </h2><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20211025023935179.png" alt="image-20211025023935179" style="zoom:50%;" /></p><p>é¦–å…ˆä½œä¸ºæŠ½è±¡çˆ¶ç±»çš„<code>RateLimiter</code>åªæœ‰ä¸¤ä¸ªå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RateLimiter.SleepingStopwatch stopwatch;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> Object mutexDoNotUseDirectly;</span><br></pre></td></tr></table></figure><p>â€‹    è¿™ä¸¤ä¸ªå±æ€§ä¸­çš„ stopwatchç”¨äº è®¡æ—¶ ï¼Œå…¶ä»–é€»è¾‘ä¸­å…³äºæ—¶é—´çš„è®¡ç®—åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±å®ƒæ¥å®Œæˆçš„ï¼Œå¦å¤–ä¸€ä¸ªmutexDoNotUserDirectlyç”¨æ¥åšé”ï¼ŒRateLimiter ä¾èµ–äº synchronized æ¥æ§åˆ¶å¹¶å‘ï¼Œå„ä¸ªå±æ€§ç”šè‡³éƒ½æ²¡æœ‰ç”¨ volatile ä¿®é¥°ã€‚    </p><p>â€‹    ä¹‹ååœ¨<code>SmoothRateLimiter</code>ä¸­è´Ÿè´£å®ç°å¤§éƒ¨åˆ†æ–¹æ³•å’Œé€»è¾‘ï¼Œå®ƒçš„å±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SmoothRateLimiter.java</span></span><br><span class="line"><span class="comment">//å½“å‰å­˜å‚¨ä»¤ç‰Œæ•°</span></span><br><span class="line"><span class="keyword">double</span> storedPermits;</span><br><span class="line"><span class="comment">//æœ€å¤§å­˜å‚¨ä»¤ç‰Œæ•°</span></span><br><span class="line"><span class="keyword">double</span> maxPermits;</span><br><span class="line"><span class="comment">//æ·»åŠ ä»¤ç‰Œæ—¶é—´é—´éš”</span></span><br><span class="line"><span class="keyword">double</span> stableIntervalMicros;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸‹ä¸€æ¬¡è¯·æ±‚å¯ä»¥è·å–ä»¤ç‰Œçš„èµ·å§‹æ—¶é—´</span></span><br><span class="line"><span class="comment"> * ç”±äºRateLimiterå…è®¸é¢„æ¶ˆè´¹ï¼Œä¸Šæ¬¡è¯·æ±‚é¢„æ¶ˆè´¹ä»¤ç‰Œå</span></span><br><span class="line"><span class="comment"> * ä¸‹æ¬¡è¯·æ±‚éœ€è¦ç­‰å¾…ç›¸åº”çš„æ—¶é—´åˆ°nextFreeTicketMicrosæ—¶åˆ»æ‰å¯ä»¥è·å–ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> nextFreeTicketMicros = <span class="number">0L</span>;</span><br></pre></td></tr></table></figure><h3 id="1ã€å¹³æ»‘çªå‘é™æµ-SmoothBursty-åˆ†æ"><a href="#1ã€å¹³æ»‘çªå‘é™æµ-SmoothBursty-åˆ†æ" class="headerlink" title="1ã€å¹³æ»‘çªå‘é™æµ SmoothBursty åˆ†æ"></a>1ã€å¹³æ»‘çªå‘é™æµ SmoothBursty åˆ†æ</h3><p>â€‹    é¦–å…ˆæ˜¯å¹³æ»‘çªå‘é™æµçš„<code>RateLimiter</code>çš„æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RateLimiter <span class="title">create</span><span class="params">(<span class="keyword">double</span> permitsPerSecond)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> create(permitsPerSecond, RateLimiter.SleepingStopwatch.createFromSystemTimer());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> RateLimiter <span class="title">create</span><span class="params">(<span class="keyword">double</span> permitsPerSecond, RateLimiter.SleepingStopwatch stopwatch)</span> </span>&#123;</span><br><span class="line">    RateLimiter rateLimiter = <span class="keyword">new</span> SmoothBursty(stopwatch, <span class="number">1.0</span>D <span class="comment">/* maxBurstSeconds */</span>);</span><br><span class="line">    rateLimiter.setRate(permitsPerSecond); <span class="comment">// setRate</span></span><br><span class="line">    <span class="keyword">return</span> rateLimiter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å¯ä»¥çœ‹åˆ°å¹³æ»‘çªå‘é™æµå°±æ˜¯å¯¹å­ç±»SmoothBurstyçš„å®ç°</p><p>â€‹    SmoothBursty æœ‰ä¸€ä¸ªå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ å‡½æ•°æŒ‡å®šäº† maxBurstSeconds ä¸º 1.0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¤šä¼šç¼“å­˜ 1 ç§’é’Ÿï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå°±æ˜¯ (1.0 * permitsPerSecond) è¿™ä¹ˆå¤šä¸ª permits åˆ°æ± ä¸­ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">double</span> maxBurstSeconds;</span><br></pre></td></tr></table></figure><p>â€‹    è¿™ä¸ªå±æ€§åœ¨<code>create</code>æ–¹æ³•ä¸­å·²ç»è¢«æŒ‡å®šä¸º1ï¼›</p><p>â€‹    æ¥ä¸‹æ¥çœ‹<code>setRate</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pulic æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setRate</span><span class="params">(<span class="keyword">double</span> permitsPerSecond)</span> </span>&#123;</span><br><span class="line">        Preconditions.checkArgument(permitsPerSecond &gt; <span class="number">0.0</span>D &amp;&amp; !Double.isNaN(permitsPerSecond), <span class="string">"rate must be positive"</span>);</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.mutex()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doSetRate(permitsPerSecond, <span class="keyword">this</span>.stopwatch.readMicros());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">doSetRate</span><span class="params">(<span class="keyword">double</span> permitsPerSecond, <span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.resync(nowMicros);</span><br><span class="line">        <span class="keyword">double</span> stableIntervalMicros = (<span class="keyword">double</span>)TimeUnit.SECONDS.toMicros(<span class="number">1L</span>) / permitsPerSecond;</span><br><span class="line">        <span class="keyword">this</span>.stableIntervalMicros = stableIntervalMicros;</span><br><span class="line">        <span class="keyword">this</span>.doSetRate(permitsPerSecond, stableIntervalMicros);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹    setRateé¦–å…ˆè¿›è¡Œäº†å‚æ•°çš„æ ¡éªŒï¼Œç„¶åè¿™é‡Œçš„<code>resync</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resync</span><span class="params">(<span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (nowMicros &gt; <span class="keyword">this</span>.nextFreeTicketMicros) &#123;</span><br><span class="line">         <span class="comment">// coolDownIntervalMicros è¿™é‡Œçš„è¿™ä¸ªæ–¹æ³•è¿”å›çš„å°±æ˜¯æ·»åŠ ä»¤ç‰Œæ—¶é—´é—´éš”</span></span><br><span class="line">           <span class="keyword">double</span> newPermits = (<span class="keyword">double</span>)(nowMicros - <span class="keyword">this</span>.nextFreeTicketMicros) / <span class="keyword">this</span>.coolDownIntervalMicros();</span><br><span class="line">           <span class="keyword">this</span>.storedPermits = Math.min(<span class="keyword">this</span>.maxPermits, <span class="keyword">this</span>.storedPermits + newPermits);</span><br><span class="line">           <span class="keyword">this</span>.nextFreeTicketMicros = nowMicros;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>resyncæ–¹æ³•å°±æ˜¯å°†å½“å‰æ—¶é—´ä½œä¸ºå‚æ•°ï¼Œåˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦å¤§äºâ€˜ä¸‹æ¬¡å¯ä»¥è·å–ä»¤ç‰Œâ€˜çš„æ—¶é—´ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥é‡æ–°åˆ·æ–°ä»¤ç‰Œæ± ä¸­å¯ä¾›ä½¿ç”¨çš„ä»¤ç‰Œæ•°é‡ï¼Œ</p><blockquote><p>åœ¨ SmoothBursty ç±»ä¸­çš„å®ç°æ˜¯ç›´æ¥è¿”å›äº† stableIntervalMicros çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ï¼Œæ¯äº§ç”Ÿä¸€ä¸ª permit çš„æ—¶é—´é•¿åº¦ã€‚</p><p>åœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨çš„resync æ­¤æ—¶çš„ stableIntervalMicros å…¶å®æ²¡æœ‰è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢å‘ç”Ÿäº†ä¸€æ¬¡é™¤ä»¥ 0 å€¼çš„æ“ä½œï¼Œå¾—åˆ°çš„ newPermits å…¶å®æ˜¯ä¸€ä¸ªæ— ç©·å¤§ã€‚è€Œ maxPermits æ­¤æ—¶è¿˜æ˜¯ 0 å€¼ï¼Œä¸è¿‡è¿™é‡Œå…¶å®æ²¡æœ‰å…³ç³»ã€‚</p></blockquote><p>resyncæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå¯¹<code>stableIntervalMicros</code>è¿›è¡Œäº†èµ‹å€¼ï¼Œè¿™é‡Œåˆè¿›è¡Œäº†ä¸€æ¬¡setRateï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSetRate</span><span class="params">(<span class="keyword">double</span> permitsPerSecond, <span class="keyword">double</span> stableIntervalMicros)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> oldMaxPermits = <span class="keyword">this</span>.maxPermits;</span><br><span class="line">    <span class="keyword">this</span>.maxPermits = <span class="keyword">this</span>.maxBurstSeconds * permitsPerSecond;</span><br><span class="line">    <span class="keyword">if</span> (oldMaxPermits == <span class="number">1.0</span>D / <span class="number">0.0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.storedPermits = <span class="keyword">this</span>.maxPermits;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.storedPermits = oldMaxPermits == <span class="number">0.0</span>D ? <span class="number">0.0</span>D : <span class="keyword">this</span>.storedPermits * <span class="keyword">this</span>.maxPermits / oldMaxPermits;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å› ä¸ºsetRateæ˜¯ä¸€ä¸ªpublicæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨RateLimiteråˆ›å»ºåˆå§‹åŒ–ä¹‹åä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥åŠ¨æ€çš„è°ƒæ•´å®ƒçš„é€Ÿç‡ï¼Œè¿™éƒ¨åˆ†åˆå§‹åŒ–äº†maxPermitså‚æ•°ï¼Œå¹¶ä¸”ä¹Ÿå¯¹storedPermitså‚æ•°è¿›è¡Œäº†è°ƒæ•´ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨ä¸€æ¬¡setRateå¯¹äº maxPermits æ¥è¯´ï¼Œæ˜¯é‡æ–°è®¡ç®—ï¼Œè€Œå¯¹äº storedPermits æ¥è¯´ï¼Œæ˜¯åšç­‰æ¯”ä¾‹çš„ç¼©æ”¾ã€‚</p><p>â€‹    åˆå§‹åŒ–çš„ä»£ç åŸºæœ¬åˆ°æ­¤å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥æ˜¯acquireéƒ¨åˆ†ï¼ŒRateLimiteræ˜¯æ€æ ·é€šè¿‡è®¡ç®—æ—¶é—´çš„æ–¹å¼æ¥æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„ä»¤ç‰Œçš„ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CanIgnoreReturnValue</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">acquire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.acquire(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CanIgnoreReturnValue</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®—éœ€è¦sleepç­‰å¾…çš„æ—¶é—´</span></span><br><span class="line">      <span class="keyword">long</span> microsToWait = <span class="keyword">this</span>.reserve(permits);</span><br><span class="line">     <span class="comment">// sleep</span></span><br><span class="line">      <span class="keyword">this</span>.stopwatch.sleepMicrosUninterruptibly(microsToWait);</span><br><span class="line">    <span class="comment">// è¿”å›sleepçš„æ—¶é—´</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1.0</span>D * (<span class="keyword">double</span>)microsToWait / (<span class="keyword">double</span>)TimeUnit.SECONDS.toMicros(<span class="number">1L</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—éœ€è¦sleepç­‰å¾…çš„æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">long</span> <span class="title">reserve</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">      checkPermits(permits); <span class="comment">// æ£€æŸ¥æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„permitså‚æ•°</span></span><br><span class="line">      <span class="keyword">synchronized</span>(<span class="keyword">this</span>.mutex()) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.reserveAndGetWaitLength(permits, <span class="keyword">this</span>.stopwatch.readMicros());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">long</span> <span class="title">reserveAndGetWaitLength</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">long</span> momentAvailable = <span class="keyword">this</span>.reserveEarliestAvailable(permits, nowMicros);</span><br><span class="line">      <span class="keyword">return</span> Math.max(momentAvailable - nowMicros, <span class="number">0L</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">long</span> <span class="title">reserveEarliestAvailable</span><span class="params">(<span class="keyword">int</span> requiredPermits, <span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.resync(nowMicros); <span class="comment">// åˆ·æ–°ä»¤ç‰Œæ± </span></span><br><span class="line">      <span class="keyword">long</span> returnValue = <span class="keyword">this</span>.nextFreeTicketMicros; <span class="comment">// ä¸‹æ¬¡å¯ä»¥å–åˆ°ä»¤ç‰Œçš„æ—¶é—´</span></span><br><span class="line">    <span class="comment">// è®¡ç®—åœ¨å½“å‰ä»¤ç‰Œæ± ä¸­éœ€è¦ä½¿ç”¨çš„ä»¤ç‰Œæ•°é‡[è¯·æ±‚çš„ä»¤ç‰Œæ•°å¯èƒ½å¤§äºå½“å‰ä»¤ç‰Œæ± ä¸­çš„æœ‰æ•ˆä»¤ç‰Œæ•°ï¼Œé¢„æ¶ˆè´¹é€»è¾‘]</span></span><br><span class="line">      <span class="keyword">double</span> storedPermitsToSpend = Math.min((<span class="keyword">double</span>)requiredPermits, <span class="keyword">this</span>.storedPermits);</span><br><span class="line">    <span class="comment">// è®¡ç®—é¢„æ¶ˆè´¹ä¸­ä¸å¤Ÿçš„éƒ¨åˆ†</span></span><br><span class="line">      <span class="keyword">double</span> freshPermits = (<span class="keyword">double</span>)requiredPermits - storedPermitsToSpend;</span><br><span class="line">      <span class="comment">// storedPermitsToWaitTime åœ¨å¹³æ»‘çªå‘é™æµæ¨¡å¼ä¸­é»˜è®¤è¿”å›ä¸º0</span></span><br><span class="line">    <span class="comment">// è®¡ç®—æ€»å…±éœ€è¦ç­‰å¾…çš„æ—¶é—´</span></span><br><span class="line">      <span class="keyword">long</span> waitMicros = <span class="keyword">this</span>.storedPermitsToWaitTime(<span class="keyword">this</span>.storedPermits, storedPermitsToSpend) + (<span class="keyword">long</span>)(freshPermits * <span class="keyword">this</span>.stableIntervalMicros);</span><br><span class="line">    <span class="comment">// è®¡ç®—ä¸‹æ¬¡æœ‰æœ‰æ•ˆä»¤ç‰Œçš„å…·ä½“æ—¶é—´ï¼Œé‡æ–°æ›´æ–°nextFreeTicketMicros</span></span><br><span class="line">      <span class="keyword">this</span>.nextFreeTicketMicros = LongMath.saturatedAdd(<span class="keyword">this</span>.nextFreeTicketMicros, waitMicros);</span><br><span class="line">      <span class="keyword">this</span>.storedPermits -= storedPermitsToSpend;</span><br><span class="line">      <span class="keyword">return</span> returnValue;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>â€‹    è¿”å›å€¼æ˜¯ nextFreeTicketMicros çš„æ—§å€¼ï¼Œå› ä¸ºåªè¦åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå°±è¯´æ˜å½“æ¬¡ acquire å¯ä»¥æˆåŠŸè¿”å›äº†ï¼Œè€Œä¸ç®¡ storedPermits å¤Ÿä¸å¤Ÿã€‚å¦‚æœ storedPermits ä¸å¤Ÿï¼Œä¼šå°† nextFreeTicketMicros å¾€å‰æ¨ä¸€å®šçš„æ—¶é—´ï¼Œé¢„å äº†ä¸€å®šçš„é‡ã€‚</p><h3 id="2ã€å¹³æ»‘é¢„çƒ­é™æµ-SmoothWarmingUp-åˆ†æ"><a href="#2ã€å¹³æ»‘é¢„çƒ­é™æµ-SmoothWarmingUp-åˆ†æ" class="headerlink" title="2ã€å¹³æ»‘é¢„çƒ­é™æµ SmoothWarmingUp åˆ†æ"></a>2ã€å¹³æ»‘é¢„çƒ­é™æµ SmoothWarmingUp åˆ†æ</h3><p>â€‹    <img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/format,png.png" alt="img"></p><p><em>X è½´ä»£è¡¨ storedPermits çš„æ•°é‡ï¼ŒY è½´ä»£è¡¨è·å–ä¸€ä¸ª permits éœ€è¦çš„æ—¶é—´</em></p><blockquote><p>  å‡è®¾æŒ‡å®š permitsPerSecond ä¸º 10ï¼Œé‚£ä¹ˆ stableInterval ä¸º 100msï¼Œè€Œ coldInterval æ˜¯ 3 å€ï¼Œä¹Ÿå°±æ˜¯ 300msï¼ˆcoldFactorï¼Œ3 å€æ˜¯å†™æ­»çš„ï¼Œç”¨æˆ·ä¸èƒ½ä¿®æ”¹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¾¾åˆ° maxPermits æ—¶ï¼Œæ­¤æ—¶å¤„äºç³»ç»Ÿæœ€å†·çš„æ—¶å€™ï¼Œè·å–ä¸€ä¸ª permit éœ€è¦ 300msï¼Œè€Œå¦‚æœ storedPermits å°äº thresholdPermits çš„æ—¶å€™ï¼Œåªéœ€è¦ 100msã€‚</p></blockquote><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå›¾ä¸­æ¢¯å½¢æ‰€å¤„çš„åŒºåŸŸå°±ä»£è¡¨é¢„çƒ­æ—¶é—´ï¼Œé¢„çƒ­æœŸé—´å†…è·å–ä¸€ä¸ªpermitsçš„æ—¶é—´ä¼šç›¸æ¯”äºæ­£å¸¸æ—¶é—´çš„stable intervalè¦é•¿ï¼Œéšç€æœåŠ¡çš„å¯åŠ¨è·å–permitsçš„æ—¶é—´ä¼šè¶‹äºç¨³å®šã€‚</p><ul><li>å½“ç³»ç»Ÿåœ¨éå¸¸ç¹å¿™çš„æ—¶å€™ï¼Œè¿™æ¡çº¿åœç•™åœ¨ x=0 å¤„ï¼Œæ­¤æ—¶ storedPermits ä¸º 0</li><li>å½“ limiter æ²¡æœ‰è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿™æ¡çº¿æ…¢æ…¢å¾€å³ç§»åŠ¨ï¼Œç›´åˆ° x=maxPermits å¤„ï¼›</li><li>å¦‚æœ limiter è¢«é‡æ–°ä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™æ¡çº¿åˆæ…¢æ…¢å¾€å·¦ç§»åŠ¨ï¼Œç›´åˆ° x=0 å¤„ï¼Œå½“ storedPermits å¤„äº maxPermits çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸º limiter ä¸­çš„ permits æ˜¯å†·çš„ï¼Œæ­¤æ—¶è·å–ä¸€ä¸ª permit éœ€è¦è¾ƒå¤šçš„æ—¶é—´ï¼Œå› ä¸ºéœ€è¦é¢„çƒ­ï¼Œæœ‰ä¸€ä¸ªå…³é”®çš„åˆ†ç•Œç‚¹æ˜¯ <strong>thresholdPermits</strong>ã€‚</li></ul><p><strong>é¢„çƒ­æ—¶é—´</strong>æ˜¯åˆ›å»ºRaterLimiterå¯¹è±¡æ—¶æŒ‡å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡é¢„çƒ­æ—¶é—´è®¡ç®—å‡º<strong>thresholdPermits</strong> å’Œ <strong>maxPermits</strong> çš„å€¼ï¼Œç”±äºå›¾ä¸­xè½´å’Œyè½´åˆ†åˆ«ä»£è¡¨ä¿å­˜çš„ä»¤ç‰Œæ•°é‡å’Œè·å–ä»¤ç‰Œçš„æ—¶é—´ï¼Œé€šè¿‡æ•°å­¦å¸¸è¯†æˆ‘é—¨ä¸éš¾å¾—å‡º<strong>æ¢¯å½¢çš„é¢ç§¯å°±æ˜¯é¢„çƒ­æ—¶é—´</strong>ã€‚</p><blockquote><p>  ä» thresholdPermits åˆ° 0 çš„æ—¶é—´ï¼Œæ˜¯ä» maxPermits åˆ° thresholdPermits æ—¶é—´çš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯æ¢¯å½¢çš„é¢ç§¯æ˜¯é•¿æ–¹å½¢é¢ç§¯çš„ 2 å€ï¼Œæ¢¯å½¢çš„é¢ç§¯æ˜¯ warmupPeriodã€‚ï¼ˆå‰æï¼‰ä¹‹æ‰€ä»¥é•¿æ–¹å½¢çš„é¢ç§¯æ˜¯ warmupPeriod/2ï¼Œæ˜¯å› ä¸º coldFactor æ˜¯ç¡¬ç¼–ç çš„ 3ã€‚</p></blockquote><p>ç”±äºæ¢¯å½¢é¢ç§¯ä¸ºwarmupPeriodï¼Œä¸”å­˜åœ¨äºŒå€å…³ç³»ï¼Œæ•…æœ‰ï¼š</p><script type="math/tex; mode=display">warmupPeriod = 2 * stableInterval * thresholdPermits</script><p>äº¦å¾—ï¼š</p><script type="math/tex; mode=display">thresholdPermits = 0.5 * warmupPeriod / stableInterval</script><p>æ¢¯å½¢é¢ç§¯å¯é€šè¿‡æ¢¯å½¢é¢ç§¯å…¬å¼ä»¥ä¸‹é¢çš„æ–¹å¼è¡¨ç¤ºï¼š</p><script type="math/tex; mode=display">warmupPeriod = 0.5 * (stableInterval + coldInterval) * (maxPermits - thresholdPermits)</script><p>æ•´ç†åå¯ä»¥å°†maxPermitsè¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">maxPermits = thresholdPermits + 2.0 * warmupPeriod / (stableInterval + coldInterval)</script><p>å› ä¸ºwarmupPeriodæ˜¯æˆ‘ä»¬æŒ‡å®šçš„ï¼Œè€Œä¸”stableIntervalå¯ä»¥é€šè¿‡è®¡ç®—å¾—å‡ºï¼Œæ‰€ä»¥é€šè¿‡ä¸Šè¿°å…¬å¼å¯ä»¥è®¡ç®—å‡ºthresholdPermits å’Œ maxPermits çš„å€¼ã€‚</p><p>â€‹    å†·å´æ—¶é—´é—´éš”ï¼Œå®ƒæŒ‡çš„æ˜¯ storedPermits ä¸­æ¯ä¸ª permit çš„å¢é•¿é€Ÿåº¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„ x=k è¿™æ¡å‚ç›´çº¿å¾€å³çš„ç§»åŠ¨é€Ÿåº¦ï¼Œä¸ºäº†è¾¾åˆ°ä» 0 åˆ° maxPermits èŠ±è´¹ warmupPeriodMicros çš„æ—¶é—´ï¼Œæˆ‘ä»¬å°†å…¶å®šä¹‰ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">coolDownIntervalMicros</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> warmupPeriodMicros / maxPermits;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resync</span><span class="params">(<span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (nowMicros &gt; nextFreeTicketMicros) &#123;</span><br><span class="line">    <span class="comment">// coolDownIntervalMicros åœ¨è¿™é‡Œä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">double</span> newPermits = (nowMicros - nextFreeTicketMicros) / coolDownIntervalMicros();</span><br><span class="line">    storedPermits = min(maxPermits, storedPermits + newPermits);</span><br><span class="line">    nextFreeTicketMicros = nowMicros;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dosetæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSetRate</span><span class="params">(<span class="keyword">double</span> permitsPerSecond, <span class="keyword">double</span> stableIntervalMicros)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> oldMaxPermits = maxPermits;</span><br><span class="line">    <span class="comment">// coldFactor æ˜¯å›ºå®šçš„ 3</span></span><br><span class="line">    <span class="keyword">double</span> coldIntervalMicros = stableIntervalMicros * coldFactor;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå…¬å¼ä¸Šé¢å·²ç»è¯´äº†</span></span><br><span class="line">    thresholdPermits = <span class="number">0.5</span> * warmupPeriodMicros / stableIntervalMicros;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå…¬å¼ä¸Šé¢ä¹Ÿå·²ç»è¯´äº†</span></span><br><span class="line">    maxPermits =</span><br><span class="line">        thresholdPermits + <span class="number">2.0</span> * warmupPeriodMicros / (stableIntervalMicros + coldIntervalMicros);</span><br><span class="line">    <span class="comment">// è®¡ç®—é‚£æ¡æ–œçº¿çš„æ–œç‡ã€‚æ•°å­¦çŸ¥è¯†ï¼Œå¯¹è¾¹ / ä¸´è¾¹</span></span><br><span class="line">    slope = (coldIntervalMicros - stableIntervalMicros) / (maxPermits - thresholdPermits);</span><br><span class="line">    <span class="keyword">if</span> (oldMaxPermits == Double.POSITIVE_INFINITY) &#123;</span><br><span class="line">        <span class="comment">// if we don't special-case this, we would get storedPermits == NaN, below</span></span><br><span class="line">        storedPermits = <span class="number">0.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        storedPermits =</span><br><span class="line">            (oldMaxPermits == <span class="number">0.0</span>)</span><br><span class="line">                ? maxPermits <span class="comment">// initial state is cold</span></span><br><span class="line">                : storedPermits * maxPermits / oldMaxPermits;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aquireæ–¹æ³•ï¼š</p><p>åœ¨ SmoothWarmingUp çš„å®ç°ä¸­ï¼Œç”±äºéœ€è¦é¢„çƒ­ï¼Œæ‰€ä»¥ä» storedPermits ä¸­å– permits éœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ï¼Œé¦–å…ˆè¦çœ‹ä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿™é‡Œæ˜¯acquireçš„æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯å¯¹ç­‰å¾…æ—¶é—´çš„è®¡ç®—ä¹Ÿå°±æ˜¯<code>storedPermitsToWaitTime()</code>æ–¹æ³•çš„å†…å®¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">long</span> <span class="title">reserveEarliestAvailable</span><span class="params">(<span class="keyword">int</span> requiredPermits, <span class="keyword">long</span> nowMicros)</span> </span>&#123;</span><br><span class="line">  resync(nowMicros);</span><br><span class="line">  <span class="keyword">long</span> returnValue = nextFreeTicketMicros;</span><br><span class="line">  <span class="keyword">double</span> storedPermitsToSpend = min(requiredPermits, <span class="keyword">this</span>.storedPermits);</span><br><span class="line">  <span class="keyword">double</span> freshPermits = requiredPermits - storedPermitsToSpend;</span><br><span class="line">  <span class="keyword">long</span> waitMicros =</span><br><span class="line">    <span class="comment">//è¿™é‡Œè®¡ç®—ç­‰å¾…æ—¶é—´</span></span><br><span class="line">      storedPermitsToWaitTime(<span class="keyword">this</span>.storedPermits, storedPermitsToSpend)</span><br><span class="line">          + (<span class="keyword">long</span>) (freshPermits * stableIntervalMicros);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.nextFreeTicketMicros = LongMath.saturatedAdd(nextFreeTicketMicros, waitMicros);</span><br><span class="line">  <span class="keyword">this</span>.storedPermits -= storedPermitsToSpend;</span><br><span class="line">  <span class="keyword">return</span> returnValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰å¾…æ—¶é—´å…¶å®å°±æ˜¯è¦è®¡ç®—ä¸‹å›¾ä¸­ï¼Œé˜´å½±éƒ¨åˆ†çš„é¢ç§¯ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/format,png-20220723190946072.png" alt="img"></p><p>è®¡ç®—çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">storedPermitsToWaitTime</span><span class="params">(<span class="keyword">double</span> storedPermits, <span class="keyword">double</span> permitsToTake)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">double</span> availablePermitsAboveThreshold = storedPermits - thresholdPermits;</span><br><span class="line">  <span class="keyword">long</span> micros = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// å¦‚æœå³è¾¹æ¢¯å½¢éƒ¨åˆ†æœ‰ permitsï¼Œé‚£ä¹ˆå…ˆä»å³è¾¹éƒ¨åˆ†è·å–permitsï¼Œè®¡ç®—æ¢¯å½¢éƒ¨åˆ†çš„é˜´å½±éƒ¨åˆ†çš„é¢ç§¯</span></span><br><span class="line">  <span class="keyword">if</span> (availablePermitsAboveThreshold &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">    <span class="comment">// ä»å³è¾¹éƒ¨åˆ†è·å–çš„ permits æ•°é‡</span></span><br><span class="line">    <span class="keyword">double</span> permitsAboveThresholdToTake = min(availablePermitsAboveThreshold, permitsToTake);</span><br><span class="line">    <span class="comment">// æ¢¯å½¢é¢ç§¯å…¬å¼ï¼š(ä¸Šåº•+ä¸‹åº•)*é«˜/2</span></span><br><span class="line">    <span class="keyword">double</span> length =</span><br><span class="line">        permitsToTime(availablePermitsAboveThreshold)</span><br><span class="line">            + permitsToTime(availablePermitsAboveThreshold - permitsAboveThresholdToTake);</span><br><span class="line">    micros = (<span class="keyword">long</span>) (permitsAboveThresholdToTake * length / <span class="number">2.0</span>);</span><br><span class="line">    permitsToTake -= permitsAboveThresholdToTake;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åŠ ä¸Š é•¿æ–¹å½¢éƒ¨åˆ†çš„é˜´å½±é¢ç§¯</span></span><br><span class="line">  micros += (<span class="keyword">long</span>) (stableIntervalMicros * permitsToTake);</span><br><span class="line">  <span class="keyword">return</span> micros;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å¯¹äºç»™å®šçš„ x å€¼ï¼Œè®¡ç®— y å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">permitsToTime</span><span class="params">(<span class="keyword">double</span> permits)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> stableIntervalMicros + permits * slope;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    è‡³æ­¤ï¼ŒRateLimiterçš„å¹³æ»‘çªå‘é™æµä¸å¹³æ»‘é¢„çƒ­é™æµå…¨éƒ¨åˆ†æå®Œæ¯•ï¼</p><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Algorithm </tag>
            
            <tag> Guava </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»CPU cacheä¸ç¼“å­˜è¡Œåˆ°é«˜æ€§èƒ½é˜Ÿåˆ—Disruptor</title>
      <link href="/2021/04/03/%E4%BB%8ECPU-cache%E4%B8%8E%E7%BC%93%E5%AD%98%E8%A1%8C%E5%88%B0%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97Disruptor/"/>
      <url>/2021/04/03/%E4%BB%8ECPU-cache%E4%B8%8E%E7%BC%93%E5%AD%98%E8%A1%8C%E5%88%B0%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97Disruptor/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å…³äºCPU"><a href="#ä¸€ã€å…³äºCPU" class="headerlink" title="ä¸€ã€å…³äºCPU"></a>ä¸€ã€å…³äºCPU</h2><p>â€‹    CPUç”±ä¸‰éƒ¨åˆ†ç»„æˆ:</p><ul><li><strong>ç®—æœ¯/é€»è¾‘å•å…ƒ(arithmetic/logic unit)</strong>:å®ƒåŒ…å«åœ¨æ•°æ®ä¸Šæ‰§è¡Œè¿ç®—(å¦‚åŠ æ³•å’Œå‡æ³•)çš„ç”µè·¯;</li><li><strong>æ§åˆ¶å•å…ƒ(control unit)</strong>:å®ƒåŒ…å«åè°ƒæœºå™¨æ´»åŠ¨çš„ç”µè·¯;</li><li><strong>å¯„å­˜å™¨å•å…ƒ(register unit)</strong>:ä»–åŒ…å«ç§°ä¸ºå¯„å­˜å™¨(register)çš„æ•°æ®å­˜å‚¨å•å…ƒ(ä¸ä¸»å­˜å•å…ƒç›¸ä¼¼),ç”¨ä½œCPUå†…éƒ¨çš„ä¿¡æ¯ä¸´æ—¶å­˜å‚¨.</li></ul><p>å¯„å­˜å™¨å•å…ƒä¸­çš„ä¸€äº›å¯„å­˜å™¨è¢«çœ‹æˆæ˜¯<strong>é€šç”¨å¯„å­˜å™¨(general-purpose register)</strong>,è€Œå…¶ä»–çš„ä¸€äº›åˆ™è¢«çœ‹æˆæ˜¯<strong>ä¸“ç”¨å¯„å­˜å™¨(special-purpose register)</strong>.è¿™é‡Œå…ˆå…³æ³¨é€šç”¨å¯„å­˜å™¨.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210405003309699.png" alt="image-20210405003309699" style="zoom:50%;" /></p><p>â€‹    åŸºäºè¿™æ ·çš„è®¾è®¡,å°†å­˜å‚¨åœ¨ä¸»å­˜å‚¨å™¨ä¸Šçš„ä¸¤ä¸ªå€¼ç›¸åŠ çš„ä»»åŠ¡ä¸ä»…ä»…æ¶‰åŠåˆ°åŠ æ³•è¿ç®—,æ•°æ®å¿…é¡»å…ˆä»ä¸»å­˜å‚¨å™¨ä¼ è¾“åˆ°CPUåˆ°å¯„å­˜å™¨ä¸­,ç›¸åŠ åå†æŠŠç»“æœæ”¾åœ¨ä¸»å­˜å‚¨å™¨å•å…ƒä¸­.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210405005759994.png" alt="image-20210405005759994" style="zoom:50%;" /></p><p>â€‹    <strong>å­˜å‚¨ç¨‹åºæ¦‚å¿µ(stored-program concept)</strong>ï¼Œè¿™ä¸ªæ¦‚å¿µå³å°†è®¡ç®—æœºç¨‹åºå­˜å‚¨åˆ°ä¸»å­˜å‚¨å™¨ä¸­ï¼Œæ¯æ¬¡å¤„ç†ä»»åŠ¡ï¼Œåªéœ€è¦è®¿é—®å­˜å‚¨å™¨ä¸­çš„è®¡ç®—æœºç¨‹åºè¿›è¡Œå¤„ç†å³å¯ï¼Œè€Œä¸éœ€è¦å¯¹CPUè¿›è¡Œé‡æ–°å¸ƒçº¿ã€‚</p><p>CPUä¸­æœ‰ä¸¤ä¸ªä¸“ç”¨å¯„å­˜å™¨:</p><ul><li><strong>æŒ‡ä»¤å¯„å­˜å™¨(instruction register)</strong>     :ç”¨æ¥å­˜å‚¨æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤</li><li><strong>ç¨‹åºè®¡æ•°å™¨(program counter)</strong>     :ç”¨æ¥å­˜å‚¨ä¸‹ä¸€ä¸ªç­‰å¾…æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€.ç”¨äºè¿½è¸ªç¨‹åºæ‰§è¡Œåˆ°äº†ä»€ä¹ˆåœ°æ–¹.</li></ul><p>CPUé€šè¿‡ä¸æ–­é‡å¤ä¸€ä¸ªç®—æ³•æ¥å®Œæˆä»–çš„ä»»åŠ¡,è¿™ä¸ªç®—æ³•å¼•å¯¼CPUå®Œæˆä¸€ä¸ªå«<strong>æœºå™¨å‘¨æœŸ(machine cycle)</strong>çš„ä¸‰æ­¥å¤„ç†.</p><p>æè¿°CPUè®¡ç®—èƒ½åŠ›çš„æ—¶é’Ÿé¢‘ç‡<strong>ä»¥èµ«å…¹ä¸ºå•ä½</strong>,1Hz<strong>ç›¸å½“äºæ¯ç§’ä¸€ä¸ªå‘¨æœŸ</strong>.</p><h2 id="äºŒã€CPU-Cache"><a href="#äºŒã€CPU-Cache" class="headerlink" title="äºŒã€CPU Cache"></a>äºŒã€CPU Cache</h2><blockquote><p>â€‹    åœ¨<a href="https://zh.wikipedia.org/wiki/è®¡ç®—æœº" target="_blank" rel="noopener">è®¡ç®—æœº</a>ç³»ç»Ÿä¸­ï¼Œ<strong>CPUé«˜é€Ÿç¼“å­˜</strong>ï¼ˆè‹±è¯­ï¼šCPU Cacheï¼‰æ˜¯ç”¨äºå‡å°‘<a href="https://zh.wikipedia.org/wiki/ä¸­å¤®å¤„ç†å™¨" target="_blank" rel="noopener">å¤„ç†å™¨</a>è®¿é—®å†…å­˜æ‰€éœ€å¹³å‡æ—¶é—´çš„éƒ¨ä»¶ã€‚åœ¨é‡‘å­—å¡”å¼<a href="https://zh.wikipedia.org/w/index.php?title=å­˜å‚¨ä½“ç³»&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">å­˜å‚¨ä½“ç³»</a>ä¸­å®ƒä½äºè‡ªé¡¶å‘ä¸‹çš„ç¬¬äºŒå±‚ï¼Œä»…æ¬¡äº<a href="https://zh.wikipedia.org/wiki/å¯„å­˜å™¨" target="_blank" rel="noopener">CPUå¯„å­˜å™¨</a>ã€‚å…¶å®¹é‡è¿œå°äº<a href="https://zh.wikipedia.org/wiki/å†…å­˜" target="_blank" rel="noopener">å†…å­˜</a>ï¼Œä½†é€Ÿåº¦å´å¯ä»¥æ¥è¿‘å¤„ç†å™¨çš„é¢‘ç‡ã€‚</p><p>â€‹    å½“å¤„ç†å™¨å‘å‡ºå†…å­˜è®¿é—®è¯·æ±‚æ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹ç¼“å­˜å†…æ˜¯å¦æœ‰è¯·æ±‚æ•°æ®ã€‚å¦‚æœå­˜åœ¨ï¼ˆå‘½ä¸­ï¼‰ï¼Œåˆ™ä¸ç»è®¿é—®å†…å­˜ç›´æ¥è¿”å›è¯¥æ•°æ®ï¼›å¦‚æœä¸å­˜åœ¨ï¼ˆå¤±æ•ˆï¼‰ï¼Œåˆ™è¦å…ˆæŠŠå†…å­˜ä¸­çš„ç›¸åº”æ•°æ®è½½å…¥ç¼“å­˜ï¼Œå†å°†å…¶è¿”å›å¤„ç†å™¨ã€‚</p><p>â€‹    ç¼“å­˜ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œä¸»è¦æ˜¯å› ä¸ºç¨‹åºè¿è¡Œæ—¶å¯¹å†…å­˜çš„è®¿é—®å‘ˆç°<strong>å±€éƒ¨æ€§ï¼ˆLocalityï¼‰</strong>ç‰¹å¾ã€‚è¿™ç§å±€éƒ¨æ€§æ—¢åŒ…æ‹¬ç©ºé—´å±€éƒ¨æ€§ï¼ˆSpatial Localityï¼‰ï¼Œä¹ŸåŒ…æ‹¬æ—¶é—´å±€éƒ¨æ€§ï¼ˆTemporal Localityï¼‰ã€‚æœ‰æ•ˆåˆ©ç”¨è¿™ç§å±€éƒ¨æ€§ï¼Œç¼“å­˜å¯ä»¥è¾¾åˆ°æé«˜çš„å‘½ä¸­ç‡ã€‚</p><p>â€‹    åœ¨å¤„ç†å™¨çœ‹æ¥ï¼Œç¼“å­˜æ˜¯ä¸€ä¸ªé€æ˜éƒ¨ä»¶ã€‚å› æ­¤ï¼Œç¨‹åºå‘˜é€šå¸¸æ— æ³•ç›´æ¥å¹²é¢„å¯¹ç¼“å­˜çš„æ“ä½œã€‚ä½†æ˜¯ï¼Œç¡®å®å¯ä»¥æ ¹æ®ç¼“å­˜çš„ç‰¹ç‚¹å¯¹ç¨‹åºä»£ç å®æ–½ç‰¹å®šä¼˜åŒ–ï¼Œä»è€Œæ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜ã€‚</p><p>â€‹                                                                                                                                                                    â€”ç»´åŸºç™¾ç§‘</p></blockquote><h3 id="1-ä¸ºä»€ä¹ˆè¦æœ‰CPU-Cache"><a href="#1-ä¸ºä»€ä¹ˆè¦æœ‰CPU-Cache" class="headerlink" title="#1 ä¸ºä»€ä¹ˆè¦æœ‰CPU Cache"></a>#1 ä¸ºä»€ä¹ˆè¦æœ‰CPU Cache</h3><p>â€‹    éšç€å·¥è‰ºçš„æå‡æœ€è¿‘å‡ åå¹´CPUçš„é¢‘ç‡ä¸æ–­æå‡ï¼Œè€Œå—åˆ¶äºåˆ¶é€ å·¥è‰ºå’Œæˆæœ¬é™åˆ¶ï¼Œç›®å‰è®¡ç®—æœºçš„å†…å­˜ä¸»è¦æ˜¯DRAMå¹¶ä¸”åœ¨è®¿é—®é€Ÿåº¦ä¸Šæ²¡æœ‰è´¨çš„çªç ´ã€‚å› æ­¤ï¼Œ<strong>CPUçš„å¤„ç†é€Ÿåº¦å’Œå†…å­˜çš„è®¿é—®é€Ÿåº¦å·®è·è¶Šæ¥è¶Šå¤§ï¼Œç”šè‡³å¯ä»¥è¾¾åˆ°ä¸Šä¸‡å€</strong>ã€‚è¿™ç§æƒ…å†µä¸‹ä¼ ç»Ÿçš„CPUé€šè¿‡FSBç›´è¿å†…å­˜çš„æ–¹å¼æ˜¾ç„¶å°±ä¼šå› ä¸ºå†…å­˜è®¿é—®çš„ç­‰å¾…ï¼Œå¯¼è‡´è®¡ç®—èµ„æºå¤§é‡é—²ç½®ï¼Œé™ä½CPUæ•´ä½“ååé‡ã€‚åŒæ—¶åˆç”±äºå†…å­˜æ•°æ®è®¿é—®çš„çƒ­ç‚¹é›†ä¸­æ€§ï¼Œåœ¨CPUå’Œå†…å­˜ä¹‹é—´ç”¨è¾ƒä¸ºå¿«é€Ÿè€Œæˆæœ¬è¾ƒé«˜çš„SDRAMåšä¸€å±‚ç¼“å­˜ï¼Œå°±æ˜¾å¾—æ€§ä»·æ¯”æé«˜äº†ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/10538467-7923f58c663c7db1.png" alt="img"  /></p><h3 id="2-ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº§CPU-Cache"><a href="#2-ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº§CPU-Cache" class="headerlink" title="#2 ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº§CPU Cache"></a>#2 ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº§CPU Cache</h3><blockquote><p>å¤šçº§cpuç¼“å­˜é€Ÿåº¦å¯¹æ¯”ï¼›</p><ol><li>å„ç§å¯„å­˜å™¨ï¼Œç”¨æ¥å­˜å‚¨æœ¬åœ°å˜é‡å’Œå‡½æ•°å‚æ•°ï¼Œè®¿é—®ä¸€æ¬¡éœ€è¦ 1cycleï¼Œè€—æ—¶å°äº 1nsï¼›</li><li>L1 Cacheï¼Œä¸€çº§ç¼“å­˜ï¼Œæœ¬åœ° core çš„ç¼“å­˜ï¼Œåˆ†æˆ 32K çš„æ•°æ®ç¼“å­˜ L1d å’Œ 32k æŒ‡ä»¤ç¼“å­˜ L1iï¼Œè®¿é—® L1 éœ€è¦ 3cyclesï¼Œè€—æ—¶å¤§çº¦ 1nsï¼›</li><li>L2 Cacheï¼ŒäºŒçº§ç¼“å­˜ï¼Œæœ¬åœ° core çš„ç¼“å­˜ï¼Œè¢«è®¾è®¡ä¸º L1 ç¼“å­˜ä¸å…±äº«çš„ L3 ç¼“å­˜ä¹‹é—´çš„ç¼“å†²ï¼Œå¤§å°ä¸º 256Kï¼Œè®¿é—® L2 éœ€è¦ 12cyclesï¼Œè€—æ—¶å¤§çº¦ 3nsï¼›</li><li>L3 Cacheï¼Œä¸‰çº§ç¼“å­˜ï¼Œåœ¨åŒæ’æ§½çš„æ‰€æœ‰ core å…±äº« L3 ç¼“å­˜ï¼Œåˆ†ä¸ºå¤šä¸ª 2M çš„æ®µï¼Œè®¿é—® L3 éœ€è¦ 38cyclesï¼Œè€—æ—¶å¤§çº¦ 12nsï¼›</li></ol></blockquote><p>ç¼“å­˜å±‚çº§è¶Šæ¥è¿‘äº CPU coreï¼Œå®¹é‡è¶Šå°ï¼Œé€Ÿåº¦è¶Šå¿«ï¼ŒåŒæ—¶ï¼Œå…¶é€ ä»·ä¹Ÿæ›´è´µã€‚æ‰€ä»¥ä¸ºäº†æ”¯æ’‘æ›´å¤šçš„çƒ­ç‚¹æ•°æ®ï¼ŒåŒæ—¶è¿½æ±‚æœ€é«˜çš„æ€§ä»·æ¯”ï¼Œå¤šçº§ç¼“å­˜æ¶æ„åº”è¿è€Œç”Ÿã€‚</p><h3 id="3-cache-line-ç¼“å­˜è¡Œ"><a href="#3-cache-line-ç¼“å­˜è¡Œ" class="headerlink" title="#3 cache line ç¼“å­˜è¡Œ"></a>#3 cache line ç¼“å­˜è¡Œ</h3><p>CPU Cache æ˜¯ç”±å¤šä¸ªCache Lineç¼“å­˜è¡Œç»„æˆçš„ï¼ŒCache Lineå¯ä»¥ç®€å•çš„ç†è§£ä¸ºCPU Cacheä¸­çš„æœ€å°ç¼“å­˜å•ä½ã€‚ç›®å‰ä¸»æµçš„CPU Cacheçš„Cache Lineå¤§å°éƒ½æ˜¯64Bytesã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª512å­—èŠ‚çš„ä¸€çº§ç¼“å­˜ï¼Œé‚£ä¹ˆæŒ‰ç…§64Bçš„ç¼“å­˜å•ä½å¤§å°æ¥ç®—ï¼Œè¿™ä¸ªä¸€çº§ç¼“å­˜æ‰€èƒ½å­˜æ”¾çš„ç¼“å­˜ä¸ªæ•°å°±æ˜¯<code>512/64 = 8</code>ä¸ªã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/å¤šçº§ç¼“å­˜.png" alt="img"></p><h3 id="4-CPU-è®¿é—®ç¼“å­˜ã€å†…å­˜"><a href="#4-CPU-è®¿é—®ç¼“å­˜ã€å†…å­˜" class="headerlink" title="#4 CPU è®¿é—®ç¼“å­˜ã€å†…å­˜"></a>#4 CPU è®¿é—®ç¼“å­˜ã€å†…å­˜</h3><p>â€‹    è¯•æƒ³ä¸€ä¸‹ä½ æ­£åœ¨éå†ä¸€ä¸ªé•¿åº¦ä¸º 16 çš„ long æ•°ç»„ data[16]ï¼ŒåŸå§‹æ•°æ®è‡ªç„¶å­˜åœ¨äºä¸»å†…å­˜ä¸­ï¼Œè®¿é—®è¿‡ç¨‹æè¿°å¦‚ä¸‹</p><ol><li>è®¿é—® data[0]ï¼ŒCPU core å°è¯•è®¿é—® CPU Cacheï¼Œæœªå‘½ä¸­ã€‚</li><li>å°è¯•è®¿é—®ä¸»å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¸€æ¬¡è®¿é—®çš„å•ä½æ˜¯ä¸€ä¸ª Cache Line çš„å¤§å° â€” 64 å­—èŠ‚ï¼Œè¿™æ„å‘³ç€ï¼šæ—¢ä»ä¸»å†…å­˜ä¸­è·å–åˆ°äº† data[0] çš„å€¼ï¼ŒåŒæ—¶å°† data[0] ~ data[7] åŠ å…¥åˆ°äº† CPU Cache ä¹‹ä¸­ï¼Œfor free~</li><li>è®¿é—® data[1]~data[7]ï¼ŒCPU core å°è¯•è®¿é—® CPU Cacheï¼Œå‘½ä¸­ç›´æ¥è¿”å›ã€‚</li><li>è®¿é—® data[8]ï¼ŒCPU core å°è¯•è®¿é—® CPU Cacheï¼Œæœªå‘½ä¸­ã€‚</li><li>å°è¯•è®¿é—®ä¸»å†…å­˜ã€‚é‡å¤æ­¥éª¤ 2</li></ol><p>å½“CPUæ‰§è¡Œè¿ç®—çš„æ—¶å€™ï¼Œå®ƒå…ˆå»L1æŸ¥æ‰¾æ‰€éœ€çš„æ•°æ®ã€å†å»L2ã€ç„¶åæ˜¯L3ï¼Œå¦‚æœæœ€åè¿™äº›ç¼“å­˜ä¸­éƒ½æ²¡æœ‰ï¼Œæ‰€éœ€çš„æ•°æ®å°±è¦å»ä¸»å†…å­˜æ‹¿ã€‚èµ°å¾—è¶Šè¿œï¼Œè¿ç®—è€—è´¹çš„æ—¶é—´å°±è¶Šé•¿ã€‚æ‰€ä»¥å¦‚æœä½ åœ¨åšä¸€äº›å¾ˆé¢‘ç¹çš„äº‹ï¼Œä½ è¦å°½é‡ç¡®ä¿æ•°æ®åœ¨L1ç¼“å­˜ä¸­ã€‚</p><p>å¦å¤–ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«ä¸€ä»½æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ªçº¿ç¨‹æŠŠæ•°æ®å†™å›ä¸»å­˜ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸»å­˜ä¸­ç›¸åº”çš„æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        arr = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">1024</span> * <span class="number">1024</span>][<span class="number">8</span>];</span><br><span class="line">        <span class="comment">// æ¨ªå‘éå†</span></span><br><span class="line">        <span class="keyword">long</span> marked = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span> * <span class="number">1024</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">                sum += arr[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Loop times:"</span> + (System.currentTimeMillis() - marked) + <span class="string">"ms"</span>);</span><br><span class="line"></span><br><span class="line">        marked = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// çºµå‘éå†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1024</span> * <span class="number">1024</span>; j++) &#123;</span><br><span class="line">                sum += arr[j][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Loop times:"</span> + (System.currentTimeMillis() - marked) + <span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢è¿™æ®µä»£ç å¯¹ä¸€ä¸ªäºŒç»´æ•°ç»„è¿›è¡Œçºµå‘å’Œæ¨ªå‘çš„éå†ï¼Œæœ€åè¾“å‡ºç»“æœæ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Loop times:<span class="number">19</span>ms</span><br><span class="line">Loop times:<span class="number">48</span>ms</span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨çºµå‘éå†æ—¶ï¼Œæ¯æ¬¡éå†éƒ½éœ€è¦ä»å†…å­˜é‡Œé‡æ–°è¯»å–æ•°æ®ï¼Œä¹‹å‰è¯»å–çš„åªèƒ½ä½œåºŸï¼Œå¤šæ¬¡è®¿é—®å†…å­˜å¯¼è‡´è€—æ—¶æ›´é•¿ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>ä»CPUåˆ°</strong></th><th><strong>å¤§çº¦éœ€è¦çš„CPUå‘¨æœŸ</strong></th><th><strong>å¤§çº¦éœ€è¦çš„æ—¶é—´</strong></th></tr></thead><tbody><tr><td style="text-align:left">ä¸»å­˜</td><td>-</td><td>çº¦60-80ns</td></tr><tr><td style="text-align:left">QPI æ€»çº¿ä¼ è¾“(between sockets, not drawn)</td><td>-</td><td>çº¦20ns</td></tr><tr><td style="text-align:left">L3 cache</td><td>çº¦40-45 cycles</td><td>çº¦15ns</td></tr><tr><td style="text-align:left">L2 cache</td><td>çº¦10 cycles</td><td>çº¦3ns</td></tr><tr><td style="text-align:left">L1 cache</td><td>çº¦3-4 cycles</td><td>çº¦1ns</td></tr><tr><td style="text-align:left">å¯„å­˜å™¨</td><td>1 cycle</td><td>-</td></tr></tbody></table></div><h3 id="4-ä¼ªå…±äº«"><a href="#4-ä¼ªå…±äº«" class="headerlink" title="#4 ä¼ªå…±äº«"></a>#4 ä¼ªå…±äº«</h3><p>å¦‚åŒæåˆ°CASå°±æ— æ³•é¿å…æåˆ°ABAé—®é¢˜ä¸€æ ·ï¼Œä¼ªå…±äº«é—®é¢˜ä¹Ÿæ˜¯CPUç¼“å­˜è¡Œç›¸å…³çš„ä¸€å®šä¼šæåŠçš„é—®é¢˜ã€‚</p><p>ä¼ªå…±äº«æŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ªç¼“å­˜è¡Œçš„ä¸åŒå˜é‡æ—¶å¯¼è‡´çš„ CPU ç¼“å­˜å¤±æ•ˆã€‚å› ä¸ºè¿™äº›å˜é‡ä½äºä¸»å­˜ä¸­é‚»è¿‘çš„ä½ç½®ï¼Œæ‰€ä»¥ä»–ä»¬å­˜åœ¨äºä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œå½“å¯¹ç¼“å­˜è¡Œçš„æŸä¸ªæ•°æ®è¿›è¡Œæ“ä½œï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªç¼“å­˜è¡Œå¤±æ•ˆï¼Œå¯¼è‡´å¦‚æœéœ€è¦è¯»å–æœ¬åº”åœ¨æ­¤ç¼“å­˜è¡Œä¸­çš„æ•°æ®éœ€è¦ä»ä¸»å­˜ä¸­é‡æ–°è¯»åŒºã€‚è¿™æ ·ï¼Œåœ¨é¢‘ç¹çš„å¤šçº¿ç¨‹æ“ä½œä¸‹ï¼ŒCPU ç¼“å­˜å°†ä¼šå½»åº•å¤±æ•ˆï¼Œé™çº§ä¸º CPU core å’Œä¸»å†…å­˜çš„ç›´æ¥äº¤äº’ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/ä¼ªå…±äº«.png" alt="img"  /></p><p>ä¼ªå…±äº«é—®é¢˜çš„è§£å†³æ–¹å¼å°±æ˜¯<strong>å­—èŠ‚å¡«å……</strong></p><p>å­—èŠ‚å¡«å……çš„å®—æ—¨å°±æ˜¯ä¸åŒçº¿ç¨‹çš„å˜é‡å­˜åœ¨ä¸åŒçš„ç¼“å­˜è¡Œä¸Šï¼Œè¿™æ ·å¤šä¸ªçº¿ç¨‹çš„æ“ä½œå°±ä¸ä¼šé€ æˆå½¼æ­¤çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œä½¿ç”¨å¤šä½™çš„å­—èŠ‚å¡«å……å°±å¯ä»¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>å­—èŠ‚å¡«å……å¯ä»¥ç”¨<strong>Paddingæ–¹å¼</strong>å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸ºäº†é¿å… JVM çš„è‡ªåŠ¨ä¼˜åŒ–ï¼Œéœ€è¦ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥å¡«å……</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractPaddingObject</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">long</span> p1, p2, p3, p4, p5, p6;<span class="comment">// å¡«å……</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaddingObject</span> <span class="keyword">extends</span> <span class="title">AbstractPaddingObject</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value = <span class="number">0L</span>;    <span class="comment">// å®é™…æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…æ•°æ® value + ç”¨äºå¡«å……çš„ p1~p6 æ€»å…±åªå æ®äº† 7 <em> 8 = 56 ä¸ªå­—èŠ‚ï¼Œè€Œ Cache Line çš„å¤§å°åº”å½“æ˜¯ 64 å­—èŠ‚ï¼Œè¿™æ˜¯æœ‰æ„è€Œä¸ºä¹‹ï¼Œåœ¨ Java ä¸­ï¼Œ<em>* å¯¹è±¡å¤´è¿˜å æ®äº† 8 ä¸ªå­—èŠ‚ </em></em>ï¼Œæ‰€ä»¥ä¸€ä¸ª PaddingObject å¯¹è±¡å¯ä»¥æ°å¥½å æ®ä¸€ä¸ª Cache Lineã€‚</p><p>Java8ä¸­æä¾›äº†<strong>å®˜æ–¹çš„å­—èŠ‚å¡«å……æ³¨é‡Š</strong>å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sun.misc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.FIELD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Contended &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">æ³¨æ„éœ€è¦åŒæ—¶å¼€å¯ JVM å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">-XX:-RestrictContended=false</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><blockquote><p>@Contended æ³¨è§£ä¼šå¢åŠ ç›®æ ‡å®ä¾‹å¤§å°ï¼Œæ¥ä½¿å„ä¸ªå˜é‡åœ¨Cache lineä¸­åˆ†éš”å¼€,è¦è°¨æ…ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤äº† JDK å†…éƒ¨çš„ç±»ï¼ŒJVM ä¼šå¿½ç•¥è¯¥æ³¨è§£ã€‚è¦åº”ç”¨ä»£ç æ”¯æŒçš„è¯ï¼Œè¦è®¾ç½® -XX:-RestrictContended=falseï¼Œå®ƒé»˜è®¤ä¸º trueï¼ˆæ„å‘³ä»…é™ JDK å†…éƒ¨çš„ç±»ä½¿ç”¨ï¼‰ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸ª â€“XX: EnableContented çš„é…ç½®å‚æ•°ï¼Œæ¥æ§åˆ¶å¼€å¯å’Œå…³é—­è¯¥æ³¨è§£çš„åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯ trueï¼Œå¦‚æœæ”¹ä¸º falseï¼Œå¯ä»¥å‡å°‘ Thread å’Œ ConcurrentHashMap ç±»çš„å¤§å°ã€‚å‚è§ã€ŠJava æ€§èƒ½æƒå¨æŒ‡å—ã€‹210 é¡µã€‚</p></blockquote><p>Javaä¸­å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†è¿™ä¸ªæ³¨è§£ï¼Œæ¯”å¦‚ <code>ConcurrentHashMap</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ---------------- Counter support -------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A padded cell for distributing counts.  Adapted from LongAdder</span></span><br><span class="line"><span class="comment"> * and Striped64.  See their internal docs for explanation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterCell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line">    CounterCell(<span class="keyword">long</span> x) &#123;value = x;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Thread</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The following three initially uninitialized fields are exclusively</span></span><br><span class="line"><span class="comment">// managed by class java.util.concurrent.ThreadLocalRandom. These</span></span><br><span class="line"><span class="comment">// fields are used to build the high-performance PRNGs in the</span></span><br><span class="line"><span class="comment">// concurrent code, and we can not risk accidental false sharing.</span></span><br><span class="line"><span class="comment">// Hence, the fields are isolated with @Contended.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** The current seed for a ThreadLocalRandom */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">"tlr"</span>)</span><br><span class="line"><span class="keyword">long</span> threadLocalRandomSeed;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Probe hash value; nonzero if threadLocalRandomSeed initialized */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">"tlr"</span>)</span><br><span class="line"><span class="keyword">int</span> threadLocalRandomProbe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Secondary seed isolated from public ThreadLocalRandom sequence */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">"tlr"</span>)</span><br><span class="line"><span class="keyword">int</span> threadLocalRandomSecondarySeed;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€åŠ é”ä¸CAS"><a href="#ä¸‰ã€åŠ é”ä¸CAS" class="headerlink" title="ä¸‰ã€åŠ é”ä¸CAS"></a>ä¸‰ã€åŠ é”ä¸CAS</h2><h3 id="Javaå†…ç½®é˜Ÿåˆ—"><a href="#Javaå†…ç½®é˜Ÿåˆ—" class="headerlink" title="#Javaå†…ç½®é˜Ÿåˆ—"></a>#Javaå†…ç½®é˜Ÿåˆ—</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210529033830072.png" alt="image-20210529033830072"></p><p>åœ¨å­¦ä¹ Disruptorä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹Javaå†…ç½®çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—å­˜åœ¨çš„é—®é¢˜ï¼š</p><p>â€‹    é˜Ÿåˆ—çš„å®ç°æ–¹å¼ä¸€èˆ¬æ˜¯ä¸‰ç§ï¼šæ•°ç»„ã€é“¾è¡¨ã€å †ï¼Œå…¶ä¸­å †å®ç°æ˜¯ä¸ºäº†å®ç°å¸¦ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼›è¿™é‡Œå°±åªä¸“æ³¨äºæ•°ç»„å’Œé“¾è¡¨å®ç°çš„é˜Ÿåˆ—ï¼š</p><p>â€‹    åŸºäºæ•°ç»„çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå…¸å‹çš„æ˜¯ArrayBlockingQueueï¼Œå®ƒä¸»è¦é€šè¿‡åŠ é”çš„æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</p><p>â€‹    åŸºäºé“¾è¡¨çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—åˆ†æˆLinkedBlockingQueueå’ŒConcurrentLinkedQueueä¸¤å¤§ç±»ï¼Œå‰è€…ä¹Ÿé€šè¿‡é”çš„æ–¹å¼æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè€Œåè€…ä»¥åŠä¸Šé¢è¡¨æ ¼ä¸­çš„LinkedTransferQueueéƒ½æ˜¯é€šè¿‡åŸå­å˜é‡CASæ— é”çš„æ–¹å¼æ¥å®ç°çš„ã€‚</p><blockquote><p><strong>æœ‰ç•Œæ€§</strong>ï¼šæ˜¯å¦ä¿è¯é˜Ÿåˆ—çš„é•¿åº¦åœ¨ç¡®å®šçš„èŒƒå›´å†… ã€‚</p></blockquote><p>â€‹     ä¸åŠ é”å®ç°çš„é˜Ÿåˆ—éƒ½æ˜¯æ— ç•Œçš„ï¼ŒåŠ é”å®ç°çš„é˜Ÿåˆ—éƒ½æ˜¯æœ‰ç•Œçš„ï¼Œä¸ºäº†è¿½æ±‚ç¨³å®šæ€§ï¼Œé˜²æ­¢ç”Ÿäº§è€…é€Ÿåº¦è¿‡å¿«ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œåªèƒ½é€‰æ‹©æœ‰ç•Œé˜Ÿåˆ—ï¼›åŒæ—¶ï¼Œä¸ºäº†å‡å°‘Javaçš„åƒåœ¾å›æ”¶å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ï¼Œä¼šå°½é‡é€‰æ‹©array/heapæ ¼å¼çš„æ•°æ®ç»“æ„ã€‚è¿™æ ·ç­›é€‰ä¸‹æ¥ï¼Œç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—å°±åªæœ‰ArrayBlockingQueueã€‚</p><p>Disruporçš„è®ºæ–‡ä¸­è¿›è¡Œäº†ä¸€æ¬¡å®éªŒï¼Œ64ä½çš„è®¡æ•°å™¨å¾ªç¯è‡ªå¢5äº¿æ¬¡ï¼Œä½¿ç”¨ä¸åŒçš„å®ç°æ–¹å¼çš„è€—æ—¶æƒ…å†µå¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>Method</th><th>Time (ms)</th></tr></thead><tbody><tr><td>Single thread</td><td>300</td></tr><tr><td>Single thread with CAS</td><td>5,700</td></tr><tr><td>Single thread with lock</td><td>10,000</td></tr><tr><td>Single thread with volatile write</td><td>4,700</td></tr><tr><td>Two threads with CAS</td><td>30,000</td></tr><tr><td>Two threads with lock</td><td>224,000</td></tr></tbody></table></div><p>å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œæ— é”æ€§èƒ½ &gt; CASçš„æ€§èƒ½ &gt; åŠ é”çš„æ€§èƒ½</p><p>å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¿…é¡»è¦ä½¿ç”¨CASæˆ–è€…é”ï¼Œå› æ­¤CASçš„æ€§èƒ½è¦ä¼˜äºåŠ é”çš„æ€§èƒ½ï¼Œå¤§çº¦æ˜¯8å€çš„å·®åˆ«ã€‚</p><h3 id="é”"><a href="#é”" class="headerlink" title="#é”"></a>#é”</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/9b6a41f7d8527df9730b7832b38ec4d5180025.png" alt="å›¾1 é€šè¿‡åŠ é”çš„æ–¹å¼å®ç°çº¿ç¨‹å®‰å…¨" style="zoom:50%;" /></p><p>  åŠ é”çš„æ–¹å¼ä¸­è®¿é—®æ•°æ®éœ€è¦å…ˆåŠ é”å†è®¿é—®ï¼Œè®¿é—®åè§£é”ã€‚ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p><h3 id="åŸå­å˜é‡"><a href="#åŸå­å˜é‡" class="headerlink" title="#åŸå­å˜é‡"></a>#åŸå­å˜é‡</h3><p>â€‹    åŸå­å˜é‡èƒ½å¤Ÿä¿è¯åŸå­æ€§çš„æ“ä½œï¼Œåœ¨æŸä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/de0ced42337014947e7466db4d8f2d4d158395.png" alt="å›¾2 é€šè¿‡åŸå­å˜é‡CASå®ç°çº¿ç¨‹å®‰å…¨"></p><p>å¦‚å›¾ï¼ŒCASæ“ä½œå›å°†ç°åœ¨çš„valueå’Œå½“åˆè¯»å‡ºçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ç›¸åŒåˆ™èµ‹å€¼ï¼›è‹¥ä¸åŒåˆ™æ‰§è¡Œå¤±è´¥ã€‚</p><h2 id="å››ã€Disruptor"><a href="#å››ã€Disruptor" class="headerlink" title="å››ã€Disruptor"></a>å››ã€Disruptor</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="#èƒŒæ™¯"></a>#èƒŒæ™¯</h3><p>â€‹    Disruptoræ˜¯è‹±å›½å¤–æ±‡äº¤æ˜“å…¬å¸LMAXå¼€å‘çš„ä¸€ä¸ªé«˜æ€§èƒ½é˜Ÿåˆ—ï¼Œç ”å‘çš„åˆè¡·æ˜¯è§£å†³å†…å­˜é˜Ÿåˆ—çš„å»¶è¿Ÿé—®é¢˜ï¼ˆåœ¨æ€§èƒ½æµ‹è¯•ä¸­å‘ç°ç«Ÿç„¶ä¸I/Oæ“ä½œå¤„äºåŒæ ·çš„æ•°é‡çº§ï¼‰ã€‚åŸºäºDisruptorå¼€å‘çš„ç³»ç»Ÿå•çº¿ç¨‹èƒ½æ”¯æ’‘æ¯ç§’600ä¸‡è®¢å•ï¼Œ2010å¹´åœ¨QConæ¼”è®²åï¼Œè·å¾—äº†ä¸šç•Œå…³æ³¨ã€‚2011å¹´ï¼Œä¼ä¸šåº”ç”¨è½¯ä»¶ä¸“å®¶Martin Fowlerä¸“é—¨æ’°å†™é•¿æ–‡ä»‹ç»ã€‚åŒå¹´å®ƒè¿˜è·å¾—äº†Oracleå®˜æ–¹çš„Dukeå¤§å¥–ã€‚</p><h3 id="Disruptorçš„è§£å†³æ–¹æ¡ˆ"><a href="#Disruptorçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="#Disruptorçš„è§£å†³æ–¹æ¡ˆ"></a>#Disruptorçš„è§£å†³æ–¹æ¡ˆ</h3><ul><li><strong>ç¯å½¢æ•°ç»„</strong>ï¼šé¿å…åƒåœ¾å›æ”¶ï¼Œä½¿ç”¨æ•°ç»„è€Œä¸æ˜¯é“¾è¡¨ï¼Œè€Œä¸”å¯¹ç¼“å­˜æœºåˆ¶æ›´åŠ å‹å¥½ï¼›</li><li><strong>å…ƒç´ ä½ç½®å®šä½</strong>ï¼šæ•°ç»„é•¿åº¦2^nï¼Œé€šè¿‡ä½è¿ç®—å¿«é€Ÿå®šä½ï¼Œindexæ˜¯longç±»å‹ï¼Œå³ä¾¿æ˜¯100ä¸‡qpsï¼Œä¹Ÿéœ€è¦30ä¸‡å¹´æ‰èƒ½ç”¨å®Œï¼›</li><li><strong>æ— é”è®¾è®¡</strong>ï¼šæ¯ä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œä¼šå…ˆç”³è¯·å¯æ“ä½œå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç”³è¯·åˆ°ä¹‹åæ‰ä¼šåœ¨è¯¥ä½ç½®å†™å…¥æˆ–è€…è¯»å–æ•°æ®ã€‚</li></ul><h3 id="æ— é”è®¾è®¡å®ç°ç”Ÿäº§ä¸æ¶ˆè´¹"><a href="#æ— é”è®¾è®¡å®ç°ç”Ÿäº§ä¸æ¶ˆè´¹" class="headerlink" title="#æ— é”è®¾è®¡å®ç°ç”Ÿäº§ä¸æ¶ˆè´¹"></a>#æ— é”è®¾è®¡å®ç°ç”Ÿäº§ä¸æ¶ˆè´¹</h3><h4 id="å•ä¸ªç”Ÿäº§è€…"><a href="#å•ä¸ªç”Ÿäº§è€…" class="headerlink" title="å•ä¸ªç”Ÿäº§è€…"></a>å•ä¸ªç”Ÿäº§è€…</h4><p>å•çº¿ç¨‹ç”Ÿäº§è€…å†™å…¥æ•°æ®ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒç®€å•ï¼š</p><ol><li>ç”³è¯·å†™å…¥mä¸ªå…ƒç´ ï¼›</li><li>è‹¥æœ‰mä¸ªå…ƒç´ å¯ä»¥å†™å…¥ï¼Œåˆ™è¿”å›æœ€å¤§çš„åºå·ï¼Œè¿™é‡Œä¼šåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ä¼šè¦†ç›–æœªæ¶ˆè´¹çš„å…ƒç´ ï¼›</li><li>å¦‚æœè¿”å›æ­£ç¡®çš„æœ€å¤§åºå·ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å°±å¼€å§‹å†™å…¥å…ƒç´ ï¼›</li></ol><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/e71c1449273361ec413fffc7b0bf5507208689.png" alt="å›¾5 å•ä¸ªç”Ÿäº§è€…ç”Ÿäº§è¿‡ç¨‹ç¤ºæ„å›¾" style="zoom:50%;" /></p><h4 id="å¤šä¸ªç”Ÿäº§è€…"><a href="#å¤šä¸ªç”Ÿäº§è€…" class="headerlink" title="å¤šä¸ªç”Ÿäº§è€…"></a>å¤šä¸ªç”Ÿäº§è€…</h4><p>å¤šä¸ªç”Ÿäº§è€…çš„æƒ…å†µä¸‹ï¼Œâ€œå¦‚ä½•é˜²æ­¢å¤šä¸ªçº¿ç¨‹é‡å¤å†™å…¥åŒä¸€å…ƒç´ â€ï¼ŒDisruptorä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æ¯ä¸ªçº¿ç¨‹è·å–ä¸é€šçš„ä¸€æ®µæ•°ç»„ç©ºé—´æ¥è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªåªéœ€è¦é€šè¿‡CASå°±å¯ä»¥è½»æ¾åšåˆ°ã€‚</p><p>ä½†æ˜¯åœ¨æ¶ˆè´¹è€…æ¶ˆè´¹æ—¶ï¼Œå¯èƒ½æ¶ˆè´¹åˆ°è¿˜æœªå†™å…¥çš„å…ƒç´ ï¼Œäºæ˜¯Disruptorå¼•å…¥äº†ä¸€ä¸ªå’ŒRingBufferå¤§å°ç›¸åŒçš„bufferï¼šavailable Bufferã€‚å½“æŸä¸ªä½ç½®å†™å…¥æˆåŠŸçš„æ—¶å€™ï¼Œä¾¿éœ€è¦æŠŠavailable bufferå¯¹åº”çš„ä½ç½®ç½®ä½ï¼Œåœ¨æ¶ˆè´¹çš„æ—¶å€™ä¼šå…ˆç¡®å®šavailable bufferä¸­å¯¹åº”çš„ä½ç½®æ˜¯å¦æ˜¯å·²ç»ç½®ä½çš„çŠ¶æ€ï¼Œæ¥åˆ¤æ–­æ˜¯å¦å·²ç»å¯ä»¥è¿›è¡Œæ¶ˆè´¹ã€‚</p><p><strong>å†™æ•°æ®</strong></p><ol><li>ç”³è¯·å†™å…¥mä¸ªå…ƒç´ ï¼›</li><li>è‹¥æ˜¯æœ‰mä¸ªå…ƒç´ å¯ä»¥å†™å…¥ï¼Œåˆ™è¿”å›æœ€å¤§çš„åºåˆ—å·ã€‚æ¯ä¸ªç”Ÿäº§è€…ä¼šè¢«åˆ†é…ä¸€æ®µç‹¬äº«çš„ç©ºé—´ï¼›</li><li>ç”Ÿäº§è€…å†™å…¥å…ƒç´ ï¼Œå†™å…¥å…ƒç´ çš„åŒæ—¶è®¾ç½®available Bufferé‡Œé¢ç›¸åº”çš„ä½ç½®ï¼Œä»¥æ ‡è®°è‡ªå·±å“ªäº›ä½ç½®æ˜¯å·²ç»å†™å…¥æˆåŠŸçš„ã€‚</li></ol><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/5e06841b1bba4dcf1d3fac169734ba36133983.png" alt="å›¾7 å¤šä¸ªç”Ÿäº§è€…æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ç”Ÿäº§è¿‡ç¨‹ç¤ºæ„å›¾" style="zoom:50%;" /></p><p><strong>è¯»æ•°æ®</strong></p><ol><li>ç”³è¯·è¯»å–åˆ°åºå·nï¼›</li><li>è‹¥writer cursor &gt;= nï¼Œè¿™æ—¶ä»ç„¶æ— æ³•ç¡®å®šè¿ç»­å¯è¯»çš„æœ€å¤§ä¸‹æ ‡ã€‚ä»reader cursorå¼€å§‹è¯»å–available Bufferï¼Œä¸€ç›´æŸ¥åˆ°ç¬¬ä¸€ä¸ªä¸å¯ç”¨çš„å…ƒç´ ï¼Œç„¶åè¿”å›æœ€å¤§è¿ç»­å¯è¯»å…ƒç´ çš„ä½ç½®ï¼›</li><li>æ¶ˆè´¹è€…è¯»å–å…ƒç´ ã€‚</li></ol><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/99c603494ea90c9535e165579daf340a161527.png" alt="å›¾6 å¤šä¸ªç”Ÿäº§è€…æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹è¿‡ç¨‹ç¤ºæ„å›¾" style="zoom:50%;" /></p><h3 id="Disruptorçš„ä½¿ç”¨Demo"><a href="#Disruptorçš„ä½¿ç”¨Demo" class="headerlink" title="#Disruptorçš„ä½¿ç”¨Demo"></a>#Disruptorçš„ä½¿ç”¨Demo</h3><h4 id="äº‹ä»¶ç±»"><a href="#äº‹ä»¶ç±»" class="headerlink" title="äº‹ä»¶ç±»"></a>äº‹ä»¶ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lcl.disruptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuchanglin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TestEvent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: äº‹ä»¶ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/5/28 15:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEvent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…ç±»"><a href="#ç”Ÿäº§è€…ç±»" class="headerlink" title="ç”Ÿäº§è€…ç±»"></a>ç”Ÿäº§è€…ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lcl.disruptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.RingBuffer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuchanglin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TestEventProducer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç”Ÿäº§è€…ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/5/28 15:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEventProducer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RingBuffer&lt;TestEvent&gt; ringBuffer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestEventProducer</span><span class="params">(RingBuffer&lt;TestEvent&gt; ringBuffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ringBuffer = ringBuffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onData</span><span class="params">(String orderId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> sequence = ringBuffer.next();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TestEvent testEvent = ringBuffer.get(sequence);</span><br><span class="line">            testEvent.setId(orderId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ringBuffer.publish(sequence);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹è€…ç±»"><a href="#æ¶ˆè´¹è€…ç±»" class="headerlink" title="æ¶ˆè´¹è€…ç±»"></a>æ¶ˆè´¹è€…ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lcl.disruptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.EventHandler;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.WorkHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuchanglin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TestEventHandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆè´¹è€…ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/5/28 16:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEventHandler</span> <span class="keyword">implements</span> <span class="title">EventHandler</span>&lt;<span class="title">TestEvent</span>&gt;, <span class="title">WorkHandler</span>&lt;<span class="title">TestEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(TestEvent testEvent, <span class="keyword">long</span> sequence, <span class="keyword">boolean</span> endOfBatch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"threadName: "</span> + Thread.currentThread().getName() + <span class="string">", event: "</span> + testEvent + <span class="string">", sequence: "</span> + sequence + <span class="string">", endOfBatch: "</span> + endOfBatch);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(TestEvent testEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"threadName: "</span> + Thread.currentThread().getName() + <span class="string">", event: "</span> + testEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lcl.disruptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.RingBuffer;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.YieldingWaitStrategy;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.dsl.Disruptor;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.dsl.ProducerType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuchanglin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TestDisruptorDemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: demo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/5/28 16:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDisruptorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Disruptor&lt;TestEvent&gt; disruptor = <span class="keyword">new</span> Disruptor&lt;&gt;(</span><br><span class="line">                TestEvent::<span class="keyword">new</span>,</span><br><span class="line">                <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                ProducerType.SINGLE,</span><br><span class="line">                <span class="keyword">new</span> YieldingWaitStrategy() <span class="comment">//æ‹’ç»ç­–ç•¥ è‡ªæ—‹</span></span><br><span class="line">        );</span><br><span class="line"><span class="comment">//        disruptor.handleEventsWith(new TestEventHandler());</span></span><br><span class="line"><span class="comment">//        å¤šæ¶ˆè´¹è€… é‡å¤æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">//        disruptor.handleEventsWith(new TestEventHandler(), new TestEventHandler());</span></span><br><span class="line"><span class="comment">//        å¤šæ¶ˆè´¹è€… åªæ¶ˆè´¹ä¸€æ¬¡</span></span><br><span class="line">        disruptor.handleEventsWithWorkerPool(<span class="keyword">new</span> TestEventHandler(), <span class="keyword">new</span> TestEventHandler());</span><br><span class="line">        disruptor.start();</span><br><span class="line">        RingBuffer&lt;TestEvent&gt; ringBuffer = disruptor.getRingBuffer();</span><br><span class="line">        TestEventProducer eventProducer = <span class="keyword">new</span> TestEventProducer(ringBuffer);</span><br><span class="line"><span class="comment">//        eventProducer.onData(UUID.randomUUID().toString());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        å¤šä¸ªç”Ÿäº§è€…</span></span><br><span class="line">        ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            fixedThreadPool.execute(() -&gt; eventProducer.onData(UUID.randomUUID().toString()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”ã€Disruptor-æºç åˆ†æ"><a href="#äº”ã€Disruptor-æºç åˆ†æ" class="headerlink" title="äº”ã€Disruptor æºç åˆ†æ"></a>äº”ã€Disruptor æºç åˆ†æ</h3><h4 id="æ ¸å¿ƒè®¾è®¡"><a href="#æ ¸å¿ƒè®¾è®¡" class="headerlink" title="#æ ¸å¿ƒè®¾è®¡"></a>#æ ¸å¿ƒè®¾è®¡</h4><ul><li><strong>Event</strong> <em>åœ¨Disruptoræ¡†æ¶ä¸­ï¼Œäº‹ä»¶æ˜¯é€šè¿‡ç³»ç»ŸæµåŠ¨çš„æ•°æ®å•å…ƒã€‚ç”Ÿäº§è€…åˆ›å»ºäº‹ä»¶ï¼Œç„¶åé€šè¿‡RingBufferå‘å¸ƒäº‹ä»¶ï¼Œæ¶ˆè´¹è€…åˆ™ä»RingBufferä¸­è·å–äº‹ä»¶å¹¶å¤„ç†</em>  </li><li><strong>EventFactory</strong> <em>è¿™æ˜¯ç”¨äºåˆ›å»ºäº‹ä»¶å¯¹è±¡çš„å·¥å‚ã€‚ç”±äºDisruptorä½¿ç”¨é¢„åˆ†é…çš„äº‹ä»¶ç¼“å†²åŒºï¼ˆå³RingBufferï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨å¯åŠ¨æ—¶åˆ›å»ºæ‰€æœ‰çš„äº‹ä»¶å¯¹è±¡ã€‚EventFactoryå°±æ˜¯ç”¨äºåˆ›å»ºè¿™äº›äº‹ä»¶å¯¹è±¡çš„å·¥å‚æ¥å£ã€‚</em></li><li><strong>EventHandler</strong> <em>äº‹ä»¶å¤„ç†å™¨æ˜¯æ¶ˆè´¹è€…çš„ä¸€éƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†ä»RingBufferä¸­è·å–çš„äº‹ä»¶ã€‚</em></li><li><strong>RingBufferï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰</strong>ï¼šRingBufferæ˜¯Disruptoræ¡†æ¶çš„æ ¸å¿ƒã€‚å®ƒæ˜¯ä¸€ä¸ªé¢„åˆ†é…çš„ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨äº‹ä»¶å¯¹è±¡ã€‚ç”Ÿäº§è€…å‘å¸ƒäº‹ä»¶åˆ°RingBufferï¼Œæ¶ˆè´¹è€…åˆ™ä»RingBufferä¸­è·å–äº‹ä»¶ã€‚</li><li><strong>Disruptor</strong>ï¼šè¿™æ˜¯æ¡†æ¶çš„ä¸»ç±»ï¼Œç”¨äºé…ç½®å’Œå¯åŠ¨Disruptorç³»ç»Ÿã€‚å®ƒåŒ…æ‹¬ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€RingBufferä»¥åŠäº‹ä»¶å¤„ç†é€»è¾‘ç­‰ç»„æˆéƒ¨åˆ†ã€‚</li></ul><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/e665f3a95e5c47568f36437fc2ea5340~tplv-k3u1fbpfcp-zoom-in-crop-mark-3024-0-0-0.image.png" alt="e665f3a95e5c47568f36437fc2ea5340~tplv-k3u1fbpfcp-zoom-in-crop-mark-3024-0-0-0.image"  /></p><h4 id="åˆ›å»ºDisruptor"><a href="#åˆ›å»ºDisruptor" class="headerlink" title="#åˆ›å»ºDisruptor"></a>#åˆ›å»ºDisruptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Disruptor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> EventFactory&lt;T&gt; eventFactory, //äº‹ä»¶çš„æ„æˆå™¨</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> <span class="keyword">int</span> ringBufferSize, // RingBufferé•¿åº¦ å®¹é‡</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> ThreadFactory threadFactory, // æ¶ˆè´¹çº¿ç¨‹çš„åˆ›å»ºå·¥å‚</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> ProducerType producerType, // å•ç”Ÿäº§è€…æ¨¡å¼æˆ–è€…å¤šç”Ÿäº§è€…æ¨¡å¼ é»˜è®¤å¤šç”Ÿäº§è€…</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> WaitStrategy waitStrategy)</span> <span class="comment">// ç­‰å¾…ç­–ç•¥ ï¼ˆRingBufferä¸­ä¸ºç©º</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(</span><br><span class="line">        RingBuffer.create(producerType, eventFactory, ringBufferSize, waitStrategy),</span><br><span class="line">        <span class="keyword">new</span> BasicExecutor(threadFactory));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Disruptor</span><span class="params">(<span class="keyword">final</span> RingBuffer&lt;T&gt; ringBuffer, <span class="keyword">final</span> Executor executor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ringBuffer = ringBuffer;</span><br><span class="line">    <span class="keyword">this</span>.executor = executor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    æ„é€ æ–¹æ³•åˆ›å»ºäº†<code>RingBuffer</code>å’Œä¸€ä¸ª<code>Executor</code>ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶æ„æˆäº†ä¸€ä¸ª<code>Disruptor</code>ã€‚</p><p>â€‹    <strong>RingBuffer</strong> è´Ÿè´£å­˜å‚¨äº‹ä»¶ï¼Œç”³è¯·Sequenceå’Œ publish eventã€‚</p><p>â€‹    <strong>Excutor</strong> è´Ÿè´£è¿è¡Œæ¶ˆè´¹é€»è¾‘</p><h4 id="åˆ›å»ºRingBuffer"><a href="#åˆ›å»ºRingBuffer" class="headerlink" title="#åˆ›å»ºRingBuffer"></a>#åˆ›å»ºRingBuffer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="function">RingBuffer&lt;E&gt; <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ProducerType producerType,</span></span></span><br><span class="line"><span class="function"><span class="params">    EventFactory&lt;E&gt; factory,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> bufferSize,</span></span></span><br><span class="line"><span class="function"><span class="params">    WaitStrategy waitStrategy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (producerType)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> SINGLE:</span><br><span class="line">            <span class="keyword">return</span> createSingleProducer(factory, bufferSize, waitStrategy);</span><br><span class="line">        <span class="keyword">case</span> MULTI:</span><br><span class="line">            <span class="keyword">return</span> createMultiProducer(factory, bufferSize, waitStrategy);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(producerType.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    æ ¹æ®ç”Ÿäº§è€…ç±»å‹çš„ä¸åŒï¼ˆå•ç”Ÿäº§è€… or å¤šç”Ÿäº§è€…ï¼‰å­˜åœ¨ä¸¤ç§ä¸åŒç±»å‹çš„RingBufferã€‚</p><p><strong>å•ç”Ÿäº§è€…ç±»å‹RingBuffer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class RingBuffer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="function">RingBuffer&lt;E&gt; <span class="title">createSingleProducer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    EventFactory&lt;E&gt; factory,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> bufferSize,</span></span></span><br><span class="line"><span class="function"><span class="params">    WaitStrategy waitStrategy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SingleProducerSequencer sequencer = <span class="keyword">new</span> SingleProducerSequencer(bufferSize, waitStrategy);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RingBuffer&lt;E&gt;(factory, sequencer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    RingBufferçš„åˆ›å»ºéœ€è¦ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªSingleProducerSequencerå’Œä¸€ä¸ªEventFactoryã€‚</p><p><strong>RingBuffer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class RingBuffer</span></span><br><span class="line">RingBuffer(</span><br><span class="line">    EventFactory&lt;E&gt; eventFactory,</span><br><span class="line">    Sequencer sequencer)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">super</span>(eventFactory, sequencer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class RingBufferFields</span></span><br><span class="line">RingBufferFields(</span><br><span class="line">    EventFactory&lt;E&gt; eventFactory,</span><br><span class="line">    Sequencer sequencer)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// sequenceç”³è¯·ã€ç»´æŠ¤ä»¥åŠå‘å¸ƒ</span></span><br><span class="line">    <span class="keyword">this</span>.sequencer = sequencer;</span><br><span class="line">    <span class="keyword">this</span>.bufferSize = sequencer.getBufferSize();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bufferSize &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"bufferSize must not be less than 1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Integer.bitCount(bufferSize) != <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"bufferSize must be a power of 2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// indexMaskä¸»è¦æ˜¯ä¸ºäº†ä½¿ç”¨ä½è¿ç®—å–æ¨¡çš„</span></span><br><span class="line">    <span class="keyword">this</span>.indexMask = bufferSize - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ•°ç»„é™¤äº†æ­£å¸¸çš„sizeä¹‹å¤–è¿˜æœ‰å¡«å……çš„å…ƒç´ ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è§£å†³false sharingçš„ï¼Œæœ¬ç¯‡æ–‡ç« æš‚ä¸å±•å¼€</span></span><br><span class="line">    <span class="keyword">this</span>.entries = <span class="keyword">new</span> Object[sequencer.getBufferSize() + <span class="number">2</span> * BUFFER_PAD];</span><br><span class="line">    <span class="comment">// é¢„å…ˆå¡«å……æ•°ç»„å…ƒç´ ï¼Œè¿™å¯¹åƒåœ¾å›æ”¶å¾ˆä¼˜åŒ–ï¼Œåç»­å‘å¸ƒäº‹ä»¶ç­‰æ“ä½œéƒ½ä¸éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œè€Œåªéœ€è¦å³å¯</span></span><br><span class="line">    fill(eventFactory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class RingBufferFields</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(EventFactory&lt;E&gt; eventFactory)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bufferSize; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        entries[BUFFER_PAD + i] = eventFactory.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BUFFER_PAD æ˜¯ä¸€ä¸ªå¸¸é‡ 128 / scale è¡¨ç¤º ï¼Œåˆ›å»ºæ•°ç»„æ—¶å¡«å……çš„æ•°ç»„ç©ºé—´ä¸ªæ•°ï¼Œåœ¨64ä½jvmä¸­å¤§æ¦‚æ˜¯16ä¸ªç©ºé—´ï¼Œä¸ºä¸¤å€çš„ç¼“å­˜è¡Œå¤§å°ï¼Œé¿å…äº†æ•°ç»„çš„å¼€å¤´å’Œç»“å°¾åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œè€Œå¯¼è‡´å¹¶å‘ä¸­çš„ä¼ªå…±äº«é—®é¢˜ã€‚</p><p><strong>BasicExecutor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicExecutor</span><span class="params">(ThreadFactory factory)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BasicExecutorçš„åˆ›å»ºç›´æ¥ä½¿ç”¨äº†<code>java.util.concurrent.Executor</code>æ¥å£å®ç°ï¼Œé€šè¿‡å•å‚æ•°<code>ThreadFactory</code>æ„é€ ã€‚</p><h4 id="äº‹ä»¶å¤„ç†é€»è¾‘æ³¨å†Œ-handleEventsWith"><a href="#äº‹ä»¶å¤„ç†é€»è¾‘æ³¨å†Œ-handleEventsWith" class="headerlink" title="#äº‹ä»¶å¤„ç†é€»è¾‘æ³¨å†Œ handleEventsWith"></a>#äº‹ä»¶å¤„ç†é€»è¾‘æ³¨å†Œ handleEventsWith</h4><p>â€‹    åœ¨ä¸Šé¢çš„<code>TestDisruptorDemo</code>ä¸­ï¼Œå°†Disruptoråˆ›å»ºå®Œæˆåï¼Œéœ€è¦é€šè¿‡è°ƒç”¨<code>handleEventsWith</code>ç›¸å…³æ–¹æ³•å®Œæˆäº‹ä»¶å¤„ç†é€»è¾‘çš„æ³¨å†Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disruptor.handleEventsWith(<span class="keyword">new</span> TestEventHandler());</span><br></pre></td></tr></table></figure><p>â€‹    è€Œæ–¹æ³•çš„æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> EventHandlerGroup&lt;T&gt; <span class="title">handleEventsWith</span><span class="params">(<span class="keyword">final</span> EventHandler&lt;? <span class="keyword">super</span> T&gt;... handlers)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªç©ºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">return</span> createEventProcessors(<span class="keyword">new</span> Sequence[<span class="number">0</span>], handlers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DataStructure </tag>
            
            <tag> Algorithm </tag>
            
            <tag> Computer Science </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>workReview:æ–°æœåŠ¡çš„åˆ›å»º&amp;éƒ¨ç½²&amp;å¼€å‘</title>
      <link href="/2021/02/15/workReview-%E6%96%B0%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%88%9B%E5%BB%BA-%E9%83%A8%E7%BD%B2-%E5%BC%80%E5%8F%91/"/>
      <url>/2021/02/15/workReview-%E6%96%B0%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%88%9B%E5%BB%BA-%E9%83%A8%E7%BD%B2-%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h2 id="é›¶ã€å†™åœ¨å‰é¢"><a href="#é›¶ã€å†™åœ¨å‰é¢" class="headerlink" title="é›¶ã€å†™åœ¨å‰é¢"></a>é›¶ã€å†™åœ¨å‰é¢</h2><p>â€‹    ç°åœ¨æ˜¯2021å¹´çš„2æœˆä»½äº†ï¼Œæ€ç»ªå›åˆ°ä¸¤ä¸ªæœˆä¹‹å‰ï¼Œ2020å¹´åœ£è¯èŠ‚å‰ï¼Œè€å¤§å®‰æ’ä»»åŠ¡â€”â€”è¿ç§»è€é¡¹ç›®ä¸­çš„é‚®ä»¶ä¸‹å‘ç›¸å…³ä¸šåŠ¡è‡³ä¸€ä¸ªmailçš„æ–°æœåŠ¡ä¸­ã€‚è™½ç„¶å½“æ—¶åˆšåˆšå¬åˆ°è¿™ä¸ªä»»åŠ¡ï¼Œè§‰å¾—æ— éæ˜¯æ¥å£ä»£ç çš„è¿ç§»ï¼Œä½†æ˜¯ä¸Šæ‰‹ä¹‹åå‘ç°è¿™ä¸ªä»»åŠ¡åŒ…æ‹¬äº†æœåŠ¡çš„æ–°å»ºã€éƒ¨ç½²ã€ä»¥åŠä¹±ä¸ƒå…«ç³Ÿçš„é…ç½®ï¼Œè¿˜æœ‰ä»£ç è®¾è®¡ä¸Šéœ€è¦åšçš„ä¼˜åŒ–ã€‚</p><p>â€‹    ä¸¤ä¸ªæœˆä»¥æ¥ï¼Œæ¥å£è¿ç§»å’Œä¸¤ä¸ªç‰ˆæœ¬çš„è¿­ä»£éœ€æ±‚ä¸å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„äº‹æƒ…å¹¶è¡Œè¿›è¡Œï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæœˆå…¬å¸ä¸€ç›´æ˜¯abç­æ¨¡å¼è¿›è¡Œå·¥ä½œã€‚å¹¸è¿çš„æ˜¯mailè¿ç§»ä»»åŠ¡ç®—æ˜¯æ¯”è¾ƒåœ†æ»¡çš„å®Œæˆäº†ã€‚å¹´åå›å‚å°±è¯¥è€ƒè™‘çœŸæ­£è¿›è¡Œç°åº¦ä¸Šçº¿ç›¸å…³äº‹å®œï¼Œå¸Œæœ›æ¥ä¸‹æ¥çš„ä¸Šçº¿ã€æ‰©é‡ç­‰åç»­å·¥ä½œä¸è¦å‡ºç°é—®é¢˜ğŸ™ã€‚</p><h2 id="ä¸€ã€ä»£ç è®¾è®¡â€”â€”æ‹¦æˆªå™¨æ¨¡å¼"><a href="#ä¸€ã€ä»£ç è®¾è®¡â€”â€”æ‹¦æˆªå™¨æ¨¡å¼" class="headerlink" title="ä¸€ã€ä»£ç è®¾è®¡â€”â€”æ‹¦æˆªå™¨æ¨¡å¼"></a>ä¸€ã€ä»£ç è®¾è®¡â€”â€”æ‹¦æˆªå™¨æ¨¡å¼</h2><p>â€‹    é¦–å…ˆå…³äºé‚®ä»¶ä¸‹å‘è¿™ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨è®¾è®¡ä¸Šæ»¡è¶³å‡ ä¸ªåŠŸèƒ½ï¼š</p><ul><li>é‚®ç®±åŸŸåã€é‚®ç®±åœ°å€é»‘åå•å±è”½</li><li>å‘é€è´¦å·çš„è·¯ç”±</li><li>å‘é€å¤±è´¥ååˆ‡æ¢ä»SendCloudå‘é€è½¬æ¢ä¸ºAliyunå‘é€</li></ul><p>â€‹    ä¸ºäº†ä¿è¯è¿™äº›åŠŸèƒ½å½¼æ­¤ä¹‹é—´ä¿æŒä½è€¦åˆé«˜å†…èšï¼Œä¾¿äºä¹‹åçš„æ‰©å±•ï¼Œå°±éœ€è¦ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è®¾è®¡æ¨¡å¼æ¥å®Œæˆå®ƒï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿæ˜¯è€å¤§è¦æ±‚çš„ï¼‰ï¼Œåœ¨åœ£è¯èŠ‚ä¸‹ç­çš„è·¯ä¸Šï¼Œæˆ‘é¦–å…ˆè”æƒ³åˆ°Nettyæºç ä¸­åœ¨ä¸€ä¸ªpipelineä¸­ç»„è£…å¤šä¸ªHandlerçš„æ–¹å¼ï¼Œæ¥æ‰©å±•Nettyæ”¶å‘äºŒè¿›åˆ¶æµçš„æ“ä½œï¼Œæ¥ç€æˆ‘åˆæƒ³åˆ°ä¹‹å‰chatæœåŠ¡ä¸­çš„IMå³æ—¶é€šè®¯ä¸­æ”¶å‘æ¶ˆæ¯é‡‡ç”¨çš„æ‹¦æˆªå™¨æ¨¡å¼ï¼Œå¤šä¸ªFilterç»„æˆä¸€ä¸ªFiltreChainçš„æ–¹å¼å¯¹Messageè¿›è¡Œè¿‡æ»¤ï¼Œæœ€åç»è¿‡ä¸è€å¤§äº¤æµï¼Œè€å¤§ä¸€å¼€å§‹ä¹Ÿæ˜¯æƒ³è®©æˆ‘é‡‡ç”¨FilterChainçš„æ–¹å¼æ¥è¿›è¡Œï¼Œç®—æ˜¯æ­£ä¸­ä¸‹æ€€ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210215034400406.png" alt="image-20210215034400406"></p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210215034622758.png" alt="image-20210215034622758">    </p><p>â€‹    æœ€ç»ˆçš„Filterç»“æ„å¦‚ä¸Šï¼Œåˆ›å»ºäº†å‘é€å‰è°ƒç”¨çš„<code>beforeSend</code>æ–¹æ³•å’Œå‘é€åè°ƒç”¨çš„<code>afterSend</code>æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªFilterAdapteræ¥å¯¹è¿™ä¸¤ä¸ªæ¥å£æ·»åŠ é»˜è®¤å®ç°ï¼Œå°†ä¸‰ä¸ªå®ç°ç±»ç»„è£…åˆ°FilterChainä¸­å»ï¼Œå‘é€é‚®ä»¶æ—¶è¿›è¡Œé“¾å¼çš„è°ƒç”¨ã€‚</p><blockquote><p>å³ä½¿æ˜¯ç°åœ¨æˆ‘ä»ç„¶è®¤ä¸ºè¿™æ ·çš„è®¾è®¡å­˜åœ¨å¾ˆå¤šçš„æ¼æ´ï¼Œå‘é€çš„å‰ç½®å’Œåç½®å‚æ•°åº”å½“é€‰æ‹©ä»€ä¹ˆï¼Ÿè¿”å›å€¼åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å°½ç®¡å¦‚æ­¤æˆ‘ä¹Ÿæ˜ç™½ï¼Œä¸€ä¸ªå¥½çš„è®¾è®¡ä»æ¥ä¸æ˜¯ä¸€è¹´è€Œå°±ï¼Œæ˜¯ä¸æ–­çš„ä¿®æ”¹ã€è°ƒæ•´å‡ºæ¥çš„ã€‚</p></blockquote><h2 id="äºŒã€å¤šæ¨¡å—é¡¹ç›®â€”æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»"><a href="#äºŒã€å¤šæ¨¡å—é¡¹ç›®â€”æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»" class="headerlink" title="äºŒã€å¤šæ¨¡å—é¡¹ç›®â€”æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»"></a>äºŒã€å¤šæ¨¡å—é¡¹ç›®â€”æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»</h2><p>â€‹    ä¸€ä¸ªç®€å•çš„javaé¡¹ç›®é€šå¸¸åªæœ‰ä¸€ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210215161108423.png" alt="image-20210215161108423"></p><p>â€‹    ä½†æ˜¯ï¼Œä¸€èˆ¬ä¼ä¸šçº§çš„å¼€å‘é¡¹ç›®éƒ½ä¼šæ˜¯å­˜åœ¨å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210215161158145.png" alt="image-20210215161158145"></p><p>â€‹    mailé¡¹ç›®å°±æœ‰<code>api-client</code>ã€<code>api-def</code>ã€<code>api-impl</code>ã€<code>server</code>è¿™äº›æ¨¡å—ï¼Œè¿™äº›æ¨¡å—é€šè¿‡mavençš„çˆ¶å­ä¾èµ–æ¥ç»„æˆä¾èµ–å…³ç³»ï¼Œå­pomä¾èµ–çˆ¶pomã€‚</p><p>â€‹    éšç€ä¸šåŠ¡é‡çš„å¢é•¿ï¼Œå•ä¸€æ¨¡å—çš„é¡¹ç›®å¯èƒ½ä¼šå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼š</p><ul><li>ä¸åŒä¸šåŠ¡ä¹‹é—´çš„ä»£ç äº’ç›¸è€¦åˆï¼Œéš¾ä»¥åŒºåˆ†ä¸”å¿«é€Ÿå®šä½é—®é¢˜</li><li>å¢åŠ å¼€å‘æˆæœ¬ï¼Œå…¥æ‰‹éš¾åº¦å¢é«˜</li><li>å¼€å‘ç•Œçº¿æ¨¡ç³Šï¼Œä¸æ˜“å®šä½åˆ°å…·ä½“è´Ÿè´£äºº</li><li>å¯¹äºæœ‰ç‰¹æ®Šéœ€æ±‚çš„æ¨¡å—æ— æ³•æ‹†è§£ï¼Œæ¯”å¦‚ï¼šä¸Šä¼  maven ä»“åº“åªéœ€è¦éƒ¨åˆ†ä»£ç å³å¯ï¼Œä½†ç”±äºåªæœ‰ 1 ä¸ªæ¨¡å—ï¼Œä¸å¾—ä¸å…¨éƒ¨ä¸Šä¼ ã€‚</li></ul><p>è¿›è¡Œæ¨¡å—æ‹†åˆ†ï¼Œå¯ä»¥å°†è¿™äº›é—®é¢˜æ”¹å–„ã€è§£å†³ã€‚</p><hr><p>åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªè§„èŒƒ ï¼Œå…·ä½“è¯¥å¦‚ä½•æ‹†åˆ†è¿™äº›æ¨¡å—ï¼Œæ˜¯æŒ‰ç…§ä¸šåŠ¡å»æ‹†åˆ†ï¼Œäº¦æˆ–è€…æ˜¯æŒ‰ç…§ä»£ç çš„åŠŸèƒ½æ¥æ‹†åˆ†ã€‚æˆ‘å‚é‡‡ç”¨çš„æ‹†åˆ†å¤§ä½“å¦‚ä¸‹ï¼š</p><ul><li>Api-client é€šå¸¸æ˜¯dubboæ¥å£æš´éœ²è¢«å¼•ç”¨ä¸ºjaråŒ…çš„æ¨¡å—</li><li>Api-def æ¥å£çš„å®šä¹‰ã€æŸäº›å¸¸é‡å®ä½“ç±»ç­‰</li><li>Api-impl æ¥å£çš„å®ç°</li><li>Api-cache ç¼“å­˜ç›¸å…³</li><li>Api-common ä¸€äº›é…ç½®ã€å¸¸é‡ã€utils</li><li>consumer mqçš„æ¶ˆè´¹è€…æˆ–è€…Listener</li><li>schedule å®šæ—¶ä»»åŠ¡</li><li>Server webæœåŠ¡</li><li>Service-def Serviceå±‚</li><li>Service-impl Serviceå±‚çš„å…·ä½“å®ç°</li></ul><blockquote><p>æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³» apiæ¨¡å—åªä¾èµ–æœ€åŸºç¡€çš„ä¸‰æ–¹æ¨¡å—ï¼Œä¸èƒ½ä¾èµ–å…¶æ‰€åœ¨é¡¹ç›®çš„æ¨¡å—ï¼Œé˜²æ­¢å‡ºç°å¾ªç¯ä¾èµ–</p><p>serviceæ¨¡å—éœ€è¦ä¾èµ–apiæ¨¡å— ä»¥åŠç›¸åº”çš„commonæ¨¡å—ï¼ˆåŸºç¡€çš„å¸¸ç”¨å·¥å…·ç±»æˆ–è€…resultå°è£…å¯¹è±¡å¯ä»¥å†™åœ¨è¿™é‡Œï¼‰å’Œmapperæ¨¡å—ï¼ˆæ•°æ®åº“çš„æ“ä½œæ¨¡å—ï¼Œä¹Ÿå¯ä»¥å«manageræ¨¡å—ï¼‰ ä»¥åŠpojoæ¨¡å—ï¼ˆæœ€åŸºç¡€çš„å®ä½“æ¨¡å—ï¼Œå…¶ä¸åº”è¯¥å†ä¾èµ–ä»»ä½•æ¨¡å—ï¼‰ï¼Œ</p><p>commonæ¨¡å—å’Œmapperæ¨¡å—ä»¥åŠpojoæ¨¡å—ï¼Œ åœ¨comsumeré¡¹ç›®ä¸­æœ‰ï¼Œé€šè¿‡installå‘½ä»¤æ¨åˆ°mavençš„æœ¬åœ°ä»“åº“ä¸­</p><p>provideré¡¹ç›®å¯ä»¥é€šè¿‡å¼•å…¥mavenä¾èµ–çš„å½¢å¼ å»ä½¿ç”¨è¿™äº›jar</p><p>å¯åŠ¨ç±»æ¨¡å—ä¸­éœ€è¦ä¾èµ–serviceæ¨¡å—ï¼Œå› ä¸ºéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™åŠ è½½è¿™äº›æ¨¡å—</p><p>ğŸŒšå”¯ä¸€ä¸€ä¸ªä»ç½‘ä¸Šæ‰¾åˆ°æ¯”è¾ƒç›¸å…³çš„è§„èŒƒ</p></blockquote><h2 id="ä¸‰ã€Dynamic-åŠ¨æ€å±æ€§çš„åº”ç”¨"><a href="#ä¸‰ã€Dynamic-åŠ¨æ€å±æ€§çš„åº”ç”¨" class="headerlink" title="ä¸‰ã€Dynamic åŠ¨æ€å±æ€§çš„åº”ç”¨"></a>ä¸‰ã€Dynamic åŠ¨æ€å±æ€§çš„åº”ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; filterDomains = Collections.newSetFromMap(<span class="keyword">new</span> ConcurrentHashMap&lt;String, Boolean&gt;());</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; filterAddress = Collections.newSetFromMap(<span class="keyword">new</span> ConcurrentHashMap&lt;String, Boolean&gt;());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DynamicStringProperty domains = DynamicPropertyFactory.getInstance()</span><br><span class="line">            .getStringProperty(DBDomainConfiguration.MAIL_BLACK_DOMAIN, <span class="string">""</span>, <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    refreshFilterDomainsSet();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DynamicStringProperty address = DynamicPropertyFactory.getInstance()</span><br><span class="line">            .getStringProperty(DBDomainConfiguration.MAIL_BLACK_ADDRESS, <span class="string">""</span>, <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    refreshFilterAddressSet();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">......</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">refreshAliyunDomainSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String confValue = aliyunWhiteDomains.get();</span><br><span class="line">        log.info(<span class="string">"refresh aliyunWhiteDomainSet ["</span> + confValue + <span class="string">"]"</span>);</span><br><span class="line">        String[] whiteDomains = StringUtils.split(confValue, <span class="string">','</span>);</span><br><span class="line">        aliyunDomains.clear();</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isNotEmpty(whiteDomains)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; whiteDomains.length; i++) &#123;</span><br><span class="line">                String whiteDomain = StringUtils.lowerCase(StringUtils.trimToNull(whiteDomains[i]));</span><br><span class="line">                <span class="keyword">if</span> (whiteDomain != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    log.info(<span class="string">"add aliyunWhiteDomain "</span> + whiteDomain);</span><br><span class="line">                    aliyunDomains.add(whiteDomain);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">refreshFilterDomainsSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String value = domains.get();</span><br><span class="line">        log.info(<span class="string">"refresh filterDomains ["</span> + value + <span class="string">"]"</span>);</span><br><span class="line">        String[] filter = StringUtils.split(value, <span class="string">','</span>);</span><br><span class="line">        filterDomains.clear();</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isNotEmpty(filter)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String s : filter) &#123;</span><br><span class="line">                String blackDomain = StringUtils.lowerCase(StringUtils.trimToNull(s));</span><br><span class="line">                <span class="keyword">if</span> (blackDomain != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    log.info(<span class="string">"add filterDomains "</span> + blackDomain);</span><br><span class="line">                    filterDomains.add(blackDomain);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹    è¿™é‡Œæˆ‘å®šä¹‰äº†ä¸¤ä¸ªMapæ¥å­˜æ”¾åœ°å€å’ŒåŸŸåçš„é»‘åå•åˆ—è¡¨ï¼Œæ¯æ¬¡å‘é€å‰è¿›è¡Œæ ¡éªŒæ¥åˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œå†å†³å®šæ˜¯å¦ç»§ç»­å‘é€ã€‚</p><p>â€‹    é‚®ä»¶çš„åŸŸåå’Œåœ°å€é»‘åå•å­˜æ”¾åœ¨mysqlè¡¨æ ¼ä¸­ï¼Œä½†æ˜¯å¦‚æœæ¯æ¬¡å‘é€éƒ½è¦æŸ¥ä¸€éè¡¨è¿›è¡Œæ ¡éªŒï¼Œå°±æ˜¾å¾—å¾ˆè ¢ï¼Œè¿™ä¸ªæ—¶å€™ç”±Netflixæ¨å‡ºçš„Archaiusæä¾›äº†è¿™æ ·çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼›DynamicåŠ¨æ€å±æ€§ï¼Œå¦‚å›¾ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸¤ä¸ª<code>DynamicStringProperty</code>çš„æˆå‘˜å˜é‡<code>address</code>å’Œ<code>domains</code>,å½“æˆ‘åœ¨é¡¹ç›®è¿è¡Œæ—¶ï¼Œå°†mysqlæ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¸¤ä¸ªæˆå‘˜å˜é‡å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œ<strong>ä¿æŒä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸€è‡´</strong>ã€‚è€Œè¿™é‡Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œåœ¨æˆå‘˜å˜é‡å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨(æˆ‘è¿™é‡Œçš„å›è°ƒæ—¶å¯¹å­˜æ”¾åœ°å€å’ŒåŸŸåçš„é»‘åå•è¿›è¡Œrefreshæ“ä½œ)ã€‚</p><p>â€‹    é™„ä¸Šä¸€ä¸ª<code>DynamicStringProperty</code>å¯¹è¯»å–MySqlæ•°æ®åº“çš„é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhipin.mail.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> com.netflix.config.PollResult;</span><br><span class="line"><span class="keyword">import</span> com.netflix.config.PolledConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> com.zhipin.mail.dao.EmailBlackAddressDAO;</span><br><span class="line"><span class="keyword">import</span> com.zhipin.mail.dao.EmailBlackDomainDAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBDomainConfiguration</span> <span class="keyword">implements</span> <span class="title">PolledConfigurationSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAIL_BLACK_DOMAIN = <span class="string">"email_black_domain"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAIL_BLACK_ADDRESS = <span class="string">"email_black_address"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EmailBlackDomainDAO emailBlackDomainDAO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EmailBlackAddressDAO emailBlackAddressDAO;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DBDomainConfiguration</span><span class="params">(EmailBlackDomainDAO emailBlackDomainDAO, EmailBlackAddressDAO emailBlackAddressDAO)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.emailBlackDomainDAO = emailBlackDomainDAO;</span><br><span class="line">        <span class="keyword">this</span>.emailBlackAddressDAO = emailBlackAddressDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PollResult <span class="title">poll</span><span class="params">(<span class="keyword">boolean</span> initial, Object checkPoint)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = load();</span><br><span class="line">        <span class="keyword">return</span> PollResult.createFull(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">load</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; blackDomainList = emailBlackDomainDAO.getConfigDomains();</span><br><span class="line">        List&lt;String&gt; blackAddressList = emailBlackAddressDAO.getConfigAddress();</span><br><span class="line">        Map&lt;String, Object&gt; result = Maps.newHashMap();</span><br><span class="line">        String domains = String.join(<span class="string">","</span>, blackDomainList);</span><br><span class="line">        String address = String.join(<span class="string">","</span>, blackAddressList);</span><br><span class="line">        result.put(MAIL_BLACK_DOMAIN, domains);</span><br><span class="line">        result.put(MAIL_BLACK_ADDRESS, address);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    é™¤äº†æ„ŸçŸ¥Mysqlæ•°æ®åº“ä¸­æ•°æ®çš„å˜åŒ–æ¥æ›´æ–°åŠ¨æ€å±æ€§çš„æ–¹å¼ä¹‹å¤–ï¼ŒArchaiusçš„åŠ¨æ€å±æ€§è¿˜å¯ä»¥é…ç½®ä¸ºå¯åŠ¨é¡¹ã€propertiesé…ç½®ç­‰è®¸å¤šæ–¹å¼ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œä¹‹åæœ‰æœºä¼šå¯ä»¥å•ç‹¬å»ç ”ç©¶ã€‚</p><h2 id="å››ã€éƒ¨ç½²é—®é¢˜ç›¸å…³"><a href="#å››ã€éƒ¨ç½²é—®é¢˜ç›¸å…³" class="headerlink" title="å››ã€éƒ¨ç½²é—®é¢˜ç›¸å…³"></a>å››ã€éƒ¨ç½²é—®é¢˜ç›¸å…³</h2><p>â€‹    æ—¶é—´æ¥åˆ°å¼€å‘ç»“æŸï¼Œéƒ¨ç½²è‡³å¼€å‘ç¯å¢ƒï¼Œè¿™ä¸ªè¿‡ç¨‹é‡Œé—®é¢˜ä¸å¤§ï¼Œä¸»è¦æ˜¯å‘ç”Ÿäº†ä¸¤ä¸ªé—®é¢˜ã€‚</p><p><strong>#1 runè„šæœ¬é—®é¢˜</strong></p><p>â€‹    è¿™ä¸ªé—®é¢˜å¾ˆéš¾è®²ï¼Œæˆ‘ä»”ç»†æ£€æŸ¥runè„šæœ¬ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆä¸åˆç†çš„åœ°æ–¹ï¼Œç»è¿‡æŸ¥é˜…èµ„æ–™çœ‹åˆ°ç½‘ä¸Šæœ‰äººæåˆ°<strong>shellè„šæœ¬åœ¨Linuxç¯å¢ƒå’Œæ™®é€šideå¼€å‘çš„ç¯å¢ƒä¸‹å­˜åœ¨å­—ç¬¦é›†ä¸ä¸€è‡´çš„æƒ…å†µ</strong>ã€‚è¿™é‡Œæˆ‘é‡‡ç”¨çš„è§£å†³æ–¹å¼æ˜¯ï¼ŒæŠŠrunè„šæœ¬å¤åˆ¶ï¼Œåœ¨vimç¼–è¾‘æ¨¡å¼ä¸‹ç²˜è´´ä¸€éï¼Œç¥å¥‡çš„å¥æ•ˆäº†ï¼Œå¯èƒ½é—®é¢˜ç¡®å®å‘ç”Ÿåœ¨è¿™é‡Œå§ã€‚ã€‚ã€‚ã€‚</p><p><strong>#2 mavenæ‰“åŒ…é…ç½®</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.zhipin.mail.MailBootstrap<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span> // Mailootstrap </span><br><span class="line">        <span class="tag">&lt;<span class="name">executable</span>&gt;</span>true<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;service.name&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    éƒ¨ç½²æ–¹å¼é‡‡ç”¨mavenæ‰“åŒ…æˆjaråŒ…ï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œçš„æ–¹å¼ï¼Œè¿™é‡Œçš„mavené…ç½®ä¹‹å‰mainClassä¹¦å†™é”™è¯¯ï¼Œå¯¼è‡´jaråŒ…åœ¨è¿è¡Œçš„æƒ…å†µä¸‹æ‰¾ä¸åˆ°å¯åŠ¨çš„mainå…¥å£ã€‚å¯ä»¥æƒ³åˆ°ï¼Œ<strong>mavenæ‰“åŒ…SpringBootåjaråŒ…çš„å¯åŠ¨å…¥å£å°±åœ¨è¿™ä¸ª<code>mainClass</code>æ ‡ç­¾ä¸‹çš„mainæ–¹æ³•ä¸Š</strong>ã€‚</p><h2 id="äº”ã€éSpringå®¹å™¨ä¸­Compentè‡ªåŠ¨è£…é…å¤±è´¥é—®é¢˜"><a href="#äº”ã€éSpringå®¹å™¨ä¸­Compentè‡ªåŠ¨è£…é…å¤±è´¥é—®é¢˜" class="headerlink" title="äº”ã€éSpringå®¹å™¨ä¸­Compentè‡ªåŠ¨è£…é…å¤±è´¥é—®é¢˜"></a>äº”ã€éSpringå®¹å™¨ä¸­Compentè‡ªåŠ¨è£…é…å¤±è´¥é—®é¢˜</h2><p>â€‹    è¿™ä¸ªé—®é¢˜æœ‰ç‚¹ç±»ä¼¼ä¹‹å‰å†™è¿‡çš„<code>Springè‡ªåŠ¨è£…é…çš„ä¸€æ¬¡è¸©å‘ç»å†</code>ä¸­æåˆ°çš„é—®é¢˜ã€‚</p><p>â€‹    æ˜¯è¿™æ ·ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªç±»<code>CheckAndRetryTask</code>è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯é‚®ä»¶å‘é€åçš„æ£€éªŒç›¸å…³é€»è¾‘ï¼Œè€Œæˆ‘æ¯æ¬¡å‘é€å®Œé‚®ä»¶éƒ½ä¼šnewä¸€ä¸ªtaskï¼Œå°†å®ƒä¸¢åˆ°çº¿ç¨‹æ± ä¸­å»å¤„ç†ï¼Œè€Œè¿™ä¸ªç»è¿‡newåˆ›å»ºçš„ç±»ä¸­æœ‰ä¸€ä¸ªæ ‡æ³¨äº†<code>@Autowired</code>çš„æˆå‘˜å˜é‡ã€‚è¿™æ ·çš„æ–¹å¼è¿™ä¸ªæˆå‘˜å˜é‡æ— æ³•é€šè¿‡è‡ªåŠ¨è£…é…çš„æ–¹å¼æ¥èµ‹å€¼ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šæœ‰NullPointerExceptionã€‚</p><p>â€‹    è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯å°†è‡ªåŠ¨è£…é…æ–¹å¼æ”¹æˆç›´æ¥ä»Springå®¹å™¨ä¸­è·å–ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨ç©ºæŒ‡é’ˆå¼‚å¸¸äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ResumeManager resumeManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> ä¿®æ”¹ä¸ºğŸ‘‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> ResumeManager resumeManager = (ResumeManager) ApplicationContextUtils.getBean(<span class="string">"resumeManager"</span>);</span><br></pre></td></tr></table></figure><p>é™„ä¸Šä¸€ä¸ª<code>ApplicationContextUtils</code>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextUtils</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        ApplicationContextUtils.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line">        object = ApplicationContextUtils.applicationContext.getBean(name);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        T object = <span class="keyword">null</span>;</span><br><span class="line">        object = ApplicationContextUtils.applicationContext.getBean(clazz);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name, Class&lt;T&gt; requiredType)</span> </span>&#123;</span><br><span class="line">        T object = <span class="keyword">null</span>;</span><br><span class="line">        object = ApplicationContextUtils.applicationContext.getBean(name, requiredType);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ApplicationContextUtils.applicationContext.containsBean(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] getAliases(String name) &#123;</span><br><span class="line">        String[] s = <span class="keyword">null</span>;</span><br><span class="line">        s = ApplicationContextUtils.applicationContext.getAliases(name);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…­ã€dubboæ¥å£å¼•ç”¨"><a href="#å…­ã€dubboæ¥å£å¼•ç”¨" class="headerlink" title="å…­ã€dubboæ¥å£å¼•ç”¨"></a>å…­ã€dubboæ¥å£å¼•ç”¨</h2><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20210215174500237.png" alt="image-20210215174500237"></p><p>â€‹    dubboæ¥å£å¼•ç”¨æ˜¯å°†å¼•ç”¨çš„é…ç½®å†™åœ¨<code>api-client</code>æ¨¡å—ä¸‹ï¼Œç„¶åæœåŠ¡ä¸Šæ¸¸è°ƒç”¨æ–¹ç›´æ¥å¼•ç”¨é¡¹ç›®deployå¥½çš„jaråŒ…çš„è¿™ä¸ªclientæ¨¡å—å°±å¯ä»¥äº†ã€‚</p><p>å¼•ç”¨é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                http://code.alibabatech.com/schema/dubbo</span></span></span><br><span class="line"><span class="tag"><span class="string">                http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"mailRegistry"</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"$&#123;zk_registry&#125;"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">group</span>=<span class="string">"$&#123;mail.dubbo.registry.group:zp_dubbo/mail&#125;"</span> <span class="attr">file</span>=<span class="string">"dubbo-registry-mail-provider.file"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"resumeMailApi"</span> <span class="attr">interface</span>=<span class="string">"com.zhipin.mail.api.ResumeMailApi"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">registry</span>=<span class="string">"mailRegistry"</span>  <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">check</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€Jenkinsæ–°å»ºä»»åŠ¡"><a href="#ä¸ƒã€Jenkinsæ–°å»ºä»»åŠ¡" class="headerlink" title="ä¸ƒã€Jenkinsæ–°å»ºä»»åŠ¡"></a>ä¸ƒã€Jenkinsæ–°å»ºä»»åŠ¡</h2><p>â€‹        æ˜¯ç¬¬ä¸€æ¬¡åœ¨Jenkinsä¸Šæ–°å»ºä»»åŠ¡ï¼Œå…¶å®ç°åœ¨å›å¤´æ¥çœ‹ä¹Ÿéƒ½æ¯”è¾ƒç®€å•ï¼Œå…·ä½“å¤§æ¦‚ä¹Ÿå°±æ˜¯ä¸€äº›å‚æ•°çš„é…ç½®ï¼Œæ¯”å¦‚gitåœ°å€ã€åˆ†æ”¯åç§°ã€æœåŠ¡åç§°ï¼Œå…·ä½“è¦ç•™æ„çš„ä¸€éƒ¨åˆ†åº”è¯¥æ˜¯Post Stepsè¿™ä¸ªéƒ¨åˆ†ï¼Œè¿™é‡Œé‡‡ç”¨shellè„šæœ¬çš„æ–¹å¼æ¥å¯¹å·²ç»ç»è¿‡Jenkinsæ‰“åŒ…å¥½çš„é¡¹ç›®è¿›è¡Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åè¿è¡Œçš„æ“ä½œã€‚</p><p><strong>Command</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for i in $&#123;service[*]&#125;</span><br><span class="line">do</span><br><span class="line"> JAR_NAME=`find $WORKSPACE/ -name "$i.jar"|grep -v SNAPSHOT`</span><br><span class="line">  scp -P port  $JAR_NAME work@host:/data/$i</span><br><span class="line">  ssh -p port  work@host "cd /data/$i;svc -dk .;svc -u .;"</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>â€‹    è¿™é‡Œçš„shellä¸»è¦ä½œç”¨æ˜¯ï¼Œå¾ªç¯éå†ä¸Šé¢é…ç½®è¿‡çš„éœ€è¦è¿›è¡Œéƒ¨ç½²çš„æœåŠ¡åç§°ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”å·²ç»æ‰“åŒ…å¥½çš„jaråŒ…ï¼Œå°†å®ƒé€šè¿‡scpçš„æ–¹å¼ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„å¯¹åº”ç›®å½•ä¸­ï¼Œç„¶åè¿æ¥å¯¹åº”æœåŠ¡å™¨ï¼Œé€šè¿‡daemontoolsçš„æ–¹å¼è¿›è¡Œé‡å¯ã€‚</p><blockquote><p>è¿™é‡Œå…¶å®æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœå½“å‰é¡¹ç›®æ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²ï¼Œé‚£ä¹ˆä»–çš„runè„šæœ¬ä»¥åŠæ‰“åŒ…åçš„æ–‡ä»¶ä¸­çš„å…¶ä»–å†…å®¹éƒ½ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œå®é™…ä¸Šåªä¼šå•ç‹¬ä¸Šä¼ ä¸€ä¸ªjaråŒ…ï¼Œè€Œå½“æˆ‘ä»¬æ²¡æœ‰runè„šæœ¬æ—¶ï¼Œé¡¹ç›®å°±æ— æ³•å¯åŠ¨ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for i in $&#123;service[*]&#125;</span><br><span class="line">do</span><br><span class="line">JAR_NAME=`find $WORKSPACE/ -name "*$i*.zip"`</span><br><span class="line">ssh -p port work@host "cd /data/$i; svc -dk .; rm -rf lib *.zip"</span><br><span class="line">scp -P port $JAR_NAME work@host:/data/$i</span><br><span class="line">ssh -p port work@host "cd /data/$i; unzip -o *.zip -x run; svc -u .;"</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>â€‹    è¿™ä¸ªshellå°±æ­£å¸¸å¤šäº†ï¼Œé¦–å…ˆå°†æœåŠ¡å™¨ä¸Šçš„æœåŠ¡è¿›ç¨‹æ€æ­»ï¼Œç„¶åä¸Šä¼ æ‰“åŒ…å¥½çš„æ•´ä¸ªzipåŒ…ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šè§£å‹ã€å¯åŠ¨ã€‚</p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>â€‹    é›¶é›¶ç¢ç¢çš„ä¸¤ä¸ªæœˆï¼Œé›¶é›¶ç¢ç¢çš„ä¸€å †é—®é¢˜ï¼Œè¿™äº›é—®é¢˜ç°åœ¨çœ‹æ¥ç®€å•ï¼Œè§£å†³æ–¹å¼æ¸…æ™°æ˜äº†ï¼Œä½†æ˜¯åœ¨å½“æ—¶éƒ½æ˜¯è€—è´¹äº†æˆ‘å¾ˆå¤šå¿ƒæ€ï¼Œè§£å†³åæœ‰å¾ˆå¤§æ”¶è·çš„é—®é¢˜ï¼›å…¶å®é™¤äº†ä¸Šè¿°çš„è¿™äº›é—®é¢˜ä¹‹å¤–ä¹Ÿæœ‰å¾ˆå¤šæ²¡æœ‰å†™è¿›æ¥çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><ul><li>RateLimiter qpsé™åˆ¶å™¨</li><li>mqConsumer é…ç½®ç›¸å…³</li><li>Spring beançš„é…ç½®</li></ul><p>â€‹    è¿™äº›å…¶ä»–é—®é¢˜å¯èƒ½æ˜¯æˆ‘è¿˜æ²¡æœ‰è§£å†³çš„å¾ˆå®Œå–„ï¼Œæˆ–è€…æ˜¯é‡‡ç”¨äº†å…¬å¸ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæœ‰äº›æ˜¯ä¸å€¼ä¸€æçš„é—®é¢˜ï¼Œä¸ç®¡æ€æ ·è¿™äº›é—®é¢˜éƒ½æ˜¯å¾ˆæœ‰ä»·å€¼çš„é—®é¢˜ï¼Œè‡³å°‘å¯¹ç°åœ¨çš„æˆ‘æ˜¯è¿™æ ·â€¦.</p><p>â€‹    <strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> workReview </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty Study(ä¸‰):Netty-Demo(EchoæœåŠ¡å™¨&amp;å®¢æˆ·ç«¯)</title>
      <link href="/2020/12/17/Netty-Study-%E4%B8%89-Netty-Demo-Echo%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%AE%A2%E6%88%B7%E7%AB%AF/"/>
      <url>/2020/12/17/Netty-Study-%E4%B8%89-Netty-Demo-Echo%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%AE%A2%E6%88%B7%E7%AB%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€NettyæœåŠ¡å™¨ç«¯"><a href="#ä¸€ã€NettyæœåŠ¡å™¨ç«¯" class="headerlink" title="ä¸€ã€NettyæœåŠ¡å™¨ç«¯"></a>ä¸€ã€NettyæœåŠ¡å™¨ç«¯</h2><p>ä¸€ä¸ªNettyæœåŠ¡å™¨åº”è¯¥åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ChannelHandlerï¼šå®ç°æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡é€»è¾‘ï¼›</li><li>BootStrapï¼š æœåŠ¡å™¨çš„å¯åŠ¨éƒ¨åˆ†ï¼Œå°†æœåŠ¡å™¨ç»‘å®šåˆ°è¦ç›‘å¬è¿æ¥è¯·æ±‚åˆ°ç«¯å£ä¸Šï¼›</li></ul><h3 id="1-ChannelHandler"><a href="#1-ChannelHandler" class="headerlink" title="#1 ChannelHandler"></a>#1 ChannelHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ChannelHandler</span>.Sharable<span class="comment">//æ ‡ç¤ºä¸€ä¸ªChannelHandlerå¯ä»¥è¢«å¤šä¸ªChannelå…±äº«</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelHandlerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ByteBuf in = (ByteBuf) msg;</span><br><span class="line">      <span class="comment">//æ§åˆ¶å°æ‰“å°æ¶ˆæ¯è®°å½•</span></span><br><span class="line">      <span class="comment">//å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ å†™ç»™å‘é€è€…ï¼Œè€Œ ä¸å†²åˆ·å‡ºç«™æ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">"Server received: "</span> + in.toString(StandardCharsets.UTF_8));</span><br><span class="line">        ctx.write(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//å°†æœªå†³æ¶ˆæ¯å†²åˆ·åˆ° è¿œç¨‹èŠ‚ç‚¹ï¼Œå¹¶ä¸”å…³ é—­è¯¥ Channel</span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.EMPTY_BUFFER).addListener(ChannelFutureListener.CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//æ•è·å¼‚å¸¸ï¼Œå…³é—­è¿æ¥</span></span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>EchoServerHandler</code>å®ç°äº†<code>ChannelHandlerAdapter</code>ï¼ˆNetty in actionä¹¦ä¸­æ˜¯é€‰æ‹©å®ç°çš„<code>ChannelInboundHandlerAdapter</code>ï¼Œ <strong>åœ¨Netty 5.0ç‰ˆæœ¬ä¹‹åï¼Œä¸ºäº†ç²¾ç®€handlerç±»å‹ç»§æ‰¿å…³ç³»</strong>ï¼Œ<code>ChannelInboundHandler</code>å’Œ<code>ChannelOutboundHandler</code>è¢«åˆå¹¶æˆ<code>ChannelHandler</code>ã€‚ç°åœ¨<code>ChannelHandler</code>ä¸­æ—¢æœ‰<strong>inbound handlerå‡½æ•°</strong>ä¹Ÿæœ‰<strong>outbound handlerå‡½æ•°</strong>)ï¼ŒHandlerå®ç°çš„<code>ChannelHandlerAdapter</code>æœ‰å¾ˆå¤šå¯é‡å†™çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æŒ‚å‹¾åˆ°äº‹ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ°å½“æ—¶é—´ç‚¹ä¸Šã€‚</p><p>å…³äº<strong>å¼‚å¸¸æ•è·</strong>ï¼Œå¦‚æœChannelPiplineä¸Šçš„æ‰€æœ‰ChannelHandleréƒ½æ²¡æœ‰é‡å†™<code>exceptionCaught()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæ‰€æ¥æ”¶çš„ä¸€åœºä¼šè¢«ä¼ é€’åˆ°ChannelPiplineçš„å°¾ç«¯å¹¶è¢«è®°å½•ã€‚</p><blockquote><ul><li>é’ˆå¯¹ä¸åŒç±»å‹çš„äº‹ä»¶æ¥è°ƒç”¨ ChannelHandler;</li><li>åº”ç”¨ç¨‹åºé€šè¿‡å®ç°æˆ–è€…æ‰©å±• ChannelHandler æ¥æŒ‚é’©åˆ°äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”æä¾›è‡ªå®šä¹‰çš„åº”ç”¨ç¨‹åºé€»è¾‘;</li><li>åœ¨æ¶æ„ä¸Šï¼ŒChannelHandler æœ‰åŠ©äºä¿æŒä¸šåŠ¡é€»è¾‘ä¸ç½‘ç»œå¤„ç†ä»£ç çš„åˆ†ç¦»ã€‚è¿™ç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œå› ä¸ºä»£ç å¿…é¡»ä¸æ–­åœ°æ¼”åŒ–ä»¥å“åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚</li></ul></blockquote><h3 id="2-ServerBootStrap"><a href="#2-ServerBootStrap" class="headerlink" title="#2 ServerBootStrap"></a>#2 ServerBootStrap</h3><p>å¼•å¯¼æœåŠ¡å™¨çš„å…·ä½“ä½œç”¨ä¸»è¦æ˜¯ï¼š</p><ul><li>ç»‘å®šåˆ°æœåŠ¡å™¨å°†åœ¨å…¶ä¸Šç›‘å¬å¹¶æ¥å—ä¼ å…¥è¿æ¥è¯·æ±‚çš„ç«¯å£;</li><li>é…ç½® Channelï¼Œä»¥å°†æœ‰å…³çš„å…¥ç«™æ¶ˆæ¯é€šçŸ¥ç»™ Handler å®ä¾‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EchoServer</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//è®¾ç½®ç»‘å®šç«¯å£</span></span><br><span class="line">        <span class="keyword">if</span> (args.length != <span class="number">1</span>) &#123;</span><br><span class="line">            System.err.println("Usage: " + EchoServer.class.getSimpleName() + " &lt;port&gt;");</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">new</span> EchoServer(port).start(); <span class="comment">//å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> EchoServerHandler serverHandler = <span class="keyword">new</span> EchoServerHandler();</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup(); <span class="comment">// åˆ›å»ºEventLoop</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServerBootstrap serverBootstrap = <span class="keyword">new</span> ServerBootstrap(); <span class="comment">//åˆ›å»ºBootStrap å¼•å¯¼</span></span><br><span class="line">            serverBootstrap.group(group)</span><br><span class="line">                    .channel(NioServerSocketChannel<span class="class">.<span class="keyword">class</span>) //æŒ‡å®š<span class="title">Nio</span>ä¼ è¾“<span class="title">Channel</span></span></span><br><span class="line"><span class="class">                    .<span class="title">localAddress</span>(<span class="title">new</span> <span class="title">InetSocketAddress</span>(<span class="title">port</span>))// æŒ‡å®š<span class="title">socket</span>åœ°å€</span></span><br><span class="line"><span class="class">                    .<span class="title">childHandler</span>(<span class="title">new</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">SocketChannel</span>&gt;() </span>&#123; <span class="comment">//ChannelInitializer</span></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(serverHandler);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind().sync(); <span class="comment">//çœŸæ­£çš„ç»‘å®šæœåŠ¡å™¨</span></span><br><span class="line">            channelFuture.channel().closeFuture().sync();<span class="comment">//ç›´åˆ°æœåŠ¡å™¨channelå…³é—­ï¼Œæ‰ä¼šé€€å‡ºå½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully().sync(); <span class="comment">//å…³é—­å¹¶é‡Šæ”¾æ‰€æœ‰èµ„æº</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Channelã€EventLoopä¸¤è€…ç›¸äº’é…åˆå®ç°åŸºæœ¬çš„å¥—æ¥å­—æ“ä½œ</strong>ï¼Œè¿™é‡Œé€šè¿‡<code>ServerBootstrap</code>å¼•å¯¼å°†å…¶æ•´åˆèµ·æ¥ï¼Œchannel()æ–¹æ³•æŒ‡å®šäº†NIOä¼ è¾“Channelï¼Œæ¥ç€ç»‘å®šæœ¬åœ°ç«¯å£ï¼ˆ<code>InetSocketAddress</code>ï¼‰ã€‚</p><p>é€šè¿‡<code>ChannelInitializer</code>åœ¨æ–°é“¾æ¥æ¥å—æ—¶ï¼Œåˆ›å»ºæ–°çš„å­Channelï¼Œä¹‹åChannelInitializerå†ä¼šæŠŠå·²ç»å®šä¹‰å¥½çš„serverHandleræ·»åŠ åˆ°piplineé‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ChannelFuture channelFuture = serverBootstrap.bind().sync(); <span class="comment">//çœŸæ­£çš„ç»‘å®šæœåŠ¡å™¨</span></span><br><span class="line">channelFuture.channel().closeFuture().sync();<span class="comment">//ç›´åˆ°æœåŠ¡å™¨channelå…³é—­ï¼Œæ‰ä¼šé€€å‡ºå½“å‰çº¿ç¨‹</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„<strong>ç¬¬ä¸€è¡Œä»£ç æ˜¯æœåŠ¡å™¨å»ç»‘å®šæŒ‡å®šå¥½çš„ç«¯å£ï¼Œä½¿ç”¨sync()é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ç»‘å®šæ“ä½œå®Œæˆ</strong>ã€‚<strong>ç¬¬äºŒè¡Œä»£ç æ˜¯é˜»å¡ç­‰å¾…ç›´åˆ°æœåŠ¡å™¨çš„æ‰€æœ‰Channelå…³é—­</strong>ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯ä¿è¯äº†ç»‘å®šå¥½äº†ç«¯å£ä¹‹åä¸ä¼šæ‰§è¡Œfinallyä»£ç å—é‡Œçš„æ–¹æ³•ï¼Œå¯¼è‡´æ•´ä¸ªNettyæœåŠ¡å™¨å…³é—­ã€‚è¿™æ ·å°±å¯ä»¥ç›‘å¬å…³é—­äº‹ä»¶ï¼Œç„¶åè¿›è¡ŒshutdownGracefullyä¼˜é›…å…³é—­ã€‚</p><h2 id="äºŒã€Nettyå®¢æˆ·ç«¯"><a href="#äºŒã€Nettyå®¢æˆ·ç«¯" class="headerlink" title="äºŒã€Nettyå®¢æˆ·ç«¯"></a>äºŒã€Nettyå®¢æˆ·ç«¯</h2><h3 id="1-ChannelHandler-1"><a href="#1-ChannelHandler-1" class="headerlink" title="#1 ChannelHandler"></a>#1 ChannelHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClientHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">ByteBuf</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">"Netty rocks!"</span>, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ByteBuf in = (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">"Client received: "</span> + in.toString(StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">messageReceived</span><span class="params">(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦é‡å†™äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ª<code>channelActive()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ä¸€ä¸ªé“¾æ¥è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ï¼Œè¿™é‡Œç¼–ç äº†ä¸€ä¸ªå­—ç¬¦ä¸²â€œNetty rocksâ€å­—ç¬¦ä¸²çš„Bufferï¼Œå°†å…¶å†™å…¥æœåŠ¡å™¨ï¼ˆwriteAndFlushï¼‰ï¼›</p><p>ç„¶åé‡å†™äº†<code>channelRead()</code>æ–¹æ³•ã€‚æ¥æ”¶æ•°æ®æ—¶å›è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œçš„æ¥æ”¶å¯èƒ½ä¸æ˜¯ä¸€æ¬¡æ€§æ¥æ”¶çš„ï¼ŒæœåŠ¡å™¨å‘å‡ºæ¥çš„æ¶ˆæ¯å¯èƒ½è¿›è¡Œåˆ†å—æ¥æ”¶ï¼Œå³ä½¿æ˜¯å‡ ä¸ªå­—èŠ‚å¾ˆå°‘é‡çš„æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯èƒ½è°ƒç”¨ä¸¤æ¬¡ï¼Œä½œä¸ºä¸€ä¸ªé¢å‘æµçš„åè®®ï¼ŒTCPä¿è¯æ•°ç»„ä¼šæŒ‰ç…§æœåŠ¡å™¨å‘é€å®ƒçš„é¡ºåºå»æ¥æ”¶å®ƒã€‚</p><p>ç¬¬ä¸‰ä¸ªæ–¹æ³•å°±æ˜¯<code>exceptionCaught()</code>ï¼Œå’ŒæœåŠ¡å™¨ç«¯çš„ä¸€æ ·ï¼Œè®°å½•Throwableï¼Œå…³é—­channelã€‚</p><h3 id="2-BootStrap"><a href="#2-BootStrap" class="headerlink" title="#2 BootStrap"></a>#2 BootStrap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EchoClient</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Bootstrap bootstrap = <span class="keyword">new</span> Bootstrap();</span><br><span class="line">            bootstrap.group(group)</span><br><span class="line">                    .channel(NioSocketChannel<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                    .<span class="title">remoteAddress</span>(<span class="title">new</span> <span class="title">InetSocketAddress</span>(<span class="title">host</span>, <span class="title">port</span>))</span></span><br><span class="line"><span class="class">                    .<span class="title">handler</span>(<span class="title">new</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">SocketChannel</span>&gt;() </span>&#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> EchoClientHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            ChannelFuture future = bootstrap.connect().sync();</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully().sync();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(</span><br><span class="line">                    <span class="string">"Usage: "</span> + EchoClient<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>() +</span></span><br><span class="line">                            "&lt;host&gt; &lt;post&gt;"</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String host = args[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">new</span> EchoClient(host, port).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯çš„å¼•å¯¼ï¼Œç±»æ¯”æœåŠ¡å™¨å¤§éƒ¨åˆ†ä¸€è‡´ï¼Œéœ€è¦åŒºåˆ«çš„åœ°æ–¹ä¸»è¦åœ¨äºï¼š</p><ul><li>æœåŠ¡ç«¯ä½¿ç”¨çš„å¼•å¯¼å’Œå®¢æˆ·ç«¯ä½¿ç”¨çš„å¼•å¯¼ç±»åˆ†åˆ«æ˜¯ServerBootstrapå’ŒBootstrapï¼›</li><li>è™½ç„¶ä¸Šé¢ä»£ç æŒ‡å®šçš„Channelæ˜¯å’ŒæœåŠ¡ç«¯ä¸€æ ·çš„NIOä¼ è¾“ï¼Œä½†æ˜¯å…¶å®å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨å…¶ä»–ç±»å‹çš„ä¼ è¾“æ–¹å¼ </li></ul><p>æ„å»ºã€è¿è¡Œã€æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«æ‰“å°å¯¹åº”å‘å‡ºæˆ–è€…æ”¶åˆ°çš„è¯­å¥ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty Study(äºŒ):Nettyç»„ä»¶</title>
      <link href="/2020/12/17/Netty-Study-%E4%BA%8C-Netty%E7%BB%84%E4%BB%B6/"/>
      <url>/2020/12/17/Netty-Study-%E4%BA%8C-Netty%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€Nettyçš„æ ¸å¿ƒç»„ä»¶"><a href="#ä¸€ã€Nettyçš„æ ¸å¿ƒç»„ä»¶" class="headerlink" title="ä¸€ã€Nettyçš„æ ¸å¿ƒç»„ä»¶"></a>ä¸€ã€Nettyçš„æ ¸å¿ƒç»„ä»¶</h2><p><strong><em>Nettyä¸­ä¸»è¦çš„ç»„ä»¶<code>Channel</code>,<code>EventLoop</code>,<code>CHannelFuture</code>,è¿™å‡ ä¸ªç±»å’Œåœ¨ä¸€èµ·å¯ä»¥åŸºæœ¬ç»„æˆNettyçš„åŠŸèƒ½ï¼›</em></strong></p><ul><li>Channelï¼šSocket</li><li>EventLoopï¼šæ§åˆ¶æµã€å¤šçº¿ç¨‹å¤„ç†ã€å¹¶å‘ï¼›</li><li>ChannelFutureï¼šå¼‚æ­¥é€šçŸ¥ï¼›</li></ul><h3 id="1-Channel"><a href="#1-Channel" class="headerlink" title="#1 Channel"></a>#1 Channel</h3><blockquote><p>Channelæ˜¯Java NIOçš„ä¸€ä¸ªåŸºæœ¬æ„é€ </p><p>å®ƒä»£è¡¨ä¸€ä¸ªåˆ°å®ä½“(å¦‚ä¸€ä¸ªç¡¬ä»¶è®¾å¤‡ã€ä¸€ä¸ªæ–‡ä»¶ã€ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—æˆ–è€…ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„I/Oæ“ä½œçš„ç¨‹åºç»„ä»¶)çš„å¼€æ”¾è¿æ¥ï¼Œå¦‚è¯»æ“ä½œå’Œå†™æ“ä½œã€‚</p></blockquote><p>Channel æ¥å£æ˜¯ Netty å¯¹ç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼ŒåŒ…æ‹¬ <code>bind()</code>ã€<code>connect()</code>ã€<code>read()</code>ã€<code>write()</code>ç­‰åŸºæœ¬çš„IOæ“ä½œã€‚</p><p>é™¤äº†ä¸Šè¿°åŸºæœ¬çš„IOæ“ä½œï¼Œè¿˜ç”±æ¯”è¾ƒå¸¸ç”¨çš„Channelæ¥å£å®ç°ç±»ï¼š<code>NioServerSocketChannel</code>ï¼ˆæœåŠ¡ç«¯ï¼‰å’Œ<code>NioSocketChannel</code>ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼Œè¿™ä¸¤ä¸ª Channel å¯ä»¥å’Œ BIO ç¼–ç¨‹æ¨¡å‹ä¸­çš„<code>ServerSocket</code>ä»¥åŠ<code>Socket</code>ä¸¤ä¸ªæ¦‚å¿µå¯¹åº”ä¸Šã€‚Channelæ‹¥æœ‰å¾ˆå¤šå·²ç»é¢„å®šä¹‰çš„ã€ä¸“é—¨åŒ–å®ç°çš„å¹¿æ³›æ¥å£ç±»ï¼š<code>EmbeddedChannel</code>,<code>LocalServerChannel</code>,<code>NioDatagramChannel</code>,<code>NioSctpChannel</code>ç­‰ï¼›Netty çš„ Channel æ¥å£æ‰€æä¾›çš„ APIï¼Œå¤§å¤§åœ°é™ä½äº†ç›´æ¥ä½¿ç”¨ Socket ç±»çš„å¤æ‚æ€§ã€‚</p><p>ç›®å‰ï¼Œå¯ä»¥æŠŠChannelçœ‹ä½œæ˜¯ä¼ å…¥æˆ–è€…ä¼ å‡ºæ•°æ®çš„è½½ä½“ã€‚å¯ä»¥è¢«æ‰“å¼€æˆ–è€…å…³é—­ï¼Œè¿æ¥æˆ–è€…æ–­å¼€è¿æ¥ã€‚</p><p>â€‹    </p><h3 id="2-EventLoop"><a href="#2-EventLoop" class="headerlink" title="#2 EventLoop"></a>#2 EventLoop</h3><p>Netty åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä½¿ç”¨ä¸åŒçš„äº‹ä»¶æ¥é€šçŸ¥æˆ‘ä»¬çŠ¶æ€çš„æ”¹å˜æˆ–è€…æ“ä½œçŠ¶æ€çš„æ”¹å˜ã€‚å®ƒå®šä¹‰äº†åœ¨æ•´ä¸ªè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸé‡Œå½“æœ‰äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™å¤„ç†çš„æ ¸å¿ƒæŠ½è±¡ã€‚Nettyä½¿ç”¨EventLoopå¤„ç†IOæ“ä½œï¼ŒNettyä½¿ç”¨Channelå’ŒEventLoopç›¸äº’é…åˆæ¥è¿›è¡ŒIOæ“ä½œï¼›</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201215144525371.png" alt="image-20201215144525371"></p><p>Channelã€EventLoopã€EventLoopGroupä¹‹é—´çš„å…³ç³»åŒ…æ‹¬ï¼š</p><ul><li>ä¸€ä¸ªEventLoopGroupåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªEventLoopï¼›</li><li>ä¸€ä¸ªEventLoopåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªå’Œä¸€ä¸ªThreadè¿›è¡Œç»‘å®šï¼›</li><li>æ‰€æœ‰æœ‰EventLoopå¤„ç†çš„IOäº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„Threadä¸Šè¢«å¤„ç†ï¼›</li><li>ä¸€ä¸ªChannelåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªæ³¨å†Œäºä¸€ä¸ªEventLoopï¼›</li><li>ä¸€ä¸ªEventLoopå¯èƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªæˆ–è€…å¤šä¸ªChannelï¼›</li></ul><p>åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œä¸€ä¸ªç»™å®šçš„Channelçš„IOæ“ä½œéƒ½æ˜¯æœ‰ç›¸åŒçš„Threadæ‰§è¡Œçš„ï¼Œå®é™…ä¸Šæ¶ˆé™¤äº†å¯¹äºåŒæ­¥çš„éœ€è¦ã€‚</p><h3 id="3-ChannelFutureæ¥å£"><a href="#3-ChannelFutureæ¥å£" class="headerlink" title="#3 ChannelFutureæ¥å£"></a>#3 ChannelFutureæ¥å£</h3><p>ç”±äºNettyä¸­æ‰€æœ‰çš„IOæ“ä½œéƒ½æ˜¯ä¸€éƒ¨çš„ã€‚å› ä¸ºä¸€ä¸ªæ“ä½œå¯èƒ½ä¸ä¼šç«‹åˆ»è¿”å›ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ç§ç”¨äºä¹‹åæŸä¸ªæ—¶é—´ç¡®å®šå…¶ç»“æœçš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯éœ€è¦åº”ç”¨åˆ°<strong>å›è°ƒ</strong>çš„æ€æƒ³ï¼Œä¹Ÿå°±æ˜¯Nettyæä¾›çš„<code>ChannelFuture</code>æ¥å£ï¼Œå…¶<code>addListener()</code>æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ª<code>ChannelFutureListener</code>ï¼Œç”¨æ¥å¾—åˆ°æŸä¸ªæ“ä½œå®Œæˆæ—¶ç»“æœçš„é€šçŸ¥ã€‚</p><blockquote><p>ChannelFutureå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªNettyæ“ä½œæ‰§è¡Œç»“æœçš„å ä½ç¬¦ï¼Œä»–ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™è¢«æ‰§è¡Œå¯èƒ½å–å†³äºå¾ˆå¤šå› ç´ ï¼Œä¸å¯èƒ½è¢«å‡†ç¡®é¢„æµ‹ï¼Œä½†æ˜¯å®ƒä¸€å®šä¼šè¢«æ‰§è¡Œã€‚æ­¤å¤–ï¼Œæ‰€æœ‰å±äºä¸€ä¸ªChannelçš„æ“ä½œéƒ½ä¼šè¢«ä¿è¯å…¶å°†ä»¥è¢«è°ƒç”¨çš„é¡ºåºè¢«æ‰§è¡Œã€‚</p></blockquote><h2 id="äºŒã€ChannelHandlerã€ChannelPipeline"><a href="#äºŒã€ChannelHandlerã€ChannelPipeline" class="headerlink" title="äºŒã€ChannelHandlerã€ChannelPipeline"></a>äºŒã€ChannelHandlerã€ChannelPipeline</h2><p><code>ChannelHandler</code>ã€<code>ChannelPipeline</code>ä¸»è¦è´Ÿè´£ç®¡ç†æ•°æ®æµä»¥åŠæ‰§è¡Œåº”ç”¨ç¨‹åºå¤„ç†é€»è¾‘çš„ç»„ä»¶ã€‚</p><h3 id="1-ChannelHandleræ¥å£"><a href="#1-ChannelHandleræ¥å£" class="headerlink" title="#1 ChannelHandleræ¥å£"></a>#1 ChannelHandleræ¥å£</h3><p>ChannelHandleræ¥å£å……å½“äº†æ‰€æœ‰å¤„ç†å…¥ç«™æ•°æ®å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨ã€‚æˆ‘ä»¬é€šå¸¸ä¼šå®ç°è¿™ä¸ªæ¥å£æ¥è‡ªå®šä¹‰å¯¹æ•°æ®å¤„ç†çš„é€»è¾‘ï¼ŒChannelHandlerçš„æ–¹æ³•æ˜¯ç”±<strong>ç½‘ç»œäº‹ä»¶</strong>æ¥è§¦å‘çš„ï¼Œä¸€èˆ¬æ¥è¯´ChannelHandlerå¯ä»¥å¤„ç†ä»»ä½•ç±»å‹çš„åŠ¨ä½œï¼Œå¯ä»¥æ˜¯è¿æ¥ã€æ•°æ®æ¥æ”¶ã€å¼‚å¸¸ã€æ•°æ®è½¬æ¢ç­‰ã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬åœ¨ä½¿ç”¨Nettyå¼€å‘çš„æ—¶å€™ï¼Œä¼šé€‰æ‹©å®ç°<code>ChannelInboundHandler</code>å­æ¥å£ï¼ˆ <strong>ä¸€èˆ¬ä¸ä¼šç›´æ¥ä½¿ç”¨è¯¥æ¥å£ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªAdapterç±»ï¼ŒChannelInboundHandlerAdapterï¼Œè¯¥ç±»åšäº†æ¥å£çš„åŸºæœ¬å®ç°ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç»§æ‰¿è¯¥ç±»</strong>ï¼‰è¿™ä¸ªç±»å‹çš„ChannelHandleræ¥å—å…¥ç«™äº‹ä»¶å’Œæ•°æ®ï¼Œè¿™äº›æ•°æ®éšåä¼šè¢«ä¸šåŠ¡é€»è¾‘æ‰€å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘åº”å½“é©»ç•™åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ª<code>ChannelInboundHandler</code>æ¥å£ä¸­ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201215165519917.png" alt="image-20201215165519917"></p><h3 id="2-ChannelPipelineæ¥å£"><a href="#2-ChannelPipelineæ¥å£" class="headerlink" title="#2 ChannelPipelineæ¥å£"></a>#2 ChannelPipelineæ¥å£</h3><p>ChannelHandlerå¤šä¸ªçš„æƒ…å†µä¸‹ï¼ŒChannelPipelineæä¾›äº†ChannelHandleré“¾çš„å®¹å™¨ï¼Œå¹¶å®šä¹‰äº†ç”¨äºåœ¨è¯¥é“¾ä¸Šä¼ æ’­å…¥ç«™å’Œå‡ºç«™æ—¶é—´æµçš„APIï¼Œ<strong>å½“ Channel è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°åˆ†é…åˆ°å®ƒä¸“å±çš„ ChannelPipelineã€‚</strong></p><p>ChannelHandlerå®‰è£…åˆ°ChannelPipelineçš„è¿‡ç¨‹ï¼š</p><ul><li>ä¸€ä¸ªChannelInitializerçš„å®ç°è¢«æ³¨å†Œåˆ°äº†ServerBootstrapä¸­ï¼›</li><li>å½“ChannelInitializer.initChannel()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒChannelInitializerå°†åœ¨ChannelPipelineä¸­å®‰è£…ä¸€ç»„è‡ªå®šä¹‰çš„ChannelHandlerï¼›</li><li>ChannelInitializerå°†å®ƒè‡ªå·±ä»ChannelPipelineä¸­ç§»é™¤ï¼›</li></ul><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201215173023596.png" alt="image-20201215173023596"></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®æˆ–è€…äº‹ä»¶ç»æµ ChannelPipelineï¼Œç”± ChannelHandler å¤„ç†ã€‚åœ¨è¿™ä¸ªå¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ª ChannelHandler æ¥æ”¶æ•°æ®åå¤„ç†å®Œæˆåäº¤ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œæˆ–è€…ä»€ä¹ˆéƒ½ä¸åšç›´æ¥äº¤ç»™ä¸‹ä¸€ä¸ª ChannelHandlerã€‚</p><blockquote><p>ä¸€ä¸ª Netty åº”ç”¨ç¨‹åºä¸­å…¥ç«™å’Œå‡ºç«™æ•°æ®æµä¹‹é—´çš„åŒºåˆ«ã€‚ä»ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åº çš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœäº‹ä»¶çš„è¿åŠ¨æ–¹å‘æ˜¯ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™äº›äº‹ä»¶ä¸ºå‡ºç«™çš„ï¼Œåä¹‹ åˆ™ç§°ä¸ºå…¥ç«™çš„ã€‚</p></blockquote><h4 id="ç¼–ç å™¨ã€è§£ç å™¨"><a href="#ç¼–ç å™¨ã€è§£ç å™¨" class="headerlink" title="ç¼–ç å™¨ã€è§£ç å™¨"></a>ç¼–ç å™¨ã€è§£ç å™¨</h4><p>å½“ä½¿ç”¨Nettyå‘é€æˆ–è€…æ¥å—ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œéœ€è¦è¿›è¡Œå­—èŠ‚æ ¼å¼å’Œå¦ä¸€ç§æ ¼å¼ï¼ˆå¯èƒ½æ˜¯Javaå¯¹è±¡ï¼‰ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼›ä¹Ÿå°±æ˜¯<code>è§£ç </code>ã€<code>ç¼–ç </code>çš„è¿‡ç¨‹ã€‚è€Œä¸”Nettyè¿˜ä¸ºç¼–ç å™¨å’Œè§£ç å™¨æä¾›äº†ä¸åŒç±»å‹çš„æŠ½è±¡ç±»ï¼Œå¯èƒ½åœ¨æ•°æ®ä¼ è¾“çš„æ—¶å€™ä¸é‡‡ç”¨å­—èŠ‚æ ¼å¼ï¼Œæ¯”å¦‚ä½¿ç”¨Googleçš„<strong>Protocol Buffers</strong>ï¼ŒNettyå·²ç»ä¸ºå®ƒé¢„ç½®äº†<code>ProtobufEncoder</code>å’Œ<code>ProtobufDecoder</code>ã€‚</p><blockquote><p>ä¸¥æ ¼åœ°è¯´ï¼Œå…¶ä»–çš„å¤„ç†å™¨ä¹Ÿå¯ä»¥å®Œæˆç¼–ç å™¨å’Œè§£ç å™¨çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æœ‰ç”¨æ¥ç®€åŒ– ChannelHandler çš„åˆ›å»ºçš„é€‚é…å™¨ç±»ä¸€æ ·ï¼Œæ‰€æœ‰ç”± Netty æä¾›çš„ç¼–ç å™¨/è§£ç å™¨é€‚é…å™¨ç±»éƒ½å®ç° äº† ChannelOutboundHandler æˆ–è€… ChannelInboundHandler æ¥å£ã€‚</p></blockquote><h3 id="3-ChannelHandler-amp-ChannelPipeline"><a href="#3-ChannelHandler-amp-ChannelPipeline" class="headerlink" title="#3 ChannelHandler&amp;ChannelPipeline"></a>#3 ChannelHandler&amp;ChannelPipeline</h3><p>ChannelHandler æ˜¯ä¸“ä¸ºæ”¯æŒå¹¿æ³›çš„ç”¨é€”è€Œè®¾è®¡çš„ï¼Œå¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯å¤„ç†å¾€æ¥ChannelPipelineäº‹ä»¶(åŒ…æ‹¬æ•°æ®)çš„ä»»ä½•ä»£ç çš„é€šç”¨å®¹å™¨ã€‚</p><p>ChannelHandlerä¸»è¦å·¥ä½œå°±æ˜¯è®©äº‹ä»¶æµç»ChannelPipelineï¼ŒChannelHandleråœ¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–æˆ–è€…å¼•å¯¼é˜¶æ®µè¢«å®‰è£…ï¼Œè´Ÿè´£æ¥æ”¶äº‹ä»¶ã€æ‰§è¡Œå¤„ç†é€»è¾‘ï¼Œç„¶åä¼ é€’ç»™ä¸‹ä¸€ä¸ªChannelHandlerï¼Œå®ƒä»¬çš„<strong>æ·»åŠ é¡ºåºå†³å®šäº†ä»–ä»¬çš„æ‰§è¡Œé¡ºåº</strong>ã€‚å…¶å®ChannelPipelineä¹Ÿå¯ä»¥è¢«è§†ä½œChannelHandlerçš„ç¼–æ’é¡ºåºã€‚</p><blockquote><p>å‡ºç«™å’Œè¿›ç«™è¿åŠ¨ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ¯ä¸ªæ–¹æ³•çš„ <strong>ChannelHandlerContext</strong>ï¼Œäº‹ä»¶å¯ä»¥è¢«ä¼ é€’ç»™å½“å‰ChannelHandler é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚</p><p>è€Œä¸”Nettyå¯ä»¥åŒºåˆ† <strong>ChannelInboundHandler</strong> å®ç°å’Œ ChannelOutboundHandler å®ç°ï¼Œå¹¶ç¡®ä¿æ•°æ®åªä¼šåœ¨å…·æœ‰ç›¸åŒå®šå‘ç±»å‹çš„ä¸¤ä¸ª ChannelHandler ä¹‹é—´ä¼ é€’ã€‚</p></blockquote><h2 id="ä¸‰ã€å¼•å¯¼ï¼ˆBootStrapï¼‰"><a href="#ä¸‰ã€å¼•å¯¼ï¼ˆBootStrapï¼‰" class="headerlink" title="ä¸‰ã€å¼•å¯¼ï¼ˆBootStrapï¼‰"></a>ä¸‰ã€å¼•å¯¼ï¼ˆBootStrapï¼‰</h2><blockquote><p>â€œå¼•å¯¼â€è¿™ä¸ªè¯åœ¨ä¹‹å‰çš„ä»£ç Demoé‡Œä¹Ÿåå¤çœ‹åˆ°ï¼Œæœ¬æ¥ä»¥ä¸ºæ˜¯ä¸€ä¸ªæŠ½è±¡çš„è¯ï¼Œæ²¡æƒ³åˆ°æ‰€è°“å¼•å¯¼å°±æ˜¯Bootstrapç›´è¯‘ã€‚ã€‚ã€‚</p></blockquote><p>Netty çš„å¼•å¯¼ç±»<strong>ä¸ºåº”ç”¨ç¨‹åºçš„ç½‘ç»œå±‚é…ç½®æä¾›äº†å®¹å™¨</strong>ï¼Œè¿™æ¶‰åŠ<strong>å°†ä¸€ä¸ªè¿›ç¨‹ç»‘å®šåˆ°æŸä¸ªæŒ‡å®šçš„ç«¯å£</strong>ï¼Œæˆ–è€…å°†ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿è¡Œåœ¨æŸä¸ªæŒ‡å®šä¸»æœºçš„æŒ‡å®šç«¯å£ä¸Šçš„è¿›ç¨‹ã€‚å› æ­¤ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¼•å¯¼:ä¸€ç§ç”¨äº<strong>å®¢æˆ·ç«¯(ç®€å•åœ°ç§°ä¸º Bootstrap)</strong>ï¼Œè€Œå¦ä¸€ç§ç”¨äº<strong>æœåŠ¡å™¨(ServerBootstrap)</strong>ã€‚æ— è®ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨å“ªç§åè®®æˆ–è€…å¤„ç†å“ªç§ç±»å‹çš„æ•°æ®ï¼Œ å”¯ä¸€å†³å®šå®ƒä½¿ç”¨å“ªç§å¼•å¯¼ç±»çš„æ˜¯å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯è¿˜æ˜¯ä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201215212249192.png" alt="image-20201215212249192"></p><p>å¼•å¯¼ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªEventLoopï¼Œä½†æ˜¯å¼•å¯¼ä¸€ä¸ªæœåŠ¡å™¨ServerBootstrapéœ€è¦ä¸¤ä¸ªï¼›è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨éœ€è¦ç¬¬ä¸€ç»„åªåŒ…å«ä¸€ä¸ªServerChannelæ¥è¡¨ç¤º<strong>æœåŠ¡å™¨è‡ªèº«å·²ç»ç»‘å®šåˆ°æŸä¸ªæœ¬åœ°ç«¯å£æ­£åœ¨ç›‘å¬çš„socket</strong>ï¼›ç„¶åå°†ç¬¬äºŒç»„å°†<strong>åŒ…å«æ‰€æœ‰å·²ç»åˆ›å»ºçš„ç”¨æ¥å¤„ç†ä¼ å…¥å®¢æˆ·ç«¯é“¾æ¥çš„Channel</strong>ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201215213350743.png" alt="image-20201215213350743"></p><blockquote><p>ä¸ ServerChannel ç›¸å…³è”çš„ EventLoopGroup å°†åˆ†é…ä¸€ä¸ªè´Ÿè´£ä¸ºä¼ å…¥è¿æ¥è¯·æ±‚åˆ›å»º Channel çš„ EventLoopã€‚ä¸€æ—¦è¿æ¥è¢«æ¥å—ï¼Œç¬¬äºŒä¸ª EventLoopGroup å°±ä¼šç»™å®ƒçš„ Channel åˆ†é…ä¸€ä¸ª EventLoopã€‚</p></blockquote><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty Study(ä¸€):åŸºæœ¬çŸ¥è¯†</title>
      <link href="/2020/10/17/Netty-Study-%E4%B8%80-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"/>
      <url>/2020/10/17/Netty-Study-%E4%B8%80-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h2 id="é›¶ã€å†™åœ¨å‰é¢"><a href="#é›¶ã€å†™åœ¨å‰é¢" class="headerlink" title="é›¶ã€å†™åœ¨å‰é¢"></a>é›¶ã€å†™åœ¨å‰é¢</h2><p>â€‹    ä¸ƒæœˆä»½å…¥èŒä¹‹ååˆ°ç°åœ¨å·²ç»ä¸‰ä¸ªå¤šæœˆäº†ï¼Œæˆ‘ä¹Ÿé¡ºåˆ©è½¬æ­£äº†ï¼Œè¿™å‡ ä¸ªæœˆä¹Ÿåœ¨å…¬å¸å­¦ä¹ äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¯å‘¨çš„æŠ€æœ¯åˆ†äº«éƒ½æœ‰è®©æˆ‘æƒ³å­¦çš„çŸ¥è¯†å‡ºç°ï¼Œä¹‹åæœ‰æŠŠæ‰€æœ‰æƒ³å­¦çš„ä¸œè¥¿å†™åœ¨ç¬”è®°é‡Œï¼ˆçœŸä»–å¦ˆå¤šğŸ˜…ï¼‰ã€‚é¢å¯¹è¿™ä¹ˆå¤šçš„çŸ¥è¯†ä¸€åº¦ååˆ†ç„¦è™‘ï¼Œä¸çŸ¥é“ä»ä½•å­¦èµ·ï¼Œä¸è¿‡ä»”ç»†æƒ³æƒ³ï¼Œè¿™äº›ä¸œè¥¿èƒ½åœ¨ä¸¤ä¸‰å¹´å†…å­¦åˆ°æˆ‘ç†æƒ³çš„ç¨‹åº¦å·²ç»å¾ˆä¸é”™äº†ã€‚</p><p>â€‹    Nettyç›¸å…³å·²ç»çœ‹äº†å¾ˆä¹…äº†ï¼Œä¸ƒæœˆåº•çš„æ—¶å€™å°±å¼€å§‹çœ‹ã€ŠNettyå®æˆ˜ã€‹ï¼Œä½†æ˜¯å…¬å¸è¶Šæ¥è¶Šå¿™ï¼Œå¯¼è‡´ä¹¦çœ‹äº†å¿˜ï¼Œå¿˜äº†å†çœ‹ï¼Œä¸€ç›´åœç•™åœ¨åŸåœ°æ²¡æœ‰è¿›å±•ï¼Œè¿™æ¬¡å‡†å¤‡æŠŠä¹‹å‰çœ‹çš„ä¹¦æ€»ç»“ä¸€ä¸‹ï¼Œçœçš„å†å›å»çœ‹å¿˜æ‰çš„çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿè¦å°½å¿«æŠŠNettyå­¦ä¹ æä¸Šæ—¥ç¨‹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†åç»­æ‰‹å†™RPCæ¡†æ¶çš„è®¡åˆ’ä½œå‡†å¤‡ã€‚</p><h2 id="ä¸€ã€å¸¸è§IOçº¿ç¨‹æ¨¡å‹"><a href="#ä¸€ã€å¸¸è§IOçº¿ç¨‹æ¨¡å‹" class="headerlink" title="ä¸€ã€å¸¸è§IOçº¿ç¨‹æ¨¡å‹"></a>ä¸€ã€å¸¸è§IOçº¿ç¨‹æ¨¡å‹</h2><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/77752ed5.jpg" alt="emma_1"></p><p>â€‹    ä»»ä½•ä¸€ä¸ªIOè¿‡ç¨‹ä¸­ï¼Œéƒ½åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€ä¸ªæ˜¯ç­‰å¾…ï¼Œç¬¬äºŒæ˜¯æ‹·è´ã€‚è€Œåœ¨å®é™…åº”ç”¨çš„åœºæ™¯ä¸­ï¼Œç­‰å¾…æ¶ˆè€—çš„æ—¶é—´è¿œè¿œé«˜äºæ‹·è´çš„æ—¶é—´ï¼›ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>è¯»å‡½æ•°</code>ï¼Œåˆ†ä¸ºç­‰å¾…ç³»ç»Ÿå¯è¯»å’ŒçœŸæ­£çš„è¯»ï¼›åŒç†ï¼Œå†™å‡½æ•°åˆ†ä¸ºç­‰å¾…ç½‘å¡å¯ä»¥å†™å’ŒçœŸæ­£çš„å†™ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ç­‰å¾…å°±ç»ªçš„é˜»å¡æ—¶ä¸ä½¿ç”¨CPUèµ„æºçš„ï¼Œæ˜¯åœ¨â€œç©ºç­‰â€ï¼›è€ŒçœŸæ­£çš„è¯»å†™æ“ä½œçš„é˜»å¡æ˜¯ä½¿ç”¨CPUçš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«ï¼Œç”šè‡³å¯ä»¥ç†è§£æˆåŸºæœ¬ä¸è€—æ—¶ã€‚</p><p>â€‹    <strong>ä¸ºäº†è®©IOæ›´åŠ é«˜æ•ˆï¼Œæœ€æ ¸å¿ƒçš„æ–¹æ³•å°±æ˜¯è®©ç­‰å¾…çš„æ—¶é—´å°½å¯èƒ½çš„å˜å°‘ã€‚</strong></p><h3 id="1-é˜»å¡IO"><a href="#1-é˜»å¡IO" class="headerlink" title="#1 é˜»å¡IO"></a>#1 é˜»å¡IO</h3><p>â€‹    åœ¨å†…æ ¸å°†æ•°æ®å‡†å¤‡å¥½ä¹‹å‰ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šä¸€ç›´ç­‰å¾…ã€‚æ‰€æœ‰çš„å¥—æ¥å­—ï¼ˆsockeï¼‰ï¼Œé»˜è®¤éƒ½æ˜¯é˜»å¡æ–¹å¼ï¼Œ<strong>é˜»å¡å¼æ˜¯æœ€å¸¸è§çš„IOæ¨¡å‹ï¼Œå±äºåŒæ­¥IOæ¨¡å‹ã€‚</strong></p><p>â€‹    ä¾‹å­ï¼šAæ‹¿ç€ä¸€æ”¯é±¼ç«¿åœ¨æ²³è¾¹é’“é±¼ï¼Œå¹¶ä¸”ä¸€ç›´åœ¨é±¼ç«¿å‰ç­‰ï¼Œåœ¨ç­‰çš„æ—¶å€™ä¸åšå…¶ä»–çš„äº‹æƒ…ï¼Œååˆ†ä¸“å¿ƒã€‚åªæœ‰é±¼ä¸Šé’©çš„æ—¶ï¼Œæ‰ç»“æŸæ‰ç­‰çš„åŠ¨ä½œï¼ŒæŠŠé±¼é’“ä¸Šæ¥ã€‚</p><p>â€‹    <img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/v2-7ee1abb79d9c79b1378c3ede0528bfa4_r.jpg" alt="preview"></p><h3 id="2-éé˜»å¡IO"><a href="#2-éé˜»å¡IO" class="headerlink" title="#2 éé˜»å¡IO"></a>#2 éé˜»å¡IO</h3><p>â€‹    å¦‚æœå†…æ ¸æ²¡æœ‰å°†æ•°æ®å‡†å¤‡å¥½ï¼Œç³»ç»Ÿçš„è°ƒç”¨ä»ç„¶ä¼šç›´æ¥è¿”å›ï¼Œå¹¶ä¸”è¿”å›EWOULDBLOCKé”™è¯¯ç ï¼Œéé˜»å¡IOå¾€å¾€éœ€è¦ç¨‹åºå‘˜å¾ªç¯çš„æ–¹å¼åå¤å°è¯•è¯»å†™æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºè®ºè¯¢ã€‚è¿™å¯¹CPUæ¥è¯´æ˜¯æ¯”è¾ƒå¤§çš„æµªè´¹ï¼Œ<strong>éé˜»å¡IOä¹Ÿå±äºåŒæ­¥IOæ¨¡å‹ã€‚</strong></p><p>â€‹    ä¾‹å­ï¼š Bä¹Ÿåœ¨æ²³è¾¹é’“é±¼ï¼Œä½†æ˜¯Bä¸æƒ³å°†è‡ªå·±çš„æ‰€æœ‰æ—¶é—´éƒ½èŠ±è´¹åœ¨é’“é±¼ä¸Šï¼Œåœ¨ç­‰é±¼ä¸Šé’©è¿™ä¸ªæ—¶é—´æ®µä¸­ï¼ŒBåœ¨åšå…¶ä»–çš„äº‹æƒ…ï¼ˆåˆ·ç‰›å®¢æˆ–è€…åˆ·çŸ¥ä¹ï¼‰ï¼Œä½†Båœ¨åšè¿™äº›äº‹æƒ…çš„æ—¶å€™ï¼Œæ¯éš”ä¸€ä¸ªå›ºå®šçš„æ—¶é—´æ£€æŸ¥é±¼æ˜¯å¦ä¸Šé’©ã€‚ä¸€æ—¦æ£€æŸ¥åˆ°æœ‰é±¼ä¸Šé’©ï¼Œå°±åœä¸‹æ‰‹ä¸­çš„äº‹æƒ…ï¼ŒæŠŠé±¼é’“ä¸Šæ¥ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/v2-7f84267dc58c969fedd5606c76bd5905_r.jpg" alt="preview"></p><h2 id="äºŒã€BIOã€NIOã€AIO"><a href="#äºŒã€BIOã€NIOã€AIO" class="headerlink" title="äºŒã€BIOã€NIOã€AIO"></a>äºŒã€BIOã€NIOã€AIO</h2><h3 id="1-BIOï¼ˆBlocking-I-Oï¼‰"><a href="#1-BIOï¼ˆBlocking-I-Oï¼‰" class="headerlink" title="#1 BIOï¼ˆBlocking I/Oï¼‰"></a>#1 BIOï¼ˆBlocking I/Oï¼‰</h3><p>â€‹    æ—©æœŸçš„ç½‘ç»œç¼–ç¨‹å¼€å‘äººå‘˜ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å»å­¦ä¹ å¤æ‚çš„Cè¯­è¨€å¥—æ¥å­—(Socket)åº“ï¼Œä½†æ˜¯ä¼šç»å¸¸åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå‡ºç°å¥‡æ€ªçš„é—®é¢˜ã€‚æ—©æœŸçš„Javaæä¾›äº†java.netåŒ…ä¸‹çš„APIï¼Œæ”¯æŒä½¿ç”¨ç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›çš„é˜»å¡å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯BIOã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„ServerSocketï¼Œç”¨æ¥ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚</span></span><br><span class="line">ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(portNumber);</span><br><span class="line"><span class="comment">//å¯¹acceptæ–¹æ³•çš„è°ƒç”¨å°†ä¼šè¢«ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä¸€ä¸ªé“¾æ¥çš„å»ºç«‹</span></span><br><span class="line">Socket clientSocket = serverSocket.accept(); </span><br><span class="line"><span class="comment">//</span></span><br><span class="line">BufferedReader in = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">  <span class="keyword">new</span> InputStreamReader(clientSocket.getInputStream()));</span><br><span class="line">PrintWriter out = <span class="keyword">new</span> PrintWriter(clientSocket.getOutputStream(), <span class="keyword">true</span>); </span><br><span class="line">String request, response;</span><br><span class="line"><span class="keyword">while</span> ((request = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="comment">//å¦‚æœå®¢æˆ·ç«¯å‘é€äº†â€˜Doneâ€™ æ¨å‡ºå¾ªç¯</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">"Done"</span>.equals(request)) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="comment">//æŠŠå®¢æˆ·ç«¯è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨çš„handleræ–¹æ³•</span></span><br><span class="line">  response = processRequest(request);</span><br><span class="line">out.println(response); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    é‡‡ç”¨BIOé€šä¿¡æ¨¡å‹çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„Acceptorçº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„é“¾æ¥ã€‚åœ¨whileï¼ˆtrueï¼‰å¾ªç¯ä¸­æœåŠ¡ç«¯ä¼šè°ƒç”¨accept()æ–¹æ³•ç­‰å¾…æ¥å—å®¢æˆ·ç«¯çš„é“¾æ¥æ–¹å¼ç›‘å¬è¯·æ±‚ï¼Œè¯·æ±‚ä¸€æ—¦æ¥å—åˆ°ä¸€ä¸ªé“¾æ¥è¯·æ±‚ï¼Œå°±å¯ä»¥å»ºç«‹é€šä¿¡å¥—æ¥å­—åœ¨è¿™ä¸ªé€šä¿¡å¥—æ¥å­—ä¸Šè¿›è¡Œè¯»å†™æ“ä½œï¼Œæ­¤æ—¶ä¸èƒ½å†æ¥å—å…¶ä»–å®¢æˆ·ç«¯çš„é“¾æ¥è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…å½“å‰é“¾æ¥çš„å®¢æˆ·ç«¯çš„æ“ä½œæ‰§è¡Œå®Œæˆï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ®µä»£ç åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œä¸è¿‡å¯ä»¥<strong>é€šè¿‡å¤šçº¿ç¨‹</strong>æ¥æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯çš„é“¾æ¥ã€‚ </p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201018154929638.png" alt="image-20201018154929638"></p><blockquote><p>â€‹    è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹è¿™ç§æ–¹æ¡ˆçš„å½±å“ã€‚ç¬¬ä¸€ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½æœ‰å¤§é‡çš„çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œåªæ˜¯ç­‰å¾…è¾“ å…¥æˆ–è€…è¾“å‡ºæ•°æ®å°±ç»ªï¼Œè¿™å¯èƒ½ç®—æ˜¯ä¸€ç§èµ„æºæµªè´¹ã€‚ç¬¬äºŒï¼Œéœ€è¦ä¸ºæ¯ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆéƒ½åˆ†é…å†…å­˜ï¼Œå…¶é»˜è®¤å€¼å¤§å°åŒºé—´ä¸º64KB åˆ°1MBï¼Œå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿã€‚ç¬¬ä¸‰ï¼Œå³ä½¿ Java è™šæ‹Ÿæœº(JVM)åœ¨ç‰©ç†ä¸Šå¯ä»¥æ”¯æŒéå¸¸å¤§æ•°é‡çš„çº¿ç¨‹ï¼Œä½†æ˜¯è¿œåœ¨åˆ°è¾¾è¯¥æé™ä¹‹å‰ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€å°±ä¼šå¸¦æ¥éº»çƒ¦ï¼Œä¾‹å¦‚ï¼Œåœ¨è¾¾åˆ°10000ä¸ªè¿æ¥çš„æ—¶å€™ã€‚</p><p>â€‹                                                                                                                                    â€”â€”ã€ŠNetty in Actionã€‹</p></blockquote><h3 id="2-NIOï¼ˆNon-Blocking-IOï¼‰"><a href="#2-NIOï¼ˆNon-Blocking-IOï¼‰" class="headerlink" title="#2 NIOï¼ˆNon-Blocking IOï¼‰"></a>#2 NIOï¼ˆNon-Blocking IOï¼‰</h3><p>â€‹    NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4ä¸­å¼•å…¥äº†NIOæ¡†æ¶ï¼Œå¯¹åº”Java.nioåŒ…ï¼Œæä¾›äº†Channelï¼ŒSelectorï¼ŒBufferç­‰æŠ½è±¡ã€‚</p><p>â€‹    NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸º<strong>Non-blocking</strong>ï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„Socketå’ŒServerSocketç›¸å¯¹åº”çš„<strong>SocketChannel</strong>å’Œ<strong>ServerSocketChannel</strong>ä¸¤ç§ä¸åŒå¥—æ¥å­—é€šé“å®ç°ï¼Œé˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿçš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯ç”¨æ€§éƒ½ä¸å¥½ï¼Œä½†æ˜¯éé˜»å¡æ­£å¥½ä¸ä»–ç›¸åï¼Œ<strong>å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨NIOçš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</strong></p><p><strong>é€‰æ‹©å™¨</strong></p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201018165658369.png" alt="image-20201018165658369"></p><p>â€‹    å›¾ä¸­çš„è¿™ç§éé˜»å¡è®¾è®¡ï¼Œæ¶ˆé™¤äº†ä¸Šè¾¹BIOçš„é‚£äº›å¼Šç«¯ï¼ŒSelectoræ˜¯Javaçš„NIOå®ç°çš„å…³é”®ã€‚æ£€æŸ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªNIO Channelï¼ˆé€šé“ï¼‰çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚å®ƒä½¿ç”¨äº‹ä»¶é€šçŸ¥APIä»¥ç¡®å®šåœ¨ä¸€ç»„éé˜»å¡å¥—æ¥å­—ä¸­é‚£äº›å·²ç»å°±ç»ªå¯ä»¥è¿›è¡ŒIOç›¸å…³çš„æ“ä½œã€‚</p><h3 id="3-AIOï¼ˆAsynchronous-IOï¼‰"><a href="#3-AIOï¼ˆAsynchronous-IOï¼‰" class="headerlink" title="#3 AIOï¼ˆAsynchronous IOï¼‰"></a>#3 AIOï¼ˆAsynchronous IOï¼‰</h3><p>â€‹    AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯<strong>å¼‚æ­¥éé˜»å¡çš„IOæ¨¡å‹</strong>ã€‚å¼‚æ­¥ IO æ˜¯åŸºäº<strong>äº‹ä»¶å’Œå›è°ƒæœºåˆ¶</strong>å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p><p>â€‹    AIO æ˜¯å¼‚æ­¥IOçš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIOæ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚ï¼ˆé™¤äº† AIO å…¶ä»–çš„ IO ç±»å‹éƒ½æ˜¯åŒæ­¥çš„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»åº•å±‚IOçº¿ç¨‹æ¨¡å‹è§£é‡Šã€‚</p><h2 id="ä¸‰ã€Netty"><a href="#ä¸‰ã€Netty" class="headerlink" title="ä¸‰ã€Netty"></a>ä¸‰ã€Netty</h2><blockquote><p>â€‹    æˆ‘ä»¬å·²ç»ä»æ¼«é•¿çš„ç—›è‹¦ç»å†ä¸­å­¦åˆ°:ç›´æ¥ä½¿ç”¨åº•å±‚çš„APIæš´éœ²äº†å¤æ‚æ€§ï¼Œå¹¶ä¸”å¼•å…¥äº†å¯¹å¾€å¾€ä¾›ä¸åº”æ±‚çš„æŠ€èƒ½çš„å…³é”®æ€§ä¾èµ– ã€‚è¿™ä¹Ÿå°±æ˜¯ï¼Œé¢å‘å¯¹è±¡çš„åŸºæœ¬æ¦‚å¿µ:</p><p>â€‹    <strong>ç”¨è¾ƒç®€å•çš„æŠ½è±¡éšè—åº•å±‚å®ç°çš„å¤æ‚æ€§ã€‚</strong></p><p>â€‹     <strong>Hide complexity behind abstractions.</strong></p></blockquote><p>â€‹    åœ¨è¿™æ ·çš„åŸåˆ™çš„é©±ä½¿ä¸‹ï¼Œä¸ºäº†åœ¨é«˜è´Ÿè½½ä¸‹å¯é å’Œé«˜æ•ˆçš„å¤„ç†å’Œè°ƒåº¦IOæ“ä½œï¼ŒNettyåº”è¿è€Œç”Ÿï¼ŒNettyé©¾é©­äº†é«˜çº§APIçš„èƒ½åŠ›ï¼Œå¹¶å°†å…¶éšè—åœ¨ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„APIä¹‹åã€‚</p><blockquote><p>Nettyæ˜¯ä½ å¯ä»¥ä¸“æ³¨äºè‡ªå·±çœŸæ­£æ„Ÿå…´è¶£çš„â€”â€”ä½ çš„åº”ç”¨ç¨‹åºç‹¬ä¸€æ— äºŒçš„ä»·å€¼ã€‚</p></blockquote><h3 id="1-å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨"><a href="#1-å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨" class="headerlink" title="#1 å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨"></a>#1 å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨</h3><p><strong>åŒæ­¥å’Œå¼‚æ­¥ï¼š</strong></p><ul><li><strong>åŒæ­¥</strong>ï¼šåŒæ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œ<strong>è¢«è°ƒç”¨è€…æœªå¤„ç†å®Œè¯·æ±‚ä¹‹å‰</strong>ï¼Œè°ƒç”¨ä¸è¿”å›ã€‚</li><li><strong>å¼‚æ­¥</strong>ï¼šå¼‚æ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œç«‹åˆ»å¾—åˆ°è¢«è°ƒç”¨è€…çš„å›åº”è¡¨ç¤ºå·²æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¢«è°ƒç”¨è€…å¹¶æ²¡æœ‰è¿”å›ç»“æœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¤„ç†å…¶ä»–çš„è¯·æ±‚ï¼Œè¢«è°ƒç”¨è€…é€šå¸¸ä¾é æ—¶é—´ï¼Œå›è°ƒæœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</li></ul><p>åŒæ­¥å’Œå¼‚æ­¥æœ€å¤§çš„åŒºåˆ«åœ¨äºå¼‚æ­¥çš„è¯è°ƒç”¨è€…ä¸éœ€è¦ç­‰å¾…å¤„ç†ç»“æœï¼Œè¢«è°ƒç”¨è€…ä¼šé€šè¿‡å›è°ƒæœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</p><p><strong>é˜»å¡ä¸éé˜»å¡ï¼š</strong></p><ul><li><strong>é˜»å¡</strong>ï¼šé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œ<strong>è°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›</strong>ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶æ»¡è¶³æ‰èƒ½ç»§ç»­ã€‚</li><li><strong>éé˜»å¡</strong>ï¼šéé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œ<strong>è°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›</strong>ï¼Œå¯ä»¥å»å…ˆå¹²å…¶ä»–äº‹æƒ…ã€‚</li></ul><blockquote><p>â€‹    åœ¨æ—¥å¸¸çš„ç”Ÿæ´»ä¸­ï¼Œå¼‚æ­¥è‡ªç„¶è€Œç„¶åœ°å°±å‘ç”Ÿäº†ï¼Œæ‰€ä»¥ä½ å¯èƒ½æ²¡æœ‰å¯¹å®ƒè€ƒè™‘è¿‡å¤šå°‘ã€‚ä½†æ˜¯è®©ä¸€ä¸ª è®¡ç®—æœºç¨‹åºä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œå°±ä¼šäº§ç”Ÿä¸€äº›éå¸¸ç‰¹æ®Šçš„é—®é¢˜ã€‚<strong>æœ¬è´¨ä¸Šï¼Œä¸€ä¸ªæ—¢æ˜¯å¼‚æ­¥çš„åˆæ˜¯äº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿä¼šè¡¨ç°å‡ºä¸€ç§ç‰¹æ®Šçš„ã€å¯¹æˆ‘ä»¬æ¥è¯´æå…·ä»·å€¼çš„è¡Œä¸º:å®ƒå¯ä»¥ä»¥ä»»æ„çš„é¡ºåºå“åº”åœ¨ä»»æ„ çš„æ—¶é—´ç‚¹äº§ç”Ÿçš„äº‹ä»¶ã€‚</strong></p><p>â€‹                                                                                                                                    â€”â€”ã€ŠNetty in Actionã€‹</p></blockquote><hr><p>â€‹    åœ¨ç›´æ¥çœ‹æ¥ï¼ŒåŒæ­¥å’Œé˜»å¡ï¼Œå¼‚æ­¥å’Œéé˜»å¡çœ‹èµ·æ¥æè¿°çš„æ˜¯ä¸€ç§æƒ…å†µï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜éœ€è¦åŒºåˆ†å¼€æ¥ä¸¤ç±»æ¦‚å¿µå‘¢ï¼Ÿè¿™é‡Œæˆ‘è®¤ä¸ºï¼Œ<code>é˜»å¡å’Œéé˜»å¡</code>ï¼Œ<code>å¼‚æ­¥å’ŒåŒæ­¥</code>å…¶å®æ˜¯ä»ä¸¤ç§ç»´åº¦æ¥è¿›è¡Œçš„æè¿°ã€‚</p><p>â€‹    åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯<strong>æ¶ˆæ¯é€šä¿¡æœºåˆ¶</strong> (synchronous communication/asynchronous communication)æ˜¯åœ¨æè¿°<strong>è°ƒç”¨</strong>ä¸<strong>è¿”å›ç»“æœ</strong>ä¸¤è€…çš„å…³ç³»ã€‚</p><p>â€‹    æ¯”å¦‚<strong>åŒæ­¥çš„æœºåˆ¶ä¸‹ï¼Œè°ƒç”¨å°±å¿…é¡»è¦æœ‰ä¸€ä¸ªç»“æœ</strong>ï¼›æ²¡æœ‰ç»“æœï¼Œè°ƒç”¨å°±ä¸è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è°ƒç”¨è€…å¿…é¡»è¦ä¸»åŠ¨ç­‰å¾…è¿™ä¸ªè°ƒç”¨çš„ç»“æœ</strong>ã€‚</p><p>â€‹    è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œå½“ä¸€ä¸ª<strong>å¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ</strong>ã€‚è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåï¼Œè¢«è°ƒç”¨è€…é€šè¿‡<strong>çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚</strong></p><p>â€‹    é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯<strong>ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€.</strong></p><p>â€‹    é˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰<strong>çº¿ç¨‹ä¼šè¢«æŒ‚èµ·</strong>ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨<strong>ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</strong>ã€‚</p><h3 id="2-å¯ä¼¸ç¼©æ€§"><a href="#2-å¯ä¼¸ç¼©æ€§" class="headerlink" title="#2 å¯ä¼¸ç¼©æ€§"></a>#2 å¯ä¼¸ç¼©æ€§</h3><blockquote><p>ä¸€ç§ç³»ç»Ÿã€ç½‘ç»œæˆ–è€…è¿›ç¨‹åœ¨éœ€è¦å¤„ç†çš„å·¥ä½œä¸æ–­å¢é•¿æ—¶ï¼Œå¯ä»¥é€šè¿‡æŸç§å¯è¡Œçš„æ–¹å¼æˆ–è€…æ‰©å¤§å®ƒçš„å¤„ç†èƒ½åŠ›æ¥é€‚åº”è¿™ç§å¢é•¿çš„èƒ½åŠ› ã€‚</p></blockquote><p>â€‹    å¼‚æ­¥çš„èƒ½åŠ›å¯¹äºå®ç°æ›´é«˜çš„<strong>å¯ä¼¸ç¼©æ€§</strong>è‡³å…³é‡è¦ã€‚</p><p>å¼‚æ­¥å’Œå¯ä¼¸ç¼©æ€§ä¹‹é—´çš„è”ç³»åœ¨äºï¼š</p><ul><li><p>éé˜»å¡ç½‘ç»œè°ƒç”¨ä½¿å¾—æˆ‘ä»¬å¯ä»¥<strong>ä¸å¿…ç­‰å¾…ä¸€ä¸ªæ“ä½œçš„å®Œæˆ</strong>ã€‚å®Œå…¨å¼‚æ­¥çš„ I/O æ­£æ˜¯åŸºäºè¿™ä¸ªç‰¹æ€§æ„å»ºçš„ï¼Œå¹¶ä¸”æ›´è¿›ä¸€æ­¥:<strong>å¼‚æ­¥æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸”åœ¨å®ƒå®Œæˆæ—¶ï¼Œä¼šç›´æ¥æˆ–è€…åœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹é€šçŸ¥ç”¨æˆ·ã€‚</strong></p></li><li><p><strong>é€‰æ‹©å™¨</strong>ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¾ƒå°‘çš„çº¿ç¨‹ä¾¿å¯ç›‘è§†è®¸å¤šè¿æ¥ä¸Šçš„äº‹ä»¶ã€‚</p></li></ul><p>â€‹    å°†è¿™äº›å…ƒç´ ç»“åˆåˆ°ä¸€èµ·ï¼Œä¸ä½¿ç”¨é˜»å¡IOæ¥å¤„ç†å¤§é‡è¿æ¥ç›¸æ¯”ï¼Œä½¿ç”¨éé˜»å¡IOæ¥å¤„ç†ä¼šæ›´å¿«é€Ÿã€æ›´ç»æµã€‚è¿™ä¹Ÿæ˜¯Nettyè®¾è®¡çš„å…³é”®ã€‚</p><h3 id="3-ç‰¹æ€§æ€»ç»“"><a href="#3-ç‰¹æ€§æ€»ç»“" class="headerlink" title="#3 ç‰¹æ€§æ€»ç»“"></a>#3 ç‰¹æ€§æ€»ç»“</h3><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20201025144215918.png" alt="image-20201025144215918"></p><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éå¯¹ç§°åŠ å¯†â€”â€”RSAç®—æ³•</title>
      <link href="/2020/10/04/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E2%80%94%E2%80%94RSA%E7%AE%97%E6%B3%95/"/>
      <url>/2020/10/04/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E2%80%94%E2%80%94RSA%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å…¬é’¥å¯†ç å­¦"><a href="#ä¸€ã€å…¬é’¥å¯†ç å­¦" class="headerlink" title="ä¸€ã€å…¬é’¥å¯†ç å­¦"></a>ä¸€ã€å…¬é’¥å¯†ç å­¦</h2><blockquote><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸä¸ªé—®é¢˜éš¾ä»¥è§£å†³è¿™æ ·ä¸€ä¸ªäº‹å®å·²ç»ä¸å†æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œè€Œå˜æˆäº†ä¸€ä¸ªä¼˜ç‚¹ã€‚</p></blockquote><p>â€‹    å­˜åœ¨è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä¸€ä¸ªç»™å®šçš„æ•´æ•°æ‰¾åˆ°å®ƒçš„å› æ•°ï¼Œå¦‚æœè¿™æ ·çš„è§£ç¡®å®å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸€å®šè¦ä¸ºè¿™ä¸ªé—®é¢˜æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„è§£ã€‚å¦‚æœåªç”¨çº¸å’Œç¬”ï¼Œé‚£ä¹ˆå³ä½¿åƒ2173è¿™æ ·ç›¸å¯¹è¾ƒå°çš„æ•°å­—ï¼Œè¦æ‰¾åˆ°å…¶å› æ•°ï¼Œä¹Ÿå¾ˆèŠ±æ—¶é—´ï¼Œå‡å¦‚æ•°å­—å¤§åˆ°å‡ ç™¾ä½æ•°å­—æ‰èƒ½è¡¨ç¤ºï¼Œé‚£ä¹ˆå³ä½¿æ˜¯ç”¨ç°åœ¨æœ€å¥½çš„å› æ•°åˆ†è§£æŠ€æœ¯ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿè¿˜æ˜¯å¾ˆéš¾è§£å†³ã€‚</p><p>â€‹    å‡å¦‚å¯†ç çš„ç ´è§£ä¹Ÿåƒè§£å†³è¿™ç§å¤æ‚æ•°å­¦é—®é¢˜ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™æ ·çš„åŠ å¯†ç®—æ³•ä¸€å®šæ˜¯ä¸€ç§å®‰å…¨çš„ç®—æ³•ã€‚</p><p><strong>ä¸€äº›å†å²</strong></p><p>â€‹    1976å¹´ä¹‹å‰ï¼Œæ‰€æœ‰çš„åŠ å¯†æ–¹å¼éƒ½æ˜¯ä¸€ç§æ¨¡å¼ï¼š</p><blockquote><p>ï¼ˆ1ï¼‰ç”²æ–¹é€‰æ‹©æŸä¸€ç§åŠ å¯†è§„åˆ™ï¼Œå¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼›</p><p>ï¼ˆ2ï¼‰ä¹™æ–¹ä½¿ç”¨åŒä¸€ç§è§„åˆ™ï¼Œå¯¹ä¿¡æ¯è¿›è¡Œè§£å¯†ã€‚</p></blockquote><p>â€‹    ç”±äºåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„åŒä¸€ç§è§„åˆ™ï¼ˆç®€ç§°ä¸ºâ€å¯†é’¥â€ï¼‰ï¼Œè¿™å°±è¢«ç§°ä¸º<strong>å¯¹ç§°åŠ å¯†ç®—æ³•(Symmetric-key algorithm)</strong>ã€‚è¿™ç§è§„åˆ™ä¸‹å¿…é¡»è¦è®©ç”²ä¹™æ–¹éƒ½çŸ¥é“åŠ å¯†è§„åˆ™æ‰æ­£å¸¸çš„ä½¿ç”¨è¿™æ ·çš„åŠ å¯†ç®—æ³•ï¼Œæ‰€ä»¥è¿™ä¹Ÿå¯¼è‡´è¿™ä¸ªç®—æ³•æœ€å¤§çš„å¼±ç‚¹å°±åœ¨äºå¦‚ä½•ä¿å­˜å’Œä¼ é€’å¯†é’¥ã€‚</p><p>â€‹    1976å¹´ï¼Œä¸¤ä½ç¾å›½è®¡ç®—æœºç§‘å­¦å®¶Whitfield Diffieå’Œ Martin Hellmanï¼Œæå‡ºä¸€ç§å´­æ–°çš„æ„æ€ï¼Œå¯ä»¥åœ¨åœ¨ä¸ç›´æ¥ä¼ é€’å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œå®Œæˆè§£å¯†ã€‚è¿™è¢«ç§°ä¸º<strong>â€œDiffie-Hellmanå¯†é’¥äº¤æ¢ç®—æ³•â€</strong>ã€‚è¿™ä¸ªç®—æ³•è®©äººä»¬æ„è¯†åˆ°ï¼ŒåŠ å¯†å’Œè§£å¯†å¯ä»¥ä½¿ç”¨ä¸åŒçš„è§„åˆ™ï¼Œåªè¦è¿™ä¸¤ç§è§„åˆ™ä¹‹é—´å­˜åœ¨æŸç§å…³ç³»å³å¯ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/bg2013062703.jpg" alt="img"></p><p>â€‹    è¿™ç§æ–°çš„æ¨¡å¼è¢«ç§°ä¸º<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong></p><blockquote><p>ï¼ˆ1ï¼‰ä¹™æ–¹ç”Ÿæˆä¸¤æŠŠå¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—ï¼Œç§é’¥åˆ™æ˜¯ä¿å¯†çš„</p><p>ï¼ˆ2ï¼‰ç”²æ–¹è·å–ä¹™æ–¹çš„å…¬é’¥ï¼Œç„¶åç”¨å®ƒå¯¹ä¿¡æ¯åŠ å¯†ã€‚</p><p>ï¼ˆ3ï¼‰ä¹™æ–¹å¾—åˆ°åŠ å¯†åçš„ä¿¡æ¯ï¼Œç”¨ç§é’¥è§£å¯†ã€‚</p></blockquote><p>â€‹    1977å¹´ï¼Œä¸‰ä½æ•°å­¦å®¶Ricestã€Shamirå’ŒAdlemanè®¾è®¡äº†ä¸€ç§ç®—æ³•ï¼Œå¯ä»¥å®ç°éå¯¹ç§°åŠ å¯†ï¼Œè¿™ç§ç®—æ³•ç”¨ä»–ä»¬ä¸‰ä¸ªäººçš„åå­—å‘½åï¼Œå«åšRSAç®—æ³•ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/bg2013062702.jpg" alt="img"></p><p>â€‹    <strong>åªè¦æœ‰è®¡ç®—æœºç½‘ç»œçš„åœ°æ–¹ï¼Œå°±æœ‰RSAç®—æ³•ã€‚</strong></p><h2 id="äºŒã€RSAç®—æ³•çš„æ•°å­¦åŸºç¡€"><a href="#äºŒã€RSAç®—æ³•çš„æ•°å­¦åŸºç¡€" class="headerlink" title="äºŒã€RSAç®—æ³•çš„æ•°å­¦åŸºç¡€"></a>äºŒã€RSAç®—æ³•çš„æ•°å­¦åŸºç¡€</h2><p>â€‹    RSAç®—æ³•çš„åŸç†å¹¶ä¸å¤æ‚ï¼Œåªéœ€è¦ä¸€äº›æ•°è®ºçš„çŸ¥è¯†ã€‚</p><h3 id="äº’è´¨å…³ç³»"><a href="#äº’è´¨å…³ç³»" class="headerlink" title="#äº’è´¨å…³ç³»"></a>#äº’è´¨å…³ç³»</h3><p>â€‹    å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº†1ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°æ˜¯<strong>äº’è´¨å…³ç³»(coprime)</strong>ã€‚æ¯”å¦‚ï¼Œ15å’Œ32æ²¡æœ‰å…¬å› å­ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯äº’è´¨å…³ç³»ã€‚(ä¸æ˜¯è´¨æ•°ä¹Ÿå¯ä»¥æ„æˆäº’è´¨å…³ç³»)</p><p>ä¸€äº›ç»“è®ºğŸ‘‡ğŸ»ï¼š</p><blockquote><ol><li><p>ä»»æ„ä¸¤ä¸ªè´¨æ•°æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚13å’Œ61ã€‚</p></li><li><p>ä¸€ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œå¦ä¸€ä¸ªæ•°åªè¦ä¸æ˜¯å‰è€…çš„å€æ•°ï¼Œä¸¤è€…å°±æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚3å’Œ10ã€‚</p></li><li><p>å¦‚æœä¸¤ä¸ªæ•°ä¹‹ä¸­ï¼Œè¾ƒå¤§çš„é‚£ä¸ªæ•°æ˜¯è´¨æ•°ï¼Œåˆ™ä¸¤è€…æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚97å’Œ57ã€‚</p></li><li><p>1å’Œä»»æ„ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯éƒ½æ˜¯äº’è´¨å…³ç³»ï¼Œæ¯”å¦‚1å’Œ99ã€‚</p></li><li><p>pæ˜¯å¤§äº1çš„æ•´æ•°ï¼Œåˆ™på’Œp-1æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚57å’Œ56ã€‚</p></li><li><p>pæ˜¯å¤§äº1çš„å¥‡æ•°ï¼Œåˆ™på’Œp-2æ„æˆäº’è´¨å…³ç³»ï¼Œæ¯”å¦‚17å’Œ15ã€‚</p></li></ol></blockquote><h3 id="æ¬§æ‹‰å‡½æ•°"><a href="#æ¬§æ‹‰å‡½æ•°" class="headerlink" title="#æ¬§æ‹‰å‡½æ•°"></a>#æ¬§æ‹‰å‡½æ•°</h3><p>â€‹    æ€è€ƒä¸€ä¸ªé—®é¢˜ğŸ‘‡ğŸ»ï¼š</p><blockquote><p>ä»»æ„ç»™å®šæ­£æ•´æ•°nï¼Œè¯·é—®åœ¨å°äºç­‰äºnçš„æ­£æ•´æ•°ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸næ„æˆäº’è´¨å…³ç³»ï¼Ÿ</p></blockquote><p>â€‹    è®¡ç®—è¿™ä¸ªå€¼çš„æ–¹æ³•å°±å«åšæ¬§æ‹‰å‡½æ•°ï¼Œä»¥Ï†(n)è¡¨ç¤ºã€‚æ¯”å¦‚ï¼Œä¸8å½¢æˆäº’è´¨å…³ç³»çš„æ•°å­—æœ‰ï¼š1ã€3ã€5ã€7ï¼Œ</p><p>æ‰€ä»¥Ï†(n) = 4ã€‚</p><p>â€‹    Ï†(n)çš„è®¡ç®—æ–¹æ³•å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯ä¸ºäº†å¾—åˆ°æœ€åçš„å…¬å¼ï¼Œéœ€è¦è¿›è¡Œä¸€æ­¥æ­¥çš„æ¨å¯¼ã€‚</p><p><strong>ç¬¬ä¸€ç§æƒ…å†µ</strong></p><p>â€‹    å¦‚æœï¼Œn = 1ï¼Œé‚£ä¹ˆÏ†(1) = 1ã€‚å› ä¸º1ä¸ä»»ä½•æ•°(åŒ…æ‹¬è‡ªèº«)éƒ½å½¢æˆäº’è´¨å…³ç³»ã€‚</p><p><strong>ç¬¬äºŒç§æƒ…å†µ</strong></p><p>â€‹    å¦‚æœnæ˜¯è´¨æ•°ï¼Œåˆ™Ï†(n) = n - 1ã€‚å› ä¸ºè´¨æ•°ä¸å°äºå®ƒçš„æ¯ä¸€ä¸ªæ•°ï¼Œéƒ½æ„æˆäº’è´¨å…³ç³»ã€‚æ¯”å¦‚5ä¸1ã€2ã€3ã€4éƒ½æ„æˆäº’è´¨å…³ç³»ã€‚</p><p><strong>ç¬¬ä¸‰ç§æƒ…å†µ</strong></p><p>â€‹    å¦‚æœnæ˜¯è´¨æ•°çš„næ¬¡æ–¹ï¼Œå³n = p<sup>k</sup> (pä¸ºè´¨æ•°ï¼Œkä¸ºå¤§äºç­‰äº1çš„æ•´æ•°)ï¼Œé‚£ä¹ˆÏ†(n)å¯ä»¥ç”±å…¬å¼è®¡ç®—</p><script type="math/tex; mode=display">Ï†(p^k) = p^k - p^{k-1}</script><p>â€‹    æ¯”å¦‚ Ï†(8) = Ï†(2<sup>3</sup>) = 2<sup>3</sup> - 2<sup>2</sup> = 4</p><p>â€‹    è¿™ä¸ªå…¬å¼æ˜¯å› ä¸ºå½“ä¸€ä¸ªæ•°ä¸åŒ…å«è´¨æ•°pï¼Œæ‰å¯èƒ½ä¸näº’è´¨ã€‚è€ŒåŒ…å«è´¨æ•°pçš„æ•°ä¸€å…±æœ‰p<sup>(k-1)</sup>ä¸ªï¼Œå³1Ã—pã€2Ã—pã€3Ã—pã€â€¦ã€p^(k-1)Ã—pï¼ŒæŠŠå®ƒä»¬å»é™¤ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸näº’è´¨çš„æ•°ã€‚(<strong>è´¨æ•°ä¸ä»»ä½•ä¸€ä¸ªä¸æ˜¯å®ƒå€æ•°çš„æ•°äº’è´¨ï¼Œå‚è€ƒäº’è´¨å…³ç³»ç»“è®º2</strong>)</p><p>â€‹    è¿™ä¸ªå…¬å¼è¿˜å¯ä»¥åŒ–ç®€æˆï¼š</p><script type="math/tex; mode=display">Ï†(p^k) = p^k - p^{k-1} = p^k(1-\frac1p)</script><p><strong>ç¬¬å››ç§æƒ…å†µ</strong></p><p>â€‹    å¦‚æœnå¯ä»¥åˆ†æˆä¸¤ä¸ªäº’è´¨çš„æ•°çš„ä¹˜ç§¯ï¼Œé‚£ä¹ˆÏ†(n)æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼š</p><blockquote><p>n = p1 * p2</p><p>Ï†(n) = Ï†(p1p2) = Ï†(p1) * Ï†(p2)</p></blockquote><p>â€‹    è¿™ä¸ªç»“è®ºçš„è¯æ˜è¦ç”¨åˆ°<strong>ä¸­å›½å‰©ä½™å®šç†</strong>ï¼Œç®€å•çš„æ€è·¯å°±æ˜¯ï¼šå¦‚æœaä¸p1äº’è´¨(a&lt;p1)ï¼Œbä¸p2äº’è´¨(b&lt;p2)ï¼Œcä¸p1p2äº’è´¨(c&lt;p1p2)ï¼Œåˆ™cä¸æ•°å¯¹ (a,b) æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚ç”±äºaçš„å€¼æœ‰Ï†(p1)ç§å¯èƒ½ï¼Œbçš„å€¼æœ‰Ï†(p2)ç§å¯èƒ½ï¼Œåˆ™æ•°å¯¹ (a,b) æœ‰Ï†(p1)Ï†(p2)ç§å¯èƒ½ï¼Œè€Œcçš„å€¼æœ‰Ï†(p1p2)ç§å¯èƒ½ï¼Œæ‰€ä»¥Ï†(p1p2)å°±ç­‰äºÏ†(p1)Ï†(p2)ã€‚</p><p><strong>ç¬¬äº”ç§æƒ…å†µ</strong></p><p>â€‹    <strong>æ¯ä¸ªå¤§äº1çš„è‡ªç„¶æ•°ï¼Œè¦ä¹ˆæœ¬èº«å°±æ˜¯è´¨æ•°ï¼Œè¦ä¹ˆå¯ä»¥å†™ä¸º2ä¸ªæˆ–ä»¥ä¸Šçš„è´¨æ•°çš„ç§¯ã€‚ï¼ˆç®—æ•°åŸºæœ¬å®šç†ï¼‰</strong>é‚£ä¹ˆæ ¹æ®ä¸Šè¾¹çš„å‡ ç§æƒ…å†µä¸­çš„æ¨è®ºï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¬§æ‹‰å‡½æ•°çš„é€šç”¨å…¬å¼ã€‚</p><script type="math/tex; mode=display">n = p_1^{k_1} p_2^{k_2} p_3^{k_3}... p_r^{k_r}\\Ï†(n) = n(1 - \frac1p_1)(1 - \frac1p_2)(1 - \frac1p_3)...(1 - \frac1p_r)</script><h3 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="#æ¬§æ‹‰å®šç†"></a>#æ¬§æ‹‰å®šç†</h3><p>â€‹    æ¬§æ‹‰å®šç†å°±æ˜¯æ¬§æ‹‰å‡½æ•°çš„ç”¨å¤„ï¼Œæ¬§æ‹‰å®šç†æŒ‡çš„æ˜¯ï¼š</p><p>â€‹    å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°aå’Œnäº’è´¨ï¼Œåˆ™nçš„æ¬§æ‹‰å‡½æ•°Ï†(n)å¯ä»¥è®©ä¸‹é¢çš„ç­‰å¼æˆç«‹</p><script type="math/tex; mode=display">a^{Ï†(n)} \equiv 1\pmod n</script><p>â€‹    açš„Ï†(n)æ¬¡æ–¹è¢«né™¤çš„ä½™æ•°ä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œaçš„Ï†(n)æ¬¡æ–¹å‡1ï¼Œå¯ä»¥è¢«næ•´é™¤ã€‚æ¯”å¦‚ï¼Œ3å’Œ7äº’è´¨ï¼Œé‚£ä¹ˆ7çš„æ¬§æ‹‰å‡½æ•°Ï†(7)ç­‰äº6ï¼Œ3çš„6æ¬¡æ–¹ï¼ˆ729ï¼‰å‡å»1å¯ä»¥è¢«7æ•´é™¤ï¼ˆ728/7 = 104ï¼‰ã€‚</p><p>â€‹    æ¬§æ‹‰å®šç†è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå‡è®¾æ­£æ•´æ•°aå’Œè´¨æ•°päº’è´¨ï¼Œå› ä¸ºè´¨æ•°pçš„Ï†(p)ç­‰äºp-1ï¼Œé‚£ä¹ˆæ¬§æ‹‰å®šç†å¯ä»¥å†™æˆï¼š</p><script type="math/tex; mode=display">a^{p-1}\equiv 1 \pmod p</script><p>è¿™å°±æ˜¯å¾ˆè‘—åçš„<strong>è´¹é©¬å°å®šç†</strong>ï¼Œæ˜¯æ¬§æ‹‰å®šç†çš„ç‰¹ä¾‹ã€‚æ¬§æ‹‰å®šç†æ˜¯RSAç®—æ³•çš„æ ¸å¿ƒã€‚</p><h3 id="æ¨¡è¿ç®—åŸºæœ¬æ€§è´¨"><a href="#æ¨¡è¿ç®—åŸºæœ¬æ€§è´¨" class="headerlink" title="#æ¨¡è¿ç®—åŸºæœ¬æ€§è´¨"></a>#æ¨¡è¿ç®—åŸºæœ¬æ€§è´¨</h3><p>(a + b) % p = (a % p + b % p) % p</p><p>(a - b) % p = (a % p - b % p) % p</p><p>(a <em> b) % p = (a % p </em> b % p) % p</p><p>(a^b) % p = ((a % p)^b) % p</p><h3 id="æ¨¡åå…ƒç´ "><a href="#æ¨¡åå…ƒç´ " class="headerlink" title="#æ¨¡åå…ƒç´ "></a>#æ¨¡åå…ƒç´ </h3><blockquote><p>å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°aå’Œnäº’è´¨ï¼Œé‚£ä¹ˆä¸€å®šå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ•´æ•°bï¼Œä½¿å¾—ab - 1è¢«næ•´é™¤ï¼Œæˆ–è€…è¯´abè¢«næ•´é™¤å¾—ä½™æ•°æ˜¯1ã€‚</p></blockquote><script type="math/tex; mode=display">ab \equiv 1 \pmod n</script><p>â€‹    è¿™é‡Œï¼Œbå°±è¢«ç§°ä¸ºaçš„â€œ<strong>æ¨¡åå…ƒç´ </strong>â€ï¼Œæ¯”å¦‚ï¼Œ3å’Œ11äº’è´¨ï¼Œé‚£ä¹ˆ3çš„æ¨¡åå…ƒç´ å°±æ˜¯4ï¼Œå› ä¸º (3 Ã— 4)-1 å¯ä»¥è¢«11æ•´é™¤ã€‚æ˜¾ç„¶ï¼Œæ¨¡åå…ƒç´ ä¸æ­¢ä¸€ä¸ªï¼Œ 4åŠ å‡11çš„æ•´æ•°å€éƒ½æ˜¯3çš„æ¨¡åå…ƒç´  {â€¦,-18,-7,4,15,26,â€¦}ï¼Œå³å¦‚æœbæ˜¯açš„æ¨¡åå…ƒç´ ï¼Œåˆ™ b+kn éƒ½æ˜¯açš„æ¨¡åå…ƒç´ ã€‚</p><p>â€‹    å¯ä»¥ä½¿ç”¨æ¬§æ‹‰å®šç†æ¥è¯æ˜æ¨¡åå…ƒç´ å¿…å®šå­˜åœ¨ğŸ‘‡ğŸ»ï¼š</p><script type="math/tex; mode=display">a^{Ï†(n)} = a \times a^{Ï†(n)-1}  \equiv 1\pmod n</script><p>â€‹    è¿™é‡Œçš„açš„Ï†(n)-1æ¬¡æ–¹å°±æ˜¯açš„æ¨¡åå…ƒç´ ã€‚</p><p>è‡³æ­¤ï¼ŒRSAæ‰€æ¶‰åŠåˆ°çš„æ‰€æœ‰æ•°å­¦çŸ¥è¯†å°±æ˜¯ä¸Šé¢è¿™äº›äº†ã€‚</p><h2 id="ä¸‰ã€RSAç®—æ³•çš„åŠ å¯†æµç¨‹"><a href="#ä¸‰ã€RSAç®—æ³•çš„åŠ å¯†æµç¨‹" class="headerlink" title="ä¸‰ã€RSAç®—æ³•çš„åŠ å¯†æµç¨‹"></a>ä¸‰ã€RSAç®—æ³•çš„åŠ å¯†æµç¨‹</h2><h3 id="å¯†é’¥çš„ç”Ÿæˆ"><a href="#å¯†é’¥çš„ç”Ÿæˆ" class="headerlink" title="#å¯†é’¥çš„ç”Ÿæˆ"></a>#å¯†é’¥çš„ç”Ÿæˆ</h3><p>â€‹    å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯é€šä¿¡åŒæ–¹ä½¿ç”¨çš„å…¬é’¥å’Œç§é’¥çš„ç”Ÿæˆéœ€è¦å…ˆé€šè¿‡æ•°å­¦æ–¹å¼è®¡ç®—å‡ºå‡ ä¸ªå€¼ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œé€‰æ‹©ä¸¤ä¸ªè´¨æ•°</strong></p><p>â€‹    éšæœºé€‰å–ä¸¤ä¸ª<strong>ä¸ç›¸ç­‰</strong>çš„è´¨æ•°på’Œqï¼Œå‡è®¾æˆ‘ä»¬è¿™é‡Œé€‰æ‹©äº†61å’Œ53ã€‚ï¼ˆåœ¨RSAå®é™…ä½¿ç”¨ä¸­ï¼Œå¾€å¾€ä¼šé€‰æ‹©æ¯”è¾ƒå¤§çš„è´¨æ•°ï¼Œè´¨æ•°è¶Šå¤§ï¼Œå°±è¶Šéš¾ç ´è§£ï¼‰</p><blockquote><p>p = 61</p><p>q = 53</p></blockquote><p><strong>ç¬¬äºŒæ­¥ï¼Œè®¡ç®—ä¸¤ä¸ªè´¨æ•°çš„ç§¯</strong></p><p>â€‹    è®¡ç®—på’Œqçš„ä¹˜ç§¯ä¸ºn</p><blockquote><p>n = p <em> q = 61 </em> 53 = 3233</p></blockquote><p>â€‹    nçš„é•¿åº¦å°±æ˜¯å¯†é’¥çš„é•¿åº¦ï¼Œ3233å†™æˆäºŒè¿›åˆ¶æ˜¯<code>110010100001</code>,ä¸€å…±æ˜¯12ä½ï¼Œæ‰€ä»¥å¯†é’¥çš„é•¿åº¦å°±æ˜¯12ä½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾€å¾€é€‰æ‹©1024ä½ç”šè‡³æ˜¯2048ä½çš„å¯†é’¥ã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼Œæ±‚æ¬§æ‹‰å‡½æ•°Ï†(n)</strong></p><p>â€‹    æ ¹æ®å…¬å¼(æ¬§æ‹‰å‡½æ•°æƒ…å†µäºŒ)ï¼š</p><script type="math/tex; mode=display">Ï†(n) = (p-1)(q-1)</script><p>â€‹    ä¹Ÿå°±æ˜¯è¿™é‡Œå¯ä»¥è®¡ç®—å‡ºÏ†(n)ï¼š</p><blockquote><p>Ï†(n) = (p-1)(q-1) =&gt; Ï†(3233) = 60 * 52 = 3120</p></blockquote><p><strong>ç¬¬å››æ­¥ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªä¸Ï†(n)äº’è´¨çš„æ•´æ•°e</strong></p><p>â€‹    é€‰æ‹©ä¸€ä¸ªä¸Ï†(n)äº’è´¨ï¼Œè€Œä¸”æ»¡è¶³ 1 &lt; e &lt; Ï†(n)æ¡ä»¶çš„æ•´æ•°eï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©17ï¼ˆåœ¨RSAå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€é€‰æ‹©65537ï¼‰</p><blockquote><p>e = 17</p></blockquote><p><strong>ç¬¬äº”æ­¥ï¼Œè®¡ç®—æ¨¡åå…ƒç´ </strong></p><p>â€‹    è®¡ç®—eå¯¹äºÏ†(n)çš„æ¨¡åå…ƒç´ dã€‚</p><p>â€‹    æ ¹æ®å…¬å¼ï¼š</p><script type="math/tex; mode=display">ab \equiv 1 \pmod n \\ å³ \\ ed \equiv 1 \pmod {Ï†(n)} \\ ç­‰ä»·äº \\ ed - 1 = kÏ†(n) \\ åŒ–ç®€åä¸º \\ ed + kÏ†(n) = 1</script><p>â€‹    </p><p>â€‹    åœ¨è¿™ä¸ªå¼å­ä¸­ï¼Œdæ˜¯æˆ‘ä»¬è¦æ±‚è§£çš„æ¨¡åå…ƒç´ ï¼Œè€Œkæ˜¯ä¸€ä¸ªä»»æ„å€¼ï¼Œæ‰€ä»¥åœ¨åŒ–ç®€è¿‡ç¨‹ä¸­å¹¶ä¸æ¶‰åŠå˜å·ã€‚è¿™æ—¶å€™å†çœ‹æœ€ååŒ–ç®€çš„ç­‰å¼ï¼Œæˆ‘ä»¬è®¡ç®—æ¨¡åå…ƒç´ çš„è¿‡ç¨‹å·²ç»å˜æˆäº†ä¸€ä¸ªæ±‚äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹è§£ï¼ˆex + yÏ†(n) = 1ï¼‰çš„é—®é¢˜ã€‚è¿™é‡Œçš„è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡<code>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</code>è¿›è¡Œè®¡ç®—ã€‚</p><blockquote><p><strong>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</strong>ï¼ˆè‹±è¯­ï¼šExtended Euclidean algorithmï¼‰æ˜¯<code>æ¬§å‡ é‡Œå¾—ç®—æ³•</code>ï¼ˆåˆå«è¾—è½¬ç›¸é™¤æ³•ï¼‰çš„æ‰©å±•ã€‚å·²çŸ¥æ•´æ•°aã€bï¼Œæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•å¯ä»¥åœ¨æ±‚å¾—aã€bçš„æœ€å¤§å…¬çº¦æ•°çš„åŒæ—¶ï¼Œèƒ½æ‰¾åˆ°æ•´æ•°xã€yï¼ˆå…¶ä¸­ä¸€ä¸ªå¾ˆå¯èƒ½æ˜¯è´Ÿæ•°ï¼‰ï¼Œä½¿å®ƒä»¬æ»¡è¶³<code>è´ç¥–ç­‰å¼</code></p><script type="math/tex; mode=display">ax + by = gcd(a,b)</script><p>ä¸Šé¢åŒ–ç®€åçš„äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ä¸­aå’Œbå¯¹åº”çš„åˆ†åˆ«æ˜¯eå’ŒÏ†(n) ï¼Œæˆ‘ä»¬çŸ¥é“eæ˜¯ä¸Ï†(n)äº’è´¨çš„å…³ç³»ï¼Œé‚£ä¹ˆgcd(e,Ï†(n)) = 1 æˆç«‹ï¼Œè¿™é‡Œçš„äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹å°±æ˜¯ä¸€ä¸ªè´ç¥–ç­‰å¼ã€‚</p></blockquote><p>â€‹    æš‚æ—¶copyä¸€ä¸ªæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆpythonå®ç°)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eucild_ex</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        x = <span class="number">1</span></span><br><span class="line">        y = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> x,y,a</span><br><span class="line">    (x,y,r) = eucild_ex(b,a % b)</span><br><span class="line">    tmp = x</span><br><span class="line">    x = y</span><br><span class="line">    y = tmp - int(a/b)*y</span><br><span class="line">    <span class="keyword">return</span> (x,y,r)</span><br></pre></td></tr></table></figure><blockquote><p>å°† a = e = 17, b = Ï†(n) = 3120 ä½¿ç”¨å‡½æ•°è®¡ç®—åå¾—å‡ºç»“æœ<code>(-367, 2, 1)</code>,æ ¹æ®æ¨¡åå…ƒç´ ä¸Šé¢æåˆ°è¿‡çš„å®šä¹‰ä¸­ï¼Œâ€œ b+kn éƒ½æ˜¯açš„æ¨¡åå…ƒç´ â€è¿™ä¸€æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæœ€å°çš„æ­£æ•´æ•°æ¨¡åå…ƒç´  d = 2753</p></blockquote><p><strong>ç¬¬å…­æ­¥ï¼Œç»„è£…å…¬é’¥å’Œç§é’¥</strong></p><p>â€‹    ç°åœ¨æˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä¸ªæ•°å­—ï¼š</p><ul><li><p>p éšæœºé€‰å–çš„è´¨æ•° 61</p></li><li><p>q éšæœºé€‰å–çš„è´¨æ•° 53</p></li><li><p>n pä¸qçš„ä¹˜ç§¯ 3233</p></li><li><p>Ï†(n) nçš„æ¬§æ‹‰å‡½æ•° 3120</p></li><li><p>e é€‰æ‹©çš„ä¸€ä¸ªä¸Ï†(n)äº’è´¨çš„æ•°å­— 17</p></li><li><p>d eçš„æ¨¡åå…ƒç´  2753</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©nã€eä½œä¸ºå…¬é’¥ï¼Œé€‰æ‹©nã€dä¸ºç§é’¥</p></li></ul><blockquote><p>å…¬é’¥ (n, e) -&gt; (3233, 17)</p><p>ç§é’¥ (n, d) -&gt; (3233, 2753)</p></blockquote><h3 id="åŠ å¯†å’Œè§£å¯†"><a href="#åŠ å¯†å’Œè§£å¯†" class="headerlink" title="#åŠ å¯†å’Œè§£å¯†"></a>#åŠ å¯†å’Œè§£å¯†</h3><p>â€‹    æœ‰äº†å…¬é’¥å’Œç§é’¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†äº†ï¼Œæˆ‘ä»¬å‡è®¾å½“å‰æœ‰ä¸€æ®µä¿¡æ¯messageï¼Œmessageå­—ç¬¦ä¸²å–å…¶unicodeå€¼æˆ–è€…asciiå€¼mï¼Œè¿™é‡Œå¿…é¡»è¦æ±‚<strong>må°äºn</strong>ã€‚æˆ‘ä»¬å‡è®¾m=65ã€‚</p><p><strong>åŠ å¯†è¿‡ç¨‹</strong></p><p>â€‹    åŠ å¯†éœ€è¦ä½¿ç”¨å…¬é’¥(n,e),æ‰€è°“çš„åŠ å¯†ï¼Œå°±æ˜¯è®¡ç®—ä¸‹é¢å…¬å¼ä¸­çš„c</p><script type="math/tex; mode=display">m^e \equiv c \pmod n \\ å³ \\ 65^{17} \equiv c \pmod {3233}</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pow(<span class="number">65</span>,<span class="number">17</span>) % <span class="number">3233</span></span><br></pre></td></tr></table></figure><p>â€‹    è®¡ç®—å¾—å‡ºï¼Œcçš„å€¼ä¸º 2790ã€‚åŠ å¯†çš„ä¿¡æ¯2790å°±è¢«å‘é€ç»™å¯¹æ–¹ã€‚</p><p><strong>è§£å¯†è¿‡ç¨‹</strong></p><p>â€‹    è§£å¯†è¿‡ç¨‹éœ€è¦ä½¿ç”¨ç§é’¥(n, d)ï¼Œå¯¹æ–¹å‘æ¥çš„åŠ å¯†ä¿¡æ¯æ˜¯c = 2790ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¡ç®—è¿™æ ·çš„ä¸€ä¸ªç®—å¼ï¼š</p><script type="math/tex; mode=display">c^d \equiv m \pmod n \\å³\\ 2790 ^{2753} \equiv m \pmod {3233}</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pow(<span class="number">2790</span>,<span class="number">2753</span>) % <span class="number">3233</span></span><br></pre></td></tr></table></figure><p>â€‹    é€šè¿‡è®¡ç®—å¾—å‡ºï¼Œm = 65</p><p>â€‹    è‡³æ­¤ï¼Œæ•´ä¸ªâ€œåŠ å¯†-è§£å¯†â€è¿‡ç¨‹å…¨éƒ¨å®Œæˆã€‚</p><h3 id="è§£å¯†è¿‡ç¨‹çš„è¯æ˜"><a href="#è§£å¯†è¿‡ç¨‹çš„è¯æ˜" class="headerlink" title="#è§£å¯†è¿‡ç¨‹çš„è¯æ˜"></a>#è§£å¯†è¿‡ç¨‹çš„è¯æ˜</h3><p>â€‹    æˆ‘ä»¬è¿™é‡Œè¯æ˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ç§é’¥è§£å¯†å¯ä»¥æ­£ç¡®çš„æ±‚å¾—mã€‚ä¹Ÿå°±æ˜¯è¯æ˜ä¸‹é¢çš„è¿™ä¸ªå…¬å¼ã€‚</p><script type="math/tex; mode=display">c^d \equiv m \pmod n</script><p>â€‹    è¿™ä¸ªå…¬å¼å¯ä»¥æ ¹æ®åŠ å¯†è§„åˆ™åŒ–ç®€ä¸€ä¸‹</p><script type="math/tex; mode=display">m^e \equiv c \pmod n (åŠ å¯†å…¬å¼) \\ å³ \\ c = m^e - kn \\ ä»£å…¥åŠ å¯†å…¬å¼ \\ {(m^e - kn)}^d \equiv m \pmod n</script><p>â€‹    é€šè¿‡æ¨¡è¿ç®—çš„åŸºæœ¬æ€§è´¨ï¼Œæœ€åè¿™ä¸ªç®—å¼ç­‰åŒäºï¼š</p><script type="math/tex; mode=display">m^{ed} \equiv m \pmod n</script><p>â€‹    å› ä¸ºdæ˜¯eçš„æ¨¡åå…ƒç´ ï¼Œæ‰€ä»¥æ»¡è¶³å…¬å¼ï¼š</p><p>â€‹    </p><script type="math/tex; mode=display">ed\equiv 1 \pmod{Ï†(n)}</script><p>â€‹    æ‰€ä»¥å¯ä»¥åŒ–ç®€ed å¹¶ä»£å…¥</p><script type="math/tex; mode=display">ed = hÏ†(n) + 1 \\ ä»£å…¥åå¾—åˆ° \\ m^{hÏ†(n) + 1} \equiv m \pmod n</script><p>â€‹    æ¥ä¸‹æ¥å¯¹æœ€åçš„ç®—å¼è¿›è¡Œä¸€ä¸ªè®¨è®ºï¼š</p><p><strong>å½“mä¸näº’è´¨</strong></p><p>â€‹    æ ¹æ®æ¬§æ‹‰å®šç†ï¼Œå¯ä»¥è¿›è¡Œæ¨å¯¼ï¼š</p><script type="math/tex; mode=display">m^{Ï†(n)}\equiv 1 \pmod n (æ¬§æ‹‰å®šç†) \\ å¯ä»¥æ¨å¾—åŸå¼ \\ {(m^{Ï†(n)})}^h \times m \equiv m \pmod n</script><p>â€‹    <strong>è¯æ¯•ã€‚</strong></p><p><strong>å½“må’Œnä¸æ˜¯äº’è´¨å…³ç³»</strong></p><p>â€‹    å› ä¸ºnæ˜¯ä¸¤ä¸ªè´¨æ•°çš„ä¹˜ç§¯ï¼Œä¹Ÿå°±ä»£è¡¨ï¼Œnçš„å› æ•°åªæœ‰på’Œqï¼Œè€Œæ­¤æ—¶må’Œnä¸æ˜¯äº’è´¨å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´må’Œnå­˜åœ¨ä¸€ä¸ªå…¬å› å­gï¼Œn=pq, m=kgã€‚nåªæœ‰på’Œqä¸¤ä¸ªå› å­ï¼Œæ‰€ä»¥kå’Œgä¸­å¿…ç„¶æœ‰ä¸€ä¸ªç­‰äºqæˆ–è€…pã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼š<strong>m = kp</strong>ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¡®å®šï¼Œkå’Œqå¿…ç„¶äº’è´¨ã€‚</p><p>â€‹    ä½¿ç”¨æ¬§æ‹‰å®šç†å¯å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">{(kp)}^{(q-1)} \equiv 1 \pmod q \\ è¿›ä¸€æ­¥å¯ä»¥å¾—åˆ° \\ {[{(kp)}^{(q-1)}]}^{h(p-1)}  \times kp \equiv kp \pmod q \\ å³ \\ {(kp)}^{ed} \equiv kp \pmod q</script><p>â€‹    è¿™æ—¶æˆ‘ä»¬å¯ä»¥å°†æœ€åçš„ç®—å¼æ”¹å†™æˆä¸€ä¸ªç­‰å¼ï¼š</p><script type="math/tex; mode=display">{(kp)}^{ed} = tq + kp</script><p>â€‹    åœ¨è¿™ä¸ªç®—å¼ä¸­ï¼Œç­‰å·å·¦è¾¹å¯ä»¥è¢«pæ•´é™¤ï¼Œé‚£ä¹ˆåŒç†tq+kpä¸€å®šä¹Ÿå¯ä»¥è¢«pæ•´é™¤ï¼Œå¯¹äºtqæ¥è¯´ï¼Œqæ˜¯ä¸päº’è´¨ï¼Œæ‰€ä»¥æ­¤æ—¶tä¸€å®šæ˜¯pçš„å€æ•°ã€‚è¿™é‡Œå°±ä»¤t = tâ€™qã€‚</p><script type="math/tex; mode=display">{(kp)}^{ed} = t'pq + kp \\m = kp,n=pq \\å¯ä»¥å¾—åˆ°\\ m^{ed} \equiv m \pmod n</script><p><strong>è¯æ¯•ã€‚</strong></p><p>â€‹    åœ¨ä¸Šé¢çš„è¯æ˜ä¸­ï¼Œç®—å¼çš„æ¨å¯¼å’ŒåŒ–ç®€ç¦»ä¸å¼€æ¨¡è¿ç®—çš„åŸºæœ¬æ€§è´¨ï¼Œä¾‹å¦‚è¿›è¡Œå¹‚è¿ç®—ä¹‹åçš„å¤„ç†ï¼Œæ— æ³•ç†è§£çš„æ—¶å€™å¯ä»¥é’ˆå¯¹ç®—å¼ä¸­çš„æ¨¡ç­‰è¡¨ç¤ºè¿›è¡Œä¿®æ”¹ï¼Œæ”¹æˆkn + m çš„å½¢å¼ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œç†è§£æ¨¡è¿ç®—çš„æœ¬è´¨æ˜¯ç†è§£ç®—å¼æ¨å¯¼åŒ–ç®€çš„å…³é”®ã€‚</p><h2 id="å››ã€RSAç®—æ³•çš„å¯é æ€§"><a href="#å››ã€RSAç®—æ³•çš„å¯é æ€§" class="headerlink" title="å››ã€RSAç®—æ³•çš„å¯é æ€§"></a>å››ã€RSAç®—æ³•çš„å¯é æ€§</h2><p>â€‹    ä»¥ä¸Šè¿°ä¾‹å­ä¸ºå‚è€ƒï¼Œæˆ‘ä»¬åœ¨åŠ å¯†è§£å¯†çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å…±äº§ç”Ÿäº†å…­ä¸ªæ•°å­—ï¼Œä»–ä»¬æ˜¯ï¼š</p><ul><li>p éšæœºé€‰å–çš„è´¨æ•° 61</li><li>q éšæœºé€‰å–çš„è´¨æ•° 53</li><li>n pä¸qçš„ä¹˜ç§¯ 3233</li><li>Ï†(n) nçš„æ¬§æ‹‰å‡½æ•° 3120</li><li>e é€‰æ‹©çš„ä¸€ä¸ªä¸Ï†(n)äº’è´¨çš„æ•°å­— 17</li><li>d eçš„æ¨¡åå…ƒç´  2753</li></ul><p>â€‹    åœ¨è¿™å…­ä¸ªæ•°å­—ä¸­ï¼Œå…¬é’¥ç”¨åˆ°äº†nå’Œeï¼Œå…¶ä»–å››ä¸ªæ•°å­—éƒ½æ˜¯ä¸å…¬å¼€çš„ï¼Œå¯¹äºç§é’¥nå’Œdæ¥è¯´ï¼Œæœ€å…³é”®çš„å°±æ˜¯dï¼Œä¸€æ—¦dæ³„æ¼ï¼Œé‚£ä¹ˆå°±ç­‰åŒäºç§é’¥æ³„æ¼ã€‚</p><p>â€‹    é‚£ä¹ˆï¼Œåœ¨å·²çŸ¥nå’Œeçš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥æ¨å¯¼å‡ºdï¼Ÿ</p><blockquote><ol><li>edâ‰¡1 (mod Ï†(n))ã€‚åªæœ‰çŸ¥é“eå’ŒÏ†(n)ï¼Œæ‰èƒ½ç®—å‡ºd (æ¨¡åå…ƒç´ )</li><li>Ï†(n) = ï¼ˆp - 1) (q - 1). åªæœ‰çŸ¥é“på’Œqæ‰èƒ½ç®—å‡ºÏ†(n)</li><li>n = pqã€‚åªæœ‰å°†nå› æ•°åˆ†è§£ï¼Œæ‰èƒ½ç®—å‡ºpå’Œq</li></ol></blockquote><p>â€‹    ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦ç ´è§£RSAç®—æ³•ï¼Œæœ€ç›´æ¥ä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å¯¹nè¿›è¡Œè´¨å› æ•°åˆ†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹3233è¿›è¡Œå› æ•°åˆ†è§£ï¼ˆ61 * 53ï¼‰ä½†æ˜¯å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·ä¸€ä¸ªæ•´æ•°å‘¢ï¼Ÿ</p><blockquote><p>123018668453011775513049495838496272077285356959533479219732245215172640050726<br>365751874520219978646938995647494277406384592519255732630345373154826850791702<br>6122142913461670429214311602221240479274737794080665351419597459856902143413</p></blockquote><p>è¿™ä¸ªæ•´æ•°ç­‰äºè¿™æ ·ä¸¤ä¸ªè´¨æ•°çš„ä¹˜ç§¯ï¼š</p><blockquote><p>334780716989568987860441698482126908177047949837137685689124313889828837938780<br>02287614711652531743087737814467999489<br>ã€€ã€€ã€€ã€€Ã—<br>367460436667995904282446337996279526322791581643430876426760322838157396665112<br>79233373417143396810270092798736308917</p></blockquote><p>â€‹    åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæƒ³è¦ç ´è§£RSAç®—æ³•è€Œè¿›è¡Œå› æ•°åˆ†è§£ï¼Œææ€•å°±æ˜¯ä¸€ä¸ªå¤æ‚åº¦æ— æ³•æƒ³è±¡çš„é—®é¢˜ã€‚</p><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
            <tag> RSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springè‡ªåŠ¨è£…é…çš„ä¸€æ¬¡è¸©å‘ç»å†</title>
      <link href="/2020/09/05/Spring%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/"/>
      <url>/2020/09/05/Spring%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h2 id="é›¶ã€å†™åœ¨å‰é¢"><a href="#é›¶ã€å†™åœ¨å‰é¢" class="headerlink" title="é›¶ã€å†™åœ¨å‰é¢"></a>é›¶ã€å†™åœ¨å‰é¢</h2><blockquote><p> ä¼—æ‰€å‘¨çŸ¥ï¼Œç¨‹åºå‘˜è®¡æ•°éƒ½æ˜¯ä»é›¶å¼€å§‹çš„ã€‚</p></blockquote><p>â€‹    æœ€è¿‘ç»„é•¿ç»™å®‰æ’äº†ä¸€ä¸ªç»„å†…â€œåˆ†äº«â€ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯æŠ€æœ¯åˆ†äº«ï¼Œä½†æ˜¯å¯èƒ½æ˜¯é‰´äºæˆ‘åˆ†äº«ä¸å‡ºæ¥ä»€ä¹ˆå¯¹ä»–ä»¬æœ‰ç”¨çš„æŠ€æœ¯ï¼Œæ‰€ä»¥ç»™æˆ‘å®šäº†ä¸ªä¸»é¢˜æ˜¯â€œåˆ†äº«å…¬å¸çš„äººå‘˜ç»„ç»‡æ¶æ„ã€ç»„å†…æœåŠ¡åŠŸèƒ½ï¼Œç³»ç»Ÿæ¶æ„â€ï¼Œç¡¬ç€å¤´çš®å†™äº†å†™è‡ªå·±çŸ¥é“çš„ï¼Œå‡†å¤‡äº†ä¸¤å‘¨ï¼Œæ¯å¤©éƒ½åœ¨è§‰å¾—pptä¸Šå†™çš„æ˜¯ä¸€å †åºŸè¯ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/IMG_9909.JPG" alt="IMG_9909" style="zoom: 33%;" /></p><p>â€‹    ç»ˆäºåœ¨åº¦è¿‡äº†æå…¶è‡ªé—­çš„ä¸¤å‘¨ï¼Œpptæ— æƒŠæ— é™©çš„è®²å®Œäº†ï¼Œä¸Šå‘¨å•ä¼‘ï¼Œè¢«å°ä¼™ä¼´æ‹‰å»æ‰“äº†æ¸¸æˆï¼Œæ‰€ä»¥ä¸Šå‘¨å­¦ä¹ è¿›åº¦ä¹Ÿæ˜¯0ã€‚</p><p>æ·¦ï¼è¿™ä¸ªé¢˜ç›®å¥½åƒæ˜¯ä¸€ä¸ªæœˆä¹‹å‰æƒ³å†™çš„äº†,æœ€è¿‘å®åœ¨æ˜¯å¤ªæ‡’æƒ°äº†ğŸ˜­ğŸ˜­ğŸ˜­ã€‚ã€‚ã€‚ã€‚</p><h2 id="ä¸€ã€è¸©å‘"><a href="#ä¸€ã€è¸©å‘" class="headerlink" title="ä¸€ã€è¸©å‘"></a>ä¸€ã€è¸©å‘</h2><p>â€‹    äº‹æƒ…ä»ä¸€æ¬¡æ™®é€šçš„éœ€æ±‚è¯´èµ·ï¼Œä¸šåŠ¡ä¸Šçš„ä»£ç éœ€è¦åœ¨ä¸€ä¸ªUtilç±»ä¸Šè¿›è¡Œæ”¹åŠ¨ï¼Œä½†æ˜¯åŒæ—¶è¿˜æ˜¯éœ€è¦è°ƒç”¨ä¸€äº›å…¶ä»–serviceæ–¹æ³•ï¼Œè¿™é‡Œå°±éœ€è¦é€šè¿‡Springè¿›è¡Œè£…é…ï¼Œä½†æ˜¯æ”¹åŠ¨çš„æ–¹æ³•æ˜¯ä¸€ä¸ªstaticçš„é™æ€æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å°±è„‘æŠ½çš„ç›´æ¥ä½¿ç”¨äº†staticå…³é”®å­—ä¿®é¥°å¼•ç”¨çš„serviceã€‚</p><blockquote><p>å…¶å®è¿™é‡Œæ˜¯ä¸å¯¹çš„ï¼ŒUtilsæ˜¯ä¸å¯ä»¥æœ‰ä»»ä½•serviceå±‚çš„è°ƒç”¨çš„ï¼Œè¿™é‡Œæˆ‘é€šè¿‡æ²Ÿé€šä¹Ÿè¿›è¡Œäº†æ”¹åŠ¨ï¼Œå°†serviceçš„è°ƒç”¨ç§»åˆ°äº†Utilsè°ƒç”¨ä¹‹å‰ï¼Œå°†serviceçš„è°ƒç”¨ç»“æœå¤„ç†åä½œä¸ºUtilsçš„å‚æ•°ã€‚ä½†æ­£å› ä¸ºè¿™æ ·ï¼Œå¥‰è¡Œctrl cã€ctrl vçš„æˆ‘ï¼Œè¿˜æ˜¯æŠŠstaticç»™å¤åˆ¶äº†è¿‡æ¥ğŸ˜…ã€‚</p></blockquote><p>ç¤ºä¾‹ä»£ç  ğŸ‘‡ğŸ»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TestService testService; <span class="comment">//the bean is modified by static!!!!</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/foo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiResult <span class="title">fooController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String msg = testService.testAutowired(<span class="string">"this is a msg"</span>);</span><br><span class="line">        System.err.println(msg);</span><br><span class="line">        <span class="keyword">return</span> ApiResult.success(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¦‚æœå»æ‰staticï¼ŒæŒ‰ç…§ä¼ ç»Ÿçš„è£…é…æ–¹å¼ï¼Œå½“ç„¶å¯ä»¥æ­£å¸¸çš„è¯·æ±‚åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªjsonğŸ‘‡ğŸ»ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">0</span>,<span class="attr">"message"</span>:<span class="string">"Success"</span>,<span class="attr">"data"</span>:<span class="string">"this is a msg"</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å‘ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯å‡ºé”™äº†æ‰å¯¹ã€‚ã€‚ã€‚</p><p>æ²¡é”™ï¼Œåœ¨ä¸Šé¢ç¤ºä¾‹ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œè¯·æ±‚ï¼Œä¼šçˆ†å‡ºä¸€ä¸ªNullPointerExceptionï¼Œé”™è¯¯å †æ ˆå¦‚ä¸‹ğŸ‘‡ğŸ»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">There was an unexpected <span class="title">error</span> <span class="params">(type=Internal Server Error, status=<span class="number">500</span>)</span>.</span></span><br><span class="line"><span class="function">No message available</span></span><br><span class="line"><span class="function">java.lang.NullPointerException</span></span><br><span class="line"><span class="function">at com.lcl.datareplenish.controller.ModelController.<span class="title">fooController</span><span class="params">(ModelController.java:<span class="number">27</span>)</span></span></span><br><span class="line"><span class="function">at sun.reflect.NativeMethodAccessorImpl.<span class="title">invoke0</span><span class="params">(Native Method)</span></span></span><br><span class="line"><span class="function">at sun.reflect.NativeMethodAccessorImpl.<span class="title">invoke</span><span class="params">(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span></span></span><br><span class="line"><span class="function">at sun.reflect.DelegatingMethodAccessorImpl.<span class="title">invoke</span><span class="params">(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span></span></span><br><span class="line"><span class="function">at java.lang.reflect.Method.<span class="title">invoke</span><span class="params">(Method.java:<span class="number">498</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.method.support.InvocableHandlerMethod.<span class="title">doInvoke</span><span class="params">(InvocableHandlerMethod.java:<span class="number">190</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.method.support.InvocableHandlerMethod.<span class="title">invokeForRequest</span><span class="params">(InvocableHandlerMethod.java:<span class="number">138</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.<span class="title">invokeAndHandle</span><span class="params">(ServletInvocableHandlerMethod.java:<span class="number">106</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.<span class="title">invokeHandlerMethod</span><span class="params">(RequestMappingHandlerAdapter.java:<span class="number">888</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.<span class="title">handleInternal</span><span class="params">(RequestMappingHandlerAdapter.java:<span class="number">793</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.<span class="title">handle</span><span class="params">(AbstractHandlerMethodAdapter.java:<span class="number">87</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.DispatcherServlet.<span class="title">doDispatch</span><span class="params">(DispatcherServlet.java:<span class="number">1040</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.DispatcherServlet.<span class="title">doService</span><span class="params">(DispatcherServlet.java:<span class="number">943</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.FrameworkServlet.<span class="title">processRequest</span><span class="params">(FrameworkServlet.java:<span class="number">1006</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.FrameworkServlet.<span class="title">doGet</span><span class="params">(FrameworkServlet.java:<span class="number">898</span>)</span></span></span><br><span class="line"><span class="function">at javax.servlet.http.HttpServlet.<span class="title">service</span><span class="params">(HttpServlet.java:<span class="number">634</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.servlet.FrameworkServlet.<span class="title">service</span><span class="params">(FrameworkServlet.java:<span class="number">883</span>)</span></span></span><br><span class="line"><span class="function">at javax.servlet.http.HttpServlet.<span class="title">service</span><span class="params">(HttpServlet.java:<span class="number">741</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">internalDoFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">231</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">doFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">166</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.tomcat.websocket.server.WsFilter.<span class="title">doFilter</span><span class="params">(WsFilter.java:<span class="number">53</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">internalDoFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">193</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">doFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">166</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.RequestContextFilter.<span class="title">doFilterInternal</span><span class="params">(RequestContextFilter.java:<span class="number">100</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.OncePerRequestFilter.<span class="title">doFilter</span><span class="params">(OncePerRequestFilter.java:<span class="number">119</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">internalDoFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">193</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">doFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">166</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.FormContentFilter.<span class="title">doFilterInternal</span><span class="params">(FormContentFilter.java:<span class="number">93</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.OncePerRequestFilter.<span class="title">doFilter</span><span class="params">(OncePerRequestFilter.java:<span class="number">119</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">internalDoFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">193</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">doFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">166</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.CharacterEncodingFilter.<span class="title">doFilterInternal</span><span class="params">(CharacterEncodingFilter.java:<span class="number">201</span>)</span></span></span><br><span class="line"><span class="function">at org.springframework.web.filter.OncePerRequestFilter.<span class="title">doFilter</span><span class="params">(OncePerRequestFilter.java:<span class="number">119</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">internalDoFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">193</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.ApplicationFilterChain.<span class="title">doFilter</span><span class="params">(ApplicationFilterChain.java:<span class="number">166</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.StandardWrapperValve.<span class="title">invoke</span><span class="params">(StandardWrapperValve.java:<span class="number">202</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.StandardContextValve.<span class="title">invoke</span><span class="params">(StandardContextValve.java:<span class="number">96</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.authenticator.AuthenticatorBase.<span class="title">invoke</span><span class="params">(AuthenticatorBase.java:<span class="number">526</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.StandardHostValve.<span class="title">invoke</span><span class="params">(StandardHostValve.java:<span class="number">139</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.valves.ErrorReportValve.<span class="title">invoke</span><span class="params">(ErrorReportValve.java:<span class="number">92</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.core.StandardEngineValve.<span class="title">invoke</span><span class="params">(StandardEngineValve.java:<span class="number">74</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.catalina.connector.CoyoteAdapter.<span class="title">service</span><span class="params">(CoyoteAdapter.java:<span class="number">343</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.coyote.http11.Http11Processor.<span class="title">service</span><span class="params">(Http11Processor.java:<span class="number">408</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.coyote.AbstractProcessorLight.<span class="title">process</span><span class="params">(AbstractProcessorLight.java:<span class="number">66</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.coyote.AbstractProtocol$ConnectionHandler.<span class="title">process</span><span class="params">(AbstractProtocol.java:<span class="number">861</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.<span class="title">doRun</span><span class="params">(NioEndpoint.java:<span class="number">1579</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.tomcat.util.net.SocketProcessorBase.<span class="title">run</span><span class="params">(SocketProcessorBase.java:<span class="number">49</span>)</span></span></span><br><span class="line"><span class="function">at java.util.concurrent.ThreadPoolExecutor.<span class="title">runWorker</span><span class="params">(ThreadPoolExecutor.java:<span class="number">1149</span>)</span></span></span><br><span class="line"><span class="function">at java.util.concurrent.ThreadPoolExecutor$Worker.<span class="title">run</span><span class="params">(ThreadPoolExecutor.java:<span class="number">624</span>)</span></span></span><br><span class="line"><span class="function">at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.<span class="title">run</span><span class="params">(TaskThread.java:<span class="number">61</span>)</span></span></span><br><span class="line"><span class="function">at java.lang.Thread.<span class="title">run</span><span class="params">(Thread.java:<span class="number">748</span>)</span></span></span><br></pre></td></tr></table></figure><p>â€‹    è€Œä¸”ä¹Ÿå¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°ä¸¤è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">09</span>-<span class="number">06</span> <span class="number">01</span>:<span class="number">47</span>:<span class="number">04.216</span>  INFO <span class="number">71855</span> --- [  restartedMain] f.a.AutowiredAnnotationBeanPostProcessor : Autowired annotation is not supported on <span class="keyword">static</span> fields: <span class="keyword">private</span> <span class="keyword">static</span> com.lcl.datareplenish.service.TestService com.lcl.datareplenish.controller.ModelController.testService</span><br><span class="line"><span class="number">2020</span>-<span class="number">09</span>-<span class="number">06</span> <span class="number">01</span>:<span class="number">47</span>:<span class="number">04.216</span>  INFO <span class="number">71855</span> --- [  restartedMain] f.a.AutowiredAnnotationBeanPostProcessor : Autowired annotation is not supported on <span class="keyword">static</span> fields: <span class="keyword">private</span> <span class="keyword">static</span> com.lcl.datareplenish.service.TestService com.lcl.datareplenish.controller.ModelController.testService</span><br></pre></td></tr></table></figure><p>â€‹    ç»è¿‡èµ„æ–™çš„æŸ¥é˜…ï¼Œä¼šå‘ç”Ÿè¿™ç§é—®é¢˜å…³é”®åœ¨äºSpringå®¹å™¨ä¸ç±»åŠ è½½çš„å…ˆåé¡ºåºé—®é¢˜ã€‚</p><h2 id="äºŒã€é—®é¢˜åˆ†æ"><a href="#äºŒã€é—®é¢˜åˆ†æ" class="headerlink" title="äºŒã€é—®é¢˜åˆ†æ"></a>äºŒã€é—®é¢˜åˆ†æ</h2><p>â€‹    <strong>é¦–å…ˆå¯¹staticå…³é”®å­—è¿›è¡Œåˆ†æ</strong>ï¼Œæ·±å…¥æ¢ç©¶staicè¦ä»Javaçš„å†…å­˜æ¨¡å‹å±‚æ¬¡ä¸Šè¿›è¡Œåˆ†æï¼Œè¿™ç¯‡æ–‡ç« å°±å…ˆä¸è®¨è®ºé‚£ä¹ˆæ·±å…¥ï¼Œæ—¥ååœ¨æˆ‘ç»§ç»­è¯»ã€Šæ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºã€‹ä¹‹ååº”è¯¥ä¼šè¿›è¡Œæ€»ç»“çš„ã€‚</p><p>â€‹    é¦–å…ˆæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå¸¸è¯†ï¼Œé™æ€å˜é‡ï¼ˆæˆå‘˜ï¼‰å®ƒæ˜¯<strong>å±äºç±»</strong>çš„ï¼Œè€Œéå±äºå®ä¾‹å¯¹è±¡çš„å±æ€§ï¼›åŒæ ·çš„é™æ€æ–¹æ³•ä¹Ÿæ˜¯å±äºç±»çš„ï¼Œæ™®é€šæ–¹æ³•ï¼ˆå®ä¾‹æ–¹æ³•ï¼‰æ‰å±äºå¯¹è±¡ã€‚</p><pre><code>&gt; çªç„¶æœ‰äº›ç†è§£ï¼Œè¢«autowiredæ³¨è§£ä¿®é¥°çš„å¼•ç”¨ï¼Œå…¶å®æ˜¯å½“å‰ç±»çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œè¿›è¡Œçš„æ³¨å…¥ï¼Œæ— éæ˜¯é€šè¿‡äº†Springå®¹å™¨å°†ç”Ÿæˆå¥½çš„beanä½œä¸ºåˆå§‹åŒ–èµ‹å€¼ç»™å½“å‰çš„è¿™ä¸ªå±æ€§ã€‚è¿™æ‰æ˜¯æ‰€è°“çš„ä¾èµ–æ³¨å…¥ã€‚</code></pre><p>â€‹    è€ŒSpringå®¹å™¨ç®¡ç†çš„éƒ½æ˜¯<strong>å®ä¾‹å¯¹è±¡</strong>ï¼ŒåŒ…æ‹¬å®ƒçš„<code>@Autowired</code>ä¾èµ–æ³¨å…¥çš„å‡æ˜¯å®¹å™¨å†…çš„å¯¹è±¡å®ä¾‹ï¼Œæ‰€ä»¥å¯¹äºstaticæˆå‘˜æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨<code>@Autowired</code>æ³¨å…¥çš„ã€‚</p><p>â€‹    ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»çš„staticå±æ€§åœ¨Springå®¹å™¨å¯åŠ¨ä¹‹å‰å°±å·²ç»åŠ è½½äº†ï¼Œè€Œä¸”å®ƒå¹¶ä¸ä¾é Springçš„ä¾èµ–æ³¨å…¥æ¥è¿›è¡Œåˆå§‹åŒ–çš„ã€‚</p><p>â€‹    è€Œä¸”Springå®˜æ–¹ä¹Ÿæ˜¯éå¸¸ä¸å»ºè®®å¯¹staticå±æ€§å­—æ®µè¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆè¿™é‡Œæ˜¯ä¸å»ºè®®ï¼Œè€Œä¸æ˜¯ä¸å¯ä»¥ï¼‰ ã€‚</p><p><strong>é‚£ä¹ˆSpringå®¹å™¨æ˜¯å¦‚ä½•åœ¨è‡ªåŠ¨è£…é…çš„æ—¶å€™åšåˆ°é¿å…staticå­—æ®µçš„beançš„ç”Ÿæˆå‘¢ï¼Ÿ</strong></p><p>â€‹    ä»ä¸Šè¿°çš„ä¸¤è¡Œ<code>not supported on static fields</code>çš„æ—¥å¿—ä¸­å¯ä»¥å®šä½åˆ°Springçš„éƒ¨åˆ†æºç ğŸ‘‡ğŸ»ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200906020204050.png" alt="image-20200906020204050"></p><p>â€‹    ä»è¿™ä¸ªä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå½“fieldæˆ–è€…æ˜¯methodè¢«<code>static</code>ä¿®é¥°ä¹‹åï¼ŒSpringå°±ä¼šè‡ªåŠ¨è·³è¿‡ä»–ä»¬ï¼Œä»…ä»…åªä¼šæ‰“å‡ºä¸€è¡Œinfoçº§åˆ«çš„æ—¥å¿—ï¼Œä½†æ˜¯ä¸ä¼šå‘ç”Ÿä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥ä¹Ÿå°±å¯¼è‡´äº†åé¢å†è°ƒç”¨æ—¶ä¼šå‘ç”ŸNullPointerExceptionå¼‚å¸¸ã€‚</p><h2 id="ä¸‰ã€é—®é¢˜è§£å†³"><a href="#ä¸‰ã€é—®é¢˜è§£å†³" class="headerlink" title="ä¸‰ã€é—®é¢˜è§£å†³"></a>ä¸‰ã€é—®é¢˜è§£å†³</h2><p>â€‹    è™½ç„¶æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„æ³¨è§£çš„æ–¹å¼å¯¹staticå±æ€§è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä»£è¡¨æˆ‘ä»¬æ²¡æœ‰æ–¹æ³•è°ƒç”¨é™æ€å±æ€§äº†å‘¢ï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼</p><h3 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a>æ–¹æ³•ä¸€ï¼š</h3><p>ä½¿ç”¨ä¸€ä¸ªsetæ–¹æ³•ğŸ‘‡ğŸ»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TestService testService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTestService</span><span class="params">(TestService testService)</span> </span>&#123;</span><br><span class="line">        ModelController.testService = testService;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/foo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult <span class="title">fooController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String msg = testService.testAutowired(<span class="string">"this is a msg"</span>);</span><br><span class="line">        System.err.println(msg);</span><br><span class="line">        <span class="keyword">return</span> ApiResult.success(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼š"><a href="#æ–¹æ³•äºŒï¼š" class="headerlink" title="æ–¹æ³•äºŒï¼š"></a>æ–¹æ³•äºŒï¼š</h3><p>ä½¿ç”¨<code>@PostConstruct</code>æ³¨è§£ï¼Œä¸ºstaticæˆå‘˜èµ‹å€¼ğŸ‘‡ğŸ»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TestService testService;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ModelController.testService = applicationContext.getBean(TestService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/foo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult <span class="title">fooController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String msg = testService.testAutowired(<span class="string">"this is a msg"</span>);</span><br><span class="line">        System.err.println(msg);</span><br><span class="line">        <span class="keyword">return</span> ApiResult.success(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•ä¸‰ï¼š"><a href="#æ–¹æ³•ä¸‰ï¼š" class="headerlink" title="æ–¹æ³•ä¸‰ï¼š"></a>æ–¹æ³•ä¸‰ï¼š</h3><p>å®ç°ä¸€ä¸ªSpringContextçš„å·¥å…·ç±»ï¼Œå»è·å–å®¹å™¨ä¸­çš„beanğŸ‘‡ğŸ»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TestService testService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/foo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult <span class="title">fooController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//æœªæä¾›SpringApplicationContextUtilç±»çš„å®ç°</span></span><br><span class="line">        testService =  SpringApplicationContextUtil.getBean(<span class="string">"testService"</span>); </span><br><span class="line">        String msg = testService.testAutowired(<span class="string">"this is a msg"</span>);</span><br><span class="line">        System.err.println(msg);</span><br><span class="line">        <span class="keyword">return</span> ApiResult.success(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€å†™åœ¨æœ€å"><a href="#å››ã€å†™åœ¨æœ€å" class="headerlink" title="å››ã€å†™åœ¨æœ€å"></a>å››ã€å†™åœ¨æœ€å</h2><p>â€‹    è¿™æ¬¡è¸©å‘å…¶å®å¹¶æ²¡æœ‰ä»»ä½•äººå‘ç°ï¼Œåªæ˜¯åœ¨æˆ‘è‡ªå·±éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒä¹‹åï¼Œè‡ªå·±å‘ç°çš„é—®é¢˜ï¼ˆå¤šäºæ²¡è¢«åˆ«äººå‘ç°ï¼Œä¸ç„¶ä¸¢æ­»äººäº†ğŸ˜£ï¼‰ï¼Œåœ¨é—®é¢˜åŸå› çš„æ¢ç©¶è¿‡ç¨‹ä¸­å‘ç°äº†è‡ªå·±å¯¹Springç”šè‡³æ˜¯staticéƒ½è¿˜ç†è§£çš„ä¸å¤Ÿé€å½»ã€‚</p><p>â€‹    æ¯”å¦‚ï¼š</p><ul><li>staticæ‰€ä¿®é¥°çš„æˆå‘˜å˜é‡åœ¨åŠ è½½è¿‡ç¨‹ä¸­çš„ç‰¹æ®Šæ€§</li><li>â€œSpringå®¹å™¨å¯åŠ¨è·³è¿‡staticæˆå‘˜æ³¨å…¥â€æ“ä½œçš„å…¥å£</li><li>Springçš„ä¾èµ–æ³¨å…¥æ‰€è§£å†³çš„é—®é¢˜</li></ul><p>â€‹    æœªæ¥è¦å­¦ä¹ å†…å®¹ä¸æ–¹å‘ï¼š</p><ul><li>Javaå†…å­˜æ¨¡å‹â€”â€”ã€Šæ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºã€‹</li><li>Springçš„åº•å±‚åŸç†ä¸æºç å®ç°â€”â€”ã€ŠSpringæºç æ·±åº¦è§£æã€‹</li></ul><p>â€‹    é“é˜»ä¸”é•¿ï¼Œç»§ç»­åŠ æ²¹ğŸ’ªğŸ»ã€‚</p><p><strong>ä»¥ä¸Šï¼</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> workReview </tag>
            
            <tag> ExceptionRecord </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMapçš„å·¥ä½œåŸç†(äºŒ)ï¼šHashMapä¸­çš„æ•°æ®ç»“æ„ä¸åŸç†</title>
      <link href="/2020/07/26/HashMap%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%E4%BA%8C-%EF%BC%9AHashMap%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%8E%9F%E7%90%86/"/>
      <url>/2020/07/26/HashMap%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%E4%BA%8C-%EF%BC%9AHashMap%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€å“ˆå¸Œè¡¨æ¦‚è¿°"><a href="#1ã€å“ˆå¸Œè¡¨æ¦‚è¿°" class="headerlink" title="1ã€å“ˆå¸Œè¡¨æ¦‚è¿°"></a>1ã€å“ˆå¸Œè¡¨æ¦‚è¿°</h3><p>â€‹    åœ¨äº†è§£ä»€ä¹ˆæ˜¯HashMapä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£å“ˆå¸Œè¡¨ï¼ˆHash tableï¼‰ï¼š</p><blockquote><p>å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰<br>ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåº”ç”¨åœºæ™¯åŠå…¶ä¸°å¯Œï¼Œè®¸å¤šç¼“å­˜æŠ€æœ¯ï¼ˆæ¯”å¦‚memcachedï¼‰çš„æ ¸å¿ƒå…¶å®å°±æ˜¯åœ¨å†…å­˜</p><p>å¼ å¤§çš„å“ˆå¸Œè¡¨. </p></blockquote><p>â€‹    é¦–å…ˆï¼Œä¸å“ˆå¸Œè¡¨è¿›è¡ŒåŒºåˆ«ï¼Œæˆ‘ä»¬è¦äº†è§£ä¸€ä¸‹å…¶ä»–æ•°æ®ç»“æ„åœ¨æ–°å¢ã€æŸ¥æ‰¾ç­‰åŸºç¡€æ“ä½œçš„æ‰§è¡Œæ€§èƒ½. </p><p><strong>æ•°ç»„ï¼š</strong></p><p>â€‹    æ•°ç»„é‡‡ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨å•å…ƒæ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå¯¹äºæŒ‡å®šä¸‹æ ‡çš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›é€šè¿‡ç»™å®šå€¼çš„æŸ¥æ‰¾ï¼Œéœ€è¦éå†æ•°ç»„ï¼Œé€ä¸€æ¯”å¯¹ç»™å®šå…³é”®å­—å’Œæ•°ç»„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå¯¹äºæœ‰åºæ•°ç»„å½“ç„¶å¯ä»¥é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ã€å·®å€¼æŸ¥æ‰¾ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾ç­‰æ–¹å¼ï¼Œå¯ä»¥è®²æŸ¥æ‰¾å¤æ‚åº¦æé«˜åˆ°O(logn)ï¼›å¯¹äºä¸€èˆ¬çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œæ¶‰åŠåˆ°æ•°ç»„å…ƒç´ çš„ç§»åŠ¨ï¼Œå¹³å‡å¤æ‚åº¦ä¸ºO(n)ã€‚</p><p>â€‹    æ•°ç»„åœ¨å†…å­˜ä¸­æŸ¥æ‰¾ä½ç½®æ»¡è¶³å…¬å¼ï¼š</p><blockquote><p>a[i]_address = base_address + i*data_type_size</p></blockquote><p>â€‹    è¿™é‡Œçš„base_addressä»£è¡¨æ•°ç»„å¤´èŠ‚ç‚¹å†…å­˜åœ°å€ï¼Œiè¡¨ç¤ºä¸ºä¸‹æ ‡ï¼Œdata_type_sizeè¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªå…¬å¼è®¡ç®—ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ•°ç»„ä¸‹æ ‡ç¬¬ä¸€ä¸ªæ˜¯0çš„åŸå› äº†ï¼ˆå‡å°‘ä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œæé«˜æ•ˆç‡ï¼‰ã€‚</p><p><strong>çº¿æ€§é“¾è¡¨ï¼š</strong></p><p>â€‹    å¯¹äºé“¾è¡¨çš„æ–°å¢ã€åˆ é™¤ç­‰æ“ä½œï¼Œåªéœ€è¦å¤„ç†èŠ‚ç‚¹ä¹‹é—´çš„å¼•ç”¨å³å¯ï¼Œè¿™æ ·çš„è¯æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ï¼Œè€ŒæŸ¥æ‰¾æ“ä½œéœ€è¦éå†é“¾è¡¨æ³¨æ„è¿›è¡Œæ¯”å¯¹ï¼Œå¤æ‚åº¦ä¸ºO(n)ã€‚</p><p><strong>äºŒå‰æ ‘ï¼š</strong></p><p>â€‹    å¯¹äºä¸€é¢—ç›¸å¯¹å¹³è¡¡çš„æœ‰åºäºŒå‰æ ‘ï¼Œå¯¹å…¶è¿›è¡Œæ’å…¥ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ç­‰æ“ä½œï¼Œå¹³å‡å¤æ‚åº¦å‡ä¸ºO(logn)ã€‚</p><p><strong>å“ˆå¸Œè¡¨ï¼š</strong></p><p>â€‹    ç›¸æ¯”äºä»¥ä¸Šæ•°æ®ç»“æ„ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œï¼Œæ€§èƒ½ååˆ†é«˜ï¼Œåœ¨ä¸è€ƒè™‘å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ã€‚ä»…éœ€è¦ä¸€æ¬¡å®šä½å³å¯å®Œæˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1). </p><p>â€‹    å“ˆå¸Œè¡¨çš„ä¸»ä½“æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸€èˆ¬è¢«ç§°ä¸ºbucketæ•°ç»„ï¼Œåœ¨è¿™ä¸ªbucketä¸­å­˜æ”¾ç€æˆ‘ä»¬éœ€è¦ä¿å­˜çš„æ•°æ®å…ƒç´ ï¼Œåœ¨æˆ‘ä»¬è¿›è¡Œä¿å­˜çš„æ—¶å€™ï¼Œé€šè¿‡å¯¹æ•°æ®hashå€¼ä¸bucketæ•°ç»„é•¿åº¦ä¹‹é—´è¿›è¡Œè¿ç®—ï¼Œå¯ä»¥å¾—åˆ°å½“å‰å…ƒç´ è¦å­˜å‚¨çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´é€šè¿‡æŸç§å‡½æ•°æ˜ å°„ï¼Œå°†å…ƒç´ æ˜ å°„åˆ°bucketä¸­çš„ç‰¹å®šä½ç½®ä¸Šï¼Œæœ‰äº†è¿™ä¸ªä½ç½®æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¿«é€Ÿçš„æ•°æ®æŸ¥æ‰¾å®šä½ã€‚</p><h3 id="2ã€HashMapçš„æ•°æ®ç»“æ„"><a href="#2ã€HashMapçš„æ•°æ®ç»“æ„" class="headerlink" title="2ã€HashMapçš„æ•°æ®ç»“æ„"></a>2ã€HashMapçš„æ•°æ®ç»“æ„</h3><h4 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>â€‹    HashMapæœ€æ—©å‡ºç°åœ¨JDK 1.2ä¸­ï¼Œåº•å±‚åŸºäºæ•£åˆ—ç®—æ³•å®ç°ã€‚HashMapå…è®¸nullé”®å’Œnullå€¼ï¼Œåœ¨è®¡ç®—nullé”®çš„å“ˆå¸Œå€¼æ—¶ï¼Œnullé”®å“ˆå¸Œå€¼ä¸º0ã€‚HashMapå¹¶ä¸ä¿è¯é”®å€¼å¯¹çš„é¡ºåºï¼Œè¿™æ„å‘³ç€åœ¨è¿›è¡ŒæŸäº›æ“ä½œä¹‹åï¼Œé”®å€¼å¯¹çš„é¡ºåºå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦å¤–ï¼ŒHashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚</p><p>â€‹    jdk1.8ä¹‹å‰é‡‡ç”¨çš„æ˜¯æ•°ç»„+é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªEntryç»“ç‚¹ï¼ŒåŒ…å«keyã€valueã€hashå€¼ã€æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„nextæŒ‡é’ˆå››ä¸ªå±æ€§ã€‚jdk1.8ä¹‹åé‡‡ç”¨çš„æ˜¯æ•°ç»„+é“¾è¡¨æˆ–è€…æ˜¯çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªNodeç»“ç‚¹ï¼ŒNodeå®ç°äº†Entryæ¥å£ï¼ŒNodeæœ‰ä¸€ä¸ªå­ç±»TreeNodeï¼Œä»£è¡¨æ ‘ç»“ç‚¹ã€‚</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200726164635518.png" alt="image-20200726164635518"  /></p><h4 id="æ•£åˆ—ç®—æ³•"><a href="#æ•£åˆ—ç®—æ³•" class="headerlink" title="æ•£åˆ—ç®—æ³•"></a>æ•£åˆ—ç®—æ³•</h4><p>åœ¨è¿›è¡Œå¢åˆ æŸ¥ç­‰æ“ä½œæ—¶ï¼Œé¦–å…ˆè¦å®šä½åˆ°å…ƒç´ åœ¨æ•°ç»„ï¼ˆbucketæ•°ç»„ï¼‰ä¸­çš„ä½ç½®ï¼Œè€Œå®šä½è¿™ä¸ªä½ç½®çš„æ–¹æ³•å°±æ˜¯â€œæ•£åˆ—ç®—æ³•â€ï¼Œä¹Ÿå«å“ˆå¸Œå‡½æ•°ã€‚</p><p>æ•£åˆ—ç®—æ³•ï¼šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨hashmapä¸­è¦æ‰¾åˆ°æŸä¸ªå…ƒç´ ï¼Œéœ€è¦æ ¹æ®keyçš„hashå€¼æ¥æ±‚å¾—å¯¹åº”æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¦‚ä½•è®¡ç®—è¿™ä¸ªä½ç½®å°±æ˜¯hashç®—æ³•ã€‚å‰é¢è¯´è¿‡hashmapçš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªhashmapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡çš„åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œè€Œä¸ç”¨å†å»éå†é“¾è¡¨ã€‚</p><p>è¿™ä¸ªç®—æ³•åœ¨HashMapçš„å®ç°æ–¹æ³•æ˜¯ç”¨hashcodeå¯¹æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><blockquote><p>index = hashcode % lengthï¼ˆä¸¾ä¾‹æ¥è¯´ å®šä½å…ƒç´ 35åœ¨æ¡¶æ•°ç»„ä¸­çš„ä½ç½®ï¼šindex = 35ï¼ˆå–å…¶hashï¼‰% 16ï¼ˆhashMapåˆå§‹åŒ–é•¿åº¦ï¼‰</p></blockquote><p>å›¾ä¸­çš„æŸ¥è¯¢æ–¹æ³•ç®€å•ä¸¾ä¾‹å°±æ˜¯ index = 35 % 16 = 3 ç„¶åå†åœ¨3å·æ¡¶æ‰€æŒ‡å‘çš„é“¾è¡¨ä¸­ç»§ç»­æŸ¥æ‰¾ï¼Œ35å°±åœ¨é“¾è¡¨ä¸­.</p><h4 id="æ•£åˆ—å†²çª"><a href="#æ•£åˆ—å†²çª" class="headerlink" title="æ•£åˆ—å†²çª"></a>æ•£åˆ—å†²çª</h4><p>â€‹    æ•£åˆ—å†²çªä¹Ÿå«å“ˆå¸Œç¢°æ’ã€å“ˆå¸Œå†²çªã€‚æ­£å¦‚ä¸‡äº‹æ— å®Œç¾ï¼Œå¦‚æœä¸¤ä¸ªä¸åŒçš„å…ƒç´ ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•è®¡ç®—å‡ºçš„å­˜å‚¨åœ°å€ç›¸åŒè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨å¯¹å…ƒç´ è¿›è¡Œæ•£åˆ—ç®—æ³•ç¡®å®šä½ç½®ä¹‹åï¼Œå‘ç°å½“å‰ä½ç½®ä¸Šå·²ç»æœ‰äº†å…ƒç´ è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æ•£åˆ—å†²çªã€‚</p><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><ol><li><p><strong>å¼€æ”¾å¯»å€æ³•</strong></p><p>å¼€æ”¾å¯»å€çš„æ€æƒ³å°±æ˜¯ï¼Œå‡ºç°äº†æ•£åˆ—å†²çªä¹‹åï¼Œæˆ‘ä»¬å°±é‡æ–°æ‰¾åˆ°ä¸€ä¸ªç©ºé—²ä½ç½®å°†å…¶æ’å…¥ï¼Œé‡æ–°æ¢æµ‹ä½ç½®çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼Œ<strong>çº¿æ€§æ¢æµ‹(Linear Probing)</strong>ã€‚</p><p><strong>çº¿æ€§æ¢æµ‹ï¼š</strong></p><p>â€‹    å½“æˆ‘ä»¬å¾€æ•£åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæŸä¸ªæ•°æ®ç»è¿‡æ•£åˆ—å‡½æ•°æ•£åˆ—ä¹‹åï¼Œå­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨äº†ï¼Œæˆ‘ä»¬å°±ä»å½“å‰ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡å¾€åæŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦æœ‰ç©ºé—²ä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚</p><p>â€‹    å¯¹äºçº¿æ€§æ¢æµ‹çš„æŸ¥æ‰¾æœ‰ç‚¹å„¿ç±»ä¼¼æ’å…¥è¿‡ç¨‹ã€‚æˆ‘ä»¬é€šè¿‡æ•£åˆ—å‡½æ•°æ±‚å‡ºè¦æŸ¥æ‰¾å…ƒç´ çš„é”®å€¼å¯¹åº”çš„æ•£åˆ—å€¼ï¼Œç„¶åæ¯”è¾ƒæ•°ç»„ä¸­ä¸‹æ ‡ä¸ºæ•£åˆ—å€¼çš„å…ƒç´ å’Œè¦æŸ¥æ‰¾çš„å…ƒç´ ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ï¼›å¦åˆ™å°±é¡ºåºå¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚<strong>å¦‚æœéå†åˆ°æ•°ç»„ä¸­çš„ç©ºé—²ä½ç½®ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¯´æ˜è¦æŸ¥æ‰¾çš„å…ƒç´ å¹¶æ²¡æœ‰åœ¨æ•£åˆ—è¡¨ä¸­ã€‚</strong></p><p>â€‹    ä½†æ˜¯çº¿æ€§æ¢æµ‹çš„ä¸€ä¸ªé‡è¦é—®é¢˜å°±æ˜¯ä»–çš„åˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬åœ¨åˆ é™¤å…ƒç´ çš„æ—¶å€™ä¸èƒ½å•çº¯çš„æŠŠå…ƒç´ è®¾ç½®ä¸ºç©ºï¼Œå› ä¸ºåœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¸€æ—¦æˆ‘ä»¬é€šè¿‡çº¿æ€§æ¢æµ‹æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤å®šæ•£åˆ—è¡¨ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªä½ç½®å°±æ˜¯æˆ‘ä»¬åˆšåˆšåˆ é™¤çš„ï¼Œé‚£è¿™ä¸ªæŸ¥æ‰¾ç®—æ³•å°±å¤±æ•ˆäº†ï¼ŒåŸæ¥å­˜åœ¨çš„æ•°æ®ä¼šè¢«è®¤å®šä¸ºä¸å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ é™¤å…ƒç´ æ—¶ï¼Œåº”è¯¥å°†åˆ é™¤çš„å…ƒç´ æ ‡è®°ä¸ºä¸€ä¸ªdeletedçŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿›è¡ŒæŸ¥æ‰¾ï¼Œå°±å¯ä»¥ç»§ç»­å‘ä¸‹æ¢æµ‹äº†ã€‚</p><blockquote><p>ç”±æ­¤å¯ä»¥çœ‹åˆ°ï¼Œçº¿æ€§æ¢æµ‹æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬æ’å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œç©ºé—²ä½ç½®è¶Šæ¥è¶Šå°‘ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±ä¼šæ›´å®¹æ˜“äº§ç”Ÿå†²çªï¼Œè€Œç”±æ­¤ä¼šæµªè´¹å¤§é‡çš„æ—¶é—´åœ¨æ¢æµ‹è¿™ä¸ªæ“ä½œä¸Šï¼Œæç«¯æƒ…å†µä¸‹è¿˜å®¹æ˜“æ¢æµ‹æ•´å¼ è¡¨ï¼Œè¿™æ ·çš„æ•ˆç‡æå…¶ä½ä¸‹ã€‚é™¤äº†çº¿æ€§æ¢æµ‹ä¹‹å¤–é‡æ–°æ¢æµ‹çš„æ–¹å¼è¿˜æœ‰ <strong>äºŒæ¬¡æ¢æµ‹(Quadratic probing)</strong>å’Œ <strong>åŒé‡æ•£åˆ—(Double hashing)</strong></p></blockquote></li><li><p><strong>é“¾è¡¨æ³•</strong></p><p>â€‹    é“¾è¡¨æ³•æ˜¯ä¸€ç§æ›´åŠ å¸¸ç”¨çš„æ•£åˆ—å†²çªè§£å†³åŠæ³•ï¼Œç›¸æ¯”å¼€æ”¾å¯»å€æ³•ï¼Œå®ƒè¦ç®€å•å¾ˆå¤šã€‚æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå›¾ï¼Œåœ¨æ•£åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªâ€œæ¡¶ï¼ˆbucketï¼‰â€æˆ–è€…â€œæ§½ï¼ˆslotï¼‰â€ä¼šå¯¹åº”ä¸€æ¡é“¾è¡¨ï¼Œæ‰€æœ‰æ•£åˆ—å€¼ç›¸åŒçš„å…ƒç´ æˆ‘ä»¬éƒ½æ”¾åˆ°ç›¸åŒæ§½ä½å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚</p><p>â€‹    æ’å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ•£åˆ—æ§½ä½ï¼Œå°†å…¶æ’å…¥åˆ°å¯¹åº”é“¾è¡¨ä¸­å³å¯ï¼Œæ‰€ä»¥æ’å…¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚å½“æŸ¥æ‰¾ã€åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ§½ï¼Œç„¶åéå†é“¾è¡¨æŸ¥æ‰¾æˆ–è€…åˆ é™¤ã€‚</p><p>â€‹    <strong>æˆ‘ä»¬åœ¨HashMapä¸­é‡‡ç”¨çš„æ­£æ˜¯é“¾è¡¨æ³•ï¼Œè€Œä¸”åœ¨é“¾è¡¨è¿‡é•¿æ—¶è¿˜ä¼šè½¬åŒ–æˆä¸ºçº¢é»‘æ ‘ï¼Œæ¥ä¿è¯æ•ˆç‡ã€‚</strong></p></li></ol><h3 id="3ã€HashMapä¸­çš„æ•°æ®ç»“æ„å®ç°"><a href="#3ã€HashMapä¸­çš„æ•°æ®ç»“æ„å®ç°" class="headerlink" title="3ã€HashMapä¸­çš„æ•°æ®ç»“æ„å®ç°"></a>3ã€HashMapä¸­çš„æ•°æ®ç»“æ„å®ç°</h3><h4 id="Bucketæ•°ç»„"><a href="#Bucketæ•°ç»„" class="headerlink" title="Bucketæ•°ç»„"></a>Bucketæ•°ç»„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment"> * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment"> * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment"> * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure><p>Bucketæ•°ç»„å°±æ˜¯ä¸€ä¸ªNode<K,V>ç±»å‹çš„æ•°ç»„ï¼Œä½¿ç”¨äº†<code>transient</code>å…³é”®å­—ä¿®é¥°</p><blockquote><ol><li>ä¸€æ—¦å˜é‡è¢«transientä¿®é¥°ï¼Œå˜é‡å°†ä¸å†æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥å˜é‡å†…å®¹åœ¨åºåˆ—åŒ–åæ— æ³•è·å¾—è®¿é—®ã€‚</li><li>transientå…³é”®å­—åªèƒ½ä¿®é¥°å˜é‡ï¼Œè€Œä¸èƒ½ä¿®é¥°æ–¹æ³•å’Œç±»ã€‚æ³¨æ„ï¼Œæœ¬åœ°å˜é‡æ˜¯ä¸èƒ½è¢«transientå…³é”®å­—ä¿®é¥°çš„ã€‚å˜é‡å¦‚æœæ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»å˜é‡ï¼Œåˆ™è¯¥ç±»éœ€è¦å®ç°Serializableæ¥å£ã€‚</li><li>ä¸€ä¸ªé™æ€å˜é‡ä¸ç®¡æ˜¯å¦è¢«transientä¿®é¥°ï¼Œå‡ä¸èƒ½è¢«åºåˆ—åŒ–ã€‚ </li></ol></blockquote><p>åœ¨HashMapæºç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¯ä»¥çœ‹åˆ°transientä¿®é¥°å…¶å›ºæœ‰å±æ€§ï¼Œå¤§æ¦‚æ˜¯ä¸ºäº†åºåˆ—åŒ–çš„å®‰å…¨æ€§ã€‚</p><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node<K, V></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Basic hash bin node, used for most entries.  (See below for</span></span><br><span class="line"><span class="comment">     * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.hash = hash;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">            V oldValue = value;</span><br><span class="line">            value = newValue;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                    Objects.equals(value, e.getValue()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Nodeç±»æ˜¯HashMapçš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entry<K, V>æ¥å£ã€‚</p><p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒNodeçš„å±æ€§æœ‰Kçš„Hashå€¼ï¼Œå…·ä½“çš„Keyã€Valueä»¥åŠæŒ‡å‘ä¸‹ä¸€ä¸ªNodeçš„NextæŒ‡é’ˆã€‚</p><p>åŒæ—¶ï¼ŒNodeä¹Ÿå¯¹å…¶çˆ¶æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•è¿›è¡Œäº†å…·ä½“çš„å®ç°. </p><h4 id="EntrySet"><a href="#EntrySet" class="headerlink" title="EntrySet"></a>EntrySet</h4><p>é€šå¸¸æˆ‘ä»¬åœ¨éå†ä¸€ä¸ªMapçš„æ—¶å€™ï¼Œé€šå¸¸ç›´æ¥ä½¿ç”¨ä½¿ç”¨å®ƒçš„<code>entrySet()</code>æ–¹æ³•è¿›è¡Œéå†ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String, String&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//set sth into hashmap ...</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; stringStringEntry : hashMap.entrySet()) &#123;</span><br><span class="line">            System.out.println(stringStringEntry.getKey());</span><br><span class="line">            System.out.println(stringStringEntry.getValue());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>åœ¨HashMapçš„æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°entrySet()æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a &#123;<span class="doctag">@link</span> Set&#125; view of the mappings contained in this map.</span></span><br><span class="line"><span class="comment"> * The set is backed by the map, so changes to the map are</span></span><br><span class="line"><span class="comment"> * reflected in the set, and vice-versa.  If the map is modified</span></span><br><span class="line"><span class="comment"> * while an iteration over the set is in progress (except through</span></span><br><span class="line"><span class="comment"> * the iterator's own &lt;tt&gt;remove&lt;/tt&gt; operation, or through the</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;setValue&lt;/tt&gt; operation on a map entry returned by the</span></span><br><span class="line"><span class="comment"> * iterator) the results of the iteration are undefined.  The set</span></span><br><span class="line"><span class="comment"> * supports element removal, which removes the corresponding</span></span><br><span class="line"><span class="comment"> * mapping from the map, via the &lt;tt&gt;Iterator.remove&lt;/tt&gt;,</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;Set.remove&lt;/tt&gt;, &lt;tt&gt;removeAll&lt;/tt&gt;, &lt;tt&gt;retainAll&lt;/tt&gt; and</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;clear&lt;/tt&gt; operations.  It does not support the</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;add&lt;/tt&gt; or &lt;tt&gt;addAll&lt;/tt&gt; operations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a set view of the mappings contained in this map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">    Set&lt;Map.Entry&lt;K,V&gt;&gt; es;</span><br><span class="line">    <span class="keyword">return</span> (es = entrySet) == <span class="keyword">null</span> ? (entrySet = <span class="keyword">new</span> EntrySet()) : es;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¸å¾—ä¸è®©äººå‘è§‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨å•çº¯è°ƒç”¨entrySetè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œåªæ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„entrySetï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨entrySetä¸­è®¿é—®åˆ°HashMapçš„keyå’Œvalueå€¼å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»EntrySetçš„æºç è¿›è¡Œåˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span>                 </span>&#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span>               </span>&#123; HashMap.<span class="keyword">this</span>.clear(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntryIterator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Map.Entry))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class="line">        Object key = e.getKey();</span><br><span class="line">        Node&lt;K,V&gt; candidate = getNode(hash(key), key);</span><br><span class="line">        <span class="keyword">return</span> candidate != <span class="keyword">null</span> &amp;&amp; candidate.equals(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;</span><br><span class="line">            Object key = e.getKey();</span><br><span class="line">            Object value = e.getValue();</span><br><span class="line">            <span class="keyword">return</span> removeNode(hash(key), key, value, <span class="keyword">true</span>, <span class="keyword">true</span>) != <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Spliterator&lt;Map.Entry&lt;K,V&gt;&gt; spliterator() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySpliterator&lt;&gt;(HashMap.<span class="keyword">this</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> Map.Entry&lt;K,V&gt;&gt; action)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab;</span><br><span class="line">        <span class="keyword">if</span> (action == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span> &amp;&amp; (tab = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> mc = modCount;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="keyword">null</span>; e = e.next)</span><br><span class="line">                    action.accept(e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (modCount != mc)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸ªé—®é¢˜ï¼ŒEntrySetæ˜¯ç»§æ‰¿è‡ªAbstractSetç±»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒEntrySetæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªSeté›†åˆï¼Œè€Œå¯¹äºä¸€ä¸ªSeté›†åˆï¼Œæˆ‘ä»¬åº”å½“æ˜ç™½ï¼š</p><blockquote><p>Setä¸æä¾›Getæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥è·å–Setä¸­çš„å…ƒç´  . </p><p>å¯¹äºä¸€ä¸ªSeté›†åˆï¼Œæˆ‘ä»¬æƒ³è¦å¯¹ä»–è¿›è¡Œéå†ï¼Œåªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li>ä½¿ç”¨è¿­ä»£å™¨Iteratorè¿›è¡Œè¿­ä»£</li><li>ä½¿ç”¨å¢å¼ºforå¾ªç¯</li></ol><p>è€Œå¢å¼ºforå¾ªç¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä½¿ç”¨äº†è¿­ä»£å™¨ã€‚</p></blockquote><p>ç”±äºEntrySetåªèƒ½è¢«è¿­ä»£å™¨è®¿é—®åˆ°å…¶ä¸­å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…³æ³¨Iteratoræ–¹æ³•ä¸­è°ƒç”¨çš„<strong>new EntryIterator()</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryIterator</span> <span class="keyword">extends</span> <span class="title">HashIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Map.<span class="function">Entry&lt;K,V&gt; <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> nextNode(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">nextNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] t;</span><br><span class="line">    Node&lt;K,V&gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">if</span> ((next = (current = e).next) == <span class="keyword">null</span> &amp;&amp; (t = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EntryIteratorè¿­ä»£å™¨çš„next()æ–¹æ³•ï¼Œæ˜¯è·å–HashMapä¸­çš„nextå…ƒç´ ï¼Œæ‰€ä»¥å®é™…ä¸Šåœ¨è¿™é‡Œè¿­ä»£åˆ°çš„ï¼Œæ˜¯HashMapçš„å…ƒç´ ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆEntrySetæ˜¯æœ‰å€¼çš„åŸå› .</p><p>â€‹    ä»¥ä¸Šï¼ğŸ™</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DataStructure </tag>
            
            <tag> Algorithm </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMapçš„å·¥ä½œåŸç†(ä¸€)ï¼šHashç®—æ³•</title>
      <link href="/2020/06/07/HashMap%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%E4%B8%80-%EF%BC%9AHash%E7%AE%97%E6%B3%95/"/>
      <url>/2020/06/07/HashMap%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%E4%B8%80-%EF%BC%9AHash%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯Hash"><a href="#1ã€ä»€ä¹ˆæ˜¯Hash" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Hash"></a>1ã€ä»€ä¹ˆæ˜¯Hash</h3><p>â€‹    Hashä¹Ÿè¢«ç§°ä¸ºæ•£åˆ—ã€å“ˆå¸Œï¼Œå¯¹åº”çš„è‹±æ–‡éƒ½æ˜¯Hash.ä»–ä»¬çš„åŸºæœ¬åŸç†éƒ½æ˜¯<strong>æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡Hashç®—æ³•å˜æˆå›ºå®šé•¿åº¦çš„è¾“å‡º.</strong>è¿™ä¸ªæ˜ å°„çš„è§„åˆ™å°±æ˜¯å¯¹åº”çš„Hashç®—æ³•ï¼Œè€ŒåŸå§‹æ•°æ®æ˜ å°„ä¹‹åçš„äºŒè¿›åˆ¶ä¸²å°±æ˜¯å“ˆå¸Œå€¼. ç»å¸¸ä½¿ç”¨çš„Hashç®—æ³•æœ‰MD5å’ŒSHAï¼Œä»–ä»¬éƒ½æ˜¯å†å²æ‚ ä¹…çš„Hashç®—æ³•.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"Hashç®—æ³•"</span>;</span><br><span class="line">System.err.println(md5(s));</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼šf1ab62697296f0b575b9229dba7ea1ba</span></span><br></pre></td></tr></table></figure><p>â€‹    è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&quot;Hashç®—æ³•&quot;</code>æ˜¯åŸå§‹å€¼ï¼Œ<code>f1ab62697296f0b575b9229dba7ea1ba</code>åˆ™æ˜¯é€šè¿‡è¿™ç§md5çš„hashç®—æ³•å¾—åˆ°çš„Hashå€¼ã€‚æ•´ä¸ªHashç®—æ³•çš„è¿‡ç¨‹å°±æ˜¯<strong>æŠŠåŸå§‹ä»»æ„é•¿åº¦çš„å€¼ç©ºé—´æ˜ å°„æˆå›ºå®šé•¿åº¦çš„å€¼ç©ºé—´çš„è¿‡ç¨‹</strong>.</p><blockquote><p>å¯¹äºHashç®—æ³•æ¥è¯´ï¼Œä¸»è¦ä¼šåœ¨æ•°æ®ç»“æ„å’Œå¯†ç å­¦ä¸­å¾—åˆ°åº”ç”¨ï¼Œåœ¨è¿™ä¸¤ç§ä¸åŒçš„é¢†åŸŸï¼Œç®—æ³•çš„è®¾è®¡é‡ç‚¹ä¹Ÿæ˜¯ä¸åŒçš„.</p></blockquote><h3 id="2ã€Hashç®—æ³•çš„ç‰¹ç‚¹"><a href="#2ã€Hashç®—æ³•çš„ç‰¹ç‚¹" class="headerlink" title="2ã€Hashç®—æ³•çš„ç‰¹ç‚¹"></a>2ã€Hashç®—æ³•çš„ç‰¹ç‚¹</h3><p>â€‹    hashç®—æ³•ä½œä¸ºä¸€ä¸ªç®—æ³•ï¼Œæœ‰è®¸å¤šä¸åŒçš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ä¸Šé¢è¯´çš„MD5æˆ–è€…SHA. è¿™äº›ç®—æ³•é™¤äº†æ»¡è¶³ä¸Šè¿°Hashçš„åŸºæœ¬åŠŸèƒ½ä¹‹å¤–ï¼Œä¹Ÿéœ€è¦æœ‰å…¶ä»–çš„ç‰¹ç‚¹æ¥ç¡®ä¿ä»–æ˜¯ä¸€ä¸ªå¯ç”¨çš„ã€åˆç†çš„ã€ä¼˜ç§€çš„Hashç®—æ³•. </p><ul><li><p>ä»Hashå€¼<strong>ä¸å¯ä»¥</strong>åå‘æ¨å¯¼å‡ºåŸå§‹çš„æ•°æ®</p><p>ç»è¿‡Hashæ˜ å°„ä¹‹åçš„æ•°æ®å’ŒåŸå§‹æ•°æ®æ²¡æœ‰å¯¹åº”å…³ç³»</p></li><li><p>Hashç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦é«˜æ•ˆï¼Œé•¿çš„æ–‡æœ¬æˆ–å­—ç¬¦ä¸²èƒ½å¤Ÿå¾ˆå¿«çš„è®¡ç®—å‡ºå“ˆå¸Œå€¼</p></li><li><p>è¾“å…¥æ•°æ®çš„å¾®å°å˜åŒ–ä¼šå¾—åˆ°<strong>å®Œå…¨ä¸åŒ</strong>çš„Hashå€¼ï¼Œç›¸åŒçš„æ•°æ®ä¼šå¾—åˆ°ç›¸åŒçš„å€¼</p><p>è¿™é‡Œä¹Ÿå¯ä»¥è¯´Hashç®—æ³•çš„<strong>æŠ—ç¯¡æ”¹èƒ½åŠ›ï¼šå¯¹äºä¸€ä¸ªæ•°æ®å—ï¼Œå“ªæ€•åªä¿®æ”¹ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œå…¶Hashå€¼çš„æ”¹åŠ¨ä¹Ÿä¼šéå¸¸å¤§. </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"Hashç®—æ³•"</span>;</span><br><span class="line">System.err.println(md5(s));</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼šf1ab62697296f0b575b9229dba7ea1ba</span></span><br><span class="line">String s = <span class="string">"Hashç®—æ³•"</span>;</span><br><span class="line">System.err.println(md5(s));</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœï¼šd789d51b7005d2d55c23bbfc4367d97d</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå®ä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯æ”¹å˜äº†ä¸€ä¸ªå­—ç¬¦ï¼Œå´èƒ½å¯¼è‡´ä¸¤ä¸ªhashå€¼å‡ ä¹æ¯ä¸€ä½éƒ½ä¸åŒ.</p></li><li><p>Hashç®—æ³•çš„å†²çªæ¦‚ç‡è¦å°</p><p>Hashç®—æ³•çš„åŸç†æ˜¯æŠŠè¾“å…¥ç©ºé—´çš„å€¼æ˜ å°„åˆ°Hashç©ºé—´å†…ï¼Œç”±äºHashå€¼çš„ç©ºé—´è¿œå°äºè¾“å…¥çš„ç©ºé—´ï¼Œè€Œä¸”å€ŸåŠ©<strong>æŠ½å±‰åŸç†</strong>ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºâ€”â€”ä¸€å®šä¼šå­˜åœ¨ä¸åŒçš„è¾“å…¥è¢«æ˜ å°„æˆç›¸åŒè¾“å‡ºçš„æƒ…å†µï¼Œå¦‚æœä¸€ä¸ªHashç®—æ³•è¶³å¤Ÿå¥½ï¼Œé‚£ä¹ˆä»–å°±ä¸€å®šä¼šæœ‰æ›´å°çš„å‘ç”Ÿå†²çªçš„æ¦‚ç‡.  ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¥½çš„Hashç®—æ³•åº”è¯¥å…·æœ‰ä¼˜ç§€çš„<strong>æŠ—ç¢°æ’èƒ½åŠ›</strong></p><p><strong>æŠ—ç¢°æ’èƒ½åŠ›ï¼šå¯¹äºä»»æ„ä¸¤ä¸ªä¸åŒçš„æ•°æ®å—ï¼Œå…¶Hashå€¼ç›¸åŒçš„å¯èƒ½æ€§æå°ï¼›å¯¹äºä¸€ä¸ªç»™å®šçš„æ•°æ®å—ï¼Œæ‰¾åˆ°ä¸€ä¸ªå’Œä»–Hashå€¼ç›¸åŒçš„æ•°æ®å—æ˜¯æä¸ºå›°éš¾çš„. </strong></p><blockquote><p><strong>æŠ½å±‰åŸç†</strong></p><p>æ¡Œä¸Šæœ‰åä¸ªè‹¹æœï¼Œè¦æŠŠè¿™åä¸ªè‹¹æœæ”¾åˆ°ä¹ä¸ªæŠ½å±‰é‡Œï¼Œæ— è®ºæ€æ ·æ”¾ï¼Œæˆ‘ä»¬ä¼šå‘ç°è‡³å°‘ä¼šæœ‰ä¸€ä¸ªæŠ½å±‰é‡Œé¢æ”¾ä¸å°‘äºä¸¤ä¸ªè‹¹æœã€‚è¿™ä¸€ç°è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œæŠ½å±‰åŸç†â€ã€‚æŠ½å±‰åŸç†çš„ä¸€èˆ¬å«ä¹‰ä¸ºï¼šâ€œå¦‚æœæ¯ä¸ªæŠ½å±‰ä»£è¡¨ä¸€ä¸ªé›†åˆï¼Œæ¯ä¸€ä¸ªè‹¹æœå°±å¯ä»¥ä»£è¡¨ä¸€ä¸ªå…ƒç´ ï¼Œå‡å¦‚æœ‰n+1ä¸ªå…ƒç´ æ”¾åˆ°nä¸ªé›†åˆä¸­å»ï¼Œå…¶ä¸­å¿…å®šæœ‰ä¸€ä¸ªé›†åˆé‡Œè‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´ ã€‚â€ æŠ½å±‰åŸç†æœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºé¸½å·¢åŸç†ã€‚å®ƒæ˜¯ç»„åˆæ•°å­¦ä¸­ä¸€ä¸ªé‡è¦çš„åŸç†</p></blockquote></li></ul><h3 id="3ã€æ•°æ®ç»“æ„ä¸­çš„Hash"><a href="#3ã€æ•°æ®ç»“æ„ä¸­çš„Hash" class="headerlink" title="3ã€æ•°æ®ç»“æ„ä¸­çš„Hash"></a>3ã€æ•°æ®ç»“æ„ä¸­çš„Hash</h3><p>â€‹    åœ¨ä½¿ç”¨åˆ°Hashè¿›è¡Œç®¡ç†çš„æ•°æ®ç»“æ„ä¸­ï¼Œæ¯”å¦‚HashMapï¼Œåœ¨è¿™ç§æ•°æ®ç»“æ„ä¸­ï¼ŒHashå€¼ï¼ˆKeyï¼‰å­˜åœ¨çš„ç›®çš„å°±æ˜¯<strong>åŠ é€Ÿé”®å€¼å¯¹çš„æŸ¥æ‰¾</strong>ï¼Œå› ä¸ºHashMapçš„æ¡¶æ•°ç»„çš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”HashMapä¹Ÿé‡‡ç”¨äº†ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è¿›è¡Œç¢°æ’å¤„ç†ï¼Œæ‰€ä»¥å¯¹äºæ•°æ®ç»“æ„ä¸­çš„Hashï¼Œå¯¹æŠ—ç¢°æ’èƒ½åŠ›çš„è¦æ±‚å¹¶ä¸æ˜¯å¾ˆé«˜. </p><p>â€‹    ä½†æ˜¯å¯¹äºHashMapçš„setæ“ä½œï¼Œéœ€è¦å®ç°å¿«é€Ÿå­˜å‚¨ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æ±‚Hashç®—æ³•çš„é€Ÿåº¦å°½å¯èƒ½çš„å¿«äº†. </p><h3 id="4ã€å¯†ç å­¦ä¸­çš„Hash"><a href="#4ã€å¯†ç å­¦ä¸­çš„Hash" class="headerlink" title="4ã€å¯†ç å­¦ä¸­çš„Hash"></a>4ã€å¯†ç å­¦ä¸­çš„Hash</h3><p>â€‹    åœ¨å¯†ç å­¦ä¸­ï¼ŒHashç®—æ³•çš„ä½œç”¨ä¸»è¦åœ¨äºæ¶ˆæ¯æ‘˜è¦æˆ–è€…æ˜¯ç­¾å. æ¯”å¦‚æˆ‘ä»¬åœ¨ç™»å½•æŸäº›ç½‘ç«™çš„æ—¶å€™ï¼Œéœ€è¦è¾“å…¥å¯†ç æ¥å®Œæˆç™»é™†æ“ä½œï¼Œå¯¹äºè¿™äº›ç½‘ç«™çš„è¿è¥å•†æ¥è¯´ï¼Œæ˜æ–‡ä¿å­˜å¯†ç æ˜¯ä¸‡ä¸‡ä¸å¯çš„ï¼Œæ‰€ä»¥å¤§éƒ¨é—¨ç½‘ç«™çš„è§£å†³æ–¹å¼å°±æ˜¯ç”¨Hashç®—æ³•å»ç”Ÿæˆå¯†ç çš„ç­¾åä¹Ÿå°±æ˜¯ä»–çš„Hashå€¼ï¼Œè¿è¥å•†åå°å»ä¿å­˜è¿™ä¸ªHashå€¼. ç”±äºHashç®—æ³•çš„ä¸å¯é€†çš„ç‰¹ç‚¹ï¼Œå³ä½¿é»‘å®¢æ‹¿åˆ°äº†è¿™ä¸ªHashå€¼ï¼Œä¹Ÿä¸å¯ä»¥æ¨å‡ºå¯†ç . </p><p>â€‹    è¿™æ ·çš„åœºæ™¯é‡Œé¢ï¼ŒHashç®—æ³•çš„é€Ÿåº¦æ˜¾å¾—å¹¶ä¸æ˜¯é‚£ä¹ˆé‡è¦äº†ï¼Œä¸ä¹‹ç›¸å¯¹çš„ï¼ŒæŠ—ç¢°æ’å’ŒæŠ—ç¯¡æ”¹èƒ½åŠ›è¦æ±‚æé«˜. ä¸€ä¸ªä¼˜ç§€çš„Hashç®—æ³•ä»–çš„æŠ—ç¢°æ’èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„. ä»¥MD5ä¸ºä¾‹ï¼Œè¾“å‡ºé•¿åº¦ä¸º128ä½ï¼Œè®¾è®¡é¢„æœŸçš„ç¢°æ’æ¦‚ç‡æ˜¯<strong>1/2<sup>64</sup></strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªæå°çš„æ•°å­—. </p><blockquote><p>2004å¹´8æœˆ17æ—¥çš„ç¾å›½åŠ å·åœ£å·´å·´æ‹‰ï¼Œæ­£åœ¨å¬å¼€çš„å›½é™…å¯†ç å­¦ä¼šè®®ï¼ˆCryptoâ€™2004ï¼‰å®‰æ’äº†ä¸‰åœºå…³äºæ‚å‡‘å‡½æ•°çš„ç‰¹åˆ«æŠ¥å‘Šã€‚å…¶ä¸­æ¥è‡ªå±±ä¸œå¤§å­¦çš„ç‹å°äº‘æ•™æˆåšäº†ç ´è¯‘MD5ã€HAVAL-128ã€ MD4å’ŒRIPEMDç®—æ³•çš„æŠ¥å‘Šã€‚</p><p>åœ¨ä¼šåœºä¸Šï¼Œå½“å¥¹å…¬å¸ƒäº†MDç³»åˆ—ç®—æ³•çš„ç ´è§£ç»“æœä¹‹åï¼ŒæŠ¥å‘Šè¢«æ¿€åŠ¨çš„æŒå£°æ‰“æ–­ã€‚å¥¹çš„ç ”ç©¶æˆæœä½œä¸ºå¯†ç å­¦é¢†åŸŸçš„é‡å¤§å‘ç°å®£å‘Šäº†å›ºè‹¥é‡‘æ±¤çš„ä¸–ç•Œé€šè¡Œå¯†ç æ ‡å‡†MDï¼•çš„å ¡å’è½°ç„¶å€’å¡Œï¼Œå¼•å‘äº†å¯†ç å­¦ç•Œçš„è½©ç„¶å¤§æ³¢ã€‚</p><p>ç»è¿‡äº†ç‹å°äº‘æ•™æˆçš„ç ´è§£ä¹‹åï¼ŒMD5çš„ç¢°æ’ä¸Šé™è¢«é™ä½è‡³1/2<sup>41</sup></p></blockquote><p>â€‹    å³ä½¿æ˜¯é™ä½åˆ°äº†1/2<sup>41</sup>ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç»è¿‡<strong>2<sup>40</sup></strong>æ¬¡æŸ¥æ‰¾ï¼Œæ‰èƒ½æœ‰1/2çš„æ¦‚ç‡æ¥æ‰¾åˆ°ä¸€ä¸ªå’Œç›®æ ‡æ–‡ä»¶ç›¸åŒçš„Hashå€¼.  </p><h3 id="5ã€Random-Oracle"><a href="#5ã€Random-Oracle" class="headerlink" title="5ã€Random Oracle"></a>5ã€Random Oracle</h3><blockquote><p>æœ‰æ²¡æœ‰å¯èƒ½æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªç®—æ³•ï¼Œå¦‚æœè¾“å‡ºé•¿åº¦ä¸º128ä½ï¼Œé‚£ä¹ˆæŠŠè¿™128ä½â€œå……åˆ†åˆ©ç”¨åˆ°â€ï¼Œè®©å®ƒå¯ä»¥æœ‰1/2<sup>128</sup>ç§ä¸åŒçš„hashå€¼ï¼Œè€Œä¸”åˆ†å¸ƒå‡åŒ€ï¼ŒæŠ—ç¯¡æ”¹èƒ½åŠ›ä¹Ÿç‰¹åˆ«é«˜ï¼Œä¸€ç‚¹ç‚¹æ”¹åŠ¨å°±ä¼šè®©hashå€¼é¢ç›®å…¨éï¼Œä¸€ç‚¹éƒ½ä¸æµªè´¹ï¼ˆè¿™é‡Œçš„è¡¨è¿°éå¸¸ä¸ä¸¥æ ¼ï¼‰ï¼Ÿç¨å¾®ä¸¥æ ¼ä¸€ç‚¹è¡¨è¿°ï¼Œå°±æ˜¯ï¼š<strong>æœ‰æ²¡æœ‰è¿™æ ·ä¸€ä¸ªç®—æ³•ï¼Œä½¿å¾—å¯¹äºä»»ä½•ä¸€ä¸ªç»™å®šçš„è¾“å…¥ï¼Œæ­¤ç®—æ³•éƒ½ä¼šè¾“å‡ºä¸€ä¸ªå›ºå®šçš„å‡åŒ€éšæœºçš„è¾“å‡ºï¼Ÿ</strong></p></blockquote><p>é—®é¢˜çš„ç­”æ¡ˆæ˜¯å¯†ç å­¦å®¶ä»¬åˆ°ç°åœ¨ä¹Ÿæ²¡æœ‰èƒ½åŠ›å»æ„é€ å‡ºä¸€ä¸ªè¿™æ ·çš„ç®—æ³•ï¼Œä½†æ˜¯å¤§å®¶æ›´åŠ å€¾å‘äºè¿™ä¸ªç®—æ³•æ˜¯å­˜åœ¨çš„ï¼Œè€Œä¸”æœ‰ä¸å°‘çš„å¯†ç å­¦ç®—æ³•æ„é€ å’Œè¿™ä¸ªå‡è®¾æœ‰å…³ï¼Œè¿™ä¸ªå‡è®¾çš„åå­—å°±æ˜¯Random Oracleï¼ˆéšæœºé¢„è¨€æœºï¼‰</p><h3 id="6ã€Hashçš„åº”ç”¨"><a href="#6ã€Hashçš„åº”ç”¨" class="headerlink" title="6ã€Hashçš„åº”ç”¨"></a>6ã€Hashçš„åº”ç”¨</h3><ul><li><p>åº”ç”¨ä¸€ï¼š<strong>å®‰å…¨åŠ å¯†</strong></p><p>ä¸Šè¿°çš„å¯†ç å­¦ä¸­çš„Hashï¼Œåœ¨å®‰å…¨åŠ å¯†çš„åº”ç”¨æ¯”è¾ƒå¹¿æ³›. </p><p>ä¸è¿‡éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œç°åœ¨çš„ä¸–ç•Œä¸Šæ²¡æœ‰ä¸€ä¸ªç»å¯¹å®‰å…¨çš„åŠ å¯†. è¶Šå¤æ‚ã€è¶Šéš¾ç ´è§£çš„åŠ å¯†ç®—æ³•ï¼Œéœ€è¦è®¡ç®—çš„æ—¶é—´å°±è¶Šé•¿. å¯†ç å­¦ç•Œä¸€ç›´åœ¨è‡´åŠ›å»æ‰¾ä¸€ç§å¯ä»¥å¿«é€Ÿç”Ÿæˆå¹¶ä¸”å¾ˆéš¾è¢«ç ´è§£çš„Hashç®—æ³•. è€Œä¸”æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä¹Ÿéœ€è¦æƒè¡¡ç ´è§£éš¾åº¦å’Œè®¡ç®—æ—¶é—´ï¼Œæ¥å†³å®šç©¶ç«Ÿä½¿ç”¨å“ªç§åŠ å¯†ç®—æ³•. </p></li><li><p>åº”ç”¨äºŒï¼š<strong>å”¯ä¸€æ ‡è¯†</strong></p><p>ç”±äºHashç®—æ³•çš„æŠ—ç¢°æ’èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€äº›éš¾ä»¥æŸ¥æ‰¾ã€æ¯”è¾ƒçš„æ–‡ä»¶æˆ–è€…å…¶ä»–çš„æ•°æ®è¿›è¡ŒHashè®¡ç®—ï¼Œç”Ÿæˆä¸€ä¸ªHashå€¼ï¼Œä¹Ÿå°±æ˜¯ä»–çš„å”¯ä¸€æ ‡è¯†. è¿™æ ·å»åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨è¿™æ ·çš„æ“ä½œå°±ä¼šç®€å•å¾ˆå¤š. </p></li><li><p>åº”ç”¨ä¸‰ï¼š<strong>æ•°æ®æ ¡éªŒ</strong></p><p>BTç§å­ä¸‹è½½è½¯ä»¶çš„åŸç†æ˜¯åŸºäºP2Påè®®çš„ï¼Œä»å¤šä¸ªæœºå™¨ä¸Šä¸‹è½½ä¸€ä¸ª2GBçš„ç”µå½±ï¼Œè¿™ä¸ªç”µå½±æ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ†æˆå¾ˆå¤šå—ï¼Œç­‰æ‰€æœ‰å—ä¸‹è½½å¥½ç„¶åç»„è£…æˆä¸€ä¸ªå®Œæ•´ç”µå½±. </p><p>ç½‘ç»œä¼ è¾“æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸‹è½½å‡ºæ¥çš„æ–‡ä»¶å—æ˜¯å¯èƒ½ä¸å®Œæ•´çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¯¹æ–‡ä»¶å—è¿›è¡ŒHashè¿ç®—ï¼Œåœ¨ä¸‹è½½ä¹‹åå’Œä¹‹å‰çš„Hashå€¼è¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥è¿›è¡Œæ•°æ®æ ¡éªŒ. </p></li><li><p>åº”ç”¨å››ï¼š<strong>æ•£åˆ—å‡½æ•°</strong></p><p>åŸºæœ¬ç”¨åœ¨æ•°æ®ç»“æ„ä¸­ï¼Œæ•£åˆ—è¡¨çš„å®ç°. </p></li><li><p>åº”ç”¨äº”ï¼š<strong>è´Ÿè½½å‡è¡¡</strong></p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦åº”ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼å»å°†ä¼šè¯çš„è¯·æ±‚åˆ†å‘ç»™ä¸åŒçš„æœåŠ¡å™¨. è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Hashç®—æ³•å¯¹å®¢æˆ·ç«¯IPè¿›è¡Œè®¡ç®—Hashå€¼ï¼Œä¸æœåŠ¡å™¨åˆ—è¡¨å¤§å°è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œè·å–å¯¹åº”éœ€è¦è¢«è·¯ç”±é“çš„æœåŠ¡å™¨ç¼–å·. </p></li><li><p>åº”ç”¨å…­ï¼š<strong>æ•°æ®åˆ†ç‰‡</strong></p><p>ä¸€èˆ¬éƒ½åœ¨åº”ç”¨äºåˆ†å¸ƒå¼è§£å†³é—®é¢˜ï¼Œåˆ†æ²»çš„æ€æƒ³ï¼Œé€šè¿‡Hashæ¥è¿›è¡Œåˆ†åŒºåŸŸåˆ†ç‰‡å®ç°â€œåˆ†â€çš„æ“ä½œ.</p></li><li><p>åº”ç”¨ä¸ƒï¼š<strong>åˆ†å¸ƒå¼å­˜å‚¨</strong></p><p>é€šè¿‡Hashå€¼ç¡®å®šæ•°æ®è¦å­˜å‚¨åˆ°å“ªå°æœºå™¨ä¸Šï¼›å¦‚æœæœºå™¨æ–°å¢äº†ï¼Œæ•°é‡æ”¹å˜äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>ä¸€è‡´æ€§hashç®—æ³•</strong>æ¥é¿å…å¤§é‡çš„æ•°æ®æ¬è¿. </p></li></ul><h3 id="7ã€ä¸€è‡´æ€§Hashç®—æ³•"><a href="#7ã€ä¸€è‡´æ€§Hashç®—æ³•" class="headerlink" title="7ã€ä¸€è‡´æ€§Hashç®—æ³•"></a>7ã€ä¸€è‡´æ€§Hashç®—æ³•</h3><blockquote><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨1997å¹´ç”±éº»çœç†å·¥å­¦é™¢æå‡ºï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•ï¼Œç›®çš„æ˜¯è§£å†³åˆ†å¸ƒå¼ç¼“å­˜çš„é—®é¢˜ã€‚ åœ¨ç§»é™¤æˆ–è€…æ·»åŠ ä¸€ä¸ªæœåŠ¡å™¨æ—¶ï¼Œèƒ½å¤Ÿå°½å¯èƒ½å°åœ°æ”¹å˜å·²å­˜åœ¨çš„æœåŠ¡è¯·æ±‚ä¸å¤„ç†è¯·æ±‚æœåŠ¡å™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ä¸€è‡´æ€§å“ˆå¸Œè§£å†³äº†ç®€å•å“ˆå¸Œç®—æ³•åœ¨åˆ†å¸ƒå¼å“ˆå¸Œè¡¨( Distributed Hash Tableï¼ŒDHT) ä¸­å­˜åœ¨çš„åŠ¨æ€ä¼¸ç¼©ç­‰é—®é¢˜</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DataStructure </tag>
            
            <tag> Algorithm </tag>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoåšå®¢çš„éƒ¨ç½²ä¸å›¾åºŠä½¿ç”¨</title>
      <link href="/2020/05/23/hexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%9B%BE%E5%BA%8A%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/05/23/hexo%E5%8D%9A%E5%AE%A2%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%9B%BE%E5%BA%8A%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å°†åšå®¢ç”¨hexoæ­å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥æ˜ç™½ï¼Œæˆ‘ä»¬çš„åšå®¢ä¸èƒ½ä¸€ç›´å¤„äºæœ¬åœ°ç¯å¢ƒå¯åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ªå¯ä»¥å…¬å…±è®¿é—®çš„ç½‘ç«™æ¥ä½¿ç”¨.</p><p>å¹¶ä¸”ä½œä¸ºæ”¯æŒmarkdownè¯­æ³•çš„åšå®¢ï¼Œåœ¨å†™åšæ–‡æ—¶æ’å…¥å›¾ç‰‡ä¹Ÿéœ€è¦å›¾åºŠçš„è®¾ç½®ã€‚</p></blockquote><h2 id="ä¸€ã€ä½¿ç”¨GitHub-pageséƒ¨ç½²hexoåšå®¢"><a href="#ä¸€ã€ä½¿ç”¨GitHub-pageséƒ¨ç½²hexoåšå®¢" class="headerlink" title="ä¸€ã€ä½¿ç”¨GitHub pageséƒ¨ç½²hexoåšå®¢"></a>ä¸€ã€ä½¿ç”¨GitHub pageséƒ¨ç½²hexoåšå®¢</h2><h3 id="æ–°å»ºä»“åº“"><a href="#æ–°å»ºä»“åº“" class="headerlink" title="æ–°å»ºä»“åº“"></a>æ–°å»ºä»“åº“</h3><p>â€‹    é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç™»å½•GitHubåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œæ¥ä½œä¸ºæˆ‘ä»¬åšå®¢æ–‡ç« åŠå…¶ä»–æ–‡ä»¶çš„å­˜å‚¨åœ°å€. åœ¨æˆ‘ä»¬æ›´æ–°æˆ–è€…è·å–åšå®¢æ—¶ï¼Œåªéœ€è¦å¯¹è¿™ä¸ªä»“åº“è¿›è¡Œcommitç­‰gitæ“ä½œå³å¯å®Œæˆæ›´æ–°ã€è·å–ç­‰æ“ä½œ.</p><p><strong>æ³¨æ„</strong></p><p>â€‹    æ–°å»ºä»“åº“çš„ä»“åº“åéœ€è¦æ ¼å¤–æ³¨æ„ï¼Œæˆ‘ä»¬æ–°å»ºä»“åº“åå­—å¿…é¡»æ»¡è¶³ï¼š</p><blockquote><p>â€œGitHubæ˜µç§°â€.github.io</p></blockquote><p>â€‹    æ¯”å¦‚ æˆ‘çš„GitHubæ˜µç§°æ˜¯<code>MagicStarLIN</code>ï¼Œé‚£ä¹ˆæˆ‘çš„ä»“åº“åå°±åº”è¯¥å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523183841443.png" alt="image-20200523183841443" style="zoom:50%;" /></p><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/MagicStarLIN/MagicStarLIN.github.io.git" target="_blank" rel="noopener">https://github.com/MagicStarLIN/MagicStarLIN.github.io.git</a></p><h3 id="å®‰è£…gitæ’ä»¶"><a href="#å®‰è£…gitæ’ä»¶" class="headerlink" title="å®‰è£…gitæ’ä»¶"></a>å®‰è£…gitæ’ä»¶</h3><p>â€‹    ä»“åº“æ–°å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„hexoç›®å½•æ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªgit deployçš„æ’ä»¶ï¼Œè¿™é‡Œå€ŸåŠ©cnpmæ¥å®Œæˆå®‰è£…ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-config-yml"><a href="#è®¾ç½®-config-yml" class="headerlink" title="è®¾ç½®_config.yml"></a>è®¾ç½®_config.yml</h3><p>æ’ä»¶å®Œæˆå®‰è£…ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹ymlé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®.</p><p>é…ç½®ä¸»è¦ä¼šåœ¨_config.ymlæ–‡ä»¶ä¸­çš„deployä¸€çº§å±æ€§ä¸‹è¿›è¡Œé…ç½®.è¿™é‡Œæˆ‘çš„githubä»“åº“åœ°å€ä¸º<code>https://github.com/MagicStarLIN/MagicStarLIN.github.io.git</code></p><p>åˆå§‹çš„_config.ymlæ–‡ä»¶çš„deployå±æ€§ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">''</span></span><br></pre></td></tr></table></figure><p>åŸºæœ¬å¤„äºä»€ä¹ˆéƒ½æ²¡æœ‰é…ç½®çš„çŠ¶æ€ï¼Œè¿™é‡Œæˆ‘ç›´æ¥å±•ç¤ºæˆ‘é…ç½®ä¹‹åçš„ymlæ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/MagicStarLIN/MagicStarLIN.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²åˆ°è¿œç«¯"><a href="#éƒ¨ç½²åˆ°è¿œç«¯" class="headerlink" title="éƒ¨ç½²åˆ°è¿œç«¯"></a>éƒ¨ç½²åˆ°è¿œç«¯</h3><p>ä½¿ç”¨hexoçš„å‘½ä»¤å®ç°éƒ¨ç½²è‡³GitHub pages</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo d</span><br></pre></td></tr></table></figure><p>å¦‚æœä¹‹å‰æ²¡æœ‰é…ç½®è¿‡gitè´¦å·å’Œå¯†ç ï¼Œé‚£ä¹ˆè¿™é‡Œç¬¬ä¸€æ¬¡éƒ¨ç½²åº”è¯¥ä¼šè¦æ±‚è¾“å…¥GitHubçš„è´¦å·å’Œå¯†ç .</p><p>è‡³æ­¤ï¼ŒæˆåŠŸä¹‹åï¼Œå°±å·²ç»å®Œæˆäº†åšå®¢çš„éƒ¨ç½².æˆ‘ä»¬å¯ä»¥è®¿é—®<code>&quot;GitHubæ˜µç§°&quot;.github.io</code>urlæ¥ç›´æ¥è®¿é—®è‡ªå·±çš„hexoåšå®¢.</p><h2 id="äºŒã€é…ç½®åšå®¢å›¾åºŠ"><a href="#äºŒã€é…ç½®åšå®¢å›¾åºŠ" class="headerlink" title="äºŒã€é…ç½®åšå®¢å›¾åºŠ"></a>äºŒã€é…ç½®åšå®¢å›¾åºŠ</h2><p>â€‹    æˆ‘ä»¬åœ¨å†™åšå®¢çš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦æ’å…¥ä¸€äº›å›¾ç‰‡(æ¯”å¦‚ä¸Šé¢çš„GitHubä»“åº“æˆªå›¾)ï¼Œè¿™ä¸ªæ—¶å€™å› ä¸ºmarkdownè¯­æ³•çš„å›¾ç‰‡æ’å…¥æ˜¯åŸºäºurlçš„é“¾æ¥è®¿é—®çš„. æ¯”å¦‚æˆ‘ä½¿ç”¨çš„æ˜¯<strong>Typoraç¼–è¾‘å™¨</strong>æ¥å†™markdownæ–‡æ¡£ï¼Œé‚£ä¹ˆä»–çš„å›¾ç‰‡ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°ç”µè„‘çš„æŸä¸ªå›ºå®šæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°æŸ¥çœ‹çš„markdownæ–‡æ¡£ä¸­çš„å›¾ç‰‡ï¼Œå°±æ˜¯è®¿é—®çš„ç”µè„‘ä¸­ä¿å­˜çš„å›¾ç‰‡. é‚£ä¹ˆå½“æˆ‘ä»¬éƒ¨ç½²åˆ°GitHubä¸Šçš„æ—¶å€™å°±ä¸èƒ½æŸ¥çœ‹åˆ°åšæ–‡ä¸­çš„å›¾ç‰‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©æ­å»ºå¥½çš„<strong>å›¾åºŠ</strong>æ¥è¿›è¡Œå›¾ç‰‡çš„è®¿é—®.</p><blockquote><p>å›¾åºŠä¸€èˆ¬æ˜¯æŒ‡å‚¨å­˜å›¾ç‰‡çš„æœåŠ¡å™¨ï¼Œæœ‰å›½å†…å’Œå›½å¤–ä¹‹åˆ†ã€‚å›½å¤–çš„å›¾åºŠç”±äºæœ‰ç©ºé—´è·ç¦»ç­‰å› ç´ å†³å®šè®¿é—®é€Ÿåº¦å¾ˆæ…¢å½±å“å›¾ç‰‡æ˜¾ç¤ºé€Ÿåº¦ã€‚å›½å†…ä¹Ÿåˆ†ä¸ºå•çº¿ç©ºé—´ã€å¤šçº¿ç©ºé—´å’ŒcdnåŠ é€Ÿä¸‰ç§ã€‚</p></blockquote><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li>markdownæ–‡æ¡£ç¼–è¾‘å™¨ï¼šTypora</li><li>å›¾åºŠï¼šé˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS</li><li>å›¾ç‰‡ä¸Šä¼ å·¥å…·ï¼šPicGo</li></ul><h3 id="å›¾åºŠæ­å»º"><a href="#å›¾åºŠæ­å»º" class="headerlink" title="å›¾åºŠæ­å»º"></a>å›¾åºŠæ­å»º</h3><p>é¦–å…ˆè´­ä¹°é˜¿é‡Œäº‘çš„OSSæœåŠ¡.</p><p>è®¿é—®<a href="https://www.aliyun.com/product/oss/" target="_blank" rel="noopener">é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSå®˜ç½‘</a>ï¼Œé€‰æ‹©æŠ˜æ‰£å¥—é¤.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523213310883.png" alt="image-20200523213310883" style="zoom:50%;" /></p><p>æˆ‘è´­ä¹°çš„æœåŠ¡å¦‚å›¾ï¼Œå¤§æ¦‚ä¸€å¹´9å…ƒ.</p><p>ä¹‹åè¿›å…¥ç®¡ç†æ§åˆ¶å°ï¼Œåœ¨Bucketç®¡ç†ä¸­é€‰æ‹©åˆ›å»ºBucket.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523213700289.png" alt="image-20200523213700289" style="zoom:50%;" /></p><p>è¿™é‡Œæˆ‘é€‰æ‹©çš„Bucketå…·ä½“ç»†èŠ‚å¦‚å›¾ï¼Œå¡«å†™å¥½Bucketåç§°ä¹‹åï¼Œå³å¯å®Œæˆåˆ›å»º.</p><h3 id="PicGoé…ç½®"><a href="#PicGoé…ç½®" class="headerlink" title="PicGoé…ç½®"></a>PicGoé…ç½®</h3><p>ä¸‹è½½PicGoï¼Œå®˜æ–¹ç½‘ç«™ï¼š<a href="https://molunerfinn.com/PicGo/" target="_blank" rel="noopener">https://molunerfinn.com/PicGo/</a>. åœ¨å®˜æ–¹ç½‘ç«™é€‰æ‹©ä¸‹è½½ï¼Œä¹‹åé€‰æ‹©å¯¹åº”ç‰ˆæœ¬ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523214053775.png" alt="image-20200523214053775" style="zoom:50%;" /></p><p>è¿™é‡Œmacç³»ç»Ÿç›´æ¥ä¸‹è½½.dmgæ–‡ä»¶å³å¯</p><p>ä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œé“¾æ¥è‡³æˆ‘ä»¬çš„é˜¿é‡Œäº‘OSS</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/æˆªå±2020-05-23 ä¸‹åˆ9.46.58.png" alt="æˆªå±2020-05-23 ä¸‹åˆ9.46.58" style="zoom:50%;" /></p><ul><li><p>KeyId/KeySecretï¼šé˜¿é‡Œäº‘OSSç®¡ç†æ§åˆ¶å° â€”&gt; Access Key â€”&gt; ä½¿ç”¨Accesskey</p></li><li><p>å­˜å‚¨ç©ºé—´åï¼šå³ä½ åˆšåˆšåˆ›å»ºçš„Bucketåç§°</p></li><li><p>å­˜å‚¨åŒºåŸŸï¼šæŸ¥çœ‹ä½ çš„Bucketè¯¦ç»†ä¿¡æ¯ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523215241237_å‰¯æœ¬.png" alt="image-20200523215241237_å‰¯æœ¬" style="zoom:50%;" /></p></li><li><p>å­˜å‚¨è·¯å¾„ï¼šåœ¨ä½ çš„Bucketç®¡ç†ç•Œé¢ä¸‹ï¼Œé€‰æ‹©æ–‡ä»¶ç®¡ç†ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523215521983.png" alt="image-20200523215521983" style="zoom:50%;" /></p><p>å°†æ–‡ä»¶åä¿å­˜ä¸ºå­˜å‚¨è·¯å¾„ï¼Œæ³¨æ„éœ€è¦ç”¨â€œ/â€åšç»“å°¾</p></li></ul><p>è‡³æ­¤ï¼ŒPicGoé…ç½®å®Œæˆ.</p><h3 id="Typoraé…ç½®"><a href="#Typoraé…ç½®" class="headerlink" title="Typoraé…ç½®"></a>Typoraé…ç½®</h3><p>æ‰“å¼€Typoraåå¥½è®¾ç½®ï¼š</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523225811663.png" alt="image-20200523225811663" style="zoom:50%;" /></p><p>é…ç½®å¦‚å›¾.</p><p>å®Œæˆä»¥ä¸Šé…ç½®åï¼Œæˆ‘ä¹ˆåœ¨ä½¿ç”¨Typoraç¼–å†™æ–‡æ¡£æ—¶ï¼Œåªéœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œå³é”®â€”&gt;ä¸Šä¼ å›¾åƒå³å¯. </p>]]></content>
      
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> hexo </tag>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨hexoæ­å»ºä¸ªäººåšå®¢</title>
      <link href="/2020/05/21/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2020/05/21/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡å¿«é€Ÿç®€æ´çš„åšå®¢æ¡†æ¶<code>hexo</code>æ­å»ºä¸ªäººåšå®¢ï¼Œå¹¶å°†å…¶æ‰˜ç®¡è‡³GitHub pageå¹³å°</p></blockquote><h2 id="ä¸€ã€hexoç®€ä»‹"><a href="#ä¸€ã€hexoç®€ä»‹" class="headerlink" title="ä¸€ã€hexoç®€ä»‹"></a>ä¸€ã€hexoç®€ä»‹</h2><p>â€‹    Hexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ï¼Œä¾èµ–å°‘æ˜“äºå®‰è£…ä½¿ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨GitHubå’ŒCodingä¸Šï¼Œæ˜¯æ­å»ºåšå®¢çš„é¦–é€‰æ¡†æ¶.å› ä¸ºHexoçš„åˆ›å»ºè€…æ˜¯å°æ¹¾äººï¼Œå¯¹ä¸­æ–‡çš„æ”¯æŒå¾ˆå‹å¥½ï¼Œå¯ä»¥é€‰æ‹©ä¸­æ–‡è¿›è¡ŒæŸ¥çœ‹.</p><p>â€‹    å®˜ç½‘ï¼š<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">hexoä¸­æ–‡å®˜ç½‘</a></p><p>â€‹    </p><h2 id="äºŒã€ç¯å¢ƒ"><a href="#äºŒã€ç¯å¢ƒ" class="headerlink" title="äºŒã€ç¯å¢ƒ"></a>äºŒã€ç¯å¢ƒ</h2><p>æ“ä½œç³»ç»Ÿï¼šMacOS Catalina 10.15.4</p><p>Gitç‰ˆæœ¬ï¼šgit version 2.24.3 (Apple Git-128)</p><p>Node.jsç‰ˆæœ¬ï¼šv12.16.2</p><h2 id="ä¸‰ã€ç¯å¢ƒé…ç½®"><a href="#ä¸‰ã€ç¯å¢ƒé…ç½®" class="headerlink" title="ä¸‰ã€ç¯å¢ƒé…ç½®"></a>ä¸‰ã€ç¯å¢ƒé…ç½®</h2><h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><blockquote><p>Node.jsæ˜¯ä¸€ä¸ªåŸºäºChrome V8 å¼•æ“çš„JavaScriptè¿è¡Œæ—¶ç¯å¢ƒ.</p></blockquote><p>ä¸‹è½½åœ°å€ï¼š<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">Node.jsä¸­æ–‡å®˜ç½‘</a></p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200521230154161.png" alt="image-20200521230154161" style="zoom:50%;" /></p><p>æˆ‘ä»¬é€‰æ‹©LTSé•¿æœŸæ”¯æŒç‰ˆï¼ˆæˆªå›¾æ—¶å·²ç»æ›´æ–°è‡³12.16.3ï¼‰ </p><p>Node.jså®‰è£…å®ŒæˆåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†</p><ul><li>Node.jsæœ¬èº«</li><li>npmåŒ…ç®¡ç†å™¨</li></ul><p><strong>ä¸‹è½½å®‰è£…</strong></p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200521235944069.png" alt="image-20200521235944069" style="zoom:50%;" /></p><p>ä¸€ç›´ä¸‹ä¸€æ­¥å³å¯å®Œæˆå®‰è£…</p><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>å› ä¸ºMacOSç³»ç»Ÿåˆå§‹å°±é›†æˆGitï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–è¿›è¡Œå®‰è£….æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéªŒè¯å½“å‰ç³»ç»Ÿæ˜¯å¦å·²ç»å®‰è£…Gitç¯å¢ƒ.</p><p><strong>æ‰“å¼€ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·</strong></p><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git</span><br></pre></td></tr></table></figure><p>å¦‚è‹¥å‡ºç°ä»¥ä¸‹ï¼Œåˆ™è¡¨ç¤ºGitç¯å¢ƒå·²ç»æœ‰æ•ˆ.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200522231946410.png" alt="image-20200522231946410" style="zoom:50%;" /></p><p>å¦‚æœå½“å‰ç³»ç»Ÿä¸­ä¸å…·å¤‡Gitç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡<code>Homebrew</code>åŒ…ç®¡ç†å·¥å…·è¿›è¡ŒGitçš„å®‰è£…å’Œé…ç½®.</p><p><a href="https://brew.sh" target="_blank" rel="noopener">Homebrewå®˜æ–¹ç½‘ç«™</a></p><h3 id="cnpm"><a href="#cnpm" class="headerlink" title="cnpm"></a>cnpm</h3><p>å› ä¸ºæˆ‘ä»¬åœ¨æ­å»ºHexoåšå®¢æ—¶ï¼Œéœ€è¦ä½¿ç”¨npmåŒ…ç®¡ç†å·¥å…·è¿›è¡Œhexoç»„ä»¶çš„ä¸‹è½½å®‰è£…ï¼Œä½†æ˜¯åœ¨å›½å†…npmä¸‹è½½é€Ÿåº¦å¹¶ä¸ç†æƒ³ï¼Œè¿™é‡Œé€šè¿‡npmå®‰è£…cnpmï¼Œcnpmæ˜¯æ·˜å®çš„é•œåƒæºï¼Œä¸‹è½½åŒ…çš„é€Ÿåº¦ä¼šæ›´å¿«ä¸€ç‚¹.</p><p><strong>æ‰“å¼€ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·</strong></p><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=http:<span class="comment">//registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure><p>æŒ‡ä»¤æ‰§è¡Œå®Œæˆï¼ŒéªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm</span><br></pre></td></tr></table></figure><p>å‡ºç°ä»¥ä¸‹ï¼Œè¡¨ç¤ºcnpmå®‰è£…æˆåŠŸ</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200522232905099.png" alt="image-20200522232905099" style="zoom:50%;" /></p><h2 id="å››ã€Hexoé…ç½®"><a href="#å››ã€Hexoé…ç½®" class="headerlink" title="å››ã€Hexoé…ç½®"></a>å››ã€Hexoé…ç½®</h2><p>ä½¿ç”¨cnpmï¼Œå®‰è£…hexo.</p><p><strong>æ‰“å¼€ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·</strong></p><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…å®Œæˆ</p><p>éªŒè¯å®‰è£…å®Œæˆï¼Œè¾“å…¥å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo -v</span><br></pre></td></tr></table></figure><p>å‡ºç°ä»¥ä¸‹ï¼Œè¯æ˜å®‰è£…å®Œæˆ</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523005709944.png" alt="image-20200523005709944" style="zoom:50%;" /></p><p>å¯ä»¥åœ¨ä¸Šå›¾ä¸­äº†è§£åˆ°hexoåŸºäºnode</p><h2 id="äº”ã€ä½¿ç”¨hexoæ­å»ºåšå®¢"><a href="#äº”ã€ä½¿ç”¨hexoæ­å»ºåšå®¢" class="headerlink" title="äº”ã€ä½¿ç”¨hexoæ­å»ºåšå®¢"></a>äº”ã€ä½¿ç”¨hexoæ­å»ºåšå®¢</h2><p>é€‰æ‹©åˆé€‚çš„è·¯å¾„ï¼Œåˆ›å»ºåšå®¢æ–‡ä»¶å¤¹ï¼Œæˆ‘è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹hexoBlogï¼Œæ‰€ä»¥æˆ‘æ¥ä¸‹æ¥çš„æ“ä½œåŸºæœ¬éƒ½æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å®Œæˆçš„.</p><blockquote><p>/Users/liuchanglin/Magic/hexoBlog</p></blockquote><p>æ‰€ä»¥ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ­å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥éšæ—¶åˆ é™¤è¿™ä¸ªæ–‡ä»¶å¤¹é‡æ–°æ¥è¿‡.</p><p><strong>è¿›å…¥<code>/Users/liuchanglin/Magic/hexoBlog</code>ç›®å½•</strong></p><p>æ­å»ºåšå®¢çš„å‘½ä»¤åªéœ€è¦ä¸€ä¸ªï¼Œéå¸¸ç®€å•.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init</span><br></pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…é…ç½®å®Œæˆ(è¿™ä¸€æ­¥é€šå¸¸è€—æ—¶æ¯”è¾ƒé•¿).</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523011010970.png" alt="image-20200523011010970" style="zoom:50%;" /></p><p>å¯ä»¥çœ‹åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹å·²ç»ç”Ÿæˆäº†å¾ˆå¤šæ–‡ä»¶.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523025022016.png" alt="image-20200523025022016" style="zoom:50%;" /></p><p>è¿™äº›éƒ½æ˜¯hexoç”Ÿæˆçš„åšå®¢çš„åŸºæœ¬çš„å†…å®¹.</p><p>è¿™ä¸ªæ—¶å€™è¾“å…¥æŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‡ºç°ä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http:<span class="comment">//localhost:4000 . Press Ctrl+C to stop.</span></span><br></pre></td></tr></table></figure><p>æŒ‰ä½commandé”®ï¼Œç‚¹å‡»é“¾æ¥ï¼Œå³å¯è®¿é—®åœ¨æœ¬åœ°å¯åŠ¨çš„åšå®¢. æŒ‰ctrl+cé”®ç»“æŸè¿›ç¨‹.</p><p>è¿™ä¸ªæœ¬åœ°å¯åŠ¨ä¸€èˆ¬ä½œä¸ºé¢„è§ˆæ¥ä½¿ç”¨.</p><p><img src="https://magic-picgo.oss-cn-beijing.aliyuncs.com/hexoBlog/image-20200523025422530.png" alt="image-20200523025422530" style="zoom:50%;" /></p><p>æ­¤æ—¶å·²ç»ä¸ºä½ å»ºç«‹äº†ä¸€ä¸ª<strong><em>hello word</em></strong>çš„åšæ–‡ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿæ˜¯hexoçš„åŸºæœ¬æ“ä½œ.</p><p>è‡³æ­¤ï¼Œhexoæ­å»ºåšå®¢å·²ç»åˆæ­¥å®Œæˆ.</p><h2 id="å…­ã€hexoçš„åŸºæœ¬æ“ä½œ"><a href="#å…­ã€hexoçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="å…­ã€hexoçš„åŸºæœ¬æ“ä½œ"></a>å…­ã€hexoçš„åŸºæœ¬æ“ä½œ</h2><h3 id="æ–°å»ºæ–‡ç« "><a href="#æ–°å»ºæ–‡ç« " class="headerlink" title="æ–°å»ºæ–‡ç« "></a>æ–°å»ºæ–‡ç« </h3><p>æ–°å»ºæ–‡ç« ä½¿ç”¨å‘½ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo n <span class="string">"åšå®¢title"</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œå°±ä¼šåœ¨å½“å‰åšå®¢æ–‡ä»¶å¤¹ä¸‹çš„source/_postsæ–‡ä»¶å¤¹ä¸­å‡ºç°ä¸€ä¸ª.mdçš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯åšå®¢æ–‡ç« æ–‡ä»¶äº†ï¼Œå› ä¸ºhexoæ˜¯å¯ä»¥ä½¿ç”¨markdownè¯­æ³•è¿›è¡Œåšå®¢çš„æ’°å†™ï¼Œä¹Ÿæ˜¯ååˆ†æ–¹ä¾¿.</p><h3 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h3><p>æ¸…ç†hexoäº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶ã€é™æ€æ–‡ä»¶.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br></pre></td></tr></table></figure><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>åœ¨hexoæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆpublicæ–‡ä»¶å¤¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g</span><br></pre></td></tr></table></figure><h3 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h3><p>hexoæ”¯æŒæ›´æ¢ä¸»é¢˜ï¼Œå¯ä»¥åœ¨hexoå®˜ç½‘çš„ä¸»é¢˜åˆ†ç±»ä¸‹é€‰æ‹©ä¸»é¢˜è¿›è¡Œé…ç½®.</p><p><a href="https://hexo.io/themes/" target="_blank" rel="noopener">ä¸»é¢˜ç½‘ç«™</a></p><p>åœ¨ä¸»é¢˜ç½‘ç«™ä¸Šé€‰å–ä¸»é¢˜ä¹‹åï¼Œè®¿é—®å…¶githubä»“åº“ï¼Œä½¿ç”¨gitå°†å…¶pullåˆ°hexoåšå®¢æ–‡ä»¶å¤¹ä¸­çš„themeæ–‡ä»¶å¤¹ä¸­.</p><p>è¿›å…¥ themes æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨å‘½ä»¤.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone <span class="string">"é¡¹ç›®åœ°å€"</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆåï¼Œæ–°å¢ä¸€ä¸ªåç§°ä¸ºä¸»é¢˜åç§°çš„æ–‡ä»¶å¤¹.</p><p><strong>é…ç½®_config.yml</strong></p><p>æ‰“å¼€_config.ymlï¼Œå¯ä»¥ä½¿ç”¨vimç¼–è¾‘å™¨æˆ–è€…vs codeç­‰å…¶ä»–å·¥å…·æ‰“å¼€.</p><p>æˆ‘è¿™é‡Œé€‰æ‹©ä½¿ç”¨vs code</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">landscape</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">''</span></span><br></pre></td></tr></table></figure><p>ymlæœ«å°¾çš„themeå±æ€§ï¼Œå°†landscapeï¼ˆåˆå§‹ä¸»é¢˜ï¼‰ä¿®æ”¹ä¸ºthemesæ–‡ä»¶å¤¹ä¸­æ–°çš„ä¸»é¢˜æ–‡ä»¶å¤¹åç§°ï¼Œä¿å­˜.</p><p><strong>æ¸…ç†</strong>ã€<strong>æ„å»º</strong></p><p>å³å¯å®Œæˆä¸»é¢˜çš„ä¿®æ”¹.</p>]]></content>
      
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> hexo </tag>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>markdown Grammar tutorial</title>
      <link href="/2020/04/26/markdown-Grammar-tutorial/"/>
      <url>/2020/04/26/markdown-Grammar-tutorial/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdownå¸¸ç”¨åŸºç¡€è¯­æ³•"><a href="#Markdownå¸¸ç”¨åŸºç¡€è¯­æ³•" class="headerlink" title="Markdownå¸¸ç”¨åŸºç¡€è¯­æ³•"></a>Markdownå¸¸ç”¨åŸºç¡€è¯­æ³•</h1><p>å…ˆæƒ³æƒ³æˆ‘ä»¬ä¸€èˆ¬å†™ä½œæ—¶å€™éœ€è¦ç”¨åˆ°ä»€ä¹ˆæ ·çš„æ’ç‰ˆï¼Ÿ</p><p>æ— éå°±æ˜¯æ ‡é¢˜ã€å¼•ç”¨ã€å¼ºè°ƒï¼ˆåŠ ç²—ã€æ–œä½“ã€ä¸‹åˆ’çº¿ï¼‰ã€æ’å…¥é“¾æ¥ã€æ’å…¥å›¾ç‰‡ã€åˆ—è¡¨ï¼ˆæœ‰åºå’Œæ— åºåˆ—è¡¨ï¼‰ï¼Œç”šè‡³è¿è¡¨æ ¼éƒ½å¾ˆå°‘ç”¨ã€‚</p><p><strong>æ ‡é¢˜è¯­æ³•</strong></p><p>Markdownä¸€å…±æ”¯æŒ6ä¸ªçº§åˆ«å¤§å°çš„æ ‡é¢˜ï¼ˆå¯¹åº”äºHTMLè¯­æ³•é‡Œçš„h1~h6ï¼‰ï¼Œå†™æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æ–‡å­—å‰ç©ºä¸€æ ¼åŠ ä¸Š#å·å°±è¡Œï¼Œå‡ ä¸ª#å·å°±æ˜¯å‡ çº§æ ‡é¢˜ï¼Œå¤§å°ç”±å¤§åˆ°å°ã€‚</p><p># ç¬¬ä¸€çº§æ ‡é¢˜ <code>&lt;h1&gt;</code> </p><p>## ç¬¬äºŒçº§æ ‡é¢˜ <code>&lt;h2&gt;</code> </p><p>###### ç¬¬å…­çº§æ ‡é¢˜ <code>&lt;h6&gt;</code></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><h1 id="ç¬¬ä¸€çº§æ ‡é¢˜"><a href="#ç¬¬ä¸€çº§æ ‡é¢˜" class="headerlink" title="ç¬¬ä¸€çº§æ ‡é¢˜"></a>ç¬¬ä¸€çº§æ ‡é¢˜</h1><h2 id="ç¬¬äºŒçº§æ ‡é¢˜"><a href="#ç¬¬äºŒçº§æ ‡é¢˜" class="headerlink" title="ç¬¬äºŒçº§æ ‡é¢˜"></a>ç¬¬äºŒçº§æ ‡é¢˜</h2><h6 id="ç¬¬å…­çº§æ ‡é¢˜"><a href="#ç¬¬å…­çº§æ ‡é¢˜" class="headerlink" title="ç¬¬å…­çº§æ ‡é¢˜"></a>ç¬¬å…­çº§æ ‡é¢˜</h6><p><strong>å¼•ç”¨è¯­æ³•</strong></p><p>å¦‚æœä½ æƒ³å¼•ç”¨ä¸€æ®µæ–‡å­—ï¼Œé‚£å°±ä½¿ç”¨å¤§äºå·&gt;</p><blockquote><p>è¿™æ˜¯ä¸€æ®µå¼•ç”¨</p><p>è¿™æ˜¯å¦ä¸€æ®µå¼•ç”¨</p></blockquote><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><blockquote><p>è¿™æ˜¯ä¸€æ®µå¼•ç”¨</p><p>è¿™æ˜¯å¦ä¸€æ®µå¼•ç”¨</p></blockquote><p><strong>å¼ºè°ƒè¯­æ³•</strong></p><p><strong>ç²—ä½“</strong></p><p>å¦‚æœä½ æƒ³åŠ ç²—ä¸€æ®µæ–‡å­—ï¼Œåªéœ€è¦åœ¨æ–‡å­—å‰ååŠ ä¸¤ä¸ª*å·</p><p><strong> æˆ‘å¾ˆé‡è¦ï¼</strong></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><strong>æˆ‘å¾ˆé‡è¦å“¦ï¼</strong></p><p><strong>æ–œä½“ </strong></p><p>å¦‚æœä½ æƒ³è®©ä¸€æ®µæ–‡å­—å€¾æ–œï¼Œåªéœ€è¦åœ¨æ–‡å­—å‰ååŠ ä¸€ä¸ªæ˜Ÿå·*</p><p><em>æˆ‘æ˜¯æ¯”è¨æ–œå¡” </em></p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><em>æˆ‘æ˜¯æ¯”è¨æ–œå¡”</em></p><p><strong>ä¸‹åˆ’çº¿</strong></p><p>å¦‚æœä½ æƒ³è®©ä¸€æ®µæ–‡å­—åŠ ä¸Šä¸‹åˆ’çº¿ï¼Œåªéœ€è¦åœ¨æ–‡å­—å‰ååŠ ä¸€ä¸ªä¸‹åˆ’çº¿_</p><p>_ äººæ˜¯ç¤¾ä¼šæ€§åŠ¨ç‰©_</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p>_äººæ˜¯ç¤¾ä¼šæ€§åŠ¨ç‰©_</p><p><strong>åˆ é™¤çº¿</strong></p><p>å¦‚æœä½ æƒ³è®©ä¸€æ®µæ–‡å­—åŠ ä¸Šåˆ é™¤çº¿æ•ˆæœï¼Œåªéœ€è¦åœ¨æ–‡å­—å‰ååŠ ä¸€ä¸ªæ³¢æµªçº¿~</p><p>~~ æˆ‘æ‰€è¯´çš„éƒ½æ˜¯é”™çš„~~</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><del>æˆ‘æ‰€è¯´çš„éƒ½æ˜¯é”™çš„</del></p><p><strong>æ’å…¥é“¾æ¥</strong></p><p>å¦‚æœä½ æƒ³æŠŠä¸€æ®µæ–‡å­—åŠ ä¸Šé“¾æ¥æŒ‡å‘åˆ°æŸä¸ªç½‘å€ï¼Œå°±æŠŠæ–‡å­—ç”¨ä¸­æ‹¬å·å›´èµ·æ¥[]ï¼Œç„¶ååŠ ä¸Šä¸€ä¸ªå°æ‹¬å·()ï¼Œæ‹¬å·é‡Œå¡«ä¸Šç½‘å€å³å¯ã€‚</p><p>[å‘é˜³ä¹”æœ¨çš„åšå®¢] (<a href="http://tuijiankan.com" target="_blank" rel="noopener">http://tuijiankan.com</a>)</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><a href="https://link.zhihu.com/?target=http%3A//tuijiankan.com">å‘é˜³ä¹”æœ¨çš„åšå®¢</a></p><p><strong>æ’å…¥å›¾ç‰‡</strong></p><p>æ’å…¥å›¾ç‰‡çš„è¯­æ³•å’Œæ’å…¥é“¾æ¥å¾ˆåƒï¼Œå°±æ˜¯åœ¨å‰é¢åŠ äº†ä¸€ä¸ªå¹å·!ï¼Œæ³¨æ„ï¼šå¹å·æ˜¯è‹±æ–‡å¹å·ã€‚</p><p>![ç™¾åº¦æœç´¢] (<a href="https://www.baidu.com/img/bd_logo1.png" target="_blank" rel="noopener">https://www.baidu.com/img/bd_logo1.png</a>)</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="data:image/png;base64,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" alt="img"></p><p><strong>åˆ—è¡¨</strong></p><p>åˆ—è¡¨åˆ†ä¸ºæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ï¼Œä»€ä¹ˆæ˜¯æœ‰åºåˆ—è¡¨å‘¢ï¼Ÿå°±æ˜¯1ã€2ã€3é¡ºåºæ’å¼€ã€‚</p><p><strong>æœ‰åºåˆ—è¡¨</strong></p><p>è¯­æ³•å¦‚ä¸‹ï¼Œæ³¨æ„ï¼šæ•°å­—ååŠ ç‚¹. å†ç©ºä¸€æ ¼å†™å†…å®¹ã€‚</p><p>\1. æŠŠå†°ç®±é—¨æ‰“å¼€</p><p>\2. æŠŠå¤§è±¡æ”¾è¿›å»</p><p>\3. å…³ä¸Šå†°ç®±é—¨</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><ol><li>æŠŠå†°ç®±é—¨æ‰“å¼€</li><li>æŠŠå¤§è±¡æ”¾è¿›å»</li><li>å…³ä¸Šå†°ç®±é—¨</li></ol><p><strong>æ— åºåˆ—è¡¨</strong></p><p>æ— åºåˆ—è¡¨åªéœ€è¦åœ¨æ–‡å­—å‰é¢åŠ ä¸Šå‡å·-å°±è¡Œã€‚ï¼ˆæ˜Ÿå·*æˆ–åŠ å·+ä¹Ÿå¯ä»¥ï¼Œçœ‹ä¸ªäººå–œå¥½ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨å‡å·ï¼‰</p><p>- æŠŠå†°ç®±é—¨æ‰“å¼€</p><p>- æŠŠå¤§è±¡æ”¾è¿›å»</p><p>- å…³ä¸Šå†°ç®±é—¨</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>æŠŠå†°ç®±é—¨æ‰“å¼€</li><li>æŠŠå¤§è±¡æ”¾è¿›å»</li><li>å…³ä¸Šå†°ç®±é—¨</li></ul><p><strong>å…¶ä»–æ ‡è®°</strong></p><p><strong>æ¢è¡Œ</strong></p><p>å½“ä½ å†™å¤§æ®µæ–‡æœ¬åˆ†æ®µçš„æ—¶å€™ï¼Œåªæ˜¯å›è½¦æ¢è¡Œæ˜¯ä¸è¡Œçš„ï¼Œæœ‰äº›è§£é‡Šå™¨å‡ºæ¥çš„æ•ˆæœä¼šè®©æ–‡å­—è¿åœ¨ä¸€èµ·ã€‚</p><p>æ®µè½ä¸æ®µè½ä¹‹é—´éœ€è¦å¼ºåˆ¶ç©ºä¸€è¡Œæ‰èƒ½åˆ†æ®µã€‚</p><p><strong>åˆ†å‰²çº¿</strong></p><p>ä½ å¯ä»¥åœ¨ä¸€è¡Œä¸­ä½¿ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„æ˜Ÿå·*æˆ–å‡å·-æ¥åˆ›å»ºåˆ†å‰²çº¿ï¼ˆæ³¨æ„ï¼šè¡Œå†…ä¸èƒ½æœ‰å…¶ä»–ä¸œè¥¿ï¼‰</p><p>-â€”</p><hr><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><hr><hr><p><strong>Markdowné«˜çº§è¯­æ³•</strong></p><p>è¿˜æœ‰ä¸€äº›ä¸å¤ªå¸¸ç”¨çš„è¯­æ³•ï¼Œæ¯”å¦‚æ’å…¥ä»£ç åŒºå—ã€æ’å…¥è¡¨æ ¼ç­‰ç­‰ã€‚</p><p><strong>ä»£ç åŒºå—</strong></p><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œéœ€è¦åˆ†äº«è‡ªå·±çš„ä»£ç ï¼Œé‚£å°±éœ€è¦åˆ›å»ºä»£ç åŒºå—ï¼Œå¦‚æœåƒæ™®é€šçš„æ®µè½ä¸€æ ·æ˜¾ç¤ºï¼Œæ ¼å¼å¯èƒ½ä¼šå¾ˆç³Ÿç³•ã€‚</p><p>å½“ç„¶ï¼ŒæŠŠæ•´å—æ–‡æœ¬æ”¾åŒºå—é‡Œä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚æœ¬æ–‡çš„è¯­æ³•è§£é‡Šéƒ¨åˆ†ã€‚</p><p>è¯­æ³•ï¼šéœ€è¦æ•´ä½“å†…å®¹ç¼©è¿› 4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆtabï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">'bluebird'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> request = <span class="built_in">Promise</span>.promisify(<span class="built_in">require</span>(<span class="string">'request'</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="built_in">require</span>(<span class="string">"underscore.string"</span>);</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨å¦å¤–ä¸€ç§å†™æ³•ï¼Œå°±æ˜¯åœ¨ä»£ç å‰åä½ç½®åŠ ä¸Šä¸‰ä¸ªåå¼•å·`ï¼ˆæ•°å­—é”®ç›˜1å·¦è¾¹é‚£ä¸ªæŒ‰é”®ï¼‰</p><p>å¦‚æœæ˜¯è¡Œå†…ä»£ç å¼•ç”¨çš„è¯ï¼Œåªéœ€è¦åœ¨ä»£ç å‰ååŠ ä¸Šä¸€ä¸ªåå¼•å·`ã€‚</p><p>Use the <code>whoisyourdaddy()</code> function.</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p>Use the <code>whoisyourdaddy()</code> function.</p><p><strong>æ’å…¥è¡¨æ ¼</strong></p><p>Markdownæ’å…¥è¡¨æ ¼çš„è¯­æ³•ç›¸å¯¹å¤æ‚ï¼Œå¿…é¡»è¦æŒ‰æ ¼å¼æ¥æ•²ï¼Œæ³¨æ„è¡¨å¤´ä¸å†…å®¹çš„åˆ†å‰²çº¿æ¨ªçº¿-ä¸èƒ½å°‘äº3ä¸ªã€‚</p><p>ç¬¬ä¸€æ ¼è¡¨å¤´ | ç¬¬äºŒæ ¼è¡¨å¤´</p><p>â€”- | â€”-</p><p>å†…å®¹å•å…ƒæ ¼ ç¬¬ä¸€åˆ—ç¬¬ä¸€æ ¼ | å†…å®¹å•å…ƒæ ¼ç¬¬äºŒåˆ—ç¬¬ä¸€æ ¼</p><p>å†…å®¹å•å…ƒæ ¼ ç¬¬ä¸€åˆ—ç¬¬äºŒæ ¼ å¤šåŠ æ–‡å­— | å†…å®¹å•å…ƒæ ¼ç¬¬äºŒåˆ—ç¬¬äºŒæ ¼</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>]]></content>
      
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/04/26/hello-world/"/>
      <url>/2020/04/26/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
